
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="FlitSoft Documents">
      
      
        <meta name="author" content="flitsoftdoc">
      
      
        <link rel="canonical" href="https://flitsoftdoc.github.io/Gaming/Behavior%20Tree/BehaviorTree.CPP%204.6%20ch/">
      
      
        <link rel="prev" href="../Behavior%20Trees%20in%20Robot%20Control%20Systems.ch/">
      
      
        <link rel="next" href="../BT2208.04211v2.ch/">
      
      
      <link rel="icon" href="/assets/logo/grid.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>BehaviorTree.CPP库 - FlitSoft Doc Hub</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../../stylesheets/pseudo-code.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-XX66BVLPNX"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-XX66BVLPNX",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-XX66BVLPNX",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#behaviortreecpp" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="FlitSoft Doc Hub" class="md-header__button md-logo" aria-label="FlitSoft Doc Hub" data-md-component="logo">
      
  <img src="/assets/logo/grid.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            FlitSoft Doc Hub
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              BehaviorTree.CPP库
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/flitsoftdoc/flitsoftdoc.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    flitsoftdoc/flitsoftdoc.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../UAS/" class="md-tabs__link">
          
  
  
    
  
  UAS

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../EM/" class="md-tabs__link">
          
  
  
    
  
  EM

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../AI/" class="md-tabs__link">
          
  
  
    
  
  AI

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
    
  
  Decision

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../C2/" class="md-tabs__link">
          
  
  
    
  
  NGC3

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Simu/" class="md-tabs__link">
          
  
  
    
  
  Simulation

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Visual/" class="md-tabs__link">
          
  
  
    
  
  Visualization

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../blog/" class="md-tabs__link">
          
  
  
    
  
  Blog

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="FlitSoft Doc Hub" class="md-nav__button md-logo" aria-label="FlitSoft Doc Hub" data-md-component="logo">
      
  <img src="/assets/logo/grid.png" alt="logo">

    </a>
    FlitSoft Doc Hub
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/flitsoftdoc/flitsoftdoc.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    flitsoftdoc/flitsoftdoc.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../UAS/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    UAS
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            UAS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" >
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Formation Control
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            Formation Control
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UAS/Formation%20Control/%E5%9B%BA%E5%AE%9A%E7%BF%BC%E6%97%A0%E4%BA%BA%E6%9C%BA%E9%98%B5%E5%9E%8B%E5%8F%98%E6%8D%A2%E8%BF%87%E6%B8%A1%E8%BD%A8%E8%BF%B9%E7%94%9F%E6%88%90/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    固定翼无人机阵型变换过渡轨迹生成
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UAS/Formation%20Control/%E5%9F%BA%E4%BA%8E%E9%9D%9E%E7%BA%BF%E6%80%A7%E6%A8%A1%E5%9E%8B%E9%A2%84%E6%B5%8B%E6%8E%A7%E5%88%B6%E7%9A%84%E6%97%A0%E4%BA%BA%E6%9C%BA%E7%BC%96%E9%98%9F%E9%A3%9E%E8%A1%8C/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    基于非线性模型预测控制的无人机编队飞行
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UAS/Formation%20Control/%E6%97%A0%E4%BA%BA%E6%9C%BA%E9%9B%86%E7%BE%A4%E5%9B%BA%E5%AE%9A%E9%98%B5%E5%9E%8B%E8%BD%A8%E8%BF%B9%E7%94%9F%E6%88%90%E6%A8%A1%E5%9E%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    无人机集群固定阵型轨迹生成模型
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" >
        
          
          <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Fix wing uav flight sim
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            Fix wing uav flight sim
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UAS/fix_wing_uav_flight_sim/fix_wing_uav_flight_sim/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    小型固定翼无人机飞行动力学模型
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UAS/fix_wing_uav_flight_sim/JSBSim_Quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JSBSim Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UAS/fix_wing_uav_flight_sim/JSBSim_User_manual/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JSBSim 用户手册
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UAS/fix_wing_uav_flight_sim/StandaloneLaeroModel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    轻量级飞行动力学模型
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_4" >
        
          
          <label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Navigation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_4">
            <span class="md-nav__icon md-icon"></span>
            Navigation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UAS/navigation/scirobotics.ado6187.ch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    面向微型无人机的安全保障高速导航
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_5" >
        
          
          <label class="md-nav__link" for="__nav_1_5" id="__nav_1_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Path Searching
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_5">
            <span class="md-nav__icon md-icon"></span>
            Path Searching
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_5_1" >
        
          
          <label class="md-nav__link" for="__nav_1_5_1" id="__nav_1_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    A* Search
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_5_1">
            <span class="md-nav__icon md-icon"></span>
            A* Search
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UAS/Path%20Searching/A%2A%20Search/A%2A%20Path%20Searching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    基于运动基元的A*算法
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_6" >
        
          
          <label class="md-nav__link" for="__nav_1_6" id="__nav_1_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Trajectory Planning
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_6">
            <span class="md-nav__icon md-icon"></span>
            Trajectory Planning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UAS/Trajectory_Planning/Key%20of%20Trajectory%20Manage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    轨迹管理的几个关键问题
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_6_2" >
        
          
          <label class="md-nav__link" for="__nav_1_6_2" id="__nav_1_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
     B spline
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_6_2">
            <span class="md-nav__icon md-icon"></span>
             B spline
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UAS/Trajectory_Planning/%20B-spline/%E9%9A%9C%E7%A2%8D%E7%8E%AF%E5%A2%83%E4%B8%8BB%E6%A0%B7%E6%9D%A1%E8%BD%A8%E8%BF%B9%E9%97%AE%E9%A2%98%E8%A7%A3%E6%9E%90/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    障碍环境下B样条轨迹问题解析
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UAS/Trajectory_Planning/%20B-spline/%E9%9A%9C%E7%A2%8D%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%9B%BA%E5%AE%9A%E7%BF%BC%E6%97%A0%E4%BA%BA%E6%9C%BAB%20%E6%A0%B7%E6%9D%A1%E9%81%BF%E9%9A%9C%E8%BD%A8%E8%BF%B9%E7%94%9F%E6%88%90%E7%AE%97%E6%B3%95/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    固定翼无人机B 样条避障轨迹生成
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_6_3" >
        
          
          <label class="md-nav__link" for="__nav_1_6_3" id="__nav_1_6_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cubic Polynomial Curve
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_6_3">
            <span class="md-nav__icon md-icon"></span>
            Cubic Polynomial Curve
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UAS/Trajectory_Planning/Cubic%20Polynomial%20Curve/Cubic%20Polynomial%20Curve%20Trajectory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    用于轨迹规划的三次样条插值
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_6_4" >
        
          
          <label class="md-nav__link" for="__nav_1_6_4" id="__nav_1_6_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Kappa trajectories
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_6_4">
            <span class="md-nav__icon md-icon"></span>
            Kappa trajectories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UAS/Trajectory_Planning/kappa-trajectories/kappa-%E8%BD%A8%E8%BF%B9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    κ轨迹平滑
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UAS/Trajectory_Planning/kappa-trajectories/kappa%E8%BD%A8%E8%BF%B9%E7%82%B9%E7%94%9F%E6%88%90C%2B%2B%E4%BB%A3%E7%A0%81%E8%AF%B4%E6%98%8E/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    κ轨迹点生成代码说明
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UAS/Trajectory_Planning/kappa-trajectories/Real-time_dynamic_trajectory_smoothing_for_unmanne%20ch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    无人机实时动态轨迹平滑
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UAS/Trajectory_Planning/kappa-trajectories/%E7%AD%89%E9%95%BF%E8%BD%A8%E8%BF%B9kappa%E6%B1%82%E8%A7%A3%E7%AE%97%E6%B3%95/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    等长轨迹κ求解算法设计
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_7" >
        
          
          <label class="md-nav__link" for="__nav_1_7" id="__nav_1_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Velocity Plan
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_7">
            <span class="md-nav__icon md-icon"></span>
            Velocity Plan
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UAS/Velocity_Plan/%E4%B8%89%E6%AE%B5S%E6%9B%B2%E7%BA%BF%E9%80%9F%E5%BA%A6%E8%A7%84%E5%88%92%E6%A8%A1%E5%9E%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    三段S曲线速度规划模型
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../EM/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    EM
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            EM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Antenna Pattern
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Antenna Pattern
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../EM/Antenna%20Pattern/01.%E8%BE%9B%E6%A0%BC%E6%96%B9%E5%90%91%E5%9B%BE%E6%A8%A1%E5%9E%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    辛格方向图模型
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../EM/Antenna%20Pattern/02.%E9%AB%98%E6%96%AF%E6%96%B9%E5%90%91%E5%9B%BE%E6%A8%A1%E5%9E%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    高斯方向图模型
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Comm
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Comm
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../EM/Comm/%E5%9C%B0%E7%A9%BA%E6%B5%8B%E6%8E%A7%E9%93%BE%E8%B7%AF%E8%AE%A1%E7%AE%97%E6%A8%A1%E5%9E%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    地空测控链路计算模型
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Radar
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Radar
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../EM/Radar/%E6%97%A0%E6%BA%90%E4%BE%A6%E5%AF%9F%E6%B5%8B%E5%90%91%E5%AE%9A%E4%BD%8D%E6%A8%A1%E5%9E%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    无源侦察测向定位模型
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../EM/Radar/%E9%9B%B7%E8%BE%BE%E5%AF%B9%E6%8A%97%E4%BE%A6%E5%AF%9F%E6%95%88%E8%83%BD%E6%A8%A1%E5%9E%8B%EF%BC%88%E7%A9%BA%E5%AF%B9%E5%9C%B0%EF%BC%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    空对地雷达对抗侦察效能模型
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../EM/Radar/%E9%9B%B7%E8%BE%BE%E5%AF%B9%E6%8A%97%E4%BE%A6%E5%AF%9F%E9%80%9A%E7%94%A8%E4%BE%A6%E5%AF%9F%E6%A8%A1%E5%9E%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    雷达对抗侦察效能通用模型
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../EM/Radar/%E9%9B%B7%E8%BE%BE%E5%B9%B2%E6%89%B0%E6%95%88%E8%83%BD%E6%A8%A1%E5%9E%8Bv3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    雷达干扰效能模型
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../EM/Radar/%E9%9B%B7%E8%BE%BE%E6%8E%A2%E6%B5%8B%E8%B7%9D%E7%A6%BB%E7%A6%BB%E7%BA%BF%E8%AE%A1%E7%AE%97%E5%99%A8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    雷达探测距离计算器
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_6" >
        
          
          <label class="md-nav__link" for="__nav_2_4_6" id="__nav_2_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Radar Equations for Modern Radar
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_6">
            <span class="md-nav__icon md-icon"></span>
            Radar Equations for Modern Radar
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../EM/Radar/Radar%20Equations%20for%20Modern%20Radar/Radar%20Equations%20for%20MR%20ch01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    第1章 雷达方程的发展
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../EM/Radar/Radar%20Equations%20for%20Modern%20Radar/Radar%20Equations%20for%20MR%20ch02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    第2章 搜索雷达方程
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../EM/Radar/Radar%20Equations%20for%20Modern%20Radar/Radar%20Equations%20for%20MR%20ch03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    第3章 杂波与干扰压制下的雷达方程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../AI/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    AI
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            AI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../AI/Americas-AI-Action-Plan/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Americas AI Action Plan
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../AI/Foundation%20models%20and%20intelligent%20decision-making/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Foundation models and intelligent decision making
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../AI/LoRA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LoRA
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../AI/MARLlib/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MARLlib
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../AI/Why%20We%20Think%20ch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Why We Think
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Decision
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Decision
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Comparative%20Analysis%20of%20Task%20Allocation%20Algorithms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    多无人机任务分配算法的比较分析
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DAVIS_OCEANS_2025_PDF_XPRESS%20ch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    面向无人水面艇探测的传感器套件设计框架
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Multi-UAV%20Task%20Assignment%20in%20Dynamic%20Environments%20ch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    动态环境下多无人机任务分配技术现状
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Policy%20Space%20Response%20Oracles-%20A%20Survey/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    策略空间响应预言机 PSRO
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Towards%20Global%20Explainability%20of%20Artificial%20Intelligence%20Agent%20Tactics%20in%20Close%20Air%20Combat%20ch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    面向近距离空战中人工智能智能体战术的全局可解释性
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7" checked>
        
          
          <label class="md-nav__link" for="__nav_4_7" id="__nav_4_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Behavior Tree
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            Behavior Tree
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Behavior%20Trees%20in%20Robot%20Control%20Systems.ch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    行为树在机器人控制系统中的应用
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    BehaviorTree.CPP库
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    BehaviorTree.CPP库
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#behaviortreecpp_1" class="md-nav__link">
    <span class="md-ellipsis">
      核心内容：BehaviorTree.CPP 是什么？
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      主要特点和优势
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#behaviortreecpp_2" class="md-nav__link">
    <span class="md-ellipsis">
      谁会使用 BehaviorTree.CPP？
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#behaviortreecpp-46" class="md-nav__link">
    <span class="md-ellipsis">
      BehaviorTree.CPP 4.6
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../BT2208.04211v2.ch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    机器人应用中的行为树和状态机
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Generation%20of%20Behavior%20Trees%20for%20Dynamic%20Agents%20Based%20on%20Market%20Inspired%20Task%20Allocation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    基于市场启发的任务分配的动态智能体行为树生成
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../LLM-BRAIn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LLM-BRAIn: 基于LLM驱动的行为树快速生成方
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%A1%8C%E4%B8%BA%E6%A0%91%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    行为树基本概念
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../C2/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    NGC3
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            NGC3
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../C2/Advanced%20Battle%20Management%20System/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    先进战斗管理系统 (ABMS)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../C2/AEP-84%20VOLI%20EDA%20V1%20ch-all/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    北约工程出版物 AEP-84 Volume I
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../C2/Decision%20Advantage%20and%20Initiative%20Completing%20Joint%20All-Domain%20Command%20and%20Control.ch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    决策优势与主动权
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../C2/Force-Based%20MANET_FANET/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    基于力的无人机蜂群自组织MANET/FANET
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../Simu/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Simulation
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Simulation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Simu/HIL%20Swarm%20Simulation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HIL Swarm Simulation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Simu/MARSIM%3A%20A%20point-realistic%20simulator%20for%20LiDAR-based%20UAVs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MARSIM: A light-weight point-realistic simulator for LiDAR-based UAVs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Simu/OctoMap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OctoMap
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Simu/The%20Mixed%20Reality%20Simulation%20Platform%20%28MIXR%29%20ch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MIXR 混合现实仿真平台
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Simu/ZMQ%20guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ZMQ guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Simu/%E6%97%A0%E4%BA%BA%E6%9C%BA%E8%9C%82%E7%BE%A4%E6%99%BA%E8%83%BD%E8%AE%AD%E7%BB%83%E5%B9%B3%E5%8F%B0%E8%AE%BE%E8%AE%A1.v1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    蜂群算法训练平台设计方案
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_8" >
        
          
          <label class="md-nav__link" for="__nav_6_8" id="__nav_6_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    AFSIM
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_8">
            <span class="md-nav__icon md-icon"></span>
            AFSIM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Simu/AFSIM/AFSIM.cn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AFSIM Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Simu/AFSIM/AFSIM%20Version%202.0%20TECHNICAL%20REFERENCE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AFSIM V2.0 TECHNICAL REFERENCE
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Simu/AFSIM/afsims-pseudo-realtime-hybrid-simulation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AFSIM 的伪实时混合仿真软件设计
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_9" >
        
          
          <label class="md-nav__link" for="__nav_6_9" id="__nav_6_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    SIMDIS
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_9">
            <span class="md-nav__icon md-icon"></span>
            SIMDIS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Simu/SIMDIS/SIMDIS%20SDK/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SIMDIS SDK 架构分析
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Simu/SIMDIS/SIMDIS%20SDK%20SimCore%20v2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SIMDIS SDK SimCore代码库分析
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Simu/SIMDIS/SIMDIS_Briefing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SIMDIS Briefing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../Visual/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Visualization
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Visualization
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Visual/TacView/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tacview Technical Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Visual/%E5%9F%BA%E4%BA%8ESIMDIS%20SDK%E4%B8%8EOSG%E7%9A%843D%E5%8F%AF%E8%A7%86%E5%8C%96%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E7%BB%BC%E5%90%88%E5%AE%9E%E6%96%BD%E6%8C%87%E5%8D%97/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SIMDIS SDK与OSG
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../blog/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Blog
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2" >
        
          
          <label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Archive
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/archive/2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2025
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_3" >
        
          
          <label class="md-nav__link" for="__nav_8_3" id="__nav_8_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Categories
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/category/analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/category/notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Notes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#behaviortreecpp_1" class="md-nav__link">
    <span class="md-ellipsis">
      核心内容：BehaviorTree.CPP 是什么？
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      主要特点和优势
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#behaviortreecpp_2" class="md-nav__link">
    <span class="md-ellipsis">
      谁会使用 BehaviorTree.CPP？
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#behaviortreecpp-46" class="md-nav__link">
    <span class="md-ellipsis">
      BehaviorTree.CPP 4.6
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  
    
      
    
    <a href="https://github.com/flitsoftdoc/flitsoftdoc.github.io/raw/main/docs/Gaming/Behavior Tree/BehaviorTree.CPP 4.6 ch.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="behaviortreecpp">BehaviorTree.CPP库<a class="headerlink" href="#behaviortreecpp" title="Permanent link">&para;</a></h1>
<p><a href="https://www.behaviortree.dev/">https://www.behaviortree.dev/</a>  是学习和使用 BehaviorTree.CPP 库的官方入口。它不仅提供了这个强大的C++库，还围绕它构建了一个完整的生态系统，包括了革命性的可视化编辑和监控工具 Groot2。 BehaviorTree.CPP作为一个强大、灵活且高效的工具来设计复杂的行为逻辑，适合在机器人、自动化或相关AI领域选择使用。</p>
<h3 id="behaviortreecpp_1"><strong>核心内容：BehaviorTree.CPP 是什么？</strong><a class="headerlink" href="#behaviortreecpp_1" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>一个C++库</strong>：它是一个功能齐全的C++库，让开发者可以方便地构建、执行和调试行为树。</li>
<li><strong>专注于任务执行</strong>：与传统的有限状态机（Finite State Machines）不同，行为树更关注于“如何执行一个动作”，而不是“在不同状态间切换”。这使得它在处理复杂任务时更加灵活和强大。</li>
<li><strong>专为机器人设计</strong>：虽然行为树可以用在很多领域，但 BehaviorTree.CPP 特别针对机器人的需求进行了优化，例如任务规划、导航、操作等。</li>
</ul>
<h3 id="_1"><strong>主要特点和优势</strong><a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>组合性 (Composability)</strong>：</p>
<ul>
<li>您可以创建简单的、可复用的行为（例如“移动到A点”、“抓取物体”），然后像搭积木一样将它们组合成复杂的、有层次结构的行为树（例如“找到并拿起一个物体，然后将它送到B点”）。</li>
<li>这种模块化的方法使得代码更容易维护和扩展。</li>
</ul>
</li>
<li>
<p><strong>C++的性能 + 脚本的灵活性</strong>：</p>
<ul>
<li>核心的行为节点（Action Nodes）用高性能的C++编写，确保了执行效率。</li>
<li>而整个行为树的逻辑结构则可以通过简单的 <strong>XML 文件</strong>来定义和修改。这意味着您可以随时调整机器人的行为，而<strong>无需重新编译C++代码</strong>，极大地加快了开发和调试的速度。</li>
</ul>
</li>
<li>
<p><strong>强大的生态系统和工具</strong>：</p>
<ul>
<li><strong>Groot2</strong>：这是一个与 BehaviorTree.CPP 配套的<strong>可视化集成开发环境（IDE）</strong>。通过 Groot2，您可以通过<strong>拖拽</strong>的方式来创建和编辑行为树，并且可以<strong>实时监控</strong>行为树的执行状态。这对于新手来说极大地降低了学习门槛，对于资深开发者来说也大大提高了效率。</li>
<li><strong>丰富的文档和教程</strong>：网站提供了详细的文档和教程，可以帮助新用户快速上手。</li>
<li><strong>开源和社区支持</strong>：该项目是开源的，代码托管在 GitHub 上，并拥有一个活跃的社区论坛，您可以在那里寻求帮助和交流。</li>
</ul>
</li>
</ol>
<h3 id="behaviortreecpp_2"><strong>谁会使用 BehaviorTree.CPP？</strong><a class="headerlink" href="#behaviortreecpp_2" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>机器人工程师</strong>：用于开发各种机器人的自主行为，从工业机器人到服务机器人、无人机等。</li>
<li><strong>游戏开发者</strong>：用于设计和实现非玩家角色（NPC）的复杂AI。</li>
<li><strong>自动化系统开发者</strong>：用于构建任何需要进行复杂任务规划和决策的自动化系统。</li>
</ul>
<h2 id="behaviortreecpp-46">BehaviorTree.CPP 4.6<a class="headerlink" href="#behaviortreecpp-46" title="Permanent link">&para;</a></h2>
<p>——The C++ library to build Behavior Trees.</p>
<h1 id="_2">关于<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h1>
<h2 id="_3">关于此库<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>该<strong>C++</strong>库提供了一个创建<strong>行为树(BehaviorTrees) </strong>的框架。它被设计得灵活、易用且高效。</p>
<p>即使我们的主要应用场景是<strong>机器人学</strong>，你也可以使用该库来构建<strong>游戏中的AI</strong>，或者用来替代你应用中的有限状态机。</p>
<p>与其他实现相比，<strong>BehaviorTree.CPP</strong>具有许多有趣的特性：</p>
<ul>
<li>它将<strong>异步动作</strong>（即非阻塞例程）作为一等公民。</li>
<li>树在运行时创建，使用基于XML的<strong>解释型语言</strong>。</li>
<li>包含一个<strong>日志/性能分析</strong>基础设施，允许用户可视化、记录、回放和分析状态转换。</li>
<li>你可以静态链接自定义的TreeNodes，也可以将它们转换为插件，在运行时加载。</li>
</ul>
<h2 id="_4">什么是行为树？<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>行为树（<strong>BT</strong>）是一种组织自主体（如机器人或计算机游戏中的虚拟实体）间不同任务切换的方式。</p>
<p>BT是一种非常高效的创建复杂系统的方法，这些系统既模块化又响应迅速。这些特性在许多应用中至关重要，促使BT从游戏编程扩展到AI和机器人学的多个领域。</p>
<p>如果你已经熟悉有限状态机（<strong>FSM</strong>），你会很容易理解大部分概念，但希望你会发现BT更具表达力且更易于推理。</p>
<p>将<strong>树节点</strong>视为一组构建模块。这些模块用C++实现，且是“可组合”的：换句话说，它们可以被“组装”起来构建行为。</p>
<p><img alt="img" src="https://www.behaviortree.dev/assets/images/intro_build_trees-d8cabed430fbf41b95a63c09f44b528a.svg" /></p>
<p>上图展示了我们如何将这些动作排列在一个简单序列中；动作将按从左到右的顺序执行。欲了解更多，请访问<a href="https://www.behaviortree.dev/docs/learn-the-basics/BT_basics">BT入门</a>。</p>
<h3 id="_5">行为树的主要优势<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>它们本质上是层级结构</strong>：我们可以<em>组合</em>复杂行为，包括将整棵树作为更大树的子分支。例如，“取啤酒”行为可以重用“抓取物体”这棵树。</li>
<li><strong>其图形表示具有语义意义</strong>：更容易“阅读”行为树并理解对应工作流程。相比之下，有限状态机中的状态转换无论文本还是图形表达都较难理解。</li>
<li><strong>它们更具表达力</strong>：现成的控制节点（ControlNodes）和装饰节点（DecoratorNodes）使表达更复杂的控制流成为可能。用户还可以用自定义节点扩展“词汇”。</li>
</ul>
<h2 id="_6">“好吧，但我们为什么需要行为树（或有限状态机）？”<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<p>许多软件系统（机器人学是显著例子）本质上非常复杂。</p>
<p>管理复杂性、多样性和可扩展性的常用方法是采用<a href="https://en.wikipedia.org/wiki/Component-based_software_engineering">基于组件的软件工程</a>的理念。</p>
<p>现有机器人中间件，无论正式或非正式，均采用此方法，著名例子有<a href="http://www.ros.org/">ROS</a>、<a href="http://www.yarp.it/">YARP</a>和<a href="http://www.servicerobotik-ulm.de/">SmartSoft</a>。</p>
<p>一个“好”的软件架构应具备：</p>
<ul>
<li>模块化。</li>
<li>组件可重用性。</li>
<li>可组合性。</li>
<li>良好的关注点分离。</li>
</ul>
<p>若不从一开始遵循这些原则，软件将紧耦合且难以重用。</p>
<p>软件系统的业务逻辑往往分散于多个组件，开发者<strong>难以推理和调试</strong>。</p>
<p>实现强关注点分离，最好将业务逻辑集中管理。</p>
<p><strong>有限状态机</strong>正是为此设计，近年来，尤其在游戏行业，<strong>行为树</strong>逐渐流行。</p>
<h1 id="_7">基础概念<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h1>
<p>了解行为树及其使用方法。</p>
<h2 id="_8">行为树简介<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<p>行为树是由<strong>层级节点组成的树</strong>，控制“任务”的执行流程，与有限状态机不同。</p>
<h3 id="_9">基本概念<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<ul>
<li>一个称为“<strong>tick</strong>”的信号发送到树根，沿树传播直到叶节点。</li>
<li>
<p>任何接收<strong>tick</strong>信号的TreeNode都会执行其回调，回调必须返回：</p>
</li>
<li>
<p><strong>SUCCESS</strong></p>
</li>
<li><strong>FAILURE</strong></li>
<li><strong>RUNNING</strong></li>
<li>RUNNING表示动作需要更多时间完成。</li>
<li>若TreeNode有子节点，它负责传播tick；不同节点类型可能对是否、何时及次数有不同规则。</li>
<li><strong>叶节点（LeafNodes）</strong>无子节点，是实际命令节点，即行为树与系统交互的接口。<strong>动作节点</strong>是最常见的叶节点。</li>
</ul>
<blockquote>
<p>💡 提示</p>
<p>单词<strong>tick</strong>常用作<em>动词</em>（to tick / to be ticked），含义为：</p>
</blockquote>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>“调用 `TreeNode` 的回调函数 `tick()`。”
</code></pre></div>
<p>在面向服务架构中，叶节点包含与执行实际操作的“服务器”通信的“客户端”代码。</p>
<h3 id="tick">tick的工作原理<a class="headerlink" href="#tick" title="Permanent link">&para;</a></h3>
<p>为形象化tick树的过程，考虑下例。</p>
<p><img alt="basic sequence" src="https://www.behaviortree.dev/assets/images/sequence_animation-4155a892772542caf81fa16c824c91f8.svg" /></p>
<p><strong>序列节点（Sequence）</strong>是最简单的<strong>控制节点（ControlNode）</strong>：依次执行子节点，若全部成功则返回SUCCESS。</p>
<ol>
<li>第一次tick将序列节点置为RUNNING（橙色）。</li>
<li>序列节点tick第一个子节点“OpenDoor”，其最终返回SUCCESS。</li>
<li>第二个子节点“Walk”及随后“CloseDoor”被tick。</li>
<li>最后一个子节点完成后，序列节点从RUNNING切换为SUCCESS。</li>
</ol>
<h3 id="_10">节点类型<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<p><img alt="UML hierarchy" src="data:image/png;base64,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" /></p>
<table>
<thead>
<tr>
<th>TreeNode 类型</th>
<th>子节点数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>控制节点（ControlNode）</td>
<td>1...N</td>
<td>通常根据兄弟节点的结果和/或自身状态来tick其子节点。</td>
</tr>
<tr>
<td>装饰节点（DecoratorNode）</td>
<td>1</td>
<td>可能会改变子节点的结果，或多次tick子节点。</td>
</tr>
<tr>
<td>条件节点（ConditionNode）</td>
<td>0</td>
<td>不应改变系统状态。不得返回RUNNING。</td>
</tr>
<tr>
<td>动作节点（ActionNode）</td>
<td>0</td>
<td>这是“执行操作”的节点。</td>
</tr>
</tbody>
</table>
<p>在<strong>动作节点</strong>的上下文中，我们可以进一步区分同步和异步节点。</p>
<p>前者是原子执行的，会阻塞行为树，直到返回SUCCESS或FAILURE。</p>
<p>异步动作则可能返回RUNNING，表示动作仍在执行中。</p>
<p>需要对它们再次tick，直到最终返回SUCCESS或FAILURE。</p>
<h3 id="_11">示例<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<p>为更好理解行为树的工作原理，我们关注一些实际例子。为简化起见，这里不考虑动作返回RUNNING时的情况。</p>
<p>假设每个动作都是原子且同步执行的。</p>
<h4 id="sequence">第一个控制节点：序列（Sequence）<a class="headerlink" href="#sequence" title="Permanent link">&para;</a></h4>
<p>让我们用最基本且常用的控制节点——<a href="https://www.behaviortree.dev/docs/nodes-library/SequenceNode">序列节点（SequenceNode）</a>来说明行为树的工作方式。</p>
<p>控制节点的子节点始终是<strong>有序的</strong>；在图形表示中，执行顺序是<strong>从左到右</strong>。</p>
<p><img alt="Simple Sequence: fridge" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojZmZmIiB3aWR0aD0iNDY2IiBoZWlnaHQ9IjE1MSIgY29udGVudD0iJmx0O214ZmlsZSBob3N0PSZxdW90O2FwcC5kaWFncmFtcy5uZXQmcXVvdDsgbW9kaWZpZWQ9JnF1b3Q7MjAyMi0wMS0xNFQyMjo1MDoxOC4xNTVaJnF1b3Q7IGFnZW50PSZxdW90OzUuMCAoWDExKSZxdW90OyB2ZXJzaW9uPSZxdW90OzE2LjIuNyZxdW90OyBldGFnPSZxdW90O21HUGNYNV9Ma01xUjBYdDhoSzAxJnF1b3Q7IHR5cGU9JnF1b3Q7Z29vZ2xlJnF1b3Q7Jmd0OyZsdDtkaWFncmFtIGlkPSZxdW90Oy1EZWs1NENMOU1BT19yOWloT2djJnF1b3Q7Jmd0O3pWWk5jNXN3RVAwMXZtYjRNTmk1aHNUdG9aMTJ4b2MyUjQzWmdGS2hwVUxZdUwrK3dxd0FRVHZqTmg3SFhHQ2Z0Tkx1ZXl0V2l6QXBtZytLbGZsblRFRXNBaTl0RnVIaklnajh3UGZOcTBXT2hJVHIrdzdKRkU4Skc0QXQvd1VFZW9UV1BJWEttYWdSaGVhbEMrNVFTdGhwQjJOSzRjR2Q5b0xDM2JWa0djeUE3WTZKT2ZxTnB6b24xSS92aDRHUHdMT2N0bDRIcTI2Z1lIWXlaVkxsTE1YRENBcWZGbUdpRUhYM1ZUUUppSlk5eTB2bnQvbkxhQitZQXFuUGNRZ29ESDIwdVVGcVVpVlRvalN2QjRXMVRLSDE4SXlGU3VlWW9XVGlFMkpwUU4rQXI2RDFrWVJpdFVZRDVib1FOQW9OMTk5Yjk3dUlyT2ZSeUdOREs1K01veldrVnNmT2FSVlorM2s4T1BpZExPdjRnbEpUSlA3YTJGMkdiVm9PUnhYV2FrZFFSRFhFVkFaRVd6eG4wdS8xTVpVTldJRFoxVXhSSUpqbWUzZDFSaFdXOWZNR0Vjd0g2ZkJuVGNLYjFXUks3VWlqZjVMby95UlpYVjRTY3YySzNLd1llUFNIQ21NNm5mYi9aRzI3UkJjVmVVMkU3Y000Uyt2bHpXbzkwalo0aC9PM2ZyL3pSOUhzbWFocDBTMzhyRUdhYUtkaXVjb2NjcTVoVzdKVFdnZlQrMXdWcHNSVVd1RVBTRkNnT3EwV2V1YlpiSHJLOXFBME5FNWFaOUJoYTloemE5aVc4R0hVcjJ3VHlrZXRhdW05bmNCNFJ1Q1hFdVRHdFBMc3doUmVnQ2gvT1RuczBSV1pXczJZYXE5TUR3RHE1bmlhRnRSVmVWclBlRW9FVm5DakpiV01sM2ZSMWNneTVuQmY3RnJRY08wT24zNEQmbHQ7L2RpYWdyYW0mZ3Q7Jmx0Oy9teGZpbGUmZ3Q7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9Ii0wLjUgLTAuNSA0NjYgMTUxIj48Zz48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTSAyMzAgNTAgTCAxMDUuOTQgOTcuNzEiIHBvaW50ZXItZXZlbnRzPSJzdHJva2UiLz48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTSAxMDEuMDQgOTkuNiBMIDEwNi4zMiA5My44MiBMIDEwNS45NCA5Ny43MSBMIDEwOC44MyAxMDAuMzUgWiIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNIDIzMCA1MCBMIDIzMCA5My42MyIgcG9pbnRlci1ldmVudHM9InN0cm9rZSIvPjxwYXRoIGZpbGw9IiMwMDAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNIDIzMCA5OC44OCBMIDIyNi41IDkxLjg4IEwgMjMwIDkzLjYzIEwgMjMzLjUgOTEuODggWiIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNIDIzMCA1MCBMIDM1OC41MyA5Ny43OCIgcG9pbnRlci1ldmVudHM9InN0cm9rZSIvPjxwYXRoIGZpbGw9IiMwMDAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNIDM2My40NSA5OS42MSBMIDM1NS42NyAxMDAuNDUgTCAzNTguNTMgOTcuNzggTCAzNTguMTEgOTMuODkgWiIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxyZWN0IHdpZHRoPSIxMjAiIGhlaWdodD0iNDAiIHg9IjE3MCIgeT0iMTAiIGZpbGw9IiNGRkYiIHN0cm9rZT0iIzAwZiIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPjxzd2l0Y2g+PGZvcmVpZ25PYmplY3Qgc3R5bGU9Im92ZXJmbG93OnZpc2libGU7dGV4dC1hbGlnbjpsZWZ0IiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBwb2ludGVyLWV2ZW50cz0ibm9uZSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5Ij48ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOnVuc2FmZSBjZW50ZXI7anVzdGlmeS1jb250ZW50OnVuc2FmZSBjZW50ZXI7d2lkdGg6MTE4cHg7aGVpZ2h0OjFweDtwYWRkaW5nLXRvcDozMHB4O21hcmdpbi1sZWZ0OjE3MXB4Ij48ZGl2IHN0eWxlPSJib3gtc2l6aW5nOmJvcmRlci1ib3g7Zm9udC1zaXplOjA7dGV4dC1hbGlnbjpjZW50ZXIiIGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsiPjxkaXYgc3R5bGU9ImRpc3BsYXk6aW5saW5lLWJsb2NrO2ZvbnQtc2l6ZToxOHB4O2ZvbnQtZmFtaWx5OkhlbHZldGljYTtjb2xvcjojMDAwO2xpbmUtaGVpZ2h0OjEuMjtwb2ludGVyLWV2ZW50czphbGw7d2hpdGUtc3BhY2U6bm9ybWFsO292ZXJmbG93LXdyYXA6bm9ybWFsIj5TZXF1ZW5jZTwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSIyMzAiIHk9IjM1IiBmaWxsPSIjMDAwIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjE4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5TZXF1ZW5jZTwvdGV4dD48L3N3aXRjaD48L2c+PHJlY3Qgd2lkdGg9IjEyMCIgaGVpZ2h0PSI0MCIgeD0iMTAiIHk9IjEwMCIgZmlsbD0iI0ZGRiIgc3Ryb2tlPSIjMDAwIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+PHN3aXRjaD48Zm9yZWlnbk9iamVjdCBzdHlsZT0ib3ZlcmZsb3c6dmlzaWJsZTt0ZXh0LWFsaWduOmxlZnQiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHBvaW50ZXItZXZlbnRzPSJub25lIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiPjxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6dW5zYWZlIGNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6dW5zYWZlIGNlbnRlcjt3aWR0aDoxMThweDtoZWlnaHQ6MXB4O3BhZGRpbmctdG9wOjEyMHB4O21hcmdpbi1sZWZ0OjExcHgiPjxkaXYgc3R5bGU9ImJveC1zaXppbmc6Ym9yZGVyLWJveDtmb250LXNpemU6MDt0ZXh0LWFsaWduOmNlbnRlciIgZGF0YS1kcmF3aW8tY29sb3JzPSJjb2xvcjogcmdiKDAsIDAsIDApOyI+PGRpdiBzdHlsZT0iZGlzcGxheTppbmxpbmUtYmxvY2s7Zm9udC1zaXplOjE4cHg7Zm9udC1mYW1pbHk6SGVsdmV0aWNhO2NvbG9yOiMwMDA7bGluZS1oZWlnaHQ6MS4yO3BvaW50ZXItZXZlbnRzOmFsbDt3aGl0ZS1zcGFjZTpub3JtYWw7b3ZlcmZsb3ctd3JhcDpub3JtYWwiPk9wZW5GcmlkZ2U8L2Rpdj48L2Rpdj48L2Rpdj48L2ZvcmVpZ25PYmplY3Q+PHRleHQgeD0iNzAiIHk9IjEyNSIgZmlsbD0iIzAwMCIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxOCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+T3BlbkZyaWRnZTwvdGV4dD48L3N3aXRjaD48L2c+PHJlY3Qgd2lkdGg9IjEyMCIgaGVpZ2h0PSI0MCIgeD0iMTcwIiB5PSIxMDAiIGZpbGw9IiNGRkYiIHN0cm9rZT0iIzAwMCIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPjxzd2l0Y2g+PGZvcmVpZ25PYmplY3Qgc3R5bGU9Im92ZXJmbG93OnZpc2libGU7dGV4dC1hbGlnbjpsZWZ0IiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBwb2ludGVyLWV2ZW50cz0ibm9uZSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5Ij48ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOnVuc2FmZSBjZW50ZXI7anVzdGlmeS1jb250ZW50OnVuc2FmZSBjZW50ZXI7d2lkdGg6MTE4cHg7aGVpZ2h0OjFweDtwYWRkaW5nLXRvcDoxMjBweDttYXJnaW4tbGVmdDoxNzFweCI+PGRpdiBzdHlsZT0iYm94LXNpemluZzpib3JkZXItYm94O2ZvbnQtc2l6ZTowO3RleHQtYWxpZ246Y2VudGVyIiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7Ij48ZGl2IHN0eWxlPSJkaXNwbGF5OmlubGluZS1ibG9jaztmb250LXNpemU6MThweDtmb250LWZhbWlseTpIZWx2ZXRpY2E7Y29sb3I6IzAwMDtsaW5lLWhlaWdodDoxLjI7cG9pbnRlci1ldmVudHM6YWxsO3doaXRlLXNwYWNlOm5vcm1hbDtvdmVyZmxvdy13cmFwOm5vcm1hbCI+R3JhYkJlZXI8L2Rpdj48L2Rpdj48L2Rpdj48L2ZvcmVpZ25PYmplY3Q+PHRleHQgeD0iMjMwIiB5PSIxMjUiIGZpbGw9IiMwMDAiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMTgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPkdyYWJCZWVyPC90ZXh0Pjwvc3dpdGNoPjwvZz48cmVjdCB3aWR0aD0iMTIwIiBoZWlnaHQ9IjQwIiB4PSIzMzQuNSIgeT0iMTAwIiBmaWxsPSIjRkZGIiBzdHJva2U9IiMwMDAiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpIj48c3dpdGNoPjxmb3JlaWduT2JqZWN0IHN0eWxlPSJvdmVyZmxvdzp2aXNpYmxlO3RleHQtYWxpZ246bGVmdCIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcG9pbnRlci1ldmVudHM9Im5vbmUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSI+PGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczp1bnNhZmUgY2VudGVyO2p1c3RpZnktY29udGVudDp1bnNhZmUgY2VudGVyO3dpZHRoOjExOHB4O2hlaWdodDoxcHg7cGFkZGluZy10b3A6MTIwcHg7bWFyZ2luLWxlZnQ6MzM2cHgiPjxkaXYgc3R5bGU9ImJveC1zaXppbmc6Ym9yZGVyLWJveDtmb250LXNpemU6MDt0ZXh0LWFsaWduOmNlbnRlciIgZGF0YS1kcmF3aW8tY29sb3JzPSJjb2xvcjogcmdiKDAsIDAsIDApOyI+PGRpdiBzdHlsZT0iZGlzcGxheTppbmxpbmUtYmxvY2s7Zm9udC1zaXplOjE4cHg7Zm9udC1mYW1pbHk6SGVsdmV0aWNhO2NvbG9yOiMwMDA7bGluZS1oZWlnaHQ6MS4yO3BvaW50ZXItZXZlbnRzOmFsbDt3aGl0ZS1zcGFjZTpub3JtYWw7b3ZlcmZsb3ctd3JhcDpub3JtYWwiPkNsb3NlRnJpZGdlPC9kaXY+PC9kaXY+PC9kaXY+PC9mb3JlaWduT2JqZWN0Pjx0ZXh0IHg9IjM5NSIgeT0iMTI1IiBmaWxsPSIjMDAwIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjE4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5DbG9zZUZyaWRnZTwvdGV4dD48L3N3aXRjaD48L2c+PC9nPjwvc3ZnPg==" /></p>
<p>简而言之：</p>
<ul>
<li>如果一个子节点返回SUCCESS，则tick下一个子节点。</li>
<li>如果一个子节点返回FAILURE，则不再tick后续子节点，序列节点返回FAILURE。</li>
<li>如果<strong>所有</strong>子节点都返回SUCCESS，则序列节点返回SUCCESS。</li>
</ul>
<blockquote>
<p>⚠️ 找BUG！</p>
<p>如果动作<strong>GrabBeer</strong>失败，冰箱门会保持打开状态，因为最后一个动作<strong>CloseFridge</strong>被跳过了。</p>
</blockquote>
<h4 id="decorators">装饰节点（Decorators）<a class="headerlink" href="#decorators" title="Permanent link">&para;</a></h4>
<p>根据<a href="https://www.behaviortree.dev/docs/nodes-library/DecoratorNode">装饰节点（DecoratorNode）</a>的类型，该节点的目标可能是：</p>
<ul>
<li>转换从子节点收到的结果。</li>
<li>中止子节点的执行。</li>
<li>根据装饰器类型重复tick子节点。</li>
</ul>
<p><img alt="简单装饰器：进入房间" src="https://www.behaviortree.dev/assets/images/DecoratorEnterRoom-f844716da2812873bdbb3f21448419c7.svg" /></p>
<p>节点<strong>Inverter</strong>是一个装饰器，它会反转子节点返回的结果；因此，一个Inverter节点后接名为<strong>isDoorOpen</strong>的节点，相当于</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>“门是关着的吗？”
</code></pre></div>
<p>节点<strong>Retry</strong>会在子节点返回FAILURE时，最多重复tick子节点<strong>num_attempts</strong>次（此例中为5次）。</p>
<p><strong>显然</strong>，左侧分支的含义是：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>如果门是关着的，则尝试打开它。
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>最多尝试5次，否则放弃并返回FAILURE。
</code></pre></div>
<p>但是……</p>
<p>找BUG！</p>
<p>如果<strong>isDoorOpen</strong>返回FAILURE，行为符合预期。但如果返回SUCCESS，左侧分支失败，整个序列被中断。</p>
<h4 id="fallback">第二个控制节点：Fallback<a class="headerlink" href="#fallback" title="Permanent link">&para;</a></h4>
<p><a href="https://www.behaviortree.dev/docs/nodes-library/FallbackNode">Fallback节点</a>，又称<strong>“选择器（Selectors）”</strong>，如其名所示，用于表达备选策略，即当子节点返回FAILURE时，下一步做什么。</p>
<p>它依次tick子节点：</p>
<ul>
<li>如果子节点返回FAILURE，则tick下一个。</li>
<li>如果子节点返回SUCCESS，则停止tick后续子节点，Fallback节点返回SUCCESS。</li>
<li>如果所有子节点均返回FAILURE，则Fallback节点返回FAILURE。</li>
</ul>
<p>下例展示了序列和Fallback的组合：</p>
<p><img alt="Fallback节点" src="https://www.behaviortree.dev/assets/images/FallbackBasic-4d0eb7fe32bdcd1f2ee3d46cd27dc19f.svg" /></p>
<blockquote>
<p>门开着吗？</p>
<p>如果没有，尝试开门。</p>
<p>如果有钥匙，解锁并打开门。</p>
<p>否则，砸门。</p>
<p>如果<strong>任意</strong>动作成功，则进入房间。</p>
</blockquote>
<h4 id="_12">“给我取瓶啤酒”示例改进<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h4>
<p>现在我们可以改进“给我取瓶啤酒”示例，避免啤酒不在冰箱时门未关闭的问题。</p>
<p>用绿色表示返回SUCCESS的节点，红色表示返回FAILURE的节点，黑色表示未执行的节点。</p>
<p><img alt="FetchBeer failure" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhodG1sPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojZmZmIiBpZD0ic3ZnNTQiIHdpZHRoPSI0NjYiIGhlaWdodD0iMTUxIiBjb250ZW50PSImbHQ7bXhmaWxlIGhvc3Q9JnF1b3Q7YXBwLmRpYWdyYW1zLm5ldCZxdW90OyBtb2RpZmllZD0mcXVvdDsyMDIyLTAxLTE0VDIzOjEwOjMyLjU0N1omcXVvdDsgYWdlbnQ9JnF1b3Q7NS4wIChYMTEpJnF1b3Q7IHZlcnNpb249JnF1b3Q7MTYuMi43JnF1b3Q7IGV0YWc9JnF1b3Q7VFBEbFlLSWNJUTgzZVFVbk1BaHkmcXVvdDsgdHlwZT0mcXVvdDtnb29nbGUmcXVvdDsmZ3Q7Jmx0O2RpYWdyYW0gaWQ9JnF1b3Q7ekRUT1pJVjJIQmZvVkU5TjBDbzgmcXVvdDsmZ3Q7elZkTGM5b3dFUDQxWEJuOFJMbUdQSHBvcDUzaDBPYW8ySXV0Um1oZElZUHByNitNMXcvaFpJYTJRSEt5OTVOVzJ2Mit0VmFlQkl0MTlhaDVrWC9CRk9URW42WFZKTGliK0w0WE0yWWZOYkp2a0pzb2FvQk1pNVFtOWNCUy9BWUNaNFNXSW9XTk05RWdTaU1LRjB4UUtVaU1nM0d0Y2VkT1c2RjBkeTE0QmlOZ21YQTVScitMMU9TRWV2Rk5QL0FKUkpiVDFzeWZOd05yM2s2bVREWTVUM0UzZ0lMN1NiRFFpS1o1VzFjTGtEVjVMUytOMzhNYm8xMWdHcFE1eGNHbk1NeSt6UTFTbXlxWkNwVjkzR29zVlFxMXg4eGFxRTJPR1NvdVB5TVdGdlFzK0JPTTJaTlF2RFJvb2R5c0pZMUNKY3lQMm4wYWtmVTBHTG1yYU9XRHNXOE5aZlMrY1pwSHJmMDBIT3o5RGxicnVFSmxLQktQV2J2SnNFN0w0V2lEcFU0SW91b3pYR2RBdE1WakpyMU9IMXZZZ0d1d3U5b3BHaVEzWXV1dXpxbkNzbTVlTDRKOUlSMWUxeVQ0c0pvY1V6dlE2SzhrK2pkSjV1ZVhoRnkvb2JBcityUDJnSnFIL3JTTmdJNG9Md3Fta2J0UUV4djVIc25iQlhPUzR1R0hWWHlnc1A4T1h5Rjd2NitRb3RseVdkS2lTL2hWZ3JMUkhvdmxLclBMaFlGbHdROXA3V3dEZEZVNEptWmpOTDdBQWlYcXcyckJNNHZDNkVDaGtIS0FyMWdDU2RKUnVRVnRvSExTUFlHbXZnV1BLcnd2OE4yZ3A3V05LaCswczNEMi8vVEdJM3EvRnFBZWJMdlB6a3p3RVkxcEJDd05YeU9lK2M5QkhKK0o0TWdmSHlIaFZSbWVqeGl1YjJPM0FQcWkvSFpsK25aaFg2aUFyOHd2Ry9HN2tMaUJTNVR3T1FoallWeGZwSzVIbURYN2UyelRGUHUvZ2VEK0R3PT0mbHQ7L2RpYWdyYW0mZ3Q7Jmx0Oy9teGZpbGUmZ3Q7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9Ii0wLjUgLTAuNSA0NjYgMTUxIj48bWV0YWRhdGEgaWQ9Im1ldGFkYXRhNjAiLz48ZyBpZD0iZzQ2Ij48cGF0aCBpZD0icGF0aDIiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNIDIzMC4yNSA0OS41IEwgMTA2LjE5IDk3LjIxIiBwb2ludGVyLWV2ZW50cz0ic3Ryb2tlIi8+PHBhdGggaWQ9InBhdGg0IiBmaWxsPSIjMDAwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTSAxMDEuMjkgOTkuMSBMIDEwNi41NyA5My4zMiBMIDEwNi4xOSA5Ny4yMSBMIDEwOS4wOCA5OS44NSBaIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PHBhdGggaWQ9InBhdGg2IiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTSAyMzAuMjUgNDkuNSBMIDIzMC4yNSA5My4xMyIgcG9pbnRlci1ldmVudHM9InN0cm9rZSIvPjxwYXRoIGlkPSJwYXRoOCIgZmlsbD0iIzAwMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGQ9Ik0gMjMwLjI1IDk4LjM4IEwgMjI2Ljc1IDkxLjM4IEwgMjMwLjI1IDkzLjEzIEwgMjMzLjc1IDkxLjM4IFoiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48cGF0aCBpZD0icGF0aDEwIiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTSAyMzAuMjUgNDkuNSBMIDM1OC43OCA5Ny4yOCIgcG9pbnRlci1ldmVudHM9InN0cm9rZSIvPjxwYXRoIGlkPSJwYXRoMTIiIGZpbGw9IiMwMDAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNIDM2My43IDk5LjExIEwgMzU1LjkyIDk5Ljk1IEwgMzU4Ljc4IDk3LjI4IEwgMzU4LjM2IDkzLjM5IFoiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48cmVjdCBpZD0icmVjdDE0IiB3aWR0aD0iMTIwIiBoZWlnaHQ9IjQwIiB4PSIxNzAuMjUiIHk9IjkuNSIgZmlsbD0iI2Y4Y2VjYyIgc3Ryb2tlPSIjYjg1NDUwIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PGcgaWQ9ImcyMCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+PHN3aXRjaCBpZD0ic3dpdGNoMTgiPjxmb3JlaWduT2JqZWN0IHN0eWxlPSJvdmVyZmxvdzp2aXNpYmxlO3RleHQtYWxpZ246bGVmdCIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcG9pbnRlci1ldmVudHM9Im5vbmUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSI+PHhodG1sOmRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOnVuc2FmZSBjZW50ZXI7anVzdGlmeS1jb250ZW50OnVuc2FmZSBjZW50ZXI7d2lkdGg6MTE4cHg7aGVpZ2h0OjFweDtwYWRkaW5nLXRvcDozMHB4O21hcmdpbi1sZWZ0OjE3MXB4Ij48eGh0bWw6ZGl2IHN0eWxlPSJib3gtc2l6aW5nOmJvcmRlci1ib3g7Zm9udC1zaXplOjA7dGV4dC1hbGlnbjpjZW50ZXIiIGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsiPjx4aHRtbDpkaXYgc3R5bGU9ImRpc3BsYXk6aW5saW5lLWJsb2NrO2ZvbnQtc2l6ZToxOHB4O2ZvbnQtZmFtaWx5OkhlbHZldGljYTtjb2xvcjojMDAwO2xpbmUtaGVpZ2h0OjEuMjtwb2ludGVyLWV2ZW50czphbGw7d2hpdGUtc3BhY2U6bm9ybWFsO292ZXJmbG93LXdyYXA6bm9ybWFsIj5TZXF1ZW5jZTwveGh0bWw6ZGl2PjwveGh0bWw6ZGl2PjwveGh0bWw6ZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCBpZD0idGV4dDE2IiB4PSIyMzAiIHk9IjM1IiBmaWxsPSIjMDAwIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjE4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5TZXF1ZW5jZTwvdGV4dD48L3N3aXRjaD48L2c+PHJlY3QgaWQ9InJlY3QyMiIgd2lkdGg9IjEyMCIgaGVpZ2h0PSI0MCIgeD0iMTAuMjUiIHk9Ijk5LjUiIGZpbGw9IiNkNWU4ZDQiIHN0cm9rZT0iIzgyYjM2NiIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxnIGlkPSJnMjgiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPjxzd2l0Y2ggaWQ9InN3aXRjaDI2Ij48Zm9yZWlnbk9iamVjdCBzdHlsZT0ib3ZlcmZsb3c6dmlzaWJsZTt0ZXh0LWFsaWduOmxlZnQiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHBvaW50ZXItZXZlbnRzPSJub25lIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiPjx4aHRtbDpkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczp1bnNhZmUgY2VudGVyO2p1c3RpZnktY29udGVudDp1bnNhZmUgY2VudGVyO3dpZHRoOjExOHB4O2hlaWdodDoxcHg7cGFkZGluZy10b3A6MTIwcHg7bWFyZ2luLWxlZnQ6MTFweCI+PHhodG1sOmRpdiBzdHlsZT0iYm94LXNpemluZzpib3JkZXItYm94O2ZvbnQtc2l6ZTowO3RleHQtYWxpZ246Y2VudGVyIiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7Ij48eGh0bWw6ZGl2IHN0eWxlPSJkaXNwbGF5OmlubGluZS1ibG9jaztmb250LXNpemU6MThweDtmb250LWZhbWlseTpIZWx2ZXRpY2E7Y29sb3I6IzAwMDtsaW5lLWhlaWdodDoxLjI7cG9pbnRlci1ldmVudHM6YWxsO3doaXRlLXNwYWNlOm5vcm1hbDtvdmVyZmxvdy13cmFwOm5vcm1hbCI+T3BlbkZyaWRnZTwveGh0bWw6ZGl2PjwveGh0bWw6ZGl2PjwveGh0bWw6ZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCBpZD0idGV4dDI0IiB4PSI3MCIgeT0iMTI1IiBmaWxsPSIjMDAwIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjE4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5PcGVuRnJpZGdlPC90ZXh0Pjwvc3dpdGNoPjwvZz48cmVjdCBpZD0icmVjdDMwIiB3aWR0aD0iMTIwIiBoZWlnaHQ9IjQwIiB4PSIxNzAuMjUiIHk9Ijk5LjUiIGZpbGw9IiNmOGNlY2MiIHN0cm9rZT0iI2I4NTQ1MCIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxnIGlkPSJnMzYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPjxzd2l0Y2ggaWQ9InN3aXRjaDM0Ij48Zm9yZWlnbk9iamVjdCBzdHlsZT0ib3ZlcmZsb3c6dmlzaWJsZTt0ZXh0LWFsaWduOmxlZnQiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHBvaW50ZXItZXZlbnRzPSJub25lIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiPjx4aHRtbDpkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczp1bnNhZmUgY2VudGVyO2p1c3RpZnktY29udGVudDp1bnNhZmUgY2VudGVyO3dpZHRoOjExOHB4O2hlaWdodDoxcHg7cGFkZGluZy10b3A6MTIwcHg7bWFyZ2luLWxlZnQ6MTcxcHgiPjx4aHRtbDpkaXYgc3R5bGU9ImJveC1zaXppbmc6Ym9yZGVyLWJveDtmb250LXNpemU6MDt0ZXh0LWFsaWduOmNlbnRlciIgZGF0YS1kcmF3aW8tY29sb3JzPSJjb2xvcjogcmdiKDAsIDAsIDApOyI+PHhodG1sOmRpdiBzdHlsZT0iZGlzcGxheTppbmxpbmUtYmxvY2s7Zm9udC1zaXplOjE4cHg7Zm9udC1mYW1pbHk6SGVsdmV0aWNhO2NvbG9yOiMwMDA7bGluZS1oZWlnaHQ6MS4yO3BvaW50ZXItZXZlbnRzOmFsbDt3aGl0ZS1zcGFjZTpub3JtYWw7b3ZlcmZsb3ctd3JhcDpub3JtYWwiPkdyYWJCZWVyPC94aHRtbDpkaXY+PC94aHRtbDpkaXY+PC94aHRtbDpkaXY+PC9mb3JlaWduT2JqZWN0Pjx0ZXh0IGlkPSJ0ZXh0MzIiIHg9IjIzMCIgeT0iMTI1IiBmaWxsPSIjMDAwIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjE4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5HcmFiQmVlcjwvdGV4dD48L3N3aXRjaD48L2c+PHJlY3QgaWQ9InJlY3QzOCIgd2lkdGg9IjEyMCIgaGVpZ2h0PSI0MCIgeD0iMzM0Ljc1IiB5PSI5OS41IiBmaWxsPSIjRkZGIiBzdHJva2U9IiMwMDAiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48ZyBpZD0iZzQ0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpIj48c3dpdGNoIGlkPSJzd2l0Y2g0MiI+PGZvcmVpZ25PYmplY3Qgc3R5bGU9Im92ZXJmbG93OnZpc2libGU7dGV4dC1hbGlnbjpsZWZ0IiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBwb2ludGVyLWV2ZW50cz0ibm9uZSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5Ij48eGh0bWw6ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6dW5zYWZlIGNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6dW5zYWZlIGNlbnRlcjt3aWR0aDoxMThweDtoZWlnaHQ6MXB4O3BhZGRpbmctdG9wOjEyMHB4O21hcmdpbi1sZWZ0OjMzNnB4Ij48eGh0bWw6ZGl2IHN0eWxlPSJib3gtc2l6aW5nOmJvcmRlci1ib3g7Zm9udC1zaXplOjA7dGV4dC1hbGlnbjpjZW50ZXIiIGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsiPjx4aHRtbDpkaXYgc3R5bGU9ImRpc3BsYXk6aW5saW5lLWJsb2NrO2ZvbnQtc2l6ZToxOHB4O2ZvbnQtZmFtaWx5OkhlbHZldGljYTtjb2xvcjojMDAwO2xpbmUtaGVpZ2h0OjEuMjtwb2ludGVyLWV2ZW50czphbGw7d2hpdGUtc3BhY2U6bm9ybWFsO292ZXJmbG93LXdyYXA6bm9ybWFsIj5DbG9zZUZyaWRnZTwveGh0bWw6ZGl2PjwveGh0bWw6ZGl2PjwveGh0bWw6ZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCBpZD0idGV4dDQwIiB4PSIzOTUiIHk9IjEyNSIgZmlsbD0iIzAwMCIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxOCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+Q2xvc2VGcmlkZ2U8L3RleHQ+PC9zd2l0Y2g+PC9nPjwvZz48L3N2Zz4=" /></p>
<p>让我们创建一个备选的行为树，即使<strong>GrabBeer</strong>返回FAILURE，也会关闭冰箱门。</p>
<p><img alt="取啤酒失败" src="https://www.behaviortree.dev/assets/images/FetchBeer-24723226326a39f057f9d9c32250eb95.svg" /></p>
<p>这两棵树最终都会关闭冰箱门，但：</p>
<ul>
<li><strong>左侧</strong>的树无论是否成功取到啤酒，都会返回SUCCESS。</li>
<li><strong>右侧</strong>的树如果啤酒在冰箱里则返回SUCCESS，否则返回FAILURE。</li>
</ul>
<p>当<strong>GrabBeer</strong>返回SUCCESS时，所有行为均符合预期。</p>
<p><img alt="取啤酒成功" src="https://www.behaviortree.dev/assets/images/FetchBeer2-318ea4fa8928e30e7c9dd80e35dfc212.svg" /></p>
<h2 id="_13">主要概念<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h2>
<p><strong>BehaviorTree.CPP</strong>是一个C++库，可以轻松集成到你喜欢的分布式中间件中，如<strong>ROS</strong>或<strong>SmartSoft</strong>。</p>
<p>你也可以将其静态链接进你的应用程序（例如游戏）。</p>
<p>以下是你需要首先理解的主要概念。</p>
<h3 id="_14">节点与树<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<p>用户必须自己创建ActionNodes和ConditionNodes（叶节点）；该库帮助你轻松将它们组合成树。</p>
<p>将叶节点看作构建复杂系统所需的构建模块。如果节点是<strong>乐高积木</strong>，那么你的树就是乐高套装。</p>
<p><img alt="乐高积木" src="https://www.behaviortree.dev/assets/images/lego-ba9dde407ed40b8f4d59df6eb17f4b19.jpg" /></p>
<p>按定义，你的自定义节点应当是高度<strong>可重用</strong>的。</p>
<h3 id="xml">使用XML格式在运行时实例化树<a class="headerlink" href="#xml" title="Permanent link">&para;</a></h3>
<p>尽管库用C++编写，树本身可以在<em>运行时</em>，更准确地说是在<em>部署时</em>，使用基于XML的脚本语言创建和组合。</p>
<p>XML格式在<a href="https://www.behaviortree.dev/docs/learn-the-basics/xml_format">这里</a>有详细描述，但学习语法的最好方法是跟随教程。</p>
<h3 id="tick_1">tick()回调<a class="headerlink" href="#tick_1" title="Permanent link">&para;</a></h3>
<p>任何TreeNode都可以视为调用<strong>回调函数</strong>的机制，即<strong>执行一段代码</strong>。回调做什么由你决定。</p>
<p>在大多数后续教程中，我们的动作仅在控制台打印信息或休眠一段时间以模拟长时间计算。</p>
<p>在生产代码中，尤其是模型驱动开发和基于组件的软件工程中，动作/条件通常会与系统的其他<em>组件</em>或<em>服务</em>通信。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1">// 你可以封装进BT动作的最简单回调</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">NodeStatus</span><span class="w"> </span><span class="nf">HelloTick</span><span class="p">()</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="p">{</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Hello World</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="p">}</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="c1">// 允许库创建调用HelloTick()的动作节点</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="n">factory</span><span class="p">.</span><span class="n">registerSimpleAction</span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="n">HelloTick</span><span class="p">));</span>
</code></pre></div>
<blockquote>
<p>💡 提示</p>
<p>工厂可能创建多个名为<strong>Hello</strong>的节点实例。</p>
</blockquote>
<h3 id="_15">通过继承创建自定义节点<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<p>上述示例通过<strong>函数指针</strong>（依赖注入）创建了调用<code>HelloTick</code>的特定类型TreeNode。</p>
<p>通常，定义自定义TreeNode应继承自类<code>TreeNode</code>或其派生类：</p>
<ul>
<li><code>ActionNodeBase</code></li>
<li><code>ConditionNode</code></li>
<li><code>DecoratorNode</code></li>
</ul>
<p>参考请见<a href="https://www.behaviortree.dev/docs/tutorial-basics/tutorial_01_first_tree">第一个教程</a>。</p>
<h3 id="_16">数据流、端口与黑板<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<p>端口的详细介绍见<a href="https://www.behaviortree.dev/docs/tutorial-basics/tutorial_02_basic_ports">第二</a>和<a href="https://www.behaviortree.dev/docs/tutorial-basics/tutorial_03_generic_ports">第三</a>教程。</p>
<p>目前需了解：</p>
<ul>
<li><strong>黑板（Blackboard）</strong>是所有树节点共享的<em>键/值</em>存储。</li>
<li><strong>端口（Ports）</strong>是节点间交换信息的机制。</li>
<li>端口通过黑板中的相同<em>键</em>进行“连接”。</li>
<li>节点的端口数量、名称和类型须在<em>编译时</em>（C++）确定；端口间连接在<em>部署时</em>（XML）完成。</li>
<li>端口值可存储任意C++类型（我们使用类似于<a href="https://www.fluentcpp.com/2021/02/05/how-stdany-works/">std::any</a>的类型擦除技术）。</li>
</ul>
<h2 id="xml_1">XML模式<a class="headerlink" href="#xml_1" title="Permanent link">&para;</a></h2>
<p>在<a href="https://www.behaviortree.dev/docs/tutorial-basics/tutorial_01_first_tree">第一个教程</a>中，展示了这棵简单的树。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="w"> </span><span class="nt">&lt;root</span><span class="w"> </span><span class="na">BTCPP_format=</span><span class="s">&quot;4&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">     </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MainTree&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">        </span><span class="nt">&lt;Sequence</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;root_sequence&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">            </span><span class="nt">&lt;SaySomething</span><span class="w">   </span><span class="na">name=</span><span class="s">&quot;action_hello&quot;</span><span class="w"> </span><span class="na">message=</span><span class="s">&quot;Hello&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">            </span><span class="nt">&lt;OpenGripper</span><span class="w">    </span><span class="na">name=</span><span class="s">&quot;open_gripper&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">            </span><span class="nt">&lt;ApproachObject</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;approach_object&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">            </span><span class="nt">&lt;CloseGripper</span><span class="w">   </span><span class="na">name=</span><span class="s">&quot;close_gripper&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">        </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">     </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w"> </span><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<p>你可能注意到：</p>
<ul>
<li>树的第一个标签是 <code>&lt;root&gt;</code>，它应包含<strong>一个或多个</strong> <code>&lt;BehaviorTree&gt;</code> 标签。</li>
<li><code>&lt;BehaviorTree&gt;</code> 标签应带有属性 <code>[ID]</code>。</li>
<li><code>&lt;root&gt;</code> 标签应包含属性 <code>[BTCPP_format]</code>。</li>
<li>
<p>每个TreeNode用单个标签表示，具体来说：</p>
</li>
<li>
<p>标签名是用于在工厂中注册该TreeNode的<strong>ID</strong>。</p>
</li>
<li>属性 <code>[name]</code> 是实例的名称，<strong>可选</strong>。</li>
<li>端口通过属性配置。在前例中，动作 <code>SaySomething</code> 需要输入端口 <code>message</code>。</li>
<li>
<p>关于子节点数量：</p>
</li>
<li>
<p><code>ControlNodes</code> 含有 <strong>1 到 N 个子节点</strong>。</p>
</li>
<li><code>DecoratorNodes</code> 和子树仅含<strong>1 个子节点</strong>。</li>
<li><code>ActionNodes</code> 和 <code>ConditionNodes</code> 没有子节点。</li>
</ul>
<h3 id="_17">端口重映射与指向黑板条目的指针<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<p>如<a href="https://www.behaviortree.dev/docs/tutorial-basics/tutorial_02_basic_ports">第二教程</a>所述，输入/输出端口可以通过黑板中条目的名称进行重映射，换言之，就是黑板中<strong>键/值</strong>对的<strong>键</strong>。</p>
<p>黑板键用如下语法表示：<code>{key_name}</code>。</p>
<p>下例中：</p>
<ul>
<li>序列的第一个子节点打印“Hello”，</li>
<li>第二个子节点读写黑板中名为 <code>"my_message"</code> 条目的值；</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="w"> </span><span class="nt">&lt;root</span><span class="w"> </span><span class="na">BTCPP_format=</span><span class="s">&quot;4&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">     </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MainTree&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">        </span><span class="nt">&lt;Sequence</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;root_sequence&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">            </span><span class="nt">&lt;SaySomething</span><span class="w"> </span><span class="na">message=</span><span class="s">&quot;Hello&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">            </span><span class="nt">&lt;SaySomething</span><span class="w"> </span><span class="na">message=</span><span class="s">&quot;{my_message}&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">        </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">     </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w"> </span><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<h3 id="_18">紧凑与显式表示<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h3>
<p>以下两种写法均有效：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="w"> </span><span class="nt">&lt;SaySomething</span><span class="w">               </span><span class="na">name=</span><span class="s">&quot;action_hello&quot;</span><span class="w"> </span><span class="na">message=</span><span class="s">&quot;Hello World&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w"> </span><span class="nt">&lt;Action</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;SaySomething&quot;</span><span class="w">   </span><span class="na">name=</span><span class="s">&quot;action_hello&quot;</span><span class="w"> </span><span class="na">message=</span><span class="s">&quot;Hello World&quot;</span><span class="nt">/&gt;</span>
</code></pre></div>
<p>我们称前者为“<strong>紧凑</strong>”语法，后者为“<strong>显式</strong>”语法。显式语法表示的第一个示例为：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="w"> </span><span class="nt">&lt;root</span><span class="w"> </span><span class="na">BTCPP_format=</span><span class="s">&quot;4&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">     </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MainTree&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">        </span><span class="nt">&lt;Sequence</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;root_sequence&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">           </span><span class="nt">&lt;Action</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;SaySomething&quot;</span><span class="w">   </span><span class="na">name=</span><span class="s">&quot;action_hello&quot;</span><span class="w"> </span><span class="na">message=</span><span class="s">&quot;Hello&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">           </span><span class="nt">&lt;Action</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;OpenGripper&quot;</span><span class="w">    </span><span class="na">name=</span><span class="s">&quot;open_gripper&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">           </span><span class="nt">&lt;Action</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;ApproachObject&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;approach_object&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">           </span><span class="nt">&lt;Action</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;CloseGripper&quot;</span><span class="w">   </span><span class="na">name=</span><span class="s">&quot;close_gripper&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">        </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">     </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w"> </span><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<p>尽管紧凑语法更便捷易写，但提供的信息较少。像<strong>Groot</strong>这类工具要求使用<em>显式</em>语法或额外信息。该信息可用 <code>&lt;TreeNodeModel&gt;</code> 标签添加。</p>
<p>为使紧凑版树与Groot兼容，XML应修改为：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="w"> </span><span class="nt">&lt;root</span><span class="w"> </span><span class="na">BTCPP_format=</span><span class="s">&quot;4&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">     </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MainTree&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">        </span><span class="nt">&lt;Sequence</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;root_sequence&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">           </span><span class="nt">&lt;SaySomething</span><span class="w">   </span><span class="na">name=</span><span class="s">&quot;action_hello&quot;</span><span class="w"> </span><span class="na">message=</span><span class="s">&quot;Hello&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">           </span><span class="nt">&lt;OpenGripper</span><span class="w">    </span><span class="na">name=</span><span class="s">&quot;open_gripper&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">           </span><span class="nt">&lt;ApproachObject</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;approach_object&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">           </span><span class="nt">&lt;CloseGripper</span><span class="w">   </span><span class="na">name=</span><span class="s">&quot;close_gripper&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">        </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">    </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">    </span><span class="cm">&lt;!-- BT执行器不需要，但Groot需要 --&gt;</span><span class="w">     </span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">    </span><span class="nt">&lt;TreeNodeModel&gt;</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w">        </span><span class="nt">&lt;Action</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;SaySomething&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="w">            </span><span class="nt">&lt;input_port</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;message&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;std::string&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="w">        </span><span class="nt">&lt;/Action&gt;</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="w">        </span><span class="nt">&lt;Action</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;OpenGripper&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="w">        </span><span class="nt">&lt;Action</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;ApproachObject&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="w">        </span><span class="nt">&lt;Action</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;CloseGripper&quot;</span><span class="nt">/&gt;</span><span class="w">      </span>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="w">    </span><span class="nt">&lt;/TreeNodeModel&gt;</span>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="w"> </span><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<h3 id="_19">子树<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h3>
<p>如<a href="https://www.behaviortree.dev/docs/tutorial-basics/tutorial_06_subtree_ports">此教程</a>所示，可在一棵树中包含子树，避免重复复制相同树，降低复杂度。</p>
<p>假设想将若干动作封装进行为树“<strong>GraspObject</strong>”（为简洁，省略可选属性[name]）。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="w"> </span><span class="nt">&lt;root</span><span class="w"> </span><span class="na">BTCPP_format=</span><span class="s">&quot;4&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">     </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MainTree&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">        </span><span class="nt">&lt;Sequence&gt;</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">           </span><span class="nt">&lt;Action</span><span class="w">  </span><span class="na">ID=</span><span class="s">&quot;SaySomething&quot;</span><span class="w">  </span><span class="na">message=</span><span class="s">&quot;Hello World&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">           </span><span class="nt">&lt;SubTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;GraspObject&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">        </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">     </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">     </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;GraspObject&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">        </span><span class="nt">&lt;Sequence&gt;</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">           </span><span class="nt">&lt;Action</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;OpenGripper&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">           </span><span class="nt">&lt;Action</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;ApproachObject&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">           </span><span class="nt">&lt;Action</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;CloseGripper&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">        </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="w">     </span><span class="nt">&lt;/BehaviorTree&gt;</span><span class="w">  </span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="w"> </span><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<p>可见，“GraspObject”树在“SaySomething”之后执行。</p>
<h3 id="_20">引入外部文件<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h3>
<p><strong>自版本2.4起</strong>。</p>
<p>你可以像C++中的<code>#include &lt;file&gt;</code>一样引入外部文件，方法是使用标签：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="w">  </span><span class="nt">&lt;include</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;relative_or_absolute_path_to_file&quot;</span><span class="nt">&gt;</span>
</code></pre></div>
<p>利用上例，我们可将两棵行为树拆分成两个文件：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="w"> </span><span class="cm">&lt;!-- 文件 maintree.xml --&gt;</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w"> </span><span class="nt">&lt;root</span><span class="w"> </span><span class="na">BTCPP_format=</span><span class="s">&quot;4&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">     </span><span class="nt">&lt;include</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;grasp.xml&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">     </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MainTree&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">        </span><span class="nt">&lt;Sequence&gt;</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">           </span><span class="nt">&lt;Action</span><span class="w">  </span><span class="na">ID=</span><span class="s">&quot;SaySomething&quot;</span><span class="w">  </span><span class="na">message=</span><span class="s">&quot;Hello World&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">           </span><span class="nt">&lt;SubTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;GraspObject&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="w">        </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="w">     </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="w">  </span><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="w"> </span><span class="cm">&lt;!-- 文件 grasp.xml --&gt;</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w"> </span><span class="nt">&lt;root</span><span class="w"> </span><span class="na">BTCPP_format=</span><span class="s">&quot;4&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">     </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;GraspObject&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">        </span><span class="nt">&lt;Sequence&gt;</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">           </span><span class="nt">&lt;Action</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;OpenGripper&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">           </span><span class="nt">&lt;Action</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;ApproachObject&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">           </span><span class="nt">&lt;Action</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;CloseGripper&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w">        </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="w">     </span><span class="nt">&lt;/BehaviorTree&gt;</span><span class="w">  </span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w"> </span><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<blockquote>
<p>ℹ️ 注</p>
<p>ROS用户注意：若想在<a href="http://wiki.ros.org/Packages">ROS包</a>内查找文件，可用此语法：</p>
</blockquote>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="nt">&lt;include</span><span class="w"> </span><span class="na">ros_pkg=</span><span class="s">&quot;name_package&quot;</span><span class="w">  </span><span class="na">path=</span><span class="s">&quot;path_relative_to_pkg/grasp.xml&quot;</span><span class="nt">/&gt;</span>
</code></pre></div>
<h1 id="_21">教程（基础）<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h1>
<p>5分钟掌握最重要的Docusaurus概念。</p>
<h2 id="01">01. 你的第一个行为树<a class="headerlink" href="#01" title="Permanent link">&para;</a></h2>
<p>行为树，类似状态机，不过是一种在合适的时间和条件下调用<strong>回调函数</strong>的机制。这些回调内部具体做什么由你决定。</p>
<p>我们将把<strong>“调用回调函数”</strong>和<strong>“tick”</strong>这两个表达交替使用。</p>
<p>在本系列教程中，大多数情况下我们的示例动作只是简单地在控制台打印信息，但请记住，真正的“生产”代码可能会更复杂。</p>
<p>接下来，我们将创建这棵简单的树：</p>
<p><img alt="Tutorial1" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhodG1sPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojZmZmIiBpZD0ic3ZnNjYiIHdpZHRoPSI2NTEiIGhlaWdodD0iMTYxIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9Ii0wLjUgLTAuNSA2NTEgMTYxIj48bWV0YWRhdGEgaWQ9Im1ldGFkYXRhNzIiLz48ZyBpZD0iZzU4Ij48cGF0aCBpZD0icGF0aDIiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0ibSAzNTAsNTAgLTY1LjE3LDU1Ljg2IiBwb2ludGVyLWV2ZW50cz0ic3Ryb2tlIiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwO3N0cm9rZS1taXRlcmxpbWl0OjEwIi8+PHBhdGggaWQ9InBhdGg0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGQ9Im0gMjgwLjg1LDEwOS4yNyAzLjA0LC03LjIxIDAuOTQsMy44IDMuNjEsMS41MSB6IiBwb2ludGVyLWV2ZW50cz0iYWxsIiBzdHlsZT0iZmlsbDojMDAwO3N0cm9rZTojMDAwO3N0cm9rZS1taXRlcmxpbWl0OjEwIi8+PHBhdGggaWQ9InBhdGg2IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGQ9Im0gMzUwLDUwIDYwLjMyLDU1LjY4IiBwb2ludGVyLWV2ZW50cz0ic3Ryb2tlIiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwO3N0cm9rZS1taXRlcmxpbWl0OjEwIi8+PHBhdGggaWQ9InBhdGg4IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGQ9Im0gNDE0LjE4LDEwOS4yNCAtNy41MiwtMi4xNyAzLjY2LC0xLjM5IDEuMDksLTMuNzYgeiIgcG9pbnRlci1ldmVudHM9ImFsbCIgc3R5bGU9ImZpbGw6IzAwMDtzdHJva2U6IzAwMDtzdHJva2UtbWl0ZXJsaW1pdDoxMCIvPjxwYXRoIGlkPSJwYXRoMTAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0ibSAzNTAsNTAgMTkzLjksNTguMTciIHBvaW50ZXItZXZlbnRzPSJzdHJva2UiIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDA7c3Ryb2tlLW1pdGVybGltaXQ6MTAiLz48cGF0aCBpZD0icGF0aDEyIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGQ9Im0gNTQ4LjkzLDEwOS42OCAtNy43MSwxLjM0IDIuNjgsLTIuODUgLTAuNjcsLTMuODYgeiIgcG9pbnRlci1ldmVudHM9ImFsbCIgc3R5bGU9ImZpbGw6IzAwMDtzdHJva2U6IzAwMDtzdHJva2UtbWl0ZXJsaW1pdDoxMCIvPjxwYXRoIGlkPSJwYXRoMTQiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTSAzNTAsNTAgOTEuMjEsMTA4LjU5IiBwb2ludGVyLWV2ZW50cz0ic3Ryb2tlIiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwO3N0cm9rZS1taXRlcmxpbWl0OjEwIi8+PHBhdGggaWQ9InBhdGgxNiIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJtIDg2LjA5LDEwOS43NSA2LjA1LC00Ljk2IC0wLjkzLDMuOCAyLjQ4LDMuMDMgeiIgcG9pbnRlci1ldmVudHM9ImFsbCIgc3R5bGU9ImZpbGw6IzAwMDtzdHJva2U6IzAwMDtzdHJva2UtbWl0ZXJsaW1pdDoxMCIvPjxyZWN0IGlkPSJyZWN0MTgiIHdpZHRoPSIxMjAiIGhlaWdodD0iNDAiIHg9IjI5MCIgeT0iMTAiIHBvaW50ZXItZXZlbnRzPSJhbGwiIHN0eWxlPSJmaWxsOiNmZmY7c3Ryb2tlOiMwMDAiLz48ZyBpZD0iZzI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41LC0wLjUpIj48c3dpdGNoIGlkPSJzd2l0Y2gyMiI+PGZvcmVpZ25PYmplY3Qgc3R5bGU9Im92ZXJmbG93OnZpc2libGU7dGV4dC1hbGlnbjpsZWZ0IiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBwb2ludGVyLWV2ZW50cz0ibm9uZSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5Ij48eGh0bWw6ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6dW5zYWZlIGNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6dW5zYWZlIGNlbnRlcjt3aWR0aDoxMThweDtoZWlnaHQ6MXB4O3BhZGRpbmctdG9wOjMwcHg7bWFyZ2luLWxlZnQ6MjkxcHgiPjx4aHRtbDpkaXYgc3R5bGU9ImJveC1zaXppbmc6Ym9yZGVyLWJveDtmb250LXNpemU6MDt0ZXh0LWFsaWduOmNlbnRlciIgZGF0YS1kcmF3aW8tY29sb3JzPSJjb2xvcjogcmdiKDAsIDAsIDApOyI+PHhodG1sOmRpdiBzdHlsZT0iZGlzcGxheTppbmxpbmUtYmxvY2s7Zm9udC1zaXplOjE4cHg7Zm9udC1mYW1pbHk6SGVsdmV0aWNhO2NvbG9yOiMwMDA7bGluZS1oZWlnaHQ6MS4yO3BvaW50ZXItZXZlbnRzOmFsbDt3aGl0ZS1zcGFjZTpub3JtYWw7b3ZlcmZsb3ctd3JhcDpub3JtYWwiPlNlcXVlbmNlPC94aHRtbDpkaXY+PC94aHRtbDpkaXY+PC94aHRtbDpkaXY+PC9mb3JlaWduT2JqZWN0Pjx0ZXh0IGlkPSJ0ZXh0MjAiIHg9IjM1MCIgeT0iMzUiIGZvbnQtc2l6ZT0iMTgiIHN0eWxlPSJmb250LXNpemU6MThweDtmb250LWZhbWlseTpIZWx2ZXRpY2E7dGV4dC1hbmNob3I6bWlkZGxlO2ZpbGw6IzAwMCI+U2VxdWVuY2U8L3RleHQ+PC9zd2l0Y2g+PC9nPjxyZWN0IGlkPSJyZWN0MjYiIHdpZHRoPSIxMjAiIGhlaWdodD0iNDAiIHg9IjE5MCIgeT0iMTEwIiBwb2ludGVyLWV2ZW50cz0iYWxsIiBzdHlsZT0iZmlsbDojZmZmO3N0cm9rZTojMDAwIi8+PGcgaWQ9ImczMiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSwtMC41KSI+PHN3aXRjaCBpZD0ic3dpdGNoMzAiPjxmb3JlaWduT2JqZWN0IHN0eWxlPSJvdmVyZmxvdzp2aXNpYmxlO3RleHQtYWxpZ246bGVmdCIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcG9pbnRlci1ldmVudHM9Im5vbmUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSI+PHhodG1sOmRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOnVuc2FmZSBjZW50ZXI7anVzdGlmeS1jb250ZW50OnVuc2FmZSBjZW50ZXI7d2lkdGg6MTE4cHg7aGVpZ2h0OjFweDtwYWRkaW5nLXRvcDoxMzBweDttYXJnaW4tbGVmdDoxOTFweCI+PHhodG1sOmRpdiBzdHlsZT0iYm94LXNpemluZzpib3JkZXItYm94O2ZvbnQtc2l6ZTowO3RleHQtYWxpZ246Y2VudGVyIiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7Ij48eGh0bWw6ZGl2IHN0eWxlPSJkaXNwbGF5OmlubGluZS1ibG9jaztmb250LXNpemU6MThweDtmb250LWZhbWlseTpIZWx2ZXRpY2E7Y29sb3I6IzAwMDtsaW5lLWhlaWdodDoxLjI7cG9pbnRlci1ldmVudHM6YWxsO3doaXRlLXNwYWNlOm5vcm1hbDtvdmVyZmxvdy13cmFwOm5vcm1hbCI+T3BlbkdyaXBwZXI8L3hodG1sOmRpdj48L3hodG1sOmRpdj48L3hodG1sOmRpdj48L2ZvcmVpZ25PYmplY3Q+PHRleHQgaWQ9InRleHQyOCIgeD0iMjUwIiB5PSIxMzUiIGZvbnQtc2l6ZT0iMTgiIHN0eWxlPSJmb250LXNpemU6MThweDtmb250LWZhbWlseTpIZWx2ZXRpY2E7dGV4dC1hbmNob3I6bWlkZGxlO2ZpbGw6IzAwMCI+T3BlbkdyaXBwZXI8L3RleHQ+PC9zd2l0Y2g+PC9nPjxyZWN0IGlkPSJyZWN0MzQiIHdpZHRoPSIxNTAiIGhlaWdodD0iNDAiIHg9IjM0MCIgeT0iMTEwIiBwb2ludGVyLWV2ZW50cz0iYWxsIiBzdHlsZT0iZmlsbDojZmZmO3N0cm9rZTojMDAwIi8+PGcgaWQ9Imc0MCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSwtMC41KSI+PHN3aXRjaCBpZD0ic3dpdGNoMzgiPjxmb3JlaWduT2JqZWN0IHN0eWxlPSJvdmVyZmxvdzp2aXNpYmxlO3RleHQtYWxpZ246bGVmdCIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcG9pbnRlci1ldmVudHM9Im5vbmUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSI+PHhodG1sOmRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOnVuc2FmZSBjZW50ZXI7anVzdGlmeS1jb250ZW50OnVuc2FmZSBjZW50ZXI7d2lkdGg6MTQ4cHg7aGVpZ2h0OjFweDtwYWRkaW5nLXRvcDoxMzBweDttYXJnaW4tbGVmdDozNDFweCI+PHhodG1sOmRpdiBzdHlsZT0iYm94LXNpemluZzpib3JkZXItYm94O2ZvbnQtc2l6ZTowO3RleHQtYWxpZ246Y2VudGVyIiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7Ij48eGh0bWw6ZGl2IHN0eWxlPSJkaXNwbGF5OmlubGluZS1ibG9jaztmb250LXNpemU6MThweDtmb250LWZhbWlseTpIZWx2ZXRpY2E7Y29sb3I6IzAwMDtsaW5lLWhlaWdodDoxLjI7cG9pbnRlci1ldmVudHM6YWxsO3doaXRlLXNwYWNlOm5vcm1hbDtvdmVyZmxvdy13cmFwOm5vcm1hbCI+QXBwcm9hY2hPYmplY3Q8L3hodG1sOmRpdj48L3hodG1sOmRpdj48L3hodG1sOmRpdj48L2ZvcmVpZ25PYmplY3Q+PHRleHQgaWQ9InRleHQzNiIgeD0iNDE1IiB5PSIxMzUiIGZvbnQtc2l6ZT0iMTgiIHN0eWxlPSJmb250LXNpemU6MThweDtmb250LWZhbWlseTpIZWx2ZXRpY2E7dGV4dC1hbmNob3I6bWlkZGxlO2ZpbGw6IzAwMCI+QXBwcm9hY2hPYmplY3Q8L3RleHQ+PC9zd2l0Y2g+PC9nPjxyZWN0IGlkPSJyZWN0NDIiIHdpZHRoPSIxMjAiIGhlaWdodD0iNDAiIHg9IjUyMCIgeT0iMTEwIiBwb2ludGVyLWV2ZW50cz0iYWxsIiBzdHlsZT0iZmlsbDojZmZmO3N0cm9rZTojMDAwIi8+PGcgaWQ9Imc0OCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSwtMC41KSI+PHN3aXRjaCBpZD0ic3dpdGNoNDYiPjxmb3JlaWduT2JqZWN0IHN0eWxlPSJvdmVyZmxvdzp2aXNpYmxlO3RleHQtYWxpZ246bGVmdCIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcG9pbnRlci1ldmVudHM9Im5vbmUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSI+PHhodG1sOmRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOnVuc2FmZSBjZW50ZXI7anVzdGlmeS1jb250ZW50OnVuc2FmZSBjZW50ZXI7d2lkdGg6MTE4cHg7aGVpZ2h0OjFweDtwYWRkaW5nLXRvcDoxMzBweDttYXJnaW4tbGVmdDo1MjFweCI+PHhodG1sOmRpdiBzdHlsZT0iYm94LXNpemluZzpib3JkZXItYm94O2ZvbnQtc2l6ZTowO3RleHQtYWxpZ246Y2VudGVyIiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7Ij48eGh0bWw6ZGl2IHN0eWxlPSJkaXNwbGF5OmlubGluZS1ibG9jaztmb250LXNpemU6MThweDtmb250LWZhbWlseTpIZWx2ZXRpY2E7Y29sb3I6IzAwMDtsaW5lLWhlaWdodDoxLjI7cG9pbnRlci1ldmVudHM6YWxsO3doaXRlLXNwYWNlOm5vcm1hbDtvdmVyZmxvdy13cmFwOm5vcm1hbCI+Q2xvc2VHcmlwcGVyPC94aHRtbDpkaXY+PC94aHRtbDpkaXY+PC94aHRtbDpkaXY+PC9mb3JlaWduT2JqZWN0Pjx0ZXh0IGlkPSJ0ZXh0NDQiIHg9IjU4MCIgeT0iMTM1IiBmb250LXNpemU9IjE4IiBzdHlsZT0iZm9udC1zaXplOjE4cHg7Zm9udC1mYW1pbHk6SGVsdmV0aWNhO3RleHQtYW5jaG9yOm1pZGRsZTtmaWxsOiMwMDAiPkNsb3NlR3JpcHBlcjwvdGV4dD48L3N3aXRjaD48L2c+PHJlY3QgaWQ9InJlY3Q1MCIgd2lkdGg9IjE1MCIgaGVpZ2h0PSI0MCIgeD0iMTAiIHk9IjExMCIgcG9pbnRlci1ldmVudHM9ImFsbCIgcng9IjE0LjQiIHJ5PSIxNC40IiBzdHlsZT0iZmlsbDojZmZmO3N0cm9rZTojMDAwIi8+PGcgaWQ9Imc1NiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSwtMC41KSI+PHN3aXRjaCBpZD0ic3dpdGNoNTQiPjxmb3JlaWduT2JqZWN0IHN0eWxlPSJvdmVyZmxvdzp2aXNpYmxlO3RleHQtYWxpZ246bGVmdCIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcG9pbnRlci1ldmVudHM9Im5vbmUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSI+PHhodG1sOmRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOnVuc2FmZSBjZW50ZXI7anVzdGlmeS1jb250ZW50OnVuc2FmZSBjZW50ZXI7d2lkdGg6MTQ4cHg7aGVpZ2h0OjFweDtwYWRkaW5nLXRvcDoxMzBweDttYXJnaW4tbGVmdDoxMXB4Ij48eGh0bWw6ZGl2IHN0eWxlPSJib3gtc2l6aW5nOmJvcmRlci1ib3g7Zm9udC1zaXplOjA7dGV4dC1hbGlnbjpjZW50ZXIiIGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsiPjx4aHRtbDpkaXYgc3R5bGU9ImRpc3BsYXk6aW5saW5lLWJsb2NrO2ZvbnQtc2l6ZToxOHB4O2ZvbnQtZmFtaWx5OkhlbHZldGljYTtjb2xvcjojMDAwO2xpbmUtaGVpZ2h0OjEuMjtwb2ludGVyLWV2ZW50czphbGw7d2hpdGUtc3BhY2U6bm9ybWFsO292ZXJmbG93LXdyYXA6bm9ybWFsIj5DaGVja0JhdHRlcnk8L3hodG1sOmRpdj48L3hodG1sOmRpdj48L3hodG1sOmRpdj48L2ZvcmVpZ25PYmplY3Q+PHRleHQgaWQ9InRleHQ1MiIgeD0iODUiIHk9IjEzNSIgZm9udC1zaXplPSIxOCIgc3R5bGU9ImZvbnQtc2l6ZToxOHB4O2ZvbnQtZmFtaWx5OkhlbHZldGljYTt0ZXh0LWFuY2hvcjptaWRkbGU7ZmlsbDojMDAwIj5DaGVja0JhdHRlcnk8L3RleHQ+PC9zd2l0Y2g+PC9nPjwvZz48L3N2Zz4=" /></p>
<h3 id="actionnodes">如何创建你自己的动作节点（ActionNodes）<a class="headerlink" href="#actionnodes" title="Permanent link">&para;</a></h3>
<p>创建TreeNode的默认（且推荐）方式是通过继承。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1">// 自定义同步动作节点（SyncActionNode）示例（无端口）</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">ApproachObject</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">SyncActionNode</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="p">{</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">  </span><span class="n">ApproachObject</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">:</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">      </span><span class="n">BT</span><span class="o">::</span><span class="n">SyncActionNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w">  </span><span class="p">{}</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">  </span><span class="c1">// 必须重写虚函数 tick()</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">  </span><span class="n">BT</span><span class="o">::</span><span class="n">NodeStatus</span><span class="w"> </span><span class="n">tick</span><span class="p">()</span><span class="w"> </span><span class="k">override</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ApproachObject: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="p">};</span>
</code></pre></div>
<p>如你所见：</p>
<ul>
<li>每个TreeNode实例都有一个<code>name</code>，用于人类可读标识，<strong>不要求唯一</strong>。</li>
<li><strong>tick()</strong>方法是实际动作执行的地方，必须返回<code>NodeStatus</code>，即RUNNING、SUCCESS或FAILURE。</li>
</ul>
<p>另一种方法是使用<strong>依赖注入</strong>，通过函数指针（即“函数对象”）创建TreeNode。</p>
<p>函数对象必须符合签名：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">BT</span><span class="o">::</span><span class="n">NodeStatus</span><span class="w"> </span><span class="n">myFunction</span><span class="p">(</span><span class="n">BT</span><span class="o">::</span><span class="n">TreeNode</span><span class="o">&amp;</span><span class="w"> </span><span class="n">self</span><span class="p">)</span><span class="w"> </span>
</code></pre></div>
<p>示例：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">BT</span><span class="p">;</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="c1">// 简单函数，返回NodeStatus</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="n">BT</span><span class="o">::</span><span class="n">NodeStatus</span><span class="w"> </span><span class="nf">CheckBattery</span><span class="p">()</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="p">{</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;[ Battery: OK ]&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="p">}</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="c1">// 封装open()和close()方法的动作节点示例</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">GripperInterface</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="p">{</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="w">  </span><span class="n">GripperInterface</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="n">_open</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="w">  </span><span class="n">NodeStatus</span><span class="w"> </span><span class="n">open</span><span class="p">()</span><span class="w"> </span>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="w">    </span><span class="n">_open</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;GripperInterface::open&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a>
<a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a><span class="w">  </span><span class="n">NodeStatus</span><span class="w"> </span><span class="n">close</span><span class="p">()</span><span class="w"> </span>
<a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;GripperInterface::close&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a><span class="w">    </span><span class="n">_open</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a>
<a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">_open</span><span class="p">;</span><span class="w"> </span><span class="c1">// 共享状态</span>
<a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a><span class="p">};</span>
</code></pre></div>
<p>我们可以基于以下函数构建<code>SimpleActionNode</code>：</p>
<ul>
<li>CheckBattery()</li>
<li>GripperInterface::open()</li>
<li>GripperInterface::close()</li>
</ul>
<h3 id="xml_2">使用XML动态创建行为树<a class="headerlink" href="#xml_2" title="Permanent link">&para;</a></h3>
<p>假设有如下名为 <strong>my_tree.xml</strong> 的XML文件：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="w"> </span><span class="nt">&lt;root</span><span class="w"> </span><span class="na">BTCPP_format=</span><span class="s">&quot;4&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w">     </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MainTree&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">        </span><span class="nt">&lt;Sequence</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;root_sequence&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">            </span><span class="nt">&lt;CheckBattery</span><span class="w">   </span><span class="na">name=</span><span class="s">&quot;check_battery&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">            </span><span class="nt">&lt;OpenGripper</span><span class="w">    </span><span class="na">name=</span><span class="s">&quot;open_gripper&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">            </span><span class="nt">&lt;ApproachObject</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;approach_object&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">            </span><span class="nt">&lt;CloseGripper</span><span class="w">   </span><span class="na">name=</span><span class="s">&quot;close_gripper&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">        </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">     </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w"> </span><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<blockquote>
<p>💡 提示
更多关于XML格式的细节请参见<a href="https://www.behaviortree.dev/docs/learn-the-basics/xml_format">这里</a>。</p>
</blockquote>
<p>首先，你必须将自定义TreeNodes注册到<code>BehaviorTreeFactory</code>，然后从文件或文本加载XML。</p>
<p>XML中使用的标识符必须与注册时使用的名称一致。</p>
<p>属性“name”表示实例名，<strong>可选</strong>。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;behaviortree_cpp/bt_factory.h&quot;</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="c1">// 自定义节点定义文件</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;dummy_nodes.h&quot;</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">DummyNodes</span><span class="p">;</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="p">{</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">    </span><span class="c1">// 使用BehaviorTreeFactory注册自定义节点</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="w">  </span><span class="n">BehaviorTreeFactory</span><span class="w"> </span><span class="n">factory</span><span class="p">;</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="w">  </span><span class="c1">// 推荐的节点创建方式是通过继承</span>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerNodeType</span><span class="o">&lt;</span><span class="n">ApproachObject</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;ApproachObject&quot;</span><span class="p">);</span>
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a>
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="w">  </span><span class="c1">// 通过函数指针注册简单条件节点</span>
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="w">  </span><span class="c1">// 也可用C++11 lambda或std::bind</span>
<a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerSimpleCondition</span><span class="p">(</span><span class="s">&quot;CheckBattery&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="n">TreeNode</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">CheckBattery</span><span class="p">();</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a>
<a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a><span class="w">  </span><span class="c1">// 也可用类成员方法创建简单动作节点</span>
<a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a><span class="w">  </span><span class="n">GripperInterface</span><span class="w"> </span><span class="n">gripper</span><span class="p">;</span>
<a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerSimpleAction</span><span class="p">(</span><span class="s">&quot;OpenGripper&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="n">TreeNode</span><span class="o">&amp;</span><span class="p">){</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">gripper</span><span class="p">.</span><span class="n">open</span><span class="p">();</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerSimpleAction</span><span class="p">(</span><span class="s">&quot;CloseGripper&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="n">TreeNode</span><span class="o">&amp;</span><span class="p">){</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">gripper</span><span class="p">.</span><span class="n">close</span><span class="p">();</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a>
<a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a><span class="w">  </span><span class="c1">// 树在部署时（运行时，但仅初始化时）创建</span>
<a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a><span class="w">  </span><span class="c1">// 注意：当tree对象超出作用域，所有TreeNodes都会被销毁</span>
<a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a><span class="w">   </span><span class="k">auto</span><span class="w"> </span><span class="n">tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factory</span><span class="p">.</span><span class="n">createTreeFromFile</span><span class="p">(</span><span class="s">&quot;./my_tree.xml&quot;</span><span class="p">);</span>
<a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a>
<a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a><span class="w">  </span><span class="c1">// “执行”树需要tick它</span>
<a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a><span class="w">  </span><span class="c1">// tick信号根据树逻辑传播到子节点</span>
<a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a><span class="w">  </span><span class="c1">// 此例中序列的所有子节点均返回SUCCESS，序列完整执行</span>
<a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a><span class="w">  </span><span class="n">tree</span><span class="p">.</span><span class="n">tickWhileRunning</span><span class="p">();</span>
<a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a>
<a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a><span class="p">}</span>
<a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a>
<a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a><span class="cm">/* 预期输出：</span>
<a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a><span class="cm">*</span>
<a id="__codelineno-18-38" name="__codelineno-18-38" href="#__codelineno-18-38"></a><span class="cm">  [ Battery: OK ]</span>
<a id="__codelineno-18-39" name="__codelineno-18-39" href="#__codelineno-18-39"></a><span class="cm">  GripperInterface::open</span>
<a id="__codelineno-18-40" name="__codelineno-18-40" href="#__codelineno-18-40"></a><span class="cm">  ApproachObject: approach_object</span>
<a id="__codelineno-18-41" name="__codelineno-18-41" href="#__codelineno-18-41"></a><span class="cm">  GripperInterface::close</span>
<a id="__codelineno-18-42" name="__codelineno-18-42" href="#__codelineno-18-42"></a><span class="cm">*/</span>
</code></pre></div>
<h2 id="02-blackboard">02. 黑板（Blackboard）与端口<a class="headerlink" href="#02-blackboard" title="Permanent link">&para;</a></h2>
<p>如前所述，自定义TreeNodes可以执行任意简单或复杂的软件片段。目标是提供更高层次的抽象接口。</p>
<p>因此，它们在概念上类似于<strong>函数</strong>。</p>
<p>类似函数，我们通常希望：</p>
<ul>
<li>向节点传递参数（<strong>输入</strong>）</li>
<li>从节点获得信息（<strong>输出</strong>）</li>
<li>一个节点的输出可以作为另一个节点的输入</li>
</ul>
<p>BehaviorTree.CPP提供了通过<strong>端口（ports）</strong>实现的基础<strong>数据流</strong>机制，使用简单，灵活且类型安全。</p>
<p>本教程将创建如下树：</p>
<p><img alt="教程2" src="https://www.behaviortree.dev/assets/images/tutorial_blackboard-c21790e0c974974f0f3eca9efeb4b765.svg" /></p>
<blockquote>
<p>💡 主要概念</p>
<ul>
<li>“黑板”是所有树节点共享的简单<strong>键/值存储</strong>。</li>
<li>黑板的“条目”是<strong>键/值对</strong>。</li>
<li><strong>输入端口</strong>可读取黑板条目，<strong>输出端口</strong>可写入黑板条目。</li>
</ul>
</blockquote>
<h3 id="_22">输入端口<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h3>
<p>有效的输入可以是：</p>
<ul>
<li>节点直接读取和解析的<strong>静态字符串</strong>，或</li>
<li>指向黑板中某条目的“指针”，由<strong>键</strong>标识。</li>
</ul>
<p>假设我们创建一个动作节点<code>SaySomething</code>，用于打印给定字符串到<code>std::cout</code>。</p>
<p>传递字符串用名为<strong>message</strong>的输入端口。</p>
<p>以下是两种XML语法示例：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="nt">&lt;SaySomething</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;first&quot;</span><span class="w">   </span><span class="na">message=</span><span class="s">&quot;hello world&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="nt">&lt;SaySomething</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;second&quot;</span><span class="w"> </span><span class="na">message=</span><span class="s">&quot;{greetings}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</code></pre></div>
<ul>
<li><strong>第一个</strong>节点端口接收字符串“hello world”；</li>
<li><strong>第二个</strong>节点则从黑板中查找名为“greetings”的条目值。</li>
</ul>
<blockquote>
<p>⚠️ 注意
条目“greetings”的值可能（且很可能会）在运行时改变。</p>
</blockquote>
<p>动作节点<code>SaySomething</code>可实现如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1">// 带输入端口的同步动作节点</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">SaySomething</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">SyncActionNode</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="p">{</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="w">  </span><span class="c1">// 有端口的节点需使用此构造函数签名</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w">  </span><span class="n">SaySomething</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">NodeConfig</span><span class="o">&amp;</span><span class="w"> </span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">SyncActionNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="w">  </span><span class="c1">// 必须定义此静态方法</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">PortsList</span><span class="w"> </span><span class="n">providedPorts</span><span class="p">()</span>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="w">    </span><span class="c1">// 该动作只有一个名为&quot;message&quot;的输入端口</span>
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">InputPort</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>
<a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="w">  </span><span class="c1">// 重写tick()</span>
<a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a><span class="w">  </span><span class="n">NodeStatus</span><span class="w"> </span><span class="n">tick</span><span class="p">()</span><span class="w"> </span><span class="k">override</span>
<a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a><span class="w">    </span><span class="n">Expected</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getInput</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">);</span>
<a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a><span class="w">    </span><span class="c1">// 校验输入是否有效，否则抛出异常</span>
<a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">RuntimeError</span><span class="p">(</span><span class="s">&quot;missing required input [message]: &quot;</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a><span class="w">                              </span><span class="n">msg</span><span class="p">.</span><span class="n">error</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a><span class="w">    </span><span class="c1">// 使用value()获取有效数据</span>
<a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Robot says: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a><span class="p">};</span>
</code></pre></div>
<p>当自定义TreeNode有输入和/或输出端口时，必须在<strong>静态</strong>方法中声明：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">static</span><span class="w"> </span><span class="n">MyCustomNode</span><span class="o">::</span><span class="n">PortsList</span><span class="w"> </span><span class="nf">providedPorts</span><span class="p">();</span>
</code></pre></div>
<p>端口 <code>message</code> 的输入可以通过模板方法 <code>TreeNode::getInput&lt;T&gt;(key)</code> 读取。</p>
<p>该方法可能因多种原因失败，用户需自行检查返回值的有效性，并决定如何处理：</p>
<ul>
<li>返回 <code>NodeStatus::FAILURE</code>？</li>
<li>抛出异常？</li>
<li>使用不同的默认值？</li>
</ul>
<blockquote>
<p>⚠️ 重要提示</p>
<p>建议<strong>始终</strong>在 <code>tick()</code> 内调用 <code>getInput()</code> 方法，<strong>不要</strong>在类的构造函数中调用。</p>
<p>C++代码应预期输入的实际值会<strong>在运行时变化</strong>，因此应定期更新。</p>
</blockquote>
<h3 id="_23">输出端口<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h3>
<p>指向黑板条目的输入端口只有在另一个节点已写入该条目内容时才有效。</p>
<p><code>ThinkWhatToSay</code> 是一个使用<strong>输出端口</strong>向条目写入字符串的节点示例。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ThinkWhatToSay</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">SyncActionNode</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="p">{</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="w">  </span><span class="n">ThinkWhatToSay</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">NodeConfig</span><span class="o">&amp;</span><span class="w"> </span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">SyncActionNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">PortsList</span><span class="w"> </span><span class="n">providedPorts</span><span class="p">()</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">OutputPort</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;text&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="w">  </span><span class="c1">// 该动作向端口&quot;text&quot;写入值</span>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="w">  </span><span class="n">NodeStatus</span><span class="w"> </span><span class="n">tick</span><span class="p">()</span><span class="w"> </span><span class="k">override</span>
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="w">    </span><span class="c1">// 输出可能每次tick()变化，此处简化为固定值</span>
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a><span class="w">    </span><span class="n">setOutput</span><span class="p">(</span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;The answer is 42&quot;</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a><span class="p">};</span>
</code></pre></div>
<p>通常，调试时也可以用内置动作 <code>Script</code> 向条目写入静态值：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="nt">&lt;Script</span><span class="w"> </span><span class="na">code=</span><span class="s">&quot; the_answer:=&#39;The answer is 42&#39; &quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</code></pre></div>
<p>我们将在关于<a href="https://www.behaviortree.dev/docs/guides/scripting">BT.CPP新脚本语言</a>的教程中进一步讲解动作<strong>Script</strong>。</p>
<blockquote>
<p>💡 提示</p>
<p>若你从BT.CPP 3.X迁移，<strong>Script</strong>可视为不需改动的替代品，替代已不推荐使用的<strong>SetBlackboard</strong>。</p>
</blockquote>
<h3 id="_24">完整示例<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h3>
<p>此示例执行3个动作组成的序列：</p>
<ul>
<li>动作1从静态字符串读取输入<code>message</code>。</li>
<li>动作2向黑板条目<code>the_answer</code>写入内容。</li>
<li>动作3从黑板条目<code>the_answer</code>读取输入<code>message</code>。</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="nt">&lt;root</span><span class="w"> </span><span class="na">BTCPP_format=</span><span class="s">&quot;4&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="w">    </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MainTree&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="w">       </span><span class="nt">&lt;Sequence</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;root_sequence&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="w">           </span><span class="nt">&lt;SaySomething</span><span class="w">     </span><span class="na">message=</span><span class="s">&quot;hello&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="w">           </span><span class="nt">&lt;ThinkWhatToSay</span><span class="w">   </span><span class="na">text=</span><span class="s">&quot;{the_answer}&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="w">           </span><span class="nt">&lt;SaySomething</span><span class="w">     </span><span class="na">message=</span><span class="s">&quot;{the_answer}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="w">       </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="w">    </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<p>注册并执行该树的C++代码：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;behaviortree_cpp/bt_factory.h&quot;</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="c1">// 自定义节点定义文件</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;dummy_nodes.h&quot;</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">DummyNodes</span><span class="p">;</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="p">{</span><span class="w">  </span>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="w">  </span><span class="n">BehaviorTreeFactory</span><span class="w"> </span><span class="n">factory</span><span class="p">;</span>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerNodeType</span><span class="o">&lt;</span><span class="n">SaySomething</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;SaySomething&quot;</span><span class="p">);</span>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerNodeType</span><span class="o">&lt;</span><span class="n">ThinkWhatToSay</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;ThinkWhatToSay&quot;</span><span class="p">);</span>
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factory</span><span class="p">.</span><span class="n">createTreeFromFile</span><span class="p">(</span><span class="s">&quot;./my_tree.xml&quot;</span><span class="p">);</span>
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="w">  </span><span class="n">tree</span><span class="p">.</span><span class="n">tickWhileRunning</span><span class="p">();</span>
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="p">}</span>
<a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a>
<a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a><span class="cm">/* 预期输出：</span>
<a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a><span class="cm">  Robot says: hello</span>
<a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a><span class="cm">  Robot says: The answer is 42</span>
<a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a><span class="cm">*/</span>
</code></pre></div>
<p>我们通过相同的键（<code>the_answer</code>）将输出端口连接到输入端口，即它们“指向”黑板的同一条目。</p>
<p>只有当端口类型相同（此例为<code>std::string</code>）时，才可连接端口。若尝试连接不同类型端口，<code>factory.createTreeFromFile</code> 会抛出异常。</p>
<h2 id="03">03. 使用泛型端口<a class="headerlink" href="#03" title="Permanent link">&para;</a></h2>
<p>在之前的教程中，我们介绍了输入和输出端口，端口类型是 <code>std::string</code>。</p>
<p>接下来，我们将展示如何为端口指定泛型的C++类型。</p>
<h3 id="_25">字符串解析<a class="headerlink" href="#_25" title="Permanent link">&para;</a></h3>
<p><strong>BehaviorTree.CPP</strong> 支持自动将字符串转换为常用类型，如 <code>int</code>、<code>long</code>、<code>double</code>、<code>bool</code>、<code>NodeStatus</code> 等，用户自定义类型也能轻松支持。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c1">// 自定义类型</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Position2D</span><span class="w"> </span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="p">};</span>
</code></pre></div>
<p>为了让XML加载器能从字符串实例化 <code>Position2D</code>，需要提供模板特化 <code>BT::convertFromString&lt;Position2D&gt;(StringView)</code>。</p>
<p>如何将 <code>Position2D</code> 序列化为字符串由你决定；此处用分号分隔两个数字。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c1">// 将字符串转换为Position2D的模板特化</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">BT</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="p">{</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w">    </span><span class="k">template</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">Position2D</span><span class="w"> </span><span class="n">convertFromString</span><span class="p">(</span><span class="n">StringView</span><span class="w"> </span><span class="n">str</span><span class="p">)</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="w">        </span><span class="c1">// 期望实数，用分号分割</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">parts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">splitString</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;;&#39;</span><span class="p">);</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">parts</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="n">RuntimeError</span><span class="p">(</span><span class="s">&quot;invalid input)&quot;</span><span class="p">);</span>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a><span class="w">        </span><span class="k">else</span>
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a><span class="w">            </span><span class="n">Position2D</span><span class="w"> </span><span class="n">output</span><span class="p">;</span>
<a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a><span class="w">            </span><span class="n">output</span><span class="p">.</span><span class="n">x</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">convertFromString</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a><span class="w">            </span><span class="n">output</span><span class="p">.</span><span class="n">y</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">convertFromString</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">output</span><span class="p">;</span>
<a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a><span class="p">}</span><span class="w"> </span><span class="c1">// namespace BT</span>
</code></pre></div>
<ul>
<li><code>StringView</code> 是C++11版本的<a href="https://en.cppreference.com/w/cpp/header/string_view">std::string_view</a>，可传入 <code>std::string</code> 或 <code>const char*</code>。</li>
<li>库提供了简单的 <code>splitString</code> 函数，也可以用其他如 <a href="https://www.boost.org/doc/libs/1_80_0/doc/html/boost/algorithm/split.html">boost::algorithm::split</a>。</li>
<li>我们使用了特化的 <code>convertFromString&lt;double&gt;()</code>。</li>
</ul>
<h3 id="_26">示例<a class="headerlink" href="#_26" title="Permanent link">&para;</a></h3>
<p>同前教程，我们创建两个自定义动作，一个写端口，一个读端口。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">CalculateGoal</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">SyncActionNode</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="p">{</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">  </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="w">    </span><span class="n">CalculateGoal</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">NodeConfig</span><span class="o">&amp;</span><span class="w"> </span><span class="n">config</span><span class="p">)</span><span class="o">:</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">      </span><span class="n">SyncActionNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="w">    </span><span class="p">{}</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">PortsList</span><span class="w"> </span><span class="n">providedPorts</span><span class="p">()</span>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">OutputPort</span><span class="o">&lt;</span><span class="n">Position2D</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;goal&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="w">    </span><span class="n">NodeStatus</span><span class="w"> </span><span class="n">tick</span><span class="p">()</span><span class="w"> </span><span class="k">override</span>
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a><span class="w">      </span><span class="n">Position2D</span><span class="w"> </span><span class="n">mygoal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">1.1</span><span class="p">,</span><span class="w"> </span><span class="mf">2.3</span><span class="p">};</span>
<a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a><span class="w">      </span><span class="n">setOutput</span><span class="o">&lt;</span><span class="n">Position2D</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;goal&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mygoal</span><span class="p">);</span>
<a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a><span class="p">};</span>
<a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a>
<a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a><span class="k">class</span><span class="w"> </span><span class="nc">PrintTarget</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">SyncActionNode</span>
<a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a><span class="p">{</span>
<a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a><span class="w">  </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a><span class="w">    </span><span class="n">PrintTarget</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">NodeConfig</span><span class="o">&amp;</span><span class="w"> </span><span class="n">config</span><span class="p">)</span><span class="o">:</span>
<a id="__codelineno-28-25" name="__codelineno-28-25" href="#__codelineno-28-25"></a><span class="w">        </span><span class="n">SyncActionNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-28-26" name="__codelineno-28-26" href="#__codelineno-28-26"></a><span class="w">    </span><span class="p">{}</span>
<a id="__codelineno-28-27" name="__codelineno-28-27" href="#__codelineno-28-27"></a>
<a id="__codelineno-28-28" name="__codelineno-28-28" href="#__codelineno-28-28"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">PortsList</span><span class="w"> </span><span class="n">providedPorts</span><span class="p">()</span>
<a id="__codelineno-28-29" name="__codelineno-28-29" href="#__codelineno-28-29"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-28-30" name="__codelineno-28-30" href="#__codelineno-28-30"></a><span class="w">      </span><span class="c1">// 端口可带有人类可读描述</span>
<a id="__codelineno-28-31" name="__codelineno-28-31" href="#__codelineno-28-31"></a><span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w">  </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Simply print the goal on console...&quot;</span><span class="p">;</span>
<a id="__codelineno-28-32" name="__codelineno-28-32" href="#__codelineno-28-32"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">InputPort</span><span class="o">&lt;</span><span class="n">Position2D</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;target&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-28-33" name="__codelineno-28-33" href="#__codelineno-28-33"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-28-34" name="__codelineno-28-34" href="#__codelineno-28-34"></a>
<a id="__codelineno-28-35" name="__codelineno-28-35" href="#__codelineno-28-35"></a><span class="w">    </span><span class="n">NodeStatus</span><span class="w"> </span><span class="n">tick</span><span class="p">()</span><span class="w"> </span><span class="k">override</span>
<a id="__codelineno-28-36" name="__codelineno-28-36" href="#__codelineno-28-36"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-28-37" name="__codelineno-28-37" href="#__codelineno-28-37"></a><span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getInput</span><span class="o">&lt;</span><span class="n">Position2D</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;target&quot;</span><span class="p">);</span>
<a id="__codelineno-28-38" name="__codelineno-28-38" href="#__codelineno-28-38"></a><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">res</span><span class="w"> </span><span class="p">)</span>
<a id="__codelineno-28-39" name="__codelineno-28-39" href="#__codelineno-28-39"></a><span class="w">      </span><span class="p">{</span>
<a id="__codelineno-28-40" name="__codelineno-28-40" href="#__codelineno-28-40"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="n">RuntimeError</span><span class="p">(</span><span class="s">&quot;error reading port [target]:&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">.</span><span class="n">error</span><span class="p">());</span>
<a id="__codelineno-28-41" name="__codelineno-28-41" href="#__codelineno-28-41"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-28-42" name="__codelineno-28-42" href="#__codelineno-28-42"></a><span class="w">      </span><span class="n">Position2D</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="p">.</span><span class="n">value</span><span class="p">();</span>
<a id="__codelineno-28-43" name="__codelineno-28-43" href="#__codelineno-28-43"></a><span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Target positions: [ %.1f, %.1f ]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-28-44" name="__codelineno-28-44" href="#__codelineno-28-44"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<a id="__codelineno-28-45" name="__codelineno-28-45" href="#__codelineno-28-45"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-28-46" name="__codelineno-28-46" href="#__codelineno-28-46"></a><span class="p">};</span>
</code></pre></div>
<p>现在可以像往常一样连接输入输出端口，指向黑板同一条目。</p>
<p>下面的树是4个动作组成的序列：</p>
<ul>
<li>使用动作 <code>CalculateGoal</code> 向黑板条目 <strong>GoalPosition</strong> 存储 <code>Position2D</code> 值。</li>
<li>调用 <code>PrintTarget</code>，其输入“target”从黑板条目 <strong>GoalPosition</strong> 读取。</li>
<li>用内置动作 <code>Script</code> 给键 <strong>OtherGoal</strong> 赋值字符串 <code>"-1;3"</code>，字符串到 <code>Position2D</code> 的转换自动完成。</li>
<li>再次调用 <code>PrintTarget</code>，输入“target”从条目 <strong>OtherGoal</strong> 读取。</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">xml_text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sa">R</span><span class="s">&quot;</span><span class="dl">(</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="s"> &lt;root BTCPP_format=&quot;4&quot; &gt;</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="s">     &lt;BehaviorTree ID=&quot;MainTree&quot;&gt;</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="s">        &lt;Sequence name=&quot;root&quot;&gt;</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="s">            &lt;CalculateGoal goal=&quot;{GoalPosition}&quot; /&gt;</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="s">            &lt;PrintTarget   target=&quot;{GoalPosition}&quot; /&gt;</span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="s">            &lt;Script        code=&quot; OtherGoal:=&#39;-1;3&#39; &quot; /&gt;</span>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="s">            &lt;PrintTarget   target=&quot;{OtherGoal}&quot; /&gt;</span>
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="s">        &lt;/Sequence&gt;</span>
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="s">     &lt;/BehaviorTree&gt;</span>
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="s"> &lt;/root&gt;</span>
<a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="s"> </span><span class="dl">)</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a>
<a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a><span class="p">{</span>
<a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a><span class="w">  </span><span class="n">BT</span><span class="o">::</span><span class="n">BehaviorTreeFactory</span><span class="w"> </span><span class="n">factory</span><span class="p">;</span>
<a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerNodeType</span><span class="o">&lt;</span><span class="n">CalculateGoal</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;CalculateGoal&quot;</span><span class="p">);</span>
<a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerNodeType</span><span class="o">&lt;</span><span class="n">PrintTarget</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;PrintTarget&quot;</span><span class="p">);</span>
<a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a>
<a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factory</span><span class="p">.</span><span class="n">createTreeFromText</span><span class="p">(</span><span class="n">xml_text</span><span class="p">);</span>
<a id="__codelineno-29-22" name="__codelineno-29-22" href="#__codelineno-29-22"></a><span class="w">  </span><span class="n">tree</span><span class="p">.</span><span class="n">tickWhileRunning</span><span class="p">();</span>
<a id="__codelineno-29-23" name="__codelineno-29-23" href="#__codelineno-29-23"></a>
<a id="__codelineno-29-24" name="__codelineno-29-24" href="#__codelineno-29-24"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-29-25" name="__codelineno-29-25" href="#__codelineno-29-25"></a><span class="p">}</span>
<a id="__codelineno-29-26" name="__codelineno-29-26" href="#__codelineno-29-26"></a><span class="cm">/* 预期输出：</span>
<a id="__codelineno-29-27" name="__codelineno-29-27" href="#__codelineno-29-27"></a>
<a id="__codelineno-29-28" name="__codelineno-29-28" href="#__codelineno-29-28"></a><span class="cm">    Target positions: [ 1.1, 2.3 ]</span>
<a id="__codelineno-29-29" name="__codelineno-29-29" href="#__codelineno-29-29"></a><span class="cm">    Converting string: &quot;-1;3&quot;</span>
<a id="__codelineno-29-30" name="__codelineno-29-30" href="#__codelineno-29-30"></a><span class="cm">    Target positions: [ -1.0, 3.0 ]</span>
<a id="__codelineno-29-31" name="__codelineno-29-31" href="#__codelineno-29-31"></a><span class="cm">*/</span>
</code></pre></div>
<h2 id="04">04. 响应式行为<a class="headerlink" href="#04" title="Permanent link">&para;</a></h2>
<p>下例展示了 <code>SequenceNode</code> 与 <code>ReactiveSequence</code> 的区别。</p>
<p>我们将实现一个<strong>异步动作</strong>，即完成需要较长时间，且未满足完成条件时返回RUNNING的动作。</p>
<p>异步动作需满足：</p>
<ul>
<li><code>tick()</code> 方法不应阻塞过久，执行流应尽快返回。</li>
<li>当调用 <code>halt()</code> 方法时，应尽快中止。</li>
</ul>
<blockquote>
<p>⚠️ 注意</p>
<p><strong>深入了解异步动作</strong></p>
<p>用户应充分理解BT.CPP中并发机制，并学习如何开发异步动作的最佳实践。详见<a href="https://www.behaviortree.dev/docs/guides/asynchronous_nodes">这里</a>。</p>
</blockquote>
<h3 id="statefulactionnode">StatefulActionNode<a class="headerlink" href="#statefulactionnode" title="Permanent link">&para;</a></h3>
<p><strong>StatefulActionNode</strong> 是实现异步动作的推荐方式。</p>
<p>特别适用于包含<strong>请求-应答模式</strong>的代码，即动作向另一进程发送异步请求，并周期性检查是否收到回复。</p>
<p>根据回复可返回SUCCESS或FAILURE。</p>
<p>如果不是与外部进程通信，而是执行耗时计算，可考虑分块执行或移至其他线程（详见<a href="https://www.behaviortree.dev/docs/guides/asynchronous_nodes">AsyncThreadedAction</a>教程）。</p>
<p>继承自<strong>StatefulActionNode</strong>的类须重写以下虚函数，替代<code>tick()</code>：</p>
<ul>
<li><code>NodeStatus onStart()</code>：节点处于IDLE时调用。可立即返回成功、失败或RUNNING。若返回RUNNING，下次tick时执行<code>onRunning</code>。</li>
<li><code>NodeStatus onRunning()</code>：节点处于RUNNING时调用，返回最新状态。</li>
<li><code>void onHalted()</code>：节点被树中其他节点中止时调用。</li>
</ul>
<p>示例：创建虚拟节点 <strong>MoveBaseAction</strong>：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="c1">// 自定义类型</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Pose2D</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="p">{</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">theta</span><span class="p">;</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="p">};</span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">chr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">std</span><span class="o">::</span><span class="nn">chrono</span><span class="p">;</span>
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">MoveBaseAction</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">StatefulActionNode</span>
<a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a><span class="p">{</span>
<a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a><span class="w">  </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a><span class="w">    </span><span class="c1">// 含端口的TreeNode必须有此构造函数签名</span>
<a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a><span class="w">    </span><span class="n">MoveBaseAction</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">NodeConfig</span><span class="o">&amp;</span><span class="w"> </span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="n">StatefulActionNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a><span class="w">    </span><span class="p">{}</span>
<a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a>
<a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a><span class="w">    </span><span class="c1">// 必须定义此静态方法</span>
<a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">PortsList</span><span class="w"> </span><span class="n">providedPorts</span><span class="p">()</span>
<a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a><span class="w">        </span><span class="k">return</span><span class="p">{</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">InputPort</span><span class="o">&lt;</span><span class="n">Pose2D</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;goal&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a>
<a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a><span class="w">    </span><span class="c1">// 初始调用一次</span>
<a id="__codelineno-30-24" name="__codelineno-30-24" href="#__codelineno-30-24"></a><span class="w">    </span><span class="n">BT</span><span class="o">::</span><span class="n">NodeStatus</span><span class="w"> </span><span class="n">onStart</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<a id="__codelineno-30-25" name="__codelineno-30-25" href="#__codelineno-30-25"></a>
<a id="__codelineno-30-26" name="__codelineno-30-26" href="#__codelineno-30-26"></a><span class="w">    </span><span class="c1">// 若onStart()返回RUNNING，则持续调用此方法直到返回非RUNNING状态</span>
<a id="__codelineno-30-27" name="__codelineno-30-27" href="#__codelineno-30-27"></a><span class="w">    </span><span class="n">BT</span><span class="o">::</span><span class="n">NodeStatus</span><span class="w"> </span><span class="nf">onRunning</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<a id="__codelineno-30-28" name="__codelineno-30-28" href="#__codelineno-30-28"></a>
<a id="__codelineno-30-29" name="__codelineno-30-29" href="#__codelineno-30-29"></a><span class="w">    </span><span class="c1">// 节点被中止时调用</span>
<a id="__codelineno-30-30" name="__codelineno-30-30" href="#__codelineno-30-30"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">onHalted</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<a id="__codelineno-30-31" name="__codelineno-30-31" href="#__codelineno-30-31"></a>
<a id="__codelineno-30-32" name="__codelineno-30-32" href="#__codelineno-30-32"></a><span class="w">  </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-30-33" name="__codelineno-30-33" href="#__codelineno-30-33"></a><span class="w">    </span><span class="n">Pose2D</span><span class="w"> </span><span class="n">_goal</span><span class="p">;</span>
<a id="__codelineno-30-34" name="__codelineno-30-34" href="#__codelineno-30-34"></a><span class="w">    </span><span class="n">chr</span><span class="o">::</span><span class="n">system_clock</span><span class="o">::</span><span class="n">time_point</span><span class="w"> </span><span class="n">_completion_time</span><span class="p">;</span>
<a id="__codelineno-30-35" name="__codelineno-30-35" href="#__codelineno-30-35"></a><span class="p">};</span>
<a id="__codelineno-30-36" name="__codelineno-30-36" href="#__codelineno-30-36"></a>
<a id="__codelineno-30-37" name="__codelineno-30-37" href="#__codelineno-30-37"></a><span class="c1">//-------------------------</span>
<a id="__codelineno-30-38" name="__codelineno-30-38" href="#__codelineno-30-38"></a>
<a id="__codelineno-30-39" name="__codelineno-30-39" href="#__codelineno-30-39"></a><span class="n">BT</span><span class="o">::</span><span class="n">NodeStatus</span><span class="w"> </span><span class="nf">MoveBaseAction::onStart</span><span class="p">()</span>
<a id="__codelineno-30-40" name="__codelineno-30-40" href="#__codelineno-30-40"></a><span class="p">{</span>
<a id="__codelineno-30-41" name="__codelineno-30-41" href="#__codelineno-30-41"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">getInput</span><span class="o">&lt;</span><span class="n">Pose2D</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;goal&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_goal</span><span class="p">))</span>
<a id="__codelineno-30-42" name="__codelineno-30-42" href="#__codelineno-30-42"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-30-43" name="__codelineno-30-43" href="#__codelineno-30-43"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">RuntimeError</span><span class="p">(</span><span class="s">&quot;missing required input [goal]&quot;</span><span class="p">);</span>
<a id="__codelineno-30-44" name="__codelineno-30-44" href="#__codelineno-30-44"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-30-45" name="__codelineno-30-45" href="#__codelineno-30-45"></a><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;[ MoveBase: SEND REQUEST ]. goal: x=%f y=%f theta=%f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<a id="__codelineno-30-46" name="__codelineno-30-46" href="#__codelineno-30-46"></a><span class="w">         </span><span class="n">_goal</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">_goal</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">_goal</span><span class="p">.</span><span class="n">theta</span><span class="p">);</span>
<a id="__codelineno-30-47" name="__codelineno-30-47" href="#__codelineno-30-47"></a>
<a id="__codelineno-30-48" name="__codelineno-30-48" href="#__codelineno-30-48"></a><span class="w">  </span><span class="c1">// 用计时器模拟耗时动作（200毫秒）</span>
<a id="__codelineno-30-49" name="__codelineno-30-49" href="#__codelineno-30-49"></a><span class="w">  </span><span class="n">_completion_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chr</span><span class="o">::</span><span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">chr</span><span class="o">::</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">220</span><span class="p">);</span>
<a id="__codelineno-30-50" name="__codelineno-30-50" href="#__codelineno-30-50"></a>
<a id="__codelineno-30-51" name="__codelineno-30-51" href="#__codelineno-30-51"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">RUNNING</span><span class="p">;</span>
<a id="__codelineno-30-52" name="__codelineno-30-52" href="#__codelineno-30-52"></a><span class="p">}</span>
<a id="__codelineno-30-53" name="__codelineno-30-53" href="#__codelineno-30-53"></a>
<a id="__codelineno-30-54" name="__codelineno-30-54" href="#__codelineno-30-54"></a><span class="n">BT</span><span class="o">::</span><span class="n">NodeStatus</span><span class="w"> </span><span class="nf">MoveBaseAction::onRunning</span><span class="p">()</span>
<a id="__codelineno-30-55" name="__codelineno-30-55" href="#__codelineno-30-55"></a><span class="p">{</span>
<a id="__codelineno-30-56" name="__codelineno-30-56" href="#__codelineno-30-56"></a><span class="w">  </span><span class="c1">// 模拟检查回复是否已收到，注意不要阻塞太久</span>
<a id="__codelineno-30-57" name="__codelineno-30-57" href="#__codelineno-30-57"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">chr</span><span class="o">::</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>
<a id="__codelineno-30-58" name="__codelineno-30-58" href="#__codelineno-30-58"></a>
<a id="__codelineno-30-59" name="__codelineno-30-59" href="#__codelineno-30-59"></a><span class="w">  </span><span class="c1">// 模拟操作完成的时间点</span>
<a id="__codelineno-30-60" name="__codelineno-30-60" href="#__codelineno-30-60"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">chr</span><span class="o">::</span><span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">_completion_time</span><span class="p">)</span>
<a id="__codelineno-30-61" name="__codelineno-30-61" href="#__codelineno-30-61"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-30-62" name="__codelineno-30-62" href="#__codelineno-30-62"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;[ MoveBase: FINISHED ]&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-30-63" name="__codelineno-30-63" href="#__codelineno-30-63"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<a id="__codelineno-30-64" name="__codelineno-30-64" href="#__codelineno-30-64"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-30-65" name="__codelineno-30-65" href="#__codelineno-30-65"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">RUNNING</span><span class="p">;</span>
<a id="__codelineno-30-66" name="__codelineno-30-66" href="#__codelineno-30-66"></a><span class="p">}</span>
<a id="__codelineno-30-67" name="__codelineno-30-67" href="#__codelineno-30-67"></a>
<a id="__codelineno-30-68" name="__codelineno-30-68" href="#__codelineno-30-68"></a><span class="kt">void</span><span class="w"> </span><span class="nf">MoveBaseAction::onHalted</span><span class="p">()</span>
<a id="__codelineno-30-69" name="__codelineno-30-69" href="#__codelineno-30-69"></a><span class="p">{</span>
<a id="__codelineno-30-70" name="__codelineno-30-70" href="#__codelineno-30-70"></a><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;[ MoveBase: ABORTED ]&quot;</span><span class="p">);</span>
<a id="__codelineno-30-71" name="__codelineno-30-71" href="#__codelineno-30-71"></a><span class="p">}</span>
</code></pre></div>
<h3 id="sequence-reactivesequence">Sequence 与 ReactiveSequence 的区别<a class="headerlink" href="#sequence-reactivesequence" title="Permanent link">&para;</a></h3>
<p>下面的示例使用简单的 <code>SequenceNode</code>。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="w"> </span><span class="nt">&lt;root</span><span class="w"> </span><span class="na">BTCPP_format=</span><span class="s">&quot;4&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w">     </span><span class="nt">&lt;BehaviorTree&gt;</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="w">        </span><span class="nt">&lt;Sequence&gt;</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="w">            </span><span class="nt">&lt;BatteryOK/&gt;</span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="w">            </span><span class="nt">&lt;SaySomething</span><span class="w">   </span><span class="na">message=</span><span class="s">&quot;mission started...&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="w">            </span><span class="nt">&lt;MoveBase</span><span class="w">           </span><span class="na">goal=</span><span class="s">&quot;1;2;3&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="w">            </span><span class="nt">&lt;SaySomething</span><span class="w">   </span><span class="na">message=</span><span class="s">&quot;mission completed!&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="w">        </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="w">     </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="w"> </span><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="p">{</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="w">  </span><span class="n">BT</span><span class="o">::</span><span class="n">BehaviorTreeFactory</span><span class="w"> </span><span class="n">factory</span><span class="p">;</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerSimpleCondition</span><span class="p">(</span><span class="s">&quot;BatteryOK&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="n">CheckBattery</span><span class="p">));</span>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerNodeType</span><span class="o">&lt;</span><span class="n">MoveBaseAction</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;MoveBase&quot;</span><span class="p">);</span>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerNodeType</span><span class="o">&lt;</span><span class="n">SaySomething</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;SaySomething&quot;</span><span class="p">);</span>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factory</span><span class="p">.</span><span class="n">createTreeFromText</span><span class="p">(</span><span class="n">xml_text</span><span class="p">);</span>
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="w">  </span><span class="c1">// 这里我们不用 tree.tickWhileRunning()</span>
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a><span class="w">  </span><span class="c1">// 而是用自己的循环</span>
<a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;--- ticking</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tree</span><span class="p">.</span><span class="n">tickOnce</span><span class="p">();</span>
<a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;--- status: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">toStr</span><span class="p">(</span><span class="n">status</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a>
<a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a><span class="w">  </span><span class="k">while</span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">RUNNING</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a><span class="w">    </span><span class="c1">// 避免忙等，睡眠一段时间</span>
<a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a><span class="w">    </span><span class="c1">// 请不要用其他sleep函数！</span>
<a id="__codelineno-32-20" name="__codelineno-32-20" href="#__codelineno-32-20"></a><span class="w">    </span><span class="c1">// 这里用较长时间只是为了控制输出数量</span>
<a id="__codelineno-32-21" name="__codelineno-32-21" href="#__codelineno-32-21"></a><span class="w">    </span><span class="n">tree</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
<a id="__codelineno-32-22" name="__codelineno-32-22" href="#__codelineno-32-22"></a>
<a id="__codelineno-32-23" name="__codelineno-32-23" href="#__codelineno-32-23"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;--- ticking</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-32-24" name="__codelineno-32-24" href="#__codelineno-32-24"></a><span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tree</span><span class="p">.</span><span class="n">tickOnce</span><span class="p">();</span>
<a id="__codelineno-32-25" name="__codelineno-32-25" href="#__codelineno-32-25"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;--- status: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">toStr</span><span class="p">(</span><span class="n">status</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-32-26" name="__codelineno-32-26" href="#__codelineno-32-26"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-32-27" name="__codelineno-32-27" href="#__codelineno-32-27"></a>
<a id="__codelineno-32-28" name="__codelineno-32-28" href="#__codelineno-32-28"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-32-29" name="__codelineno-32-29" href="#__codelineno-32-29"></a><span class="p">}</span>
</code></pre></div>
<p>预期输出：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>--- ticking
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>[ Battery: OK ]
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>Robot says: mission started...
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>[ MoveBase: SEND REQUEST ]. goal: x=1.0 y=2.0 theta=3.0
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>--- status: RUNNING
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>--- ticking
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>--- status: RUNNING
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>--- ticking
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a>[ MoveBase: FINISHED ]
<a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>Robot says: mission completed!
<a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a>--- status: SUCCESS
</code></pre></div>
<p>你会注意到，<code>executeTick()</code> 第1和第2次调用时 <code>MoveBase</code> 返回 <strong>RUNNING</strong>，第3次返回 <strong>SUCCESS</strong>。</p>
<p><code>BatteryOK</code> 只执行一次。</p>
<p>若使用 <code>ReactiveSequence</code>，当子节点 <code>MoveBase</code> 返回 RUNNING 时，序列会重新开始，条件 <code>BatteryOK</code> 会<strong>再次</strong>执行。</p>
<p>若任意时刻 <code>BatteryOK</code> 返回 <strong>FAILURE</strong>，<code>MoveBase</code> 动作将被<em>中断</em>（即<code>halted</code>）。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="w"> </span><span class="nt">&lt;root&gt;</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="w">     </span><span class="nt">&lt;BehaviorTree&gt;</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="w">        </span><span class="nt">&lt;ReactiveSequence&gt;</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="w">            </span><span class="nt">&lt;BatteryOK/&gt;</span>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="w">            </span><span class="nt">&lt;Sequence&gt;</span>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="w">                </span><span class="nt">&lt;SaySomething</span><span class="w">   </span><span class="na">message=</span><span class="s">&quot;mission started...&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="w">                </span><span class="nt">&lt;MoveBase</span><span class="w">           </span><span class="na">goal=</span><span class="s">&quot;1;2;3&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="w">                </span><span class="nt">&lt;SaySomething</span><span class="w">   </span><span class="na">message=</span><span class="s">&quot;mission completed!&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="w">            </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="w">        </span><span class="nt">&lt;/ReactiveSequence&gt;</span>
<a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="w">     </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="w"> </span><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<p>预期输出：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>--- ticking
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>[ Battery: OK ]
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>Robot says: mission started...
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>[ MoveBase: SEND REQUEST ]. goal: x=1.0 y=2.0 theta=3.0
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>--- status: RUNNING
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a>--- ticking
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a>[ Battery: OK ]
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a>--- status: RUNNING
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a>
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a>--- ticking
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a>[ Battery: OK ]
<a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a>[ MoveBase: FINISHED ]
<a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a>Robot says: mission completed!
<a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a>--- status: SUCCESS
</code></pre></div>
<h3 id="_27">事件驱动树？<a class="headerlink" href="#_27" title="Permanent link">&para;</a></h3>
<blockquote>
<p>💡 提示
我们使用 <code>tree.sleep()</code> 而非 <code>std::this_thread::sleep_for()</code> 是有原因的！</p>
<p>应优先使用 <code>Tree::sleep()</code>，因为当树中某节点调用 <code>TreeNode::emitStateChanged()</code> 时，<code>Tree::sleep()</code> 可被打断。</p>
</blockquote>
<h2 id="05-subtrees">05. 使用子树（SubTrees）<a class="headerlink" href="#05-subtrees" title="Permanent link">&para;</a></h2>
<p>通过将小而可复用的行为插入到更大行为中，可构建大规模行为。</p>
<p>换言之，我们想创建<strong>分层</strong>行为树，使树结构可<strong>组合</strong>。</p>
<p>这可通过在XML中定义多棵树，并用节点 <strong>SubTree</strong> 将一棵树包含进另一棵树实现。</p>
<h3 id="crossdoor">CrossDoor 行为示例<a class="headerlink" href="#crossdoor" title="Permanent link">&para;</a></h3>
<p>灵感来源于一篇流行的<a href="https://www.gamedeveloper.com/programming/behavior-trees-for-ai-how-they-work">行为树文章</a>。</p>
<p>这也是第一个实用示例，涉及使用 <code>Decorators</code> 和 <code>Fallback</code>。</p>
<p><img alt="crossdoor_subtree.svg" src="https://www.behaviortree.dev/assets/images/crossdoor_subtree-4f2304772a896359d3fc67c9802e0bef.svg" /></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="nt">&lt;root</span><span class="w"> </span><span class="na">BTCPP_format=</span><span class="s">&quot;4&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="w">    </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MainTree&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="w">        </span><span class="nt">&lt;Sequence&gt;</span>
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="w">            </span><span class="nt">&lt;Fallback&gt;</span>
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="w">                </span><span class="nt">&lt;Inverter&gt;</span>
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="w">                    </span><span class="nt">&lt;IsDoorClosed/&gt;</span>
<a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="w">                </span><span class="nt">&lt;/Inverter&gt;</span>
<a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="w">                </span><span class="nt">&lt;SubTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;DoorClosed&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a><span class="w">            </span><span class="nt">&lt;/Fallback&gt;</span>
<a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a><span class="w">            </span><span class="nt">&lt;PassThroughDoor/&gt;</span>
<a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a><span class="w">        </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a><span class="w">    </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a>
<a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a><span class="w">    </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;DoorClosed&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a><span class="w">        </span><span class="nt">&lt;Fallback&gt;</span>
<a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a><span class="w">            </span><span class="nt">&lt;OpenDoor/&gt;</span>
<a id="__codelineno-36-18" name="__codelineno-36-18" href="#__codelineno-36-18"></a><span class="w">            </span><span class="nt">&lt;RetryUntilSuccessful</span><span class="w"> </span><span class="na">num_attempts=</span><span class="s">&quot;5&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-36-19" name="__codelineno-36-19" href="#__codelineno-36-19"></a><span class="w">                </span><span class="nt">&lt;PickLock/&gt;</span>
<a id="__codelineno-36-20" name="__codelineno-36-20" href="#__codelineno-36-20"></a><span class="w">            </span><span class="nt">&lt;/RetryUntilSuccessful&gt;</span>
<a id="__codelineno-36-21" name="__codelineno-36-21" href="#__codelineno-36-21"></a><span class="w">            </span><span class="nt">&lt;SmashDoor/&gt;</span>
<a id="__codelineno-36-22" name="__codelineno-36-22" href="#__codelineno-36-22"></a><span class="w">        </span><span class="nt">&lt;/Fallback&gt;</span>
<a id="__codelineno-36-23" name="__codelineno-36-23" href="#__codelineno-36-23"></a><span class="w">    </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-36-24" name="__codelineno-36-24" href="#__codelineno-36-24"></a>
<a id="__codelineno-36-25" name="__codelineno-36-25" href="#__codelineno-36-25"></a><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<p>期望行为：</p>
<ul>
<li>如果门是开着的，则执行 <code>PassThroughDoor</code>。</li>
<li>如果门关着，尝试 <code>OpenDoor</code>，或尝试最多5次 <code>PickLock</code>，最后尝试 <code>SmashDoor</code>。</li>
<li>如果 <code>DoorClosed</code> 子树中的至少一个动作成功，则执行 <code>PassThroughDoor</code>。</li>
</ul>
<h3 id="cpp">CPP 代码示例<a class="headerlink" href="#cpp" title="Permanent link">&para;</a></h3>
<p>我们不展示 <code>CrossDoor</code> 中模拟动作的具体实现。</p>
<p>重点是 <code>registerNodes</code> 方法：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">CrossDoor</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="p">{</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">registerNodes</span><span class="p">(</span><span class="n">BT</span><span class="o">::</span><span class="n">BehaviorTreeFactory</span><span class="o">&amp;</span><span class="w"> </span><span class="n">factory</span><span class="p">);</span>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="w">    </span><span class="c1">// 如果 _door_open != true 返回 SUCCESS</span>
<a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a><span class="w">    </span><span class="n">BT</span><span class="o">::</span><span class="n">NodeStatus</span><span class="w"> </span><span class="nf">isDoorClosed</span><span class="p">();</span>
<a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>
<a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a><span class="w">    </span><span class="c1">// 如果 _door_open == true 返回 SUCCESS</span>
<a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a><span class="w">    </span><span class="n">BT</span><span class="o">::</span><span class="n">NodeStatus</span><span class="w"> </span><span class="nf">passThroughDoor</span><span class="p">();</span>
<a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a>
<a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a><span class="w">    </span><span class="c1">// 3次尝试后开锁</span>
<a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a><span class="w">    </span><span class="n">BT</span><span class="o">::</span><span class="n">NodeStatus</span><span class="w"> </span><span class="nf">pickLock</span><span class="p">();</span>
<a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a>
<a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a><span class="w">    </span><span class="c1">// 如果门锁着返回 FAILURE</span>
<a id="__codelineno-37-16" name="__codelineno-37-16" href="#__codelineno-37-16"></a><span class="w">    </span><span class="n">BT</span><span class="o">::</span><span class="n">NodeStatus</span><span class="w"> </span><span class="nf">openDoor</span><span class="p">();</span>
<a id="__codelineno-37-17" name="__codelineno-37-17" href="#__codelineno-37-17"></a>
<a id="__codelineno-37-18" name="__codelineno-37-18" href="#__codelineno-37-18"></a><span class="w">    </span><span class="c1">// 总是开门</span>
<a id="__codelineno-37-19" name="__codelineno-37-19" href="#__codelineno-37-19"></a><span class="w">    </span><span class="n">BT</span><span class="o">::</span><span class="n">NodeStatus</span><span class="w"> </span><span class="nf">smashDoor</span><span class="p">();</span>
<a id="__codelineno-37-20" name="__codelineno-37-20" href="#__codelineno-37-20"></a>
<a id="__codelineno-37-21" name="__codelineno-37-21" href="#__codelineno-37-21"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-37-22" name="__codelineno-37-22" href="#__codelineno-37-22"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">_door_open</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-37-23" name="__codelineno-37-23" href="#__codelineno-37-23"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">_door_locked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-37-24" name="__codelineno-37-24" href="#__codelineno-37-24"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">_pick_attempts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-37-25" name="__codelineno-37-25" href="#__codelineno-37-25"></a><span class="p">};</span>
<a id="__codelineno-37-26" name="__codelineno-37-26" href="#__codelineno-37-26"></a>
<a id="__codelineno-37-27" name="__codelineno-37-27" href="#__codelineno-37-27"></a><span class="c1">// 辅助函数，简化用户注册</span>
<a id="__codelineno-37-28" name="__codelineno-37-28" href="#__codelineno-37-28"></a><span class="kt">void</span><span class="w"> </span><span class="nf">CrossDoor::registerNodes</span><span class="p">(</span><span class="n">BT</span><span class="o">::</span><span class="n">BehaviorTreeFactory</span><span class="w"> </span><span class="o">&amp;</span><span class="n">factory</span><span class="p">)</span>
<a id="__codelineno-37-29" name="__codelineno-37-29" href="#__codelineno-37-29"></a><span class="p">{</span>
<a id="__codelineno-37-30" name="__codelineno-37-30" href="#__codelineno-37-30"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerSimpleCondition</span><span class="p">(</span>
<a id="__codelineno-37-31" name="__codelineno-37-31" href="#__codelineno-37-31"></a><span class="w">      </span><span class="s">&quot;IsDoorClosed&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">CrossDoor</span><span class="o">::</span><span class="n">isDoorClosed</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">));</span>
<a id="__codelineno-37-32" name="__codelineno-37-32" href="#__codelineno-37-32"></a>
<a id="__codelineno-37-33" name="__codelineno-37-33" href="#__codelineno-37-33"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerSimpleAction</span><span class="p">(</span>
<a id="__codelineno-37-34" name="__codelineno-37-34" href="#__codelineno-37-34"></a><span class="w">      </span><span class="s">&quot;PassThroughDoor&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">CrossDoor</span><span class="o">::</span><span class="n">passThroughDoor</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">));</span>
<a id="__codelineno-37-35" name="__codelineno-37-35" href="#__codelineno-37-35"></a>
<a id="__codelineno-37-36" name="__codelineno-37-36" href="#__codelineno-37-36"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerSimpleAction</span><span class="p">(</span>
<a id="__codelineno-37-37" name="__codelineno-37-37" href="#__codelineno-37-37"></a><span class="w">      </span><span class="s">&quot;OpenDoor&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">CrossDoor</span><span class="o">::</span><span class="n">openDoor</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">));</span>
<a id="__codelineno-37-38" name="__codelineno-37-38" href="#__codelineno-37-38"></a>
<a id="__codelineno-37-39" name="__codelineno-37-39" href="#__codelineno-37-39"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerSimpleAction</span><span class="p">(</span>
<a id="__codelineno-37-40" name="__codelineno-37-40" href="#__codelineno-37-40"></a><span class="w">      </span><span class="s">&quot;PickLock&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">CrossDoor</span><span class="o">::</span><span class="n">pickLock</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">));</span>
<a id="__codelineno-37-41" name="__codelineno-37-41" href="#__codelineno-37-41"></a>
<a id="__codelineno-37-42" name="__codelineno-37-42" href="#__codelineno-37-42"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerSimpleCondition</span><span class="p">(</span>
<a id="__codelineno-37-43" name="__codelineno-37-43" href="#__codelineno-37-43"></a><span class="w">      </span><span class="s">&quot;SmashDoor&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">CrossDoor</span><span class="o">::</span><span class="n">smashDoor</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">));</span>
<a id="__codelineno-37-44" name="__codelineno-37-44" href="#__codelineno-37-44"></a><span class="p">}</span>
<a id="__codelineno-37-45" name="__codelineno-37-45" href="#__codelineno-37-45"></a>
<a id="__codelineno-37-46" name="__codelineno-37-46" href="#__codelineno-37-46"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-37-47" name="__codelineno-37-47" href="#__codelineno-37-47"></a><span class="p">{</span>
<a id="__codelineno-37-48" name="__codelineno-37-48" href="#__codelineno-37-48"></a><span class="w">  </span><span class="n">BehaviorTreeFactory</span><span class="w"> </span><span class="n">factory</span><span class="p">;</span>
<a id="__codelineno-37-49" name="__codelineno-37-49" href="#__codelineno-37-49"></a>
<a id="__codelineno-37-50" name="__codelineno-37-50" href="#__codelineno-37-50"></a><span class="w">  </span><span class="n">CrossDoor</span><span class="w"> </span><span class="n">cross_door</span><span class="p">;</span>
<a id="__codelineno-37-51" name="__codelineno-37-51" href="#__codelineno-37-51"></a><span class="w">  </span><span class="n">cross_door</span><span class="p">.</span><span class="n">registerNodes</span><span class="p">(</span><span class="n">factory</span><span class="p">);</span>
<a id="__codelineno-37-52" name="__codelineno-37-52" href="#__codelineno-37-52"></a>
<a id="__codelineno-37-53" name="__codelineno-37-53" href="#__codelineno-37-53"></a><span class="w">  </span><span class="c1">// 本示例XML含多棵&lt;BehaviorTree&gt;</span>
<a id="__codelineno-37-54" name="__codelineno-37-54" href="#__codelineno-37-54"></a><span class="w">  </span><span class="c1">// 确定主树时先注册XML，然后根据ID创建树</span>
<a id="__codelineno-37-55" name="__codelineno-37-55" href="#__codelineno-37-55"></a>
<a id="__codelineno-37-56" name="__codelineno-37-56" href="#__codelineno-37-56"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerBehaviorTreeFromText</span><span class="p">(</span><span class="n">xml_text</span><span class="p">);</span>
<a id="__codelineno-37-57" name="__codelineno-37-57" href="#__codelineno-37-57"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factory</span><span class="p">.</span><span class="n">createTree</span><span class="p">(</span><span class="s">&quot;MainTree&quot;</span><span class="p">);</span>
<a id="__codelineno-37-58" name="__codelineno-37-58" href="#__codelineno-37-58"></a>
<a id="__codelineno-37-59" name="__codelineno-37-59" href="#__codelineno-37-59"></a><span class="w">  </span><span class="c1">// 打印树结构的辅助函数</span>
<a id="__codelineno-37-60" name="__codelineno-37-60" href="#__codelineno-37-60"></a><span class="w">  </span><span class="n">printTreeRecursively</span><span class="p">(</span><span class="n">tree</span><span class="p">.</span><span class="n">rootNode</span><span class="p">());</span>
<a id="__codelineno-37-61" name="__codelineno-37-61" href="#__codelineno-37-61"></a>
<a id="__codelineno-37-62" name="__codelineno-37-62" href="#__codelineno-37-62"></a><span class="w">  </span><span class="n">tree</span><span class="p">.</span><span class="n">tickWhileRunning</span><span class="p">();</span>
<a id="__codelineno-37-63" name="__codelineno-37-63" href="#__codelineno-37-63"></a>
<a id="__codelineno-37-64" name="__codelineno-37-64" href="#__codelineno-37-64"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-37-65" name="__codelineno-37-65" href="#__codelineno-37-65"></a><span class="p">}</span>
</code></pre></div>
<h2 id="06-port-remapping">06. 端口重映射（Port Remapping）<a class="headerlink" href="#06-port-remapping" title="Permanent link">&para;</a></h2>
<p>在CrossDoor示例中，子树在父树看来像单个叶节点。</p>
<p>为避免大型树中的名称冲突，每棵树和子树拥有各自的黑板实例。</p>
<p>因此，需显式将树的端口连接（重映射）到子树的端口。</p>
<p>你<strong>无需</strong>修改C++实现，重映射完全由XML定义完成。</p>
<h3 id="_28">示例<a class="headerlink" href="#_28" title="Permanent link">&para;</a></h3>
<p>行为树示意图：</p>
<p><img alt="port_remapping.svg" src="https://www.behaviortree.dev/assets/images/port_remapping-e025094ce2207aef9dfda609fa10bae7.svg" /></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="nt">&lt;root</span><span class="w"> </span><span class="na">BTCPP_format=</span><span class="s">&quot;4&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="w">    </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MainTree&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="w">        </span><span class="nt">&lt;Sequence&gt;</span>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="w">            </span><span class="nt">&lt;Script</span><span class="w"> </span><span class="na">code=</span><span class="s">&quot; move_goal=&#39;1;2;3&#39; &quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="w">            </span><span class="nt">&lt;SubTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MoveRobot&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;{move_goal}&quot;</span><span class="w"> </span>
<a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="w">                                    </span><span class="na">result=</span><span class="s">&quot;{move_result}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="w">            </span><span class="nt">&lt;SaySomething</span><span class="w"> </span><span class="na">message=</span><span class="s">&quot;{move_result}&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="w">        </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a><span class="w">    </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a>
<a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a><span class="w">    </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MoveRobot&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a><span class="w">        </span><span class="nt">&lt;Fallback&gt;</span>
<a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a><span class="w">            </span><span class="nt">&lt;Sequence&gt;</span>
<a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a><span class="w">                </span><span class="nt">&lt;MoveBase</span><span class="w">  </span><span class="na">goal=</span><span class="s">&quot;{target}&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a><span class="w">                </span><span class="nt">&lt;Script</span><span class="w"> </span><span class="na">code=</span><span class="s">&quot; result:=&#39;goal reached&#39; &quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a><span class="w">            </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-38-18" name="__codelineno-38-18" href="#__codelineno-38-18"></a><span class="w">            </span><span class="nt">&lt;ForceFailure&gt;</span>
<a id="__codelineno-38-19" name="__codelineno-38-19" href="#__codelineno-38-19"></a><span class="w">                </span><span class="nt">&lt;Script</span><span class="w"> </span><span class="na">code=</span><span class="s">&quot; result:=&#39;error&#39; &quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-38-20" name="__codelineno-38-20" href="#__codelineno-38-20"></a><span class="w">            </span><span class="nt">&lt;/ForceFailure&gt;</span>
<a id="__codelineno-38-21" name="__codelineno-38-21" href="#__codelineno-38-21"></a><span class="w">        </span><span class="nt">&lt;/Fallback&gt;</span>
<a id="__codelineno-38-22" name="__codelineno-38-22" href="#__codelineno-38-22"></a><span class="w">    </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-38-23" name="__codelineno-38-23" href="#__codelineno-38-23"></a>
<a id="__codelineno-38-24" name="__codelineno-38-24" href="#__codelineno-38-24"></a><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<p>你会注意到：</p>
<ul>
<li>有个 <code>MainTree</code>，包含名为 <code>MoveRobot</code> 的子树。</li>
<li>希望“连接”（即重映射） <code>MoveRobot</code> 子树的端口与 <code>MainTree</code> 其它端口。</li>
<li>该示例使用的语法完成了这项操作。</li>
</ul>
<h3 id="cpp_1">CPP 代码<a class="headerlink" href="#cpp_1" title="Permanent link">&para;</a></h3>
<p>没多少需要做的，我们用 <code>debugMessage</code> 方法检查黑板值。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="p">{</span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="w">  </span><span class="n">BT</span><span class="o">::</span><span class="n">BehaviorTreeFactory</span><span class="w"> </span><span class="n">factory</span><span class="p">;</span>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a>
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerNodeType</span><span class="o">&lt;</span><span class="n">SaySomething</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;SaySomething&quot;</span><span class="p">);</span>
<a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerNodeType</span><span class="o">&lt;</span><span class="n">MoveBaseAction</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;MoveBase&quot;</span><span class="p">);</span>
<a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a>
<a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerBehaviorTreeFromText</span><span class="p">(</span><span class="n">xml_text</span><span class="p">);</span>
<a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factory</span><span class="p">.</span><span class="n">createTree</span><span class="p">(</span><span class="s">&quot;MainTree&quot;</span><span class="p">);</span>
<a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a>
<a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a><span class="w">  </span><span class="c1">// 不断tick直到完成</span>
<a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a><span class="w">  </span><span class="n">tree</span><span class="p">.</span><span class="n">tickWhileRunning</span><span class="p">();</span>
<a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a>
<a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a><span class="w">  </span><span class="c1">// 查看黑板当前状态</span>
<a id="__codelineno-39-15" name="__codelineno-39-15" href="#__codelineno-39-15"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">------ First BB ------&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-39-16" name="__codelineno-39-16" href="#__codelineno-39-16"></a><span class="w">  </span><span class="n">tree</span><span class="p">.</span><span class="n">subtrees</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">blackboard</span><span class="o">-&gt;</span><span class="n">debugMessage</span><span class="p">();</span>
<a id="__codelineno-39-17" name="__codelineno-39-17" href="#__codelineno-39-17"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">------ Second BB------&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-39-18" name="__codelineno-39-18" href="#__codelineno-39-18"></a><span class="w">  </span><span class="n">tree</span><span class="p">.</span><span class="n">subtrees</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">blackboard</span><span class="o">-&gt;</span><span class="n">debugMessage</span><span class="p">();</span>
<a id="__codelineno-39-19" name="__codelineno-39-19" href="#__codelineno-39-19"></a>
<a id="__codelineno-39-20" name="__codelineno-39-20" href="#__codelineno-39-20"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-39-21" name="__codelineno-39-21" href="#__codelineno-39-21"></a><span class="p">}</span>
<a id="__codelineno-39-22" name="__codelineno-39-22" href="#__codelineno-39-22"></a>
<a id="__codelineno-39-23" name="__codelineno-39-23" href="#__codelineno-39-23"></a><span class="cm">/* 预期输出：</span>
<a id="__codelineno-39-24" name="__codelineno-39-24" href="#__codelineno-39-24"></a>
<a id="__codelineno-39-25" name="__codelineno-39-25" href="#__codelineno-39-25"></a><span class="cm">------ First BB ------</span>
<a id="__codelineno-39-26" name="__codelineno-39-26" href="#__codelineno-39-26"></a><span class="cm">move_result (std::string)</span>
<a id="__codelineno-39-27" name="__codelineno-39-27" href="#__codelineno-39-27"></a><span class="cm">move_goal (Pose2D)</span>
<a id="__codelineno-39-28" name="__codelineno-39-28" href="#__codelineno-39-28"></a>
<a id="__codelineno-39-29" name="__codelineno-39-29" href="#__codelineno-39-29"></a><span class="cm">------ Second BB------</span>
<a id="__codelineno-39-30" name="__codelineno-39-30" href="#__codelineno-39-30"></a><span class="cm">[result] remapped to port of parent tree [move_result]</span>
<a id="__codelineno-39-31" name="__codelineno-39-31" href="#__codelineno-39-31"></a><span class="cm">[target] remapped to port of parent tree [move_goal]</span>
<a id="__codelineno-39-32" name="__codelineno-39-32" href="#__codelineno-39-32"></a>
<a id="__codelineno-39-33" name="__codelineno-39-33" href="#__codelineno-39-33"></a><span class="cm">*/</span>
</code></pre></div>
<h2 id="07-xml">07. 使用多个 XML 文件<a class="headerlink" href="#07-xml" title="Permanent link">&para;</a></h2>
<p>在之前示例中，我们总是从<strong>单个 XML 文件</strong>创建整棵树及其子树。</p>
<p>但随着子树数量增加，使用多个文件更方便。</p>
<h3 id="_29">子树示例<a class="headerlink" href="#_29" title="Permanent link">&para;</a></h3>
<p>文件 <strong>subtree_A.xml</strong>：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="nt">&lt;root&gt;</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="w">    </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;SubTreeA&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="w">        </span><span class="nt">&lt;SaySomething</span><span class="w"> </span><span class="na">message=</span><span class="s">&quot;Executing Sub_A&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="w">    </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<p>文件 <strong>subtree_B.xml</strong>：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="nt">&lt;root&gt;</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="w">    </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;SubTreeB&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="w">        </span><span class="nt">&lt;SaySomething</span><span class="w"> </span><span class="na">message=</span><span class="s">&quot;Executing Sub_B&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="w">    </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<h3 id="_30">手动加载多个文件（推荐）<a class="headerlink" href="#_30" title="Permanent link">&para;</a></h3>
<p>假设文件 <strong>main_tree.xml</strong> 包含另外两个文件：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="nt">&lt;root&gt;</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="w">    </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MainTree&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="w">        </span><span class="nt">&lt;Sequence&gt;</span>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="w">            </span><span class="nt">&lt;SaySomething</span><span class="w"> </span><span class="na">message=</span><span class="s">&quot;starting MainTree&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="w">            </span><span class="nt">&lt;SubTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;SubTreeA&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="w">            </span><span class="nt">&lt;SubTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;SubTreeB&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="w">        </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="w">    </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<p>手动加载多个文件示例：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="p">{</span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="w">  </span><span class="n">BT</span><span class="o">::</span><span class="n">BehaviorTreeFactory</span><span class="w"> </span><span class="n">factory</span><span class="p">;</span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerNodeType</span><span class="o">&lt;</span><span class="n">DummyNodes</span><span class="o">::</span><span class="n">SaySomething</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;SaySomething&quot;</span><span class="p">);</span>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="w">  </span><span class="c1">// 使用 std::filesystem::directory_iterator 遍历文件夹，注册所有 XML</span>
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">search_directory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;./&quot;</span><span class="p">;</span>
<a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a>
<a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a><span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">filesystem</span><span class="o">::</span><span class="n">directory_iterator</span><span class="p">;</span>
<a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="k">const</span><span class="o">&amp;</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">directory_iterator</span><span class="p">(</span><span class="n">search_directory</span><span class="p">))</span><span class="w"> </span>
<a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">entry</span><span class="p">.</span><span class="n">path</span><span class="p">().</span><span class="n">extension</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;.xml&quot;</span><span class="p">)</span>
<a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a><span class="w">      </span><span class="n">factory</span><span class="p">.</span><span class="n">registerBehaviorTreeFromFile</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">path</span><span class="p">().</span><span class="n">string</span><span class="p">());</span>
<a id="__codelineno-43-15" name="__codelineno-43-15" href="#__codelineno-43-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-43-16" name="__codelineno-43-16" href="#__codelineno-43-16"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-43-17" name="__codelineno-43-17" href="#__codelineno-43-17"></a><span class="w">  </span><span class="c1">// 相当于调用：</span>
<a id="__codelineno-43-18" name="__codelineno-43-18" href="#__codelineno-43-18"></a><span class="w">  </span><span class="c1">// factory.registerBehaviorTreeFromFile(&quot;./main_tree.xml&quot;);</span>
<a id="__codelineno-43-19" name="__codelineno-43-19" href="#__codelineno-43-19"></a><span class="w">  </span><span class="c1">// factory.registerBehaviorTreeFromFile(&quot;./subtree_A.xml&quot;);</span>
<a id="__codelineno-43-20" name="__codelineno-43-20" href="#__codelineno-43-20"></a><span class="w">  </span><span class="c1">// factory.registerBehaviorTreeFromFile(&quot;./subtree_B.xml&quot;);</span>
<a id="__codelineno-43-21" name="__codelineno-43-21" href="#__codelineno-43-21"></a>
<a id="__codelineno-43-22" name="__codelineno-43-22" href="#__codelineno-43-22"></a><span class="w">  </span><span class="c1">// 创建主树，子树自动添加</span>
<a id="__codelineno-43-23" name="__codelineno-43-23" href="#__codelineno-43-23"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;----- MainTree tick ----&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-43-24" name="__codelineno-43-24" href="#__codelineno-43-24"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">main_tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factory</span><span class="p">.</span><span class="n">createTree</span><span class="p">(</span><span class="s">&quot;MainTree&quot;</span><span class="p">);</span>
<a id="__codelineno-43-25" name="__codelineno-43-25" href="#__codelineno-43-25"></a><span class="w">  </span><span class="n">main_tree</span><span class="p">.</span><span class="n">tickWhileRunning</span><span class="p">();</span>
<a id="__codelineno-43-26" name="__codelineno-43-26" href="#__codelineno-43-26"></a>
<a id="__codelineno-43-27" name="__codelineno-43-27" href="#__codelineno-43-27"></a><span class="w">  </span><span class="c1">// 或只创建其中一个子树</span>
<a id="__codelineno-43-28" name="__codelineno-43-28" href="#__codelineno-43-28"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;----- SubA tick ----&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-43-29" name="__codelineno-43-29" href="#__codelineno-43-29"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">subA_tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factory</span><span class="p">.</span><span class="n">createTree</span><span class="p">(</span><span class="s">&quot;SubTreeA&quot;</span><span class="p">);</span>
<a id="__codelineno-43-30" name="__codelineno-43-30" href="#__codelineno-43-30"></a><span class="w">  </span><span class="n">subA_tree</span><span class="p">.</span><span class="n">tickWhileRunning</span><span class="p">();</span>
<a id="__codelineno-43-31" name="__codelineno-43-31" href="#__codelineno-43-31"></a>
<a id="__codelineno-43-32" name="__codelineno-43-32" href="#__codelineno-43-32"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-43-33" name="__codelineno-43-33" href="#__codelineno-43-33"></a><span class="p">}</span>
<a id="__codelineno-43-34" name="__codelineno-43-34" href="#__codelineno-43-34"></a><span class="cm">/* 预期输出：</span>
<a id="__codelineno-43-35" name="__codelineno-43-35" href="#__codelineno-43-35"></a>
<a id="__codelineno-43-36" name="__codelineno-43-36" href="#__codelineno-43-36"></a><span class="cm">Registered BehaviorTrees:</span>
<a id="__codelineno-43-37" name="__codelineno-43-37" href="#__codelineno-43-37"></a><span class="cm"> - MainTree</span>
<a id="__codelineno-43-38" name="__codelineno-43-38" href="#__codelineno-43-38"></a><span class="cm"> - SubTreeA</span>
<a id="__codelineno-43-39" name="__codelineno-43-39" href="#__codelineno-43-39"></a><span class="cm"> - SubTreeB</span>
<a id="__codelineno-43-40" name="__codelineno-43-40" href="#__codelineno-43-40"></a><span class="cm">----- MainTree tick ----</span>
<a id="__codelineno-43-41" name="__codelineno-43-41" href="#__codelineno-43-41"></a><span class="cm">Robot says: starting MainTree</span>
<a id="__codelineno-43-42" name="__codelineno-43-42" href="#__codelineno-43-42"></a><span class="cm">Robot says: Executing Sub_A</span>
<a id="__codelineno-43-43" name="__codelineno-43-43" href="#__codelineno-43-43"></a><span class="cm">Robot says: Executing Sub_B</span>
<a id="__codelineno-43-44" name="__codelineno-43-44" href="#__codelineno-43-44"></a><span class="cm">----- SubA tick ----</span>
<a id="__codelineno-43-45" name="__codelineno-43-45" href="#__codelineno-43-45"></a><span class="cm">Robot says: Executing Sub_A</span>
<a id="__codelineno-43-46" name="__codelineno-43-46" href="#__codelineno-43-46"></a><span class="cm">*/</span>
</code></pre></div>
<h3 id="include">使用“include”添加多个文件<a class="headerlink" href="#include" title="Permanent link">&para;</a></h3>
<p>如果希望将树的包含信息放在XML内，可修改 <strong>main_tree.xml</strong> 如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="nt">&lt;root</span><span class="w"> </span><span class="na">BTCPP_format=</span><span class="s">&quot;4&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="w">    </span><span class="nt">&lt;include</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;./subtree_A.xml&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="w">    </span><span class="nt">&lt;include</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;./subtree_B.xml&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="w">    </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MainTree&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="w">        </span><span class="nt">&lt;Sequence&gt;</span>
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="w">            </span><span class="nt">&lt;SaySomething</span><span class="w"> </span><span class="na">message=</span><span class="s">&quot;starting MainTree&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="w">            </span><span class="nt">&lt;SubTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;SubTreeA&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="w">            </span><span class="nt">&lt;SubTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;SubTreeB&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="w">        </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a><span class="w">    </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<p>注意：include 的路径相对于 <strong>main_tree.xml</strong>。</p>
<p>创建树时，照常调用：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="n">factory</span><span class="p">.</span><span class="n">createTreeFromFile</span><span class="p">(</span><span class="s">&quot;main_tree.xml&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="08">08. 传递额外参数<a class="headerlink" href="#08" title="Permanent link">&para;</a></h2>
<p>之前所有示例中，我们都需提供如下构造函数：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="n">MyCustomNode</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">NodeConfig</span><span class="o">&amp;</span><span class="w"> </span><span class="n">config</span><span class="p">);</span>
</code></pre></div>
<p>有时希望向类构造函数传递额外参数、指针或引用等。</p>
<blockquote>
<p>⚠️ 注意</p>
<p>有人会用黑板实现此功能，<strong>请勿这样做</strong>。</p>
</blockquote>
<p>以下称这些参数为*"arguments"*。</p>
<p>虽然理论上可以用输入端口传递，但若满足以下条件则不推荐：</p>
<ul>
<li>参数在<em>部署时</em>已知（构建树时）。</li>
<li>参数<em>运行时</em>不变。</li>
<li>参数不需由XML设置。</li>
</ul>
<p>满足以上条件，使用端口或黑板均不合适。</p>
<h3 id="_31">推荐做法：向构造函数添加参数<a class="headerlink" href="#_31" title="Permanent link">&para;</a></h3>
<p>示例，自定义节点 <strong>Action_A</strong>，传入两个复杂参数：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Action_A</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">SyncActionNode</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="p">{</span>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="w">    </span><span class="c1">// 构造函数含额外参数</span>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="w">    </span><span class="n">Action_A</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">NodeConfig</span><span class="o">&amp;</span><span class="w"> </span><span class="n">config</span><span class="p">,</span>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="w">             </span><span class="kt">int</span><span class="w"> </span><span class="n">arg_int</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">arg_str</span><span class="p">)</span><span class="o">:</span>
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="w">        </span><span class="n">SyncActionNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">),</span>
<a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="w">        </span><span class="n">_arg1</span><span class="p">(</span><span class="n">arg_int</span><span class="p">),</span>
<a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a><span class="w">        </span><span class="n">_arg2</span><span class="p">(</span><span class="n">arg_str</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a>
<a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">PortsList</span><span class="w"> </span><span class="n">providedPorts</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a>
<a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a><span class="w">    </span><span class="n">NodeStatus</span><span class="w"> </span><span class="n">tick</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<a id="__codelineno-47-14" name="__codelineno-47-14" href="#__codelineno-47-14"></a>
<a id="__codelineno-47-15" name="__codelineno-47-15" href="#__codelineno-47-15"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-47-16" name="__codelineno-47-16" href="#__codelineno-47-16"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">_arg1</span><span class="p">;</span>
<a id="__codelineno-47-17" name="__codelineno-47-17" href="#__codelineno-47-17"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">_arg2</span><span class="p">;</span>
<a id="__codelineno-47-18" name="__codelineno-47-18" href="#__codelineno-47-18"></a><span class="p">};</span>
</code></pre></div>
<p>注册并传递参数：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="n">BT</span><span class="o">::</span><span class="n">BehaviorTreeFactory</span><span class="w"> </span><span class="n">factory</span><span class="p">;</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="n">factory</span><span class="p">.</span><span class="n">registerNodeType</span><span class="o">&lt;</span><span class="n">Action_A</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;Action_A&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hello world&quot;</span><span class="p">);</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="c1">// 指定模板参数也可</span>
<a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="c1">// factory.registerNodeType&lt;Action_A, int, std::string&gt;(&quot;Action_A&quot;, 42, &quot;hello world&quot;);</span>
</code></pre></div>
<h3 id="_32">使用初始化方法<a class="headerlink" href="#_32" title="Permanent link">&para;</a></h3>
<p>若想为同一节点类型的不同实例传递不同参数，可用初始化方法：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Action_B</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">SyncActionNode</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="p">{</span>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="w">    </span><span class="n">Action_B</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">NodeConfig</span><span class="o">&amp;</span><span class="w"> </span><span class="n">config</span><span class="p">)</span><span class="o">:</span>
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="w">        </span><span class="n">SyncActionNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a>
<a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="w">    </span><span class="c1">// 希望此方法在第一次tick()前调用且只调用一次</span>
<a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">initialize</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">arg_int</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">arg_str</span><span class="p">)</span>
<a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a><span class="w">        </span><span class="n">_arg1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arg_int</span><span class="p">;</span>
<a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a><span class="w">        </span><span class="n">_arg2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arg_str</span><span class="p">;</span>
<a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a>
<a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">PortsList</span><span class="w"> </span><span class="n">providedPorts</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-49-15" name="__codelineno-49-15" href="#__codelineno-49-15"></a>
<a id="__codelineno-49-16" name="__codelineno-49-16" href="#__codelineno-49-16"></a><span class="w">    </span><span class="n">NodeStatus</span><span class="w"> </span><span class="n">tick</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<a id="__codelineno-49-17" name="__codelineno-49-17" href="#__codelineno-49-17"></a>
<a id="__codelineno-49-18" name="__codelineno-49-18" href="#__codelineno-49-18"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-49-19" name="__codelineno-49-19" href="#__codelineno-49-19"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">_arg1</span><span class="p">;</span>
<a id="__codelineno-49-20" name="__codelineno-49-20" href="#__codelineno-49-20"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">_arg2</span><span class="p">;</span>
<a id="__codelineno-49-21" name="__codelineno-49-21" href="#__codelineno-49-21"></a><span class="p">};</span>
</code></pre></div>
<p>注册和初始化方式：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="n">BT</span><span class="o">::</span><span class="n">BehaviorTreeFactory</span><span class="w"> </span><span class="n">factory</span><span class="p">;</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="c1">// 正常注册</span>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="n">factory</span><span class="p">.</span><span class="n">registerNodeType</span><span class="o">&lt;</span><span class="n">Action_B</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;Action_B&quot;</span><span class="p">);</span>
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a>
<a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="c1">// 创建整棵树，Action_B实例尚未初始化</span>
<a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="k">auto</span><span class="w"> </span><span class="n">tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factory</span><span class="p">.</span><span class="n">createTreeFromText</span><span class="p">(</span><span class="n">xml_text</span><span class="p">);</span>
<a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a>
<a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a><span class="c1">// visitor访问所有节点，初始化 Action_B 实例</span>
<a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a><span class="k">auto</span><span class="w"> </span><span class="n">visitor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="n">TreeNode</span><span class="o">*</span><span class="w"> </span><span class="n">node</span><span class="p">)</span>
<a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a><span class="p">{</span>
<a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">action_B_node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">Action_B</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
<a id="__codelineno-50-13" name="__codelineno-50-13" href="#__codelineno-50-13"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-50-14" name="__codelineno-50-14" href="#__codelineno-50-14"></a><span class="w">    </span><span class="n">action_B_node</span><span class="o">-&gt;</span><span class="n">initialize</span><span class="p">(</span><span class="mi">69</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;interesting_value&quot;</span><span class="p">);</span>
<a id="__codelineno-50-15" name="__codelineno-50-15" href="#__codelineno-50-15"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-50-16" name="__codelineno-50-16" href="#__codelineno-50-16"></a><span class="p">};</span>
<a id="__codelineno-50-17" name="__codelineno-50-17" href="#__codelineno-50-17"></a>
<a id="__codelineno-50-18" name="__codelineno-50-18" href="#__codelineno-50-18"></a><span class="c1">// 应用visitor访问整棵树所有节点</span>
<a id="__codelineno-50-19" name="__codelineno-50-19" href="#__codelineno-50-19"></a><span class="n">tree</span><span class="p">.</span><span class="n">applyVisitor</span><span class="p">(</span><span class="n">visitor</span><span class="p">);</span>
</code></pre></div>
<h2 id="09">09. 脚本示例<a class="headerlink" href="#09" title="Permanent link">&para;</a></h2>
<p>更详细说明请见 <a href="https://www.behaviortree.dev/docs/guides/scripting">脚本简介</a>。本教程提供一个非常基础的示例，供初学者练习。</p>
<h3 id="_33">脚本节点与前置条件节点<a class="headerlink" href="#_33" title="Permanent link">&para;</a></h3>
<p>在我们的脚本语言中，变量即为黑板（blackboard）中的条目。</p>
<p>本示例使用节点 <strong>Script</strong> 设置变量，并展示如何在 <strong>SaySomething</strong> 中通过输入端口访问这些变量。</p>
<p>支持的类型包括数字（整数和浮点数）、字符串和已注册的枚举（ENUM）。</p>
<blockquote>
<p>⚠️ 注意</p>
<p>我们使用了 <strong>magic_enums</strong>，其有一些已知<a href="https://github.com/Neargye/magic_enum/blob/master/doc/limitations.md">限制</a>。
其中一个限制是默认枚举范围为 [-128, 128]，除非按照链接中说明修改。</p>
</blockquote>
<p>示例 XML：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="nt">&lt;root</span><span class="w"> </span><span class="na">BTCPP_format=</span><span class="s">&quot;4&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="w">  </span><span class="nt">&lt;BehaviorTree&gt;</span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="w">    </span><span class="nt">&lt;Sequence&gt;</span>
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="w">      </span><span class="nt">&lt;Script</span><span class="w"> </span><span class="na">code=</span><span class="s">&quot; msg:=&#39;hello world&#39; &quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="w">      </span><span class="nt">&lt;Script</span><span class="w"> </span><span class="na">code=</span><span class="s">&quot; A:=THE_ANSWER; B:=3.14; color:=RED &quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="w">        </span><span class="nt">&lt;Precondition</span><span class="w"> </span><span class="na">if=</span><span class="s">&quot;A&gt;B &amp;&amp; color != BLUE&quot;</span><span class="w"> </span><span class="na">else=</span><span class="s">&quot;FAILURE&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="w">          </span><span class="nt">&lt;Sequence&gt;</span>
<a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="w">            </span><span class="nt">&lt;SaySomething</span><span class="w"> </span><span class="na">message=</span><span class="s">&quot;{A}&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="w">            </span><span class="nt">&lt;SaySomething</span><span class="w"> </span><span class="na">message=</span><span class="s">&quot;{B}&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="w">            </span><span class="nt">&lt;SaySomething</span><span class="w"> </span><span class="na">message=</span><span class="s">&quot;{msg}&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a><span class="w">            </span><span class="nt">&lt;SaySomething</span><span class="w"> </span><span class="na">message=</span><span class="s">&quot;{color}&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a><span class="w">        </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a><span class="w">      </span><span class="nt">&lt;/Precondition&gt;</span>
<a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a><span class="w">    </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-51-15" name="__codelineno-51-15" href="#__codelineno-51-15"></a><span class="w">  </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-51-16" name="__codelineno-51-16" href="#__codelineno-51-16"></a><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<p>期望黑板条目包含：</p>
<ul>
<li><strong>msg</strong>：字符串 <code>"hello world"</code></li>
<li><strong>A</strong>：枚举标签 <code>THE_ANSWER</code> 对应的整数值</li>
<li><strong>B</strong>：浮点数 <code>3.14</code></li>
<li><strong>color</strong>：枚举标签 <code>RED</code> 对应的整数值</li>
</ul>
<p>预期输出：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="go">Robot says: 42.000000</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="go">Robot says: 3.140000</span>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="go">Robot says: hello world</span>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="go">Robot says: 1.000000</span>
</code></pre></div>
<p>对应的 C++ 代码：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="k">enum</span><span class="w"> </span><span class="nc">Color</span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="p">{</span>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="w">  </span><span class="n">RED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="w">  </span><span class="n">BLUE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="w">  </span><span class="n">GREEN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span>
<a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a><span class="p">};</span>
<a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a>
<a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a><span class="p">{</span>
<a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a><span class="w">  </span><span class="n">BehaviorTreeFactory</span><span class="w"> </span><span class="n">factory</span><span class="p">;</span>
<a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerNodeType</span><span class="o">&lt;</span><span class="n">DummyNodes</span><span class="o">::</span><span class="n">SaySomething</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;SaySomething&quot;</span><span class="p">);</span>
<a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a>
<a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a><span class="w">  </span><span class="c1">// 向脚本语言注册枚举</span>
<a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerScriptingEnums</span><span class="o">&lt;</span><span class="n">Color</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-53-15" name="__codelineno-53-15" href="#__codelineno-53-15"></a>
<a id="__codelineno-53-16" name="__codelineno-53-16" href="#__codelineno-53-16"></a><span class="w">  </span><span class="c1">// 手动为标签 &quot;THE_ANSWER&quot; 赋值，绕开范围限制</span>
<a id="__codelineno-53-17" name="__codelineno-53-17" href="#__codelineno-53-17"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerScriptingEnum</span><span class="p">(</span><span class="s">&quot;THE_ANSWER&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">);</span>
<a id="__codelineno-53-18" name="__codelineno-53-18" href="#__codelineno-53-18"></a>
<a id="__codelineno-53-19" name="__codelineno-53-19" href="#__codelineno-53-19"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factory</span><span class="p">.</span><span class="n">createTreeFromText</span><span class="p">(</span><span class="n">xml_text</span><span class="p">);</span>
<a id="__codelineno-53-20" name="__codelineno-53-20" href="#__codelineno-53-20"></a><span class="w">  </span><span class="n">tree</span><span class="p">.</span><span class="n">tickWhileRunning</span><span class="p">();</span>
<a id="__codelineno-53-21" name="__codelineno-53-21" href="#__codelineno-53-21"></a>
<a id="__codelineno-53-22" name="__codelineno-53-22" href="#__codelineno-53-22"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-53-23" name="__codelineno-53-23" href="#__codelineno-53-23"></a><span class="p">}</span>
</code></pre></div>
<h2 id="10-loggersobserver">10. 日志器（Loggers）与观察者（Observer）<a class="headerlink" href="#10-loggersobserver" title="Permanent link">&para;</a></h2>
<p>BT.CPP 提供了在运行时添加<strong>日志器</strong>的方式，通常在树创建后且开始 tick 之前添加。</p>
<p>“日志器”是一个类，每当某个节点状态改变时会调用其回调函数；这是所谓<a href="https://en.wikipedia.org/wiki/Observer_pattern">观察者模式</a>的非侵入式实现。</p>
<p>具体的回调函数签名为：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">callback</span><span class="p">(</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="w">    </span><span class="n">BT</span><span class="o">::</span><span class="n">Duration</span><span class="w"> </span><span class="n">timestamp</span><span class="p">,</span><span class="w"> </span><span class="c1">// 状态改变时间</span>
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">TreeNode</span><span class="o">&amp;</span><span class="w"> </span><span class="n">node</span><span class="p">,</span><span class="w">   </span><span class="c1">// 状态改变的节点</span>
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="w">    </span><span class="n">NodeStatus</span><span class="w"> </span><span class="n">prev_status</span><span class="p">,</span><span class="w"> </span><span class="c1">// 之前的状态</span>
<a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="w">    </span><span class="n">NodeStatus</span><span class="w"> </span><span class="n">status</span><span class="p">);</span><span class="w">     </span><span class="c1">// 新状态</span>
</code></pre></div>
<h3 id="treeobserver">TreeObserver 类<a class="headerlink" href="#treeobserver" title="Permanent link">&para;</a></h3>
<p>有时，尤其是在实现<strong>单元测试</strong>时，想知道某节点返回 SUCCESS 或 FAILURE 的次数。</p>
<p>例如，验证某些条件下，某分支被执行而另一个未被执行。</p>
<p><code>TreeObserver</code> 是一个简单的日志器实现，收集每个节点的以下统计数据：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">NodeStatistics</span>
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="p">{</span>
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="w">  </span><span class="c1">// 最后有效结果，SUCCESS 或 FAILURE</span>
<a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a><span class="w">  </span><span class="n">NodeStatus</span><span class="w"> </span><span class="n">last_result</span><span class="p">;</span>
<a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="w">  </span><span class="c1">// 当前状态，可能为任意状态（包括 IDLE 或 SKIPPED）</span>
<a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="w">  </span><span class="n">NodeStatus</span><span class="w"> </span><span class="n">current_status</span><span class="p">;</span>
<a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="w">  </span><span class="c1">// 状态转换次数（不计转换为 IDLE）</span>
<a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a><span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">transitions_count</span><span class="p">;</span>
<a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a><span class="w">  </span><span class="c1">// 转换为 SUCCESS 次数</span>
<a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a><span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">success_count</span><span class="p">;</span>
<a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a><span class="w">  </span><span class="c1">// 转换为 FAILURE 次数</span>
<a id="__codelineno-55-12" name="__codelineno-55-12" href="#__codelineno-55-12"></a><span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">failure_count</span><span class="p">;</span>
<a id="__codelineno-55-13" name="__codelineno-55-13" href="#__codelineno-55-13"></a><span class="w">  </span><span class="c1">// 转换为 SKIPPED 次数</span>
<a id="__codelineno-55-14" name="__codelineno-55-14" href="#__codelineno-55-14"></a><span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">skip_count</span><span class="p">;</span>
<a id="__codelineno-55-15" name="__codelineno-55-15" href="#__codelineno-55-15"></a><span class="w">  </span><span class="c1">// 最后一次转换时间戳</span>
<a id="__codelineno-55-16" name="__codelineno-55-16" href="#__codelineno-55-16"></a><span class="w">  </span><span class="n">Duration</span><span class="w"> </span><span class="n">last_timestamp</span><span class="p">;</span>
<a id="__codelineno-55-17" name="__codelineno-55-17" href="#__codelineno-55-17"></a><span class="p">};</span>
</code></pre></div>
<h3 id="_34">如何唯一标识节点<a class="headerlink" href="#_34" title="Permanent link">&para;</a></h3>
<p>观察者收集指定节点的统计信息，需要唯一标识节点：</p>
<p>两种方式：</p>
<ul>
<li><code>TreeNode::UID()</code>：节点对应树的<a href="https://en.wikipedia.org/wiki/Depth-first_search">深度优先遍历</a>唯一编号。</li>
<li><code>TreeNode::fullPath()</code>：节点的唯一且可读路径标识。</li>
</ul>
<p>称之为“路径”，因为典型字符串格式为：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a> first_subtree/nested_subtree/node_name
</code></pre></div>
<p>路径包含了节点在子树层级中的位置信息。</p>
<p><code>node_name</code> 是XML中分配的 <code>name</code> 属性，或者自动生成的格式：注册名 + "::" + UID。</p>
<h3 id="xml_3">示例 XML<a class="headerlink" href="#xml_3" title="Permanent link">&para;</a></h3>
<p>以下示例在子树层级结构上较复杂：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="nt">&lt;root</span><span class="w"> </span><span class="na">BTCPP_format=</span><span class="s">&quot;4&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="w">  </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MainTree&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="w">    </span><span class="nt">&lt;Sequence&gt;</span>
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="w">     </span><span class="nt">&lt;Fallback&gt;</span>
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="w">       </span><span class="nt">&lt;AlwaysFailure</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;failing_action&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="w">       </span><span class="nt">&lt;SubTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;SubTreeA&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;mysub&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a><span class="w">     </span><span class="nt">&lt;/Fallback&gt;</span>
<a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a><span class="w">     </span><span class="nt">&lt;AlwaysSuccess</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;last_action&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a><span class="w">    </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a><span class="w">  </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a>
<a id="__codelineno-57-12" name="__codelineno-57-12" href="#__codelineno-57-12"></a><span class="w">  </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;SubTreeA&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-57-13" name="__codelineno-57-13" href="#__codelineno-57-13"></a><span class="w">    </span><span class="nt">&lt;Sequence&gt;</span>
<a id="__codelineno-57-14" name="__codelineno-57-14" href="#__codelineno-57-14"></a><span class="w">      </span><span class="nt">&lt;AlwaysSuccess</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;action_subA&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-57-15" name="__codelineno-57-15" href="#__codelineno-57-15"></a><span class="w">      </span><span class="nt">&lt;SubTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;SubTreeB&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;sub_nested&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-57-16" name="__codelineno-57-16" href="#__codelineno-57-16"></a><span class="w">      </span><span class="nt">&lt;SubTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;SubTreeB&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-57-17" name="__codelineno-57-17" href="#__codelineno-57-17"></a><span class="w">    </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-57-18" name="__codelineno-57-18" href="#__codelineno-57-18"></a><span class="w">  </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-57-19" name="__codelineno-57-19" href="#__codelineno-57-19"></a>
<a id="__codelineno-57-20" name="__codelineno-57-20" href="#__codelineno-57-20"></a><span class="w">  </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;SubTreeB&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-57-21" name="__codelineno-57-21" href="#__codelineno-57-21"></a><span class="w">    </span><span class="nt">&lt;AlwaysSuccess</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;action_subB&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-57-22" name="__codelineno-57-22" href="#__codelineno-57-22"></a><span class="w">  </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-57-23" name="__codelineno-57-23" href="#__codelineno-57-23"></a><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<p>可见部分节点有 <code>name</code> 属性，有些没有。</p>
<p>对应的 <strong>UID -&gt; fullPath</strong> 映射为：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a>1 -&gt; Sequence::1
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>2 -&gt; Fallback::2
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a>3 -&gt; failing_action
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a>4 -&gt; mysub
<a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a>5 -&gt; mysub/Sequence::5
<a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a>6 -&gt; mysub/action_subA
<a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a>7 -&gt; mysub/sub_nested
<a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a>8 -&gt; mysub/sub_nested/action_subB
<a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a>9 -&gt; mysub/SubTreeB::9
<a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a>10 -&gt; mysub/SubTreeB::9/action_subB
<a id="__codelineno-58-11" name="__codelineno-58-11" href="#__codelineno-58-11"></a>11 -&gt; last_action
</code></pre></div>
<h3 id="c">示例（C++）<a class="headerlink" href="#c" title="Permanent link">&para;</a></h3>
<p>以下应用程序将执行以下操作：</p>
<ul>
<li>递归打印行为树结构。</li>
<li>将 <code>TreeObserver</code> 附加到行为树。</li>
<li>打印 <code>UID / fullPath</code> 对。</li>
<li>收集名为 <code>"last_action"</code> 的特定节点的统计数据。</li>
<li>显示观察者收集的所有统计信息。</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="p">{</span>
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="w">  </span><span class="n">BT</span><span class="o">::</span><span class="n">BehaviorTreeFactory</span><span class="w"> </span><span class="n">factory</span><span class="p">;</span>
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a>
<a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerBehaviorTreeFromText</span><span class="p">(</span><span class="n">xml_text</span><span class="p">);</span>
<a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factory</span><span class="p">.</span><span class="n">createTree</span><span class="p">(</span><span class="s">&quot;MainTree&quot;</span><span class="p">);</span>
<a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a>
<a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a><span class="w">  </span><span class="c1">// 辅助函数：递归打印树结构。</span>
<a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a><span class="w">  </span><span class="n">BT</span><span class="o">::</span><span class="n">printTreeRecursively</span><span class="p">(</span><span class="n">tree</span><span class="p">.</span><span class="n">rootNode</span><span class="p">());</span>
<a id="__codelineno-59-10" name="__codelineno-59-10" href="#__codelineno-59-10"></a>
<a id="__codelineno-59-11" name="__codelineno-59-11" href="#__codelineno-59-11"></a><span class="w">  </span><span class="c1">// 观察者用于保存某节点返回 SUCCESS 或 FAILURE 的次数统计，</span>
<a id="__codelineno-59-12" name="__codelineno-59-12" href="#__codelineno-59-12"></a><span class="w">  </span><span class="c1">// 适合单元测试，验证预期的状态转换是否发生。</span>
<a id="__codelineno-59-13" name="__codelineno-59-13" href="#__codelineno-59-13"></a><span class="w">  </span><span class="n">BT</span><span class="o">::</span><span class="n">TreeObserver</span><span class="w"> </span><span class="n">observer</span><span class="p">(</span><span class="n">tree</span><span class="p">);</span>
<a id="__codelineno-59-14" name="__codelineno-59-14" href="#__codelineno-59-14"></a>
<a id="__codelineno-59-15" name="__codelineno-59-15" href="#__codelineno-59-15"></a><span class="w">  </span><span class="c1">// 打印唯一 ID 与对应的可读路径，</span>
<a id="__codelineno-59-16" name="__codelineno-59-16" href="#__codelineno-59-16"></a><span class="w">  </span><span class="c1">// 路径也应是唯一的。</span>
<a id="__codelineno-59-17" name="__codelineno-59-17" href="#__codelineno-59-17"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">uint16_t</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ordered_UID_to_path</span><span class="p">;</span>
<a id="__codelineno-59-18" name="__codelineno-59-18" href="#__codelineno-59-18"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="p">[</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">uid</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="n">observer</span><span class="p">.</span><span class="n">pathToUID</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-59-19" name="__codelineno-59-19" href="#__codelineno-59-19"></a><span class="w">    </span><span class="n">ordered_UID_to_path</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<a id="__codelineno-59-20" name="__codelineno-59-20" href="#__codelineno-59-20"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-59-21" name="__codelineno-59-21" href="#__codelineno-59-21"></a>
<a id="__codelineno-59-22" name="__codelineno-59-22" href="#__codelineno-59-22"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="p">[</span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="n">ordered_UID_to_path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-59-23" name="__codelineno-59-23" href="#__codelineno-59-23"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">uid</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; -&gt; &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-59-24" name="__codelineno-59-24" href="#__codelineno-59-24"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-59-25" name="__codelineno-59-25" href="#__codelineno-59-25"></a>
<a id="__codelineno-59-26" name="__codelineno-59-26" href="#__codelineno-59-26"></a><span class="w">  </span><span class="n">tree</span><span class="p">.</span><span class="n">tickWhileRunning</span><span class="p">();</span>
<a id="__codelineno-59-27" name="__codelineno-59-27" href="#__codelineno-59-27"></a>
<a id="__codelineno-59-28" name="__codelineno-59-28" href="#__codelineno-59-28"></a><span class="w">  </span><span class="c1">// 访问指定节点的统计数据，可用全路径或 UID</span>
<a id="__codelineno-59-29" name="__codelineno-59-29" href="#__codelineno-59-29"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">last_action_stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">observer</span><span class="p">.</span><span class="n">getStatistics</span><span class="p">(</span><span class="s">&quot;last_action&quot;</span><span class="p">);</span>
<a id="__codelineno-59-30" name="__codelineno-59-30" href="#__codelineno-59-30"></a><span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="n">last_action_stats</span><span class="p">.</span><span class="n">transitions_count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-59-31" name="__codelineno-59-31" href="#__codelineno-59-31"></a>
<a id="__codelineno-59-32" name="__codelineno-59-32" href="#__codelineno-59-32"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;----------------&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-59-33" name="__codelineno-59-33" href="#__codelineno-59-33"></a><span class="w">  </span><span class="c1">// 打印所有统计数据</span>
<a id="__codelineno-59-34" name="__codelineno-59-34" href="#__codelineno-59-34"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="p">[</span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="n">ordered_UID_to_path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-59-35" name="__codelineno-59-35" href="#__codelineno-59-35"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">observer</span><span class="p">.</span><span class="n">getStatistics</span><span class="p">(</span><span class="n">uid</span><span class="p">);</span>
<a id="__codelineno-59-36" name="__codelineno-59-36" href="#__codelineno-59-36"></a>
<a id="__codelineno-59-37" name="__codelineno-59-37" href="#__codelineno-59-37"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;[&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">name</span>
<a id="__codelineno-59-38" name="__codelineno-59-38" href="#__codelineno-59-38"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;] </span><span class="se">\t</span><span class="s">T/S/F:  &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">stats</span><span class="p">.</span><span class="n">transitions_count</span>
<a id="__codelineno-59-39" name="__codelineno-59-39" href="#__codelineno-59-39"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">stats</span><span class="p">.</span><span class="n">success_count</span>
<a id="__codelineno-59-40" name="__codelineno-59-40" href="#__codelineno-59-40"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">stats</span><span class="p">.</span><span class="n">failure_count</span>
<a id="__codelineno-59-41" name="__codelineno-59-41" href="#__codelineno-59-41"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-59-42" name="__codelineno-59-42" href="#__codelineno-59-42"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-59-43" name="__codelineno-59-43" href="#__codelineno-59-43"></a>
<a id="__codelineno-59-44" name="__codelineno-59-44" href="#__codelineno-59-44"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-59-45" name="__codelineno-59-45" href="#__codelineno-59-45"></a><span class="p">}</span>
</code></pre></div>
<h2 id="11-groot2">11. 连接 Groot2<a class="headerlink" href="#11-groot2" title="Permanent link">&para;</a></h2>
<p><strong>Groot2</strong> 是官方的 IDE，用于编辑、监控和交互操作由 <strong>BT.CPP</strong> 创建的行为树。</p>
<p>集成非常简单，先了解以下几个核心概念。</p>
<h3 id="treenodesmodel">TreeNodesModel<a class="headerlink" href="#treenodesmodel" title="Permanent link">&para;</a></h3>
<p>Groot 需要“节点模型”。</p>
<p><img alt="img" src="https://www.behaviortree.dev/assets/images/t12_groot_models-5f1f63eeae69454a87cb5f609c0865b6.png" /></p>
<p>例如，图中 Groot 需要知道用户自定义的节点 <code>ThinkWhatToSay</code> 和 <code>SaySomething</code>。</p>
<p>此外，需要以下信息：</p>
<ul>
<li>节点类型</li>
<li>端口名称及类型（输入/输出）</li>
</ul>
<p>这些模型以 XML 格式表达，例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="w">  </span><span class="nt">&lt;TreeNodesModel&gt;</span>
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="w">    </span><span class="nt">&lt;Action</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;SaySomething&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="w">      </span><span class="nt">&lt;input_port</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;message&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="w">    </span><span class="nt">&lt;/Action&gt;</span>
<a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="w">    </span><span class="nt">&lt;Action</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;ThinkWhatToSay&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a><span class="w">      </span><span class="nt">&lt;output_port</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;text&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a><span class="w">    </span><span class="nt">&lt;/Action&gt;</span>
<a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a><span class="w">  </span><span class="nt">&lt;/TreeNodesModel&gt;</span>
</code></pre></div>
<p>但<strong>不建议手动编写此 XML</strong>。</p>
<p>BT.CPP 提供生成该 XML 的函数：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="w">  </span><span class="n">BT</span><span class="o">::</span><span class="n">BehaviorTreeFactory</span><span class="w"> </span><span class="n">factory</span><span class="p">;</span>
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="w">  </span><span class="c1">//</span>
<a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="w">  </span><span class="c1">// 在此注册用户自定义节点</span>
<a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="w">  </span><span class="c1">// </span>
<a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">xml_models</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">writeTreeNodesModelXML</span><span class="p">(</span><span class="n">factory</span><span class="p">);</span>
<a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a>
<a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a><span class="w">  </span><span class="c1">// 保存 xml_models 到文件，</span>
<a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a><span class="w">  </span><span class="c1">// 或加载到 Groot2 中使用</span>
</code></pre></div>
<p>导入 UI 的方法：</p>
<ul>
<li>将 XML 保存为文件（如 <code>models.xml</code>），在 Groot2 中点击 <strong>Import Models</strong> 按钮导入。</li>
<li>或直接将 XML 片段加入 <code>.xml</code> 或 <code>.btproj</code> 文件。</li>
</ul>
<h3 id="groot">向 Groot 添加实时可视化<a class="headerlink" href="#groot" title="Permanent link">&para;</a></h3>
<blockquote>
<p>ℹ️ 注意</p>
<p>当前仅 Groot2 PRO 版本支持实时可视化。</p>
</blockquote>
<p>连接行为树到 Groot2 只需一行代码：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="n">BT</span><span class="o">::</span><span class="n">Groot2Publisher</span><span class="w"> </span><span class="nf">publisher</span><span class="p">(</span><span class="n">tree</span><span class="p">);</span>
</code></pre></div>
<p>该功能通过进程间通信实现：</p>
<ul>
<li>发送完整树结构及模型给 Groot2。</li>
<li>定期更新各节点状态（RUNNING、SUCCESS、FAILURE、IDLE）。</li>
<li>发送黑板变量值；支持基础类型（整型、浮点、字符串），其他类型需手动添加。</li>
<li>允许 Groot2 设置断点、节点替换、故障注入。</li>
</ul>
<p>完整示例 XML：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="nt">&lt;root</span><span class="w"> </span><span class="na">BTCPP_format=</span><span class="s">&quot;4&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>
<a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a><span class="w">  </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MainTree&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="w">    </span><span class="nt">&lt;Sequence&gt;</span>
<a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="w">      </span><span class="nt">&lt;Script</span><span class="w"> </span><span class="na">code=</span><span class="s">&quot;door_open:=false&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a><span class="w">      </span><span class="nt">&lt;Fallback&gt;</span>
<a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a><span class="w">        </span><span class="nt">&lt;Inverter&gt;</span>
<a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a><span class="w">          </span><span class="nt">&lt;IsDoorClosed/&gt;</span>
<a id="__codelineno-63-9" name="__codelineno-63-9" href="#__codelineno-63-9"></a><span class="w">        </span><span class="nt">&lt;/Inverter&gt;</span>
<a id="__codelineno-63-10" name="__codelineno-63-10" href="#__codelineno-63-10"></a><span class="w">        </span><span class="nt">&lt;SubTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;DoorClosed&quot;</span><span class="w"> </span><span class="na">_autoremap=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="na">door_open=</span><span class="s">&quot;{door_open}&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-63-11" name="__codelineno-63-11" href="#__codelineno-63-11"></a><span class="w">      </span><span class="nt">&lt;/Fallback&gt;</span>
<a id="__codelineno-63-12" name="__codelineno-63-12" href="#__codelineno-63-12"></a><span class="w">      </span><span class="nt">&lt;PassThroughDoor/&gt;</span>
<a id="__codelineno-63-13" name="__codelineno-63-13" href="#__codelineno-63-13"></a><span class="w">    </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-63-14" name="__codelineno-63-14" href="#__codelineno-63-14"></a><span class="w">  </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-63-15" name="__codelineno-63-15" href="#__codelineno-63-15"></a>
<a id="__codelineno-63-16" name="__codelineno-63-16" href="#__codelineno-63-16"></a><span class="w">  </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;DoorClosed&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-63-17" name="__codelineno-63-17" href="#__codelineno-63-17"></a><span class="w">    </span><span class="nt">&lt;Fallback</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tryOpen&quot;</span><span class="w"> </span><span class="na">_onSuccess=</span><span class="s">&quot;door_open:=true&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-63-18" name="__codelineno-63-18" href="#__codelineno-63-18"></a><span class="w">      </span><span class="nt">&lt;OpenDoor/&gt;</span>
<a id="__codelineno-63-19" name="__codelineno-63-19" href="#__codelineno-63-19"></a><span class="w">        </span><span class="nt">&lt;RetryUntilSuccessful</span><span class="w"> </span><span class="na">num_attempts=</span><span class="s">&quot;5&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-63-20" name="__codelineno-63-20" href="#__codelineno-63-20"></a><span class="w">          </span><span class="nt">&lt;PickLock/&gt;</span>
<a id="__codelineno-63-21" name="__codelineno-63-21" href="#__codelineno-63-21"></a><span class="w">        </span><span class="nt">&lt;/RetryUntilSuccessful&gt;</span>
<a id="__codelineno-63-22" name="__codelineno-63-22" href="#__codelineno-63-22"></a><span class="w">      </span><span class="nt">&lt;SmashDoor/&gt;</span>
<a id="__codelineno-63-23" name="__codelineno-63-23" href="#__codelineno-63-23"></a><span class="w">    </span><span class="nt">&lt;/Fallback&gt;</span>
<a id="__codelineno-63-24" name="__codelineno-63-24" href="#__codelineno-63-24"></a><span class="w">  </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-63-25" name="__codelineno-63-25" href="#__codelineno-63-25"></a>
<a id="__codelineno-63-26" name="__codelineno-63-26" href="#__codelineno-63-26"></a><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<p>示例 C++ 代码：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="p">{</span>
<a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="w">  </span><span class="n">BT</span><span class="o">::</span><span class="n">BehaviorTreeFactory</span><span class="w"> </span><span class="n">factory</span><span class="p">;</span>
<a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a>
<a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a><span class="w">  </span><span class="c1">// 相关的简单节点，模拟开门流程</span>
<a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a><span class="w">  </span><span class="n">CrossDoor</span><span class="w"> </span><span class="n">cross_door</span><span class="p">;</span>
<a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a><span class="w">  </span><span class="n">cross_door</span><span class="p">.</span><span class="n">registerNodes</span><span class="p">(</span><span class="n">factory</span><span class="p">);</span>
<a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a>
<a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a><span class="w">  </span><span class="c1">// Groot2 需要节点模型</span>
<a id="__codelineno-64-10" name="__codelineno-64-10" href="#__codelineno-64-10"></a><span class="w">  </span><span class="c1">// 该 XML 可通过下面函数自动生成，无需手写</span>
<a id="__codelineno-64-11" name="__codelineno-64-11" href="#__codelineno-64-11"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">xml_models</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">writeTreeNodesModelXML</span><span class="p">(</span><span class="n">factory</span><span class="p">);</span>
<a id="__codelineno-64-12" name="__codelineno-64-12" href="#__codelineno-64-12"></a>
<a id="__codelineno-64-13" name="__codelineno-64-13" href="#__codelineno-64-13"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerBehaviorTreeFromText</span><span class="p">(</span><span class="n">xml_text</span><span class="p">);</span>
<a id="__codelineno-64-14" name="__codelineno-64-14" href="#__codelineno-64-14"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factory</span><span class="p">.</span><span class="n">createTree</span><span class="p">(</span><span class="s">&quot;MainTree&quot;</span><span class="p">);</span>
<a id="__codelineno-64-15" name="__codelineno-64-15" href="#__codelineno-64-15"></a>
<a id="__codelineno-64-16" name="__codelineno-64-16" href="#__codelineno-64-16"></a><span class="w">  </span><span class="c1">// 连接 Groot2Publisher，支持树结构与状态更新通信</span>
<a id="__codelineno-64-17" name="__codelineno-64-17" href="#__codelineno-64-17"></a><span class="w">  </span><span class="n">BT</span><span class="o">::</span><span class="n">Groot2Publisher</span><span class="w"> </span><span class="n">publisher</span><span class="p">(</span><span class="n">tree</span><span class="p">);</span>
<a id="__codelineno-64-18" name="__codelineno-64-18" href="#__codelineno-64-18"></a>
<a id="__codelineno-64-19" name="__codelineno-64-19" href="#__codelineno-64-19"></a><span class="w">  </span><span class="c1">// 无限循环执行</span>
<a id="__codelineno-64-20" name="__codelineno-64-20" href="#__codelineno-64-20"></a><span class="w">  </span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-64-21" name="__codelineno-64-21" href="#__codelineno-64-21"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-64-22" name="__codelineno-64-22" href="#__codelineno-64-22"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Start&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-64-23" name="__codelineno-64-23" href="#__codelineno-64-23"></a><span class="w">    </span><span class="n">cross_door</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>
<a id="__codelineno-64-24" name="__codelineno-64-24" href="#__codelineno-64-24"></a><span class="w">    </span><span class="n">tree</span><span class="p">.</span><span class="n">tickWhileRunning</span><span class="p">();</span>
<a id="__codelineno-64-25" name="__codelineno-64-25" href="#__codelineno-64-25"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">3000</span><span class="p">));</span>
<a id="__codelineno-64-26" name="__codelineno-64-26" href="#__codelineno-64-26"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-64-27" name="__codelineno-64-27" href="#__codelineno-64-27"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-64-28" name="__codelineno-64-28" href="#__codelineno-64-28"></a><span class="p">}</span>
</code></pre></div>
<h3 id="_35">在黑板中可视化自定义类型<a class="headerlink" href="#_35" title="Permanent link">&para;</a></h3>
<p>黑板中的内容以 JSON 格式发送给 Groot2。</p>
<p>要添加新类型并允许 Groot2 可视化它们，应遵循此处的说明：</p>
<p><a href="https://json.nlohmann.me/features/arbitrary_types/">https://json.nlohmann.me/features/arbitrary_types/</a></p>
<p>例如，给定一个用户自定义类型：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Pose2D</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">theta</span><span class="p">;</span>
<a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a><span class="p">}</span>
</code></pre></div>
<p>你需要包含 <strong>behaviortree_cpp/json_export.h</strong> 并根据你的 BT.CPP 版本，遵循以下说明。</p>
<h4 id="435">版本 4.3.5 及以前<a class="headerlink" href="#435" title="Permanent link">&para;</a></h4>
<p>实现函数 <code>nlohmann::to_json()</code>：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">nlohmann</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">to_json</span><span class="p">(</span><span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span><span class="o">&amp;</span><span class="w"> </span><span class="n">dest</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Pose2D</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pose</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="w">    </span><span class="n">dest</span><span class="p">[</span><span class="s">&quot;x&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pose</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="w">    </span><span class="n">dest</span><span class="p">[</span><span class="s">&quot;y&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pose</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="w">    </span><span class="n">dest</span><span class="p">[</span><span class="s">&quot;theta&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pose</span><span class="p">.</span><span class="n">theta</span><span class="p">;</span>
<a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a><span class="p">}</span>
</code></pre></div>
<p>然后，在你的 <strong>main</strong> 中注册该函数：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="n">BT</span><span class="o">::</span><span class="n">JsonExporter</span><span class="o">::</span><span class="n">get</span><span class="p">().</span><span class="n">addConverter</span><span class="o">&lt;</span><span class="n">Pose2D</span><span class="o">&gt;</span><span class="p">();</span>
</code></pre></div>
<h4 id="436">版本 4.3.6 及以后<a class="headerlink" href="#436" title="Permanent link">&para;</a></h4>
<p><code>to_json</code> 函数的实现可以有任意名称或命名空间，但必须符合函数签名 <code>void(nlohmann::json&amp;, const T&amp;)</code>。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">PoseToJson</span><span class="p">(</span><span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span><span class="o">&amp;</span><span class="w"> </span><span class="n">dest</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Pose2D</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pose</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="w">  </span><span class="n">dest</span><span class="p">[</span><span class="s">&quot;x&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pose</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="w">  </span><span class="n">dest</span><span class="p">[</span><span class="s">&quot;y&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pose</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="w">  </span><span class="n">dest</span><span class="p">[</span><span class="s">&quot;theta&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pose</span><span class="p">.</span><span class="n">theta</span><span class="p">;</span>
<a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a><span class="p">}</span>
</code></pre></div>
<p>在你的 <strong>main</strong> 中注册该函数：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="n">BT</span><span class="o">::</span><span class="n">RegisterJsonDefinition</span><span class="o">&lt;</span><span class="n">Pose2D</span><span class="o">&gt;</span><span class="p">(</span><span class="n">PoseToJson</span><span class="p">);</span>
</code></pre></div>
<h1 id="_36">教程（高级）<a class="headerlink" href="#_36" title="Permanent link">&para;</a></h1>
<p>5 分钟学习最重要的 Docusaurus 概念。</p>
<h2 id="12">12. 端口默认值<a class="headerlink" href="#12" title="Permanent link">&para;</a></h2>
<p>定义端口时，添加默认值可能很方便，即当 XML 中未指定时，端口应具有的值。</p>
<blockquote>
<p>ℹ️ 注意</p>
<p>本教程中的某些示例需要 4.5.2 版本或更高版本。</p>
</blockquote>
<h3 id="_37">默认输入端口<a class="headerlink" href="#_37" title="Permanent link">&para;</a></h3>
<p>考虑一个初始化多个端口的节点。我们使用自定义类型 <strong>Point2D</strong>，但对于简单类型如 <code>int</code>、<code>double</code> 或 <code>string</code> 同样适用。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">PortsList</span><span class="w"> </span><span class="nf">providedPorts</span><span class="p">()</span>
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="w">      </span><span class="n">BT</span><span class="o">::</span><span class="n">InputPort</span><span class="o">&lt;</span><span class="n">Point2D</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;input&quot;</span><span class="p">),</span>
<a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a><span class="w">      </span><span class="n">BT</span><span class="o">::</span><span class="n">InputPort</span><span class="o">&lt;</span><span class="n">Point2D</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;pointA&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Point2D</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;默认值为 x=1, y=2&quot;</span><span class="p">),</span>
<a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a><span class="w">      </span><span class="n">BT</span><span class="o">::</span><span class="n">InputPort</span><span class="o">&lt;</span><span class="n">Point2D</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;pointB&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;3,4&quot;</span><span class="p">,</span><span class="w">         </span><span class="s">&quot;默认值为 x=3, y=4&quot;</span><span class="p">),</span>
<a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a><span class="w">      </span><span class="n">BT</span><span class="o">::</span><span class="n">InputPort</span><span class="o">&lt;</span><span class="n">Point2D</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;pointC&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;{point}&quot;</span><span class="p">,</span><span class="w">     </span><span class="s">&quot;默认指向黑板条目 {point}&quot;</span><span class="p">),</span>
<a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a><span class="w">      </span><span class="n">BT</span><span class="o">::</span><span class="n">InputPort</span><span class="o">&lt;</span><span class="n">Point2D</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;pointD&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;{=}&quot;</span><span class="p">,</span><span class="w">         </span><span class="s">&quot;默认指向黑板条目 {pointD}&quot;</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-70-9" name="__codelineno-70-9" href="#__codelineno-70-9"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-70-10" name="__codelineno-70-10" href="#__codelineno-70-10"></a><span class="w">  </span><span class="p">}</span>
</code></pre></div>
<p>第一个 (<code>input</code>) 没有默认值，XML 中必须提供值或黑板条目。</p>
<h4 id="_38">默认值<a class="headerlink" href="#_38" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="n">BT</span><span class="o">::</span><span class="n">InputPort</span><span class="o">&lt;</span><span class="n">Point2D</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;pointA&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Point2D</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;...&quot;</span><span class="p">);</span>
</code></pre></div>
<p>如果实现了模板特化 <code>convertFromString&lt;Point2D&gt;()</code>，也可以使用字符串形式。</p>
<p>换句话说，以下语法应当等效，假如我们的 <strong>convertFromString</strong> 期待两个逗号分隔的值：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="n">BT</span><span class="o">::</span><span class="n">InputPort</span><span class="o">&lt;</span><span class="n">Point2D</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;pointB&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;3,4&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;...&quot;</span><span class="p">);</span>
<a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="c1">// 等效于：</span>
<a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="n">BT</span><span class="o">::</span><span class="n">InputPort</span><span class="o">&lt;</span><span class="n">Point2D</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;pointB&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Point2D</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;...&quot;</span><span class="p">);</span>
</code></pre></div>
<h4 id="_39">默认黑板条目<a class="headerlink" href="#_39" title="Permanent link">&para;</a></h4>
<p>另外，也可以定义端口应指向的默认黑板条目。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="n">BT</span><span class="o">::</span><span class="n">InputPort</span><span class="o">&lt;</span><span class="n">Point2D</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;pointC&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;{point}&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;...&quot;</span><span class="p">);</span>
</code></pre></div>
<p>如果端口名称和黑板条目名称<strong>相同</strong>，可以使用 "{=}"</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="n">BT</span><span class="o">::</span><span class="n">InputPort</span><span class="o">&lt;</span><span class="n">Point2D</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;pointD&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;{=}&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;...&quot;</span><span class="p">);</span>
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="c1">// 等效于：</span>
<a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="n">BT</span><span class="o">::</span><span class="n">InputPort</span><span class="o">&lt;</span><span class="n">Point2D</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;pointD&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;{pointD}&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;...&quot;</span><span class="p">);</span>
</code></pre></div>
<h3 id="_40">默认输出端口<a class="headerlink" href="#_40" title="Permanent link">&para;</a></h3>
<p>输出端口更受限制，只能指向黑板条目。当名称相同时，仍可使用 "{=}"。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">PortsList</span><span class="w"> </span><span class="nf">providedPorts</span><span class="p">()</span>
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a><span class="w">      </span><span class="n">BT</span><span class="o">::</span><span class="n">OutputPort</span><span class="o">&lt;</span><span class="n">Point2D</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;result&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;{target}&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;默认指向黑板条目 {target}&quot;</span><span class="p">);</span>
<a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a><span class="w">  </span><span class="p">}</span>
</code></pre></div>
<h2 id="13">13. 通过引用访问端口<a class="headerlink" href="#13" title="Permanent link">&para;</a></h2>
<p>如果你跟随教程，应该知道黑板使用<strong>值语义</strong>，即 <code>getInput</code> 和 <code>setOutput</code> 方法是从黑板复制值或写入值。</p>
<p>在某些情况下，可能希望使用<strong>引用语义</strong>，即直接访问存储在黑板中的对象。特别当对象是：</p>
<ul>
<li>复杂数据结构</li>
<li>复制代价高</li>
<li>不可复制</li>
</ul>
<p>例如，建议使用引用语义的节点是 <code>LoopNode</code> 装饰器，它“就地”修改对象向量。</p>
<h4 id="1">方法1：将黑板条目作为共享指针<a class="headerlink" href="#1" title="Permanent link">&para;</a></h4>
<p>为简单起见，考虑一个复制代价高的对象，称为 <strong>Pointcloud</strong>。</p>
<p>假设我们有如下简单 BT：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="w"> </span><span class="nt">&lt;root</span><span class="w"> </span><span class="na">BTCPP_format=</span><span class="s">&quot;4&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="w">    </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;SegmentCup&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a><span class="w">       </span><span class="nt">&lt;Sequence&gt;</span>
<a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a><span class="w">           </span><span class="nt">&lt;AcquirePointCloud</span><span class="w">  </span><span class="na">cloud=</span><span class="s">&quot;{pointcloud}&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a><span class="w">           </span><span class="nt">&lt;SegmentObject</span><span class="w">  </span><span class="na">obj_name=</span><span class="s">&quot;cup&quot;</span><span class="w"> </span><span class="na">cloud=</span><span class="s">&quot;{pointcloud}&quot;</span><span class="w"> </span><span class="na">obj_pose=</span><span class="s">&quot;{pose}&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a><span class="w">       </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a><span class="w">    </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<ul>
<li><strong>AcquirePointCloud</strong> 将写入黑板条目 <code>pointcloud</code>。</li>
<li><strong>SegmentObject</strong> 将从该条目读取。</li>
</ul>
<p>此时推荐的端口类型为：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="n">PortsList</span><span class="w"> </span><span class="nf">AcquirePointCloud::providedPorts</span><span class="p">()</span>
<a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a><span class="p">{</span>
<a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">OutputPort</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Pointcloud</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;cloud&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a><span class="p">}</span>
<a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a>
<a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a><span class="n">PortsList</span><span class="w"> </span><span class="nf">SegmentObject::providedPorts</span><span class="p">()</span>
<a id="__codelineno-77-7" name="__codelineno-77-7" href="#__codelineno-77-7"></a><span class="p">{</span>
<a id="__codelineno-77-8" name="__codelineno-77-8" href="#__codelineno-77-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">InputPort</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;obj_name&quot;</span><span class="p">),</span>
<a id="__codelineno-77-9" name="__codelineno-77-9" href="#__codelineno-77-9"></a><span class="w">             </span><span class="n">InputPort</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Pointcloud</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;cloud&quot;</span><span class="p">),</span>
<a id="__codelineno-77-10" name="__codelineno-77-10" href="#__codelineno-77-10"></a><span class="w">             </span><span class="n">OutputPort</span><span class="o">&lt;</span><span class="n">Pose3D</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;obj_pose&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-77-11" name="__codelineno-77-11" href="#__codelineno-77-11"></a><span class="p">}</span>
</code></pre></div>
<p><code>getInput</code> 和 <code>setOutput</code> 方法照常使用，仍是值语义。但因为被复制的是 <code>shared_ptr</code>，实际上是通过引用访问 pointcloud 实例。</p>
<h4 id="2-castptr451">方法2：线程安全的 castPtr（4.5.1 版本起推荐）<a class="headerlink" href="#2-castptr451" title="Permanent link">&para;</a></h4>
<p><code>shared_ptr</code> 方法的最大问题是<strong>线程不安全</strong>。</p>
<p>如果自定义异步节点有自己的线程，实际对象可能会被其他线程同时访问。</p>
<p>为防止此问题，提供了包含锁机制的不同 API。</p>
<p>首先，创建端口时使用普通的 <code>Pointcloud</code>，无需包装成 <code>std::shared_ptr</code>：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="n">PortsList</span><span class="w"> </span><span class="nf">AcquirePointCloud::providedPorts</span><span class="p">()</span>
<a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="p">{</span>
<a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">OutputPort</span><span class="o">&lt;</span><span class="n">Pointcloud</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;cloud&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a><span class="p">}</span>
<a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a>
<a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a><span class="n">PortsList</span><span class="w"> </span><span class="nf">SegmentObject::providedPorts</span><span class="p">()</span>
<a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a><span class="p">{</span>
<a id="__codelineno-78-8" name="__codelineno-78-8" href="#__codelineno-78-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">InputPort</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;obj_name&quot;</span><span class="p">),</span>
<a id="__codelineno-78-9" name="__codelineno-78-9" href="#__codelineno-78-9"></a><span class="w">             </span><span class="n">InputPort</span><span class="o">&lt;</span><span class="n">Pointcloud</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;cloud&quot;</span><span class="p">),</span>
<a id="__codelineno-78-10" name="__codelineno-78-10" href="#__codelineno-78-10"></a><span class="w">             </span><span class="n">OutputPort</span><span class="o">&lt;</span><span class="n">Pose3D</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;obj_pose&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-78-11" name="__codelineno-78-11" href="#__codelineno-78-11"></a><span class="p">}</span>
</code></pre></div>
<p>通过指针/引用访问 Pointcloud 实例：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="c1">// 在以下作用域内，只要 &quot;any_locked&quot; 存在，保护 &quot;cloud&quot; 实例的互斥锁将保持锁定</span>
<a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a><span class="k">if</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">any_locked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getLockedPortContent</span><span class="p">(</span><span class="s">&quot;cloud&quot;</span><span class="p">))</span>
<a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a><span class="p">{</span>
<a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">any_locked</span><span class="o">-&gt;</span><span class="n">empty</span><span class="p">())</span>
<a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a><span class="w">    </span><span class="c1">// 黑板条目尚未初始化</span>
<a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a><span class="w">    </span><span class="c1">// 可通过以下方式初始化：</span>
<a id="__codelineno-79-8" name="__codelineno-79-8" href="#__codelineno-79-8"></a><span class="w">    </span><span class="n">any_locked</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">my_initial_pointcloud</span><span class="p">);</span>
<a id="__codelineno-79-9" name="__codelineno-79-9" href="#__codelineno-79-9"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-79-10" name="__codelineno-79-10" href="#__codelineno-79-10"></a><span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">Pointcloud</span><span class="o">*</span><span class="w"> </span><span class="n">cloud_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">any_locked</span><span class="o">-&gt;</span><span class="n">castPtr</span><span class="o">&lt;</span><span class="n">Pointcloud</span><span class="o">&gt;</span><span class="p">())</span>
<a id="__codelineno-79-11" name="__codelineno-79-11" href="#__codelineno-79-11"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-79-12" name="__codelineno-79-12" href="#__codelineno-79-12"></a><span class="w">    </span><span class="c1">// 成功转换为 Pointcloud*（原始类型）</span>
<a id="__codelineno-79-13" name="__codelineno-79-13" href="#__codelineno-79-13"></a><span class="w">    </span><span class="c1">// 使用 cloud_ptr 修改 pointcloud 实例</span>
<a id="__codelineno-79-14" name="__codelineno-79-14" href="#__codelineno-79-14"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-79-15" name="__codelineno-79-15" href="#__codelineno-79-15"></a><span class="p">}</span>
</code></pre></div>
<h2 id="14">14. 子树模型和自动重映射<a class="headerlink" href="#14" title="Permanent link">&para;</a></h2>
<p>子树重映射在<a href="https://www.behaviortree.dev/docs/tutorial-basics/tutorial_06_subtree_ports">教程6</a>中介绍。</p>
<p>不幸的是，当在多个位置使用相同的 SubTree 时，我们可能会发现自己反复复制粘贴相同的长 XML 标签。</p>
<p>例如，考虑如下情况：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="nt">&lt;SubTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MoveRobot&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;{move_goal}&quot;</span><span class="w">  </span><span class="na">frame=</span><span class="s">&quot;world&quot;</span><span class="w"> </span><span class="na">result=</span><span class="s">&quot;{error_code}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</code></pre></div>
<p>我们不想每次都复制粘贴这三个 XML 属性 <code>target</code>、<code>frame</code> 和 <code>result</code>，除非它们的值不同。</p>
<p>为避免此情况，我们可以在 <code>&lt;TreeNodesModel&gt;</code> 中定义它们的默认值。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="w">  </span><span class="nt">&lt;TreeNodesModel&gt;</span>
<a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="w">    </span><span class="nt">&lt;SubTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MoveRobot&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a><span class="w">      </span><span class="nt">&lt;input_port</span><span class="w">  </span><span class="na">name=</span><span class="s">&quot;target&quot;</span><span class="w">  </span><span class="na">default=</span><span class="s">&quot;{move_goal}&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a><span class="w">      </span><span class="nt">&lt;input_port</span><span class="w">  </span><span class="na">name=</span><span class="s">&quot;frame&quot;</span><span class="w">   </span><span class="na">default=</span><span class="s">&quot;world&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a><span class="w">      </span><span class="nt">&lt;output_port</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;result&quot;</span><span class="w">  </span><span class="na">default=</span><span class="s">&quot;{error_code}&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a><span class="w">    </span><span class="nt">&lt;/SubTree&gt;</span>
<a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a><span class="w">  </span><span class="nt">&lt;/TreeNodesModel&gt;</span>
</code></pre></div>
<p>从概念上讲，这类似于<a href="https://www.behaviortree.dev/docs/tutorial-advanced/tutorial_12_default_ports">教程12</a>中解释的默认端口。</p>
<p>如果在 XML 中指定，这些重映射黑板条目的值将被覆盖。下面的例子中，我们覆盖了 "frame" 的值，但保持了其他的默认重映射。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="nt">&lt;SubTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MoveRobot&quot;</span><span class="w"> </span><span class="na">frame=</span><span class="s">&quot;map&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</code></pre></div>
<h2 id="autoremap">自动重映射（Autoremap）<a class="headerlink" href="#autoremap" title="Permanent link">&para;</a></h2>
<p>当 SubTree 和父树中条目的名称<strong>相同</strong>时，你可以使用属性 <code>_autoremap</code>。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="nt">&lt;SubTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MoveRobot&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;{target}&quot;</span><span class="w">  </span><span class="na">frame=</span><span class="s">&quot;{frame}&quot;</span><span class="w"> </span><span class="na">result=</span><span class="s">&quot;{result}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</code></pre></div>
<p>可以替换为：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="nt">&lt;SubTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MoveRobot&quot;</span><span class="w"> </span><span class="na">_autoremap=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</code></pre></div>
<p>我们仍可以覆盖特定值，并自动重映射其他值：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="nt">&lt;SubTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MoveRobot&quot;</span><span class="w"> </span><span class="na">_autoremap=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="na">frame=</span><span class="s">&quot;world&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</code></pre></div>
<blockquote>
<p>⚠️ 注意</p>
<p>属性 <code>_autoremap="true"</code> 会自动重映射 SubTree 中的<strong>所有</strong>条目，<strong>除非</strong>它们的名称以下划线字符 "_" 开头。</p>
</blockquote>
<p>这可能是将 SubTree 中某条目标记为“私有”的方便方式。</p>
<h2 id="15-mocking">15. 模拟（Mocking）与节点替换<a class="headerlink" href="#15-mocking" title="Permanent link">&para;</a></h2>
<p>有时，特别是在实现集成测试和单元测试时，希望快速替换某个特定节点或整类节点为“测试”版本（模拟）。</p>
<p>从版本 4.1 起，引入了名为“替换规则”的新机制，简化了此过程。</p>
<p>它包含 <code>BehaviorTreeFactory</code> 类中的附加方法，应在节点注册完成后且实际树实例化前调用。</p>
<p>例如，给定 XML：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="nt">&lt;SaySomething</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;talk&quot;</span><span class="w"> </span><span class="na">message=</span><span class="s">&quot;hello world&quot;</span><span class="nt">/&gt;</span>
</code></pre></div>
<p>我们可能想用另一个名为 <strong>TestMessage</strong> 的节点替换它：</p>
<p>对应的替换命令为：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="n">factory</span><span class="p">.</span><span class="n">addSubstitutionRule</span><span class="p">(</span><span class="s">&quot;talk&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TestMessage&quot;</span><span class="p">);</span>
</code></pre></div>
<p>第一个参数是与 <code>TreeNode::fullPath</code> 匹配的<a href="https://en.wikipedia.org/wiki/Wildcard_character">通配符字符串</a>。</p>
<p>关于 <strong>fullPath</strong> 的详情，请参见<a href="https://www.behaviortree.dev/docs/tutorial-basics/tutorial_10_observer">之前的教程</a>。</p>
<h3 id="testnode">TestNode<a class="headerlink" href="#testnode" title="Permanent link">&para;</a></h3>
<p><code>TestNode</code> 是一个动作节点，可以配置为：</p>
<ul>
<li>返回特定状态，SUCCESS 或 FAILURE</li>
<li>同步或异步；后者需要指定超时</li>
<li>后置条件脚本，通常用来模拟输出端口（OutputPort）</li>
</ul>
<p>这个简单的虚拟节点不会覆盖所有情况，但能作为多种替换规则的默认解决方案。</p>
<h3 id="_41">完整示例<a class="headerlink" href="#_41" title="Permanent link">&para;</a></h3>
<p>在此示例中，我们将看到：</p>
<ul>
<li>如何用替换规则替换节点</li>
<li>如何使用内置的 <code>TestNode</code></li>
<li>通配符匹配示例</li>
<li>如何在运行时通过 JSON 文件传递这些规则</li>
</ul>
<p>使用如下 XML：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="nt">&lt;root</span><span class="w"> </span><span class="na">BTCPP_format=</span><span class="s">&quot;4&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a><span class="w">  </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MainTree&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a><span class="w">    </span><span class="nt">&lt;Sequence&gt;</span>
<a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a><span class="w">      </span><span class="nt">&lt;SaySomething</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;talk&quot;</span><span class="w"> </span><span class="na">message=</span><span class="s">&quot;hello world&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a><span class="w">        </span><span class="nt">&lt;Fallback&gt;</span>
<a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a><span class="w">          </span><span class="nt">&lt;AlwaysFailure</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;failing_action&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a><span class="w">          </span><span class="nt">&lt;SubTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MySub&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;mysub&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a><span class="w">        </span><span class="nt">&lt;/Fallback&gt;</span>
<a id="__codelineno-88-9" name="__codelineno-88-9" href="#__codelineno-88-9"></a><span class="w">        </span><span class="nt">&lt;SaySomething</span><span class="w"> </span><span class="na">message=</span><span class="s">&quot;before last_action&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-88-10" name="__codelineno-88-10" href="#__codelineno-88-10"></a><span class="w">        </span><span class="nt">&lt;Script</span><span class="w"> </span><span class="na">code=</span><span class="s">&quot;msg:=&#39;after last_action&#39;&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-88-11" name="__codelineno-88-11" href="#__codelineno-88-11"></a><span class="w">        </span><span class="nt">&lt;AlwaysSuccess</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;last_action&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-88-12" name="__codelineno-88-12" href="#__codelineno-88-12"></a><span class="w">        </span><span class="nt">&lt;SaySomething</span><span class="w"> </span><span class="na">message=</span><span class="s">&quot;{msg}&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-88-13" name="__codelineno-88-13" href="#__codelineno-88-13"></a><span class="w">    </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-88-14" name="__codelineno-88-14" href="#__codelineno-88-14"></a><span class="w">  </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-88-15" name="__codelineno-88-15" href="#__codelineno-88-15"></a>
<a id="__codelineno-88-16" name="__codelineno-88-16" href="#__codelineno-88-16"></a><span class="w">  </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MySub&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-88-17" name="__codelineno-88-17" href="#__codelineno-88-17"></a><span class="w">    </span><span class="nt">&lt;Sequence&gt;</span>
<a id="__codelineno-88-18" name="__codelineno-88-18" href="#__codelineno-88-18"></a><span class="w">      </span><span class="nt">&lt;AlwaysSuccess</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;action_subA&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-88-19" name="__codelineno-88-19" href="#__codelineno-88-19"></a><span class="w">      </span><span class="nt">&lt;AlwaysSuccess</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;action_subB&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-88-20" name="__codelineno-88-20" href="#__codelineno-88-20"></a><span class="w">    </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-88-21" name="__codelineno-88-21" href="#__codelineno-88-21"></a><span class="w">  </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-88-22" name="__codelineno-88-22" href="#__codelineno-88-22"></a><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<p>对应的 C++ 代码：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">**</span><span class="w"> </span><span class="n">argv</span><span class="p">)</span>
<a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a><span class="p">{</span>
<a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a><span class="w">  </span><span class="n">BT</span><span class="o">::</span><span class="n">BehaviorTreeFactory</span><span class="w"> </span><span class="n">factory</span><span class="p">;</span>
<a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerNodeType</span><span class="o">&lt;</span><span class="n">SaySomething</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;SaySomething&quot;</span><span class="p">);</span>
<a id="__codelineno-89-5" name="__codelineno-89-5" href="#__codelineno-89-5"></a>
<a id="__codelineno-89-6" name="__codelineno-89-6" href="#__codelineno-89-6"></a><span class="w">  </span><span class="c1">// 使用 lambda 和 registerSimpleAction 创建</span>
<a id="__codelineno-89-7" name="__codelineno-89-7" href="#__codelineno-89-7"></a><span class="w">  </span><span class="c1">// 一个“虚拟”节点，用来替换指定节点。</span>
<a id="__codelineno-89-8" name="__codelineno-89-8" href="#__codelineno-89-8"></a>
<a id="__codelineno-89-9" name="__codelineno-89-9" href="#__codelineno-89-9"></a><span class="w">  </span><span class="c1">// 简单节点，仅打印名字并返回 SUCCESS</span>
<a id="__codelineno-89-10" name="__codelineno-89-10" href="#__codelineno-89-10"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerSimpleAction</span><span class="p">(</span><span class="s">&quot;DummyAction&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[](</span><span class="n">BT</span><span class="o">::</span><span class="n">TreeNode</span><span class="o">&amp;</span><span class="w"> </span><span class="n">self</span><span class="p">){</span>
<a id="__codelineno-89-11" name="__codelineno-89-11" href="#__codelineno-89-11"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;DummyAction substituting: &quot;</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">name</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-89-12" name="__codelineno-89-12" href="#__codelineno-89-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<a id="__codelineno-89-13" name="__codelineno-89-13" href="#__codelineno-89-13"></a><span class="w">  </span><span class="p">});</span>
<a id="__codelineno-89-14" name="__codelineno-89-14" href="#__codelineno-89-14"></a>
<a id="__codelineno-89-15" name="__codelineno-89-15" href="#__codelineno-89-15"></a><span class="w">  </span><span class="c1">// 用于替换 SaySomething 的动作。</span>
<a id="__codelineno-89-16" name="__codelineno-89-16" href="#__codelineno-89-16"></a><span class="w">  </span><span class="c1">// 尝试使用输入端口 &quot;message&quot;</span>
<a id="__codelineno-89-17" name="__codelineno-89-17" href="#__codelineno-89-17"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerSimpleAction</span><span class="p">(</span><span class="s">&quot;TestSaySomething&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[](</span><span class="n">BT</span><span class="o">::</span><span class="n">TreeNode</span><span class="o">&amp;</span><span class="w"> </span><span class="n">self</span><span class="p">){</span>
<a id="__codelineno-89-18" name="__codelineno-89-18" href="#__codelineno-89-18"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">getInput</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">);</span>
<a id="__codelineno-89-19" name="__codelineno-89-19" href="#__codelineno-89-19"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-89-20" name="__codelineno-89-20" href="#__codelineno-89-20"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-89-21" name="__codelineno-89-21" href="#__codelineno-89-21"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">RuntimeError</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;missing required input [message]: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="n">error</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-89-22" name="__codelineno-89-22" href="#__codelineno-89-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-89-23" name="__codelineno-89-23" href="#__codelineno-89-23"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;TestSaySomething: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-89-24" name="__codelineno-89-24" href="#__codelineno-89-24"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<a id="__codelineno-89-25" name="__codelineno-89-25" href="#__codelineno-89-25"></a><span class="w">  </span><span class="p">});</span>
<a id="__codelineno-89-26" name="__codelineno-89-26" href="#__codelineno-89-26"></a>
<a id="__codelineno-89-27" name="__codelineno-89-27" href="#__codelineno-89-27"></a><span class="w">  </span><span class="c1">//----------------------------</span>
<a id="__codelineno-89-28" name="__codelineno-89-28" href="#__codelineno-89-28"></a><span class="w">  </span><span class="c1">// 如果传入参数为 &quot;no_sub&quot;，跳过添加规则</span>
<a id="__codelineno-89-29" name="__codelineno-89-29" href="#__codelineno-89-29"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">skip_substitution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;no_sub&quot;</span><span class="p">;</span>
<a id="__codelineno-89-30" name="__codelineno-89-30" href="#__codelineno-89-30"></a>
<a id="__codelineno-89-31" name="__codelineno-89-31" href="#__codelineno-89-31"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">skip_substitution</span><span class="p">)</span>
<a id="__codelineno-89-32" name="__codelineno-89-32" href="#__codelineno-89-32"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-89-33" name="__codelineno-89-33" href="#__codelineno-89-33"></a><span class="w">    </span><span class="c1">// 可以用 JSON 文件配置替换规则</span>
<a id="__codelineno-89-34" name="__codelineno-89-34" href="#__codelineno-89-34"></a><span class="w">    </span><span class="c1">// 或手动添加</span>
<a id="__codelineno-89-35" name="__codelineno-89-35" href="#__codelineno-89-35"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">USE_JSON</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-89-36" name="__codelineno-89-36" href="#__codelineno-89-36"></a>
<a id="__codelineno-89-37" name="__codelineno-89-37" href="#__codelineno-89-37"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">USE_JSON</span><span class="p">)</span>
<a id="__codelineno-89-38" name="__codelineno-89-38" href="#__codelineno-89-38"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-89-39" name="__codelineno-89-39" href="#__codelineno-89-39"></a><span class="w">      </span><span class="n">factory</span><span class="p">.</span><span class="n">loadSubstitutionRuleFromJSON</span><span class="p">(</span><span class="n">json_text</span><span class="p">);</span>
<a id="__codelineno-89-40" name="__codelineno-89-40" href="#__codelineno-89-40"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-89-41" name="__codelineno-89-41" href="#__codelineno-89-41"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-89-42" name="__codelineno-89-42" href="#__codelineno-89-42"></a><span class="w">      </span><span class="c1">// 用通配符替换匹配的节点为 TestAction</span>
<a id="__codelineno-89-43" name="__codelineno-89-43" href="#__codelineno-89-43"></a><span class="w">      </span><span class="n">factory</span><span class="p">.</span><span class="n">addSubstitutionRule</span><span class="p">(</span><span class="s">&quot;mysub/action_*&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TestAction&quot;</span><span class="p">);</span>
<a id="__codelineno-89-44" name="__codelineno-89-44" href="#__codelineno-89-44"></a>
<a id="__codelineno-89-45" name="__codelineno-89-45" href="#__codelineno-89-45"></a><span class="w">      </span><span class="c1">// 替换名为 [talk] 的节点为 TestSaySomething</span>
<a id="__codelineno-89-46" name="__codelineno-89-46" href="#__codelineno-89-46"></a><span class="w">      </span><span class="n">factory</span><span class="p">.</span><span class="n">addSubstitutionRule</span><span class="p">(</span><span class="s">&quot;talk&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TestSaySomething&quot;</span><span class="p">);</span>
<a id="__codelineno-89-47" name="__codelineno-89-47" href="#__codelineno-89-47"></a>
<a id="__codelineno-89-48" name="__codelineno-89-48" href="#__codelineno-89-48"></a><span class="w">      </span><span class="c1">// 配置一个 TestNode</span>
<a id="__codelineno-89-49" name="__codelineno-89-49" href="#__codelineno-89-49"></a><span class="w">      </span><span class="n">BT</span><span class="o">::</span><span class="n">TestNodeConfig</span><span class="w"> </span><span class="n">test_config</span><span class="p">;</span>
<a id="__codelineno-89-50" name="__codelineno-89-50" href="#__codelineno-89-50"></a><span class="w">      </span><span class="c1">// 将节点改为异步，等待 2000 毫秒</span>
<a id="__codelineno-89-51" name="__codelineno-89-51" href="#__codelineno-89-51"></a><span class="w">      </span><span class="n">test_config</span><span class="p">.</span><span class="n">async_delay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>
<a id="__codelineno-89-52" name="__codelineno-89-52" href="#__codelineno-89-52"></a><span class="w">      </span><span class="c1">// 执行该后置条件脚本</span>
<a id="__codelineno-89-53" name="__codelineno-89-53" href="#__codelineno-89-53"></a><span class="w">      </span><span class="n">test_config</span><span class="p">.</span><span class="n">post_script</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;msg =&#39;message SUBSTITUED&#39;&quot;</span><span class="p">;</span>
<a id="__codelineno-89-54" name="__codelineno-89-54" href="#__codelineno-89-54"></a>
<a id="__codelineno-89-55" name="__codelineno-89-55" href="#__codelineno-89-55"></a><span class="w">      </span><span class="c1">// 替换名为 [last_action] 的节点为配置好的 TestNode</span>
<a id="__codelineno-89-56" name="__codelineno-89-56" href="#__codelineno-89-56"></a><span class="w">      </span><span class="n">factory</span><span class="p">.</span><span class="n">addSubstitutionRule</span><span class="p">(</span><span class="s">&quot;last_action&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">test_config</span><span class="p">);</span>
<a id="__codelineno-89-57" name="__codelineno-89-57" href="#__codelineno-89-57"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-89-58" name="__codelineno-89-58" href="#__codelineno-89-58"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-89-59" name="__codelineno-89-59" href="#__codelineno-89-59"></a>
<a id="__codelineno-89-60" name="__codelineno-89-60" href="#__codelineno-89-60"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerBehaviorTreeFromText</span><span class="p">(</span><span class="n">xml_text</span><span class="p">);</span>
<a id="__codelineno-89-61" name="__codelineno-89-61" href="#__codelineno-89-61"></a>
<a id="__codelineno-89-62" name="__codelineno-89-62" href="#__codelineno-89-62"></a><span class="w">  </span><span class="c1">// 树构造阶段将使用替换规则实例化测试节点，替代原节点</span>
<a id="__codelineno-89-63" name="__codelineno-89-63" href="#__codelineno-89-63"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factory</span><span class="p">.</span><span class="n">createTree</span><span class="p">(</span><span class="s">&quot;MainTree&quot;</span><span class="p">);</span>
<a id="__codelineno-89-64" name="__codelineno-89-64" href="#__codelineno-89-64"></a><span class="w">  </span><span class="n">tree</span><span class="p">.</span><span class="n">tickWhileRunning</span><span class="p">();</span>
<a id="__codelineno-89-65" name="__codelineno-89-65" href="#__codelineno-89-65"></a>
<a id="__codelineno-89-66" name="__codelineno-89-66" href="#__codelineno-89-66"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-89-67" name="__codelineno-89-67" href="#__codelineno-89-67"></a><span class="p">}</span>
</code></pre></div>
<h3 id="json">JSON 格式<a class="headerlink" href="#json" title="Permanent link">&para;</a></h3>
<p>对应 <code>USE_JSON == false</code> 分支执行的 JSON 文件如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="p">{</span>
<a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a><span class="w">  </span><span class="nt">&quot;TestNodeConfigs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a><span class="w">    </span><span class="nt">&quot;MyTest&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a><span class="w">      </span><span class="nt">&quot;async_delay&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span>
<a id="__codelineno-90-5" name="__codelineno-90-5" href="#__codelineno-90-5"></a><span class="w">      </span><span class="nt">&quot;return_status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SUCCESS&quot;</span><span class="p">,</span>
<a id="__codelineno-90-6" name="__codelineno-90-6" href="#__codelineno-90-6"></a><span class="w">      </span><span class="nt">&quot;post_script&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;msg =&#39;message SUBSTITUED&#39;&quot;</span>
<a id="__codelineno-90-7" name="__codelineno-90-7" href="#__codelineno-90-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-90-8" name="__codelineno-90-8" href="#__codelineno-90-8"></a><span class="w">  </span><span class="p">},</span>
<a id="__codelineno-90-9" name="__codelineno-90-9" href="#__codelineno-90-9"></a>
<a id="__codelineno-90-10" name="__codelineno-90-10" href="#__codelineno-90-10"></a><span class="w">  </span><span class="nt">&quot;SubstitutionRules&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-90-11" name="__codelineno-90-11" href="#__codelineno-90-11"></a><span class="w">    </span><span class="nt">&quot;mysub/action_*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;TestAction&quot;</span><span class="p">,</span>
<a id="__codelineno-90-12" name="__codelineno-90-12" href="#__codelineno-90-12"></a><span class="w">    </span><span class="nt">&quot;talk&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;TestSaySomething&quot;</span><span class="p">,</span>
<a id="__codelineno-90-13" name="__codelineno-90-13" href="#__codelineno-90-13"></a><span class="w">    </span><span class="nt">&quot;last_action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MyTest&quot;</span>
<a id="__codelineno-90-14" name="__codelineno-90-14" href="#__codelineno-90-14"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-90-15" name="__codelineno-90-15" href="#__codelineno-90-15"></a><span class="p">}</span>
</code></pre></div>
<p>如你所见，主要分两部分：</p>
<ul>
<li><strong>TestNodeConfigs</strong>：设置一个或多个 <strong>TestNode</strong> 的参数和名称。</li>
<li><strong>SubstitutionRules</strong>：指定具体的替换规则。</li>
</ul>
<h2 id="16">16. 全局黑板惯用法<a class="headerlink" href="#16" title="Permanent link">&para;</a></h2>
<blockquote>
<p>ℹ️ 注意
引入于 Bt.CPP 4.6.0 版本</p>
</blockquote>
<p>如前面教程所述，BT.CPP 强调“作用域黑板”的重要性，用以隔离各子树，使其如同编程语言中的独立函数/例程。</p>
<p>但有时希望拥有真正的“全局”黑板，可被每个子树直接访问，无需重映射。</p>
<p>这种做法适用于：</p>
<ul>
<li>单例和全局对象（无法按<a href="https://www.behaviortree.dev/docs/tutorial-basics/tutorial_08_additional_args">教程8</a>描述的方式共享）</li>
<li>机器人的全局状态</li>
<li>在行为树外部写入/读取的数据，即在执行 tick 的主循环中</li>
</ul>
<p>此外，黑板是通用的键/值存储，值可以是<strong>任意</strong>类型，是实现文献中所谓<strong>“世界模型”</strong>的理想数据结构，即环境、机器人和任务状态与行为树共享的地方。</p>
<h3 id="_42">黑板层级结构<a class="headerlink" href="#_42" title="Permanent link">&para;</a></h3>
<p>考虑如下包含两个子树的简单树：</p>
<p><img alt="tree_hierarchy.png" src="https://www.behaviortree.dev/assets/images/tree_hierarchy-56dab79b138903144f65368898a3ad0f.png" /></p>
<p>每个 3 个子树各有自己的黑板；这些黑板之间的父子关系与树结构一致，即 BB1 是 BB2 和 BB3 的父黑板。</p>
<p>这些黑板的生命周期与各自子树绑定。</p>
<p>我们可以实现如下外部“全局黑板”：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="k">auto</span><span class="w"> </span><span class="n">global_bb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">Blackboard</span><span class="o">::</span><span class="n">create</span><span class="p">();</span>
<a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="k">auto</span><span class="w"> </span><span class="n">maintree_bb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">Blackboard</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="n">global_bb</span><span class="p">);</span>
<a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a><span class="k">auto</span><span class="w"> </span><span class="n">tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factory</span><span class="p">.</span><span class="n">createTree</span><span class="p">(</span><span class="s">&quot;MainTree&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">maintree_bb</span><span class="p">);</span>
</code></pre></div>
<p>这将创建如下黑板层级：</p>
<p><img alt="bb_hierarchy.png" src="https://www.behaviortree.dev/assets/images/bb_hierarchy-c85c83b6c61464605231def7f2db1557.png" /></p>
<p>实例 <code>global_bb</code> 位于行为树“外部”，即使销毁 <code>tree</code> 对象也会存在。</p>
<p>且可用 <code>set</code> 和 <code>get</code> 方法方便访问。</p>
<h3 id="_43">如何从树中访问顶层黑板<a class="headerlink" href="#_43" title="Permanent link">&para;</a></h3>
<p>“顶层黑板”指层级根节点处的黑板。</p>
<p>上述代码中，<code>global_bb</code> 是顶层黑板。</p>
<p>自 BT.CPP <strong>4.6</strong> 版本起，引入新语法，允许<strong>无需重映射</strong>直接访问顶层黑板，只需在条目名称前添加前缀 <code>@</code>。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="nt">&lt;PrintNumber</span><span class="w"> </span><span class="na">val=</span><span class="s">&quot;{@value}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</code></pre></div>
<p>端口 <strong>val</strong> 将在顶层黑板中查找条目 <code>value</code>，而非局部黑板。</p>
<h3 id="_44">完整示例<a class="headerlink" href="#_44" title="Permanent link">&para;</a></h3>
<p>考虑此树：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="w">  </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MainTree&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a><span class="w">    </span><span class="nt">&lt;Sequence&gt;</span>
<a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a><span class="w">      </span><span class="nt">&lt;PrintNumber</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;main_print&quot;</span><span class="w"> </span><span class="na">val=</span><span class="s">&quot;{@value}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a><span class="w">      </span><span class="nt">&lt;SubTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MySub&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a><span class="w">    </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-93-6" name="__codelineno-93-6" href="#__codelineno-93-6"></a><span class="w">  </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-93-7" name="__codelineno-93-7" href="#__codelineno-93-7"></a>
<a id="__codelineno-93-8" name="__codelineno-93-8" href="#__codelineno-93-8"></a><span class="w">  </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;MySub&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-93-9" name="__codelineno-93-9" href="#__codelineno-93-9"></a><span class="w">    </span><span class="nt">&lt;Sequence&gt;</span>
<a id="__codelineno-93-10" name="__codelineno-93-10" href="#__codelineno-93-10"></a><span class="w">      </span><span class="nt">&lt;PrintNumber</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;sub_print&quot;</span><span class="w"> </span><span class="na">val=</span><span class="s">&quot;{@value}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-93-11" name="__codelineno-93-11" href="#__codelineno-93-11"></a><span class="w">      </span><span class="nt">&lt;Script</span><span class="w"> </span><span class="na">code=</span><span class="s">&quot;@value_sqr := @value * @value&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-93-12" name="__codelineno-93-12" href="#__codelineno-93-12"></a><span class="w">    </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-93-13" name="__codelineno-93-13" href="#__codelineno-93-13"></a><span class="w">  </span><span class="nt">&lt;/BehaviorTree&gt;</span>
</code></pre></div>
<p>对应 C++ 代码：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">PrintNumber</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">SyncActionNode</span>
<a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a><span class="p">{</span>
<a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a><span class="w">  </span><span class="n">PrintNumber</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">NodeConfig</span><span class="o">&amp;</span><span class="w"> </span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">SyncActionNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a><span class="w">  </span><span class="p">{}</span>
<a id="__codelineno-94-7" name="__codelineno-94-7" href="#__codelineno-94-7"></a>
<a id="__codelineno-94-8" name="__codelineno-94-8" href="#__codelineno-94-8"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">PortsList</span><span class="w"> </span><span class="n">providedPorts</span><span class="p">()</span>
<a id="__codelineno-94-9" name="__codelineno-94-9" href="#__codelineno-94-9"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-94-10" name="__codelineno-94-10" href="#__codelineno-94-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">InputPort</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;val&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-94-11" name="__codelineno-94-11" href="#__codelineno-94-11"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-94-12" name="__codelineno-94-12" href="#__codelineno-94-12"></a>
<a id="__codelineno-94-13" name="__codelineno-94-13" href="#__codelineno-94-13"></a><span class="w">  </span><span class="n">NodeStatus</span><span class="w"> </span><span class="n">tick</span><span class="p">()</span><span class="w"> </span><span class="k">override</span>
<a id="__codelineno-94-14" name="__codelineno-94-14" href="#__codelineno-94-14"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-94-15" name="__codelineno-94-15" href="#__codelineno-94-15"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getInput</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;val&quot;</span><span class="p">).</span><span class="n">value</span><span class="p">();</span>
<a id="__codelineno-94-16" name="__codelineno-94-16" href="#__codelineno-94-16"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;[&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">name</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;] val: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-94-17" name="__codelineno-94-17" href="#__codelineno-94-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<a id="__codelineno-94-18" name="__codelineno-94-18" href="#__codelineno-94-18"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-94-19" name="__codelineno-94-19" href="#__codelineno-94-19"></a><span class="p">};</span>
<a id="__codelineno-94-20" name="__codelineno-94-20" href="#__codelineno-94-20"></a>
<a id="__codelineno-94-21" name="__codelineno-94-21" href="#__codelineno-94-21"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-94-22" name="__codelineno-94-22" href="#__codelineno-94-22"></a><span class="p">{</span>
<a id="__codelineno-94-23" name="__codelineno-94-23" href="#__codelineno-94-23"></a><span class="w">  </span><span class="n">BehaviorTreeFactory</span><span class="w"> </span><span class="n">factory</span><span class="p">;</span>
<a id="__codelineno-94-24" name="__codelineno-94-24" href="#__codelineno-94-24"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerNodeType</span><span class="o">&lt;</span><span class="n">PrintNumber</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;PrintNumber&quot;</span><span class="p">);</span>
<a id="__codelineno-94-25" name="__codelineno-94-25" href="#__codelineno-94-25"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerBehaviorTreeFromText</span><span class="p">(</span><span class="n">xml_main</span><span class="p">);</span>
<a id="__codelineno-94-26" name="__codelineno-94-26" href="#__codelineno-94-26"></a>
<a id="__codelineno-94-27" name="__codelineno-94-27" href="#__codelineno-94-27"></a><span class="w">  </span><span class="c1">// 无任何对象拥有此黑板所有权</span>
<a id="__codelineno-94-28" name="__codelineno-94-28" href="#__codelineno-94-28"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">global_bb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">Blackboard</span><span class="o">::</span><span class="n">create</span><span class="p">();</span>
<a id="__codelineno-94-29" name="__codelineno-94-29" href="#__codelineno-94-29"></a><span class="w">  </span><span class="c1">// &quot;MainTree&quot; 拥有 maintree_bb</span>
<a id="__codelineno-94-30" name="__codelineno-94-30" href="#__codelineno-94-30"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">maintree_bb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">Blackboard</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="n">global_bb</span><span class="p">);</span>
<a id="__codelineno-94-31" name="__codelineno-94-31" href="#__codelineno-94-31"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factory</span><span class="p">.</span><span class="n">createTree</span><span class="p">(</span><span class="s">&quot;MainTree&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">maintree_bb</span><span class="p">);</span>
<a id="__codelineno-94-32" name="__codelineno-94-32" href="#__codelineno-94-32"></a>
<a id="__codelineno-94-33" name="__codelineno-94-33" href="#__codelineno-94-33"></a><span class="w">  </span><span class="c1">// 可以直接与 global_bb 交互</span>
<a id="__codelineno-94-34" name="__codelineno-94-34" href="#__codelineno-94-34"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-94-35" name="__codelineno-94-35" href="#__codelineno-94-35"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-94-36" name="__codelineno-94-36" href="#__codelineno-94-36"></a><span class="w">    </span><span class="c1">// 写入条目 &quot;value&quot;</span>
<a id="__codelineno-94-37" name="__codelineno-94-37" href="#__codelineno-94-37"></a><span class="w">    </span><span class="n">global_bb</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;value&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-94-38" name="__codelineno-94-38" href="#__codelineno-94-38"></a><span class="w">    </span><span class="c1">// 触发一次树的 tick</span>
<a id="__codelineno-94-39" name="__codelineno-94-39" href="#__codelineno-94-39"></a><span class="w">    </span><span class="n">tree</span><span class="p">.</span><span class="n">tickOnce</span><span class="p">();</span>
<a id="__codelineno-94-40" name="__codelineno-94-40" href="#__codelineno-94-40"></a><span class="w">    </span><span class="c1">// 读取条目 &quot;value_sqr&quot;</span>
<a id="__codelineno-94-41" name="__codelineno-94-41" href="#__codelineno-94-41"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">value_sqr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">global_bb</span><span class="o">-&gt;</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;value_sqr&quot;</span><span class="p">);</span>
<a id="__codelineno-94-42" name="__codelineno-94-42" href="#__codelineno-94-42"></a><span class="w">    </span><span class="c1">// 输出</span>
<a id="__codelineno-94-43" name="__codelineno-94-43" href="#__codelineno-94-43"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;[While loop] value: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span>
<a id="__codelineno-94-44" name="__codelineno-94-44" href="#__codelineno-94-44"></a><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; value_sqr: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">value_sqr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-94-45" name="__codelineno-94-45" href="#__codelineno-94-45"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-94-46" name="__codelineno-94-46" href="#__codelineno-94-46"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-94-47" name="__codelineno-94-47" href="#__codelineno-94-47"></a><span class="p">}</span>
</code></pre></div>
<p>输出：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a>[main_print] val: 1
<a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a>[sub_print] val: 1
<a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a>[While loop] value: 1 value_sqr: 1
<a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a>
<a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a>[main_print] val: 2
<a id="__codelineno-95-6" name="__codelineno-95-6" href="#__codelineno-95-6"></a>[sub_print] val: 2
<a id="__codelineno-95-7" name="__codelineno-95-7" href="#__codelineno-95-7"></a>[While loop] value: 2 value_sqr: 4
<a id="__codelineno-95-8" name="__codelineno-95-8" href="#__codelineno-95-8"></a>
<a id="__codelineno-95-9" name="__codelineno-95-9" href="#__codelineno-95-9"></a>[main_print] val: 3
<a id="__codelineno-95-10" name="__codelineno-95-10" href="#__codelineno-95-10"></a>[sub_print] val: 3
<a id="__codelineno-95-11" name="__codelineno-95-11" href="#__codelineno-95-11"></a>[While loop] value: 3 value_sqr: 9
</code></pre></div>
<p>备注：</p>
<ul>
<li>前缀 "@" 在输入/输出端口和脚本语言中均有效。</li>
<li>子树中无需重映射。</li>
<li>主循环中直接访问黑板时，无需前缀 "@ "。</li>
</ul>
<h1 id="_45">指南<a class="headerlink" href="#_45" title="Permanent link">&para;</a></h1>
<p>成为行为树高手</p>
<h2 id="_46">脚本入门<a class="headerlink" href="#_46" title="Permanent link">&para;</a></h2>
<p>行为树 4.X 引入了一个简单而强大的新概念：XML 内的脚本语言。</p>
<p>该脚本语言语法熟悉，允许用户快速从黑板读写变量。</p>
<p>学习脚本最简单的方式是使用内置动作 <strong>Script</strong>，它在<a href="https://www.behaviortree.dev/docs/tutorial-basics/tutorial_02_basic_ports">第二教程</a>中介绍。</p>
<h3 id="_47">赋值运算符、字符串和数字<a class="headerlink" href="#_47" title="Permanent link">&para;</a></h3>
<p>示例：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a>param_A := 42
<a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a>param_B = 3.14
<a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a>message = &#39;hello world&#39;
</code></pre></div>
<ul>
<li>第一行将数字 42 赋值给黑板条目 <strong>param_A</strong>。</li>
<li>第二行将数字 3.14 赋值给黑板条目 <strong>param_B</strong>。</li>
<li>第三行将字符串 "hello world" 赋值给黑板条目 <strong>message</strong>。</li>
</ul>
<blockquote>
<p>💡 提示
运算符 <strong>":="</strong> 与 <strong>"="</strong> 的区别在于，前者会在黑板不存在该条目时创建它，而后者如果黑板无此条目则抛异常。</p>
</blockquote>
<p>你也可以用 <strong>分号</strong> 在一条脚本中添加多个命令。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a>A:= 42; B:=24
</code></pre></div>
<h4 id="_48">算术运算符和括号<a class="headerlink" href="#_48" title="Permanent link">&para;</a></h4>
<p>示例：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a>param_A := 7
<a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a>param_B := 5
<a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a>param_B *= 2
<a id="__codelineno-98-4" name="__codelineno-98-4" href="#__codelineno-98-4"></a>param_C := (param_A * 3) + param_B
</code></pre></div>
<p>结果 <code>param_B</code> 为 10，<code>param_C</code> 为 31。</p>
<p>支持以下运算符：</p>
<table>
<thead>
<tr>
<th>运算符</th>
<th>赋值运算符</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>+</td>
<td>+=</td>
<td>加法</td>
</tr>
<tr>
<td>-</td>
<td>-=</td>
<td>减法</td>
</tr>
<tr>
<td>*</td>
<td>*=</td>
<td>乘法</td>
</tr>
<tr>
<td>/</td>
<td>/=</td>
<td>除法</td>
</tr>
</tbody>
</table>
<p>注意，加法运算符唯一支持字符串连接。</p>
<h3 id="_49">位运算符和十六进制数<a class="headerlink" href="#_49" title="Permanent link">&para;</a></h3>
<p>仅当值能转为整数时可用。对字符串或浮点数使用会抛异常。</p>
<p>示例：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a>value:= 0x7F
<a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a>val_A:= value &amp; 0x0F
<a id="__codelineno-99-3" name="__codelineno-99-3" href="#__codelineno-99-3"></a>val_B:= value | 0xF0
</code></pre></div>
<p><code>val_A</code> 为 0x0F（15），<code>val_B</code> 为 0xFF（255）。</p>
<table>
<thead>
<tr>
<th>二进制运算符</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>|</td>
<td>按位或</td>
</tr>
<tr>
<td>&amp;</td>
<td>按位与</td>
</tr>
<tr>
<td>^</td>
<td>按位异或</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>一元运算符</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>\~</td>
<td>按位取反</td>
</tr>
</tbody>
</table>
<h3 id="_50">逻辑和比较运算符<a class="headerlink" href="#_50" title="Permanent link">&para;</a></h3>
<p>返回布尔值。</p>
<p>示例：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a>val_A := true
<a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a>val_B := 5 &gt; 3
<a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a>val_C := (val_A == val_B)
<a id="__codelineno-100-4" name="__codelineno-100-4" href="#__codelineno-100-4"></a>val_D := (val_A &amp;&amp; val_B) || !val_C
</code></pre></div>
<table>
<thead>
<tr>
<th>运算符</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>true/false</td>
<td>布尔值，可转换为 1/0</td>
</tr>
<tr>
<td>&amp;&amp;</td>
<td>逻辑与</td>
</tr>
<tr>
<td>||</td>
<td>逻辑或</td>
</tr>
<tr>
<td>!</td>
<td>逻辑非</td>
</tr>
<tr>
<td>==</td>
<td>等于</td>
</tr>
<tr>
<td>!=</td>
<td>不等</td>
</tr>
<tr>
<td>&lt;</td>
<td>小于</td>
</tr>
<tr>
<td>&lt;=</td>
<td>小于等于</td>
</tr>
<tr>
<td>&gt;</td>
<td>大于</td>
</tr>
<tr>
<td>&gt;=</td>
<td>大于等于</td>
</tr>
</tbody>
</table>
<h4 id="if-then-else">三元运算符 if-then-else<a class="headerlink" href="#if-then-else" title="Permanent link">&para;</a></h4>
<p>示例：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a>val_B = (val_A &gt; 1) ? 42 : 24
</code></pre></div>
<h3 id="c_1">C++ 示例<a class="headerlink" href="#c_1" title="Permanent link">&para;</a></h3>
<p>展示脚本语言及如何用枚举表示<strong>整数值</strong>。</p>
<p>XML：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a><span class="nt">&lt;root</span><span class="w"> </span><span class="nt">&gt;</span>
<a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a><span class="w">    </span><span class="nt">&lt;BehaviorTree&gt;</span>
<a id="__codelineno-102-3" name="__codelineno-102-3" href="#__codelineno-102-3"></a><span class="w">        </span><span class="nt">&lt;Sequence&gt;</span>
<a id="__codelineno-102-4" name="__codelineno-102-4" href="#__codelineno-102-4"></a><span class="w">            </span><span class="nt">&lt;Script</span><span class="w"> </span><span class="na">code=</span><span class="s">&quot; msg:=&#39;hello world&#39; &quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-102-5" name="__codelineno-102-5" href="#__codelineno-102-5"></a><span class="w">            </span><span class="nt">&lt;Script</span><span class="w"> </span><span class="na">code=</span><span class="s">&quot; A:=THE_ANSWER; B:=3.14; color:=RED &quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-102-6" name="__codelineno-102-6" href="#__codelineno-102-6"></a><span class="w">            </span><span class="nt">&lt;Precondition</span><span class="w"> </span><span class="na">if=</span><span class="s">&quot;A&gt;B &amp;&amp; color!=BLUE&quot;</span><span class="w"> </span><span class="na">else=</span><span class="s">&quot;FAILURE&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-102-7" name="__codelineno-102-7" href="#__codelineno-102-7"></a><span class="w">                </span><span class="nt">&lt;Sequence&gt;</span>
<a id="__codelineno-102-8" name="__codelineno-102-8" href="#__codelineno-102-8"></a><span class="w">                  </span><span class="nt">&lt;SaySomething</span><span class="w"> </span><span class="na">message=</span><span class="s">&quot;{A}&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-102-9" name="__codelineno-102-9" href="#__codelineno-102-9"></a><span class="w">                  </span><span class="nt">&lt;SaySomething</span><span class="w"> </span><span class="na">message=</span><span class="s">&quot;{B}&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-102-10" name="__codelineno-102-10" href="#__codelineno-102-10"></a><span class="w">                  </span><span class="nt">&lt;SaySomething</span><span class="w"> </span><span class="na">message=</span><span class="s">&quot;{msg}&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-102-11" name="__codelineno-102-11" href="#__codelineno-102-11"></a><span class="w">                  </span><span class="nt">&lt;SaySomething</span><span class="w"> </span><span class="na">message=</span><span class="s">&quot;{color}&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-102-12" name="__codelineno-102-12" href="#__codelineno-102-12"></a><span class="w">                </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-102-13" name="__codelineno-102-13" href="#__codelineno-102-13"></a><span class="w">            </span><span class="nt">&lt;/Precondition&gt;</span>
<a id="__codelineno-102-14" name="__codelineno-102-14" href="#__codelineno-102-14"></a><span class="w">        </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-102-15" name="__codelineno-102-15" href="#__codelineno-102-15"></a><span class="w">    </span><span class="nt">&lt;/BehaviorTree&gt;</span>
<a id="__codelineno-102-16" name="__codelineno-102-16" href="#__codelineno-102-16"></a><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<p>C++ 注册节点和枚举代码：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a><span class="p">{</span>
<a id="__codelineno-103-3" name="__codelineno-103-3" href="#__codelineno-103-3"></a><span class="w">  </span><span class="n">BehaviorTreeFactory</span><span class="w"> </span><span class="n">factory</span><span class="p">;</span>
<a id="__codelineno-103-4" name="__codelineno-103-4" href="#__codelineno-103-4"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerNodeType</span><span class="o">&lt;</span><span class="n">SaySomething</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;SaySomething&quot;</span><span class="p">);</span>
<a id="__codelineno-103-5" name="__codelineno-103-5" href="#__codelineno-103-5"></a>
<a id="__codelineno-103-6" name="__codelineno-103-6" href="#__codelineno-103-6"></a><span class="w">  </span><span class="k">enum</span><span class="w"> </span><span class="nc">Color</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">RED</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">BLUE</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">GREEN</span><span class="o">=</span><span class="mi">3</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-103-7" name="__codelineno-103-7" href="#__codelineno-103-7"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerScriptingEnums</span><span class="o">&lt;</span><span class="n">Color</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-103-8" name="__codelineno-103-8" href="#__codelineno-103-8"></a>
<a id="__codelineno-103-9" name="__codelineno-103-9" href="#__codelineno-103-9"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerScriptingEnum</span><span class="p">(</span><span class="s">&quot;THE_ANSWER&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">);</span>
<a id="__codelineno-103-10" name="__codelineno-103-10" href="#__codelineno-103-10"></a>
<a id="__codelineno-103-11" name="__codelineno-103-11" href="#__codelineno-103-11"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factory</span><span class="p">.</span><span class="n">createTreeFromText</span><span class="p">(</span><span class="n">xml_text</span><span class="p">);</span>
<a id="__codelineno-103-12" name="__codelineno-103-12" href="#__codelineno-103-12"></a><span class="w">  </span><span class="n">tree</span><span class="p">.</span><span class="n">tickWhileRunning</span><span class="p">();</span>
<a id="__codelineno-103-13" name="__codelineno-103-13" href="#__codelineno-103-13"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-103-14" name="__codelineno-103-14" href="#__codelineno-103-14"></a><span class="p">}</span>
</code></pre></div>
<p>预期输出：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a>Robot says: 42.000000
<a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a>Robot says: 3.140000
<a id="__codelineno-104-3" name="__codelineno-104-3" href="#__codelineno-104-3"></a>Robot says: hello world
<a id="__codelineno-104-4" name="__codelineno-104-4" href="#__codelineno-104-4"></a>Robot says: 1.000000
</code></pre></div>
<p>注意，枚举在内部始终以数值形式解释。</p>
<h2 id="_51">前置条件和后置条件<a class="headerlink" href="#_51" title="Permanent link">&para;</a></h2>
<p>利用<a href="https://www.behaviortree.dev/docs/guides/scripting">前一教程</a>中介绍的脚本语言功能，BT.CPP 4.x 引入了前置条件（Pre Conditions）和后置条件（Post Conditions）的概念，即可在节点实际执行 <strong>tick()</strong> 之前或之后运行的脚本。</p>
<p>所有节点均支持前置和后置条件，无需修改你的 C++ 代码。</p>
<blockquote>
<p>⚠️ 注意
脚本的目的<strong>不是</strong>编写复杂代码，而仅仅是提升树的可读性，并减少非常简单用例中自定义 C++ 节点的需求。</p>
</blockquote>
<p>如果脚本变得过长，建议重新考虑是否适合使用脚本。</p>
<h3 id="_52">前置条件<a class="headerlink" href="#_52" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>_skipIf</strong></td>
<td>如果条件为真，则跳过该节点的执行</td>
</tr>
<tr>
<td><strong>_failureIf</strong></td>
<td>如果条件为真，则跳过并返回 FAILURE</td>
</tr>
<tr>
<td><strong>_successIf</strong></td>
<td>如果条件为真，则跳过并返回 SUCCESS</td>
</tr>
<tr>
<td><strong>_while</strong></td>
<td>类似于 _skipIf，但如果条件变为假，还可以中断一个正在运行的节点</td>
</tr>
</tbody>
</table>
<h4 id="_53">示例<a class="headerlink" href="#_53" title="Permanent link">&para;</a></h4>
<p>之前教程中，我们看到如何用 fallback 构建 if-then-else 逻辑。</p>
<p>新语法更加简洁：</p>
<p><img alt="img" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iNTg0IiBoZWlnaHQ9IjIyMCIgY29udGVudD0iJmx0O214ZmlsZSBob3N0PSZxdW90O2FwcC5kaWFncmFtcy5uZXQmcXVvdDsgbW9kaWZpZWQ9JnF1b3Q7MjAyMi0xMC0wN1QwOTo1Njo1NC41MzZaJnF1b3Q7IGFnZW50PSZxdW90OzUuMCAoWDExOyBMaW51eCB4ODZfNjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMDMuMC4wLjAgU2FmYXJpLzUzNy4zNiZxdW90OyB2ZXJzaW9uPSZxdW90OzIwLjQuMCZxdW90OyBldGFnPSZxdW90O3lBczVUSElIOFBhalNFS2pXazhBJnF1b3Q7IHR5cGU9JnF1b3Q7Z29vZ2xlJnF1b3Q7Jmd0OyZsdDtkaWFncmFtIGlkPSZxdW90O1hTSS1FUHhUZDVrWlE3eVhtTXpWJnF1b3Q7Jmd0OzdaZE5jNXN3RUlaL1N3OGNtK0hiK0JqYmNadVpkbnJJb2MwcEk0TUExYktXQ2puRy9mVVZzQmcwMkoxNDZzWTU1QkxZZDdVQ1BlOUdGcFkzMzFTZkpDbnlyNUJRYnJsMlVsbmV3bkxkaVJQcXY3V3did1hmRFZvaGt5eHBKYWNYSHRodmlxS042cFlsdERRR0tnQ3VXR0dLTVFoQlkyVm9SRXJZbWNOUzRPWlRDNUxSa2ZBUUV6NVd2N05FNWEwYUJYYXZmNllzeTdzbk96Wm1OcVFiakVLWmt3UjJBOG03czd5NUJGRHQzYWFhVTE2ejY3aTBkY3NUMmNPTFNTclVTd3JjdHVDWjhDMnU3YjVjQU1nNWg1SW0rSTVxM3kxY3dsWWt0SzUxTEcrMnk1bWlEd1dKNit4T082MjFYRzA0cGxNUUNyMXpJaDBUR1dQb2hUckVKMU9wYUhYeTdaMERFOTFMRkRaVXliMGUwalVTVXNRMml2eEpHKzk2VTV6T2xIeGdpSThhd1Q3SURqUDNxUFFOMGpwT3podVIrMVpRVWJQN0N6WDdmR29Yd09SNjBVM29HcWdta1QxRzVmNG5WUDZJQ0UzMC94T0dBb1MrekV4SUlGVU9HUWpDdndBVWlPWW5WV3FQYk1oV2dRbU9Wa3o5cU10dkFvd2VCNWxGaFRNM3diNExoRjdLb0tnT0g0ZTV2cXlKdXJxaFNRSEdjK0RhKzNwNW5oM2FNM3Q1TUs5ZXJXRmRDVnNabzRSYm9TSXlvOHBvclJjWUxDa25pajJicy8rTFZjRzdWV2RaRlYzUHFuQzBBUzBKNXlzU3I5L2NCdVFFb3cwb25MN2lCalI1NytyVFhSMk51OXE5WGxkSDR3T0phSHJ2N2Yyc1JzSDFmbEtucjNUNnFBRXhmZkM5NVN3VFdseUJVckRSaVZKUHdVUTJ3M2poT0plQjZ2dm1tZTdvUGpFOVFuVjZBYXJkOThVQXErV0dYQ0VZZzJ2NGF3dGQ0bVBaSUx2VkE1eWdxQm9TWFY3ZlpmWDFxVnl6NGo3VlE1cHl1eC94SWRHMlBjVjQ0aDdVOGZhNmJKL2RUbk5aZTFQRytXRGJTTlBVamVQYVhTVmhUUWVaSkZ5RndZVk83WDVnV2p5eGoxZzhPV0t4ZDc3Rk91dy9wcHJjNEl2VXUvc0QmbHQ7L2RpYWdyYW0mZ3Q7Jmx0Oy9teGZpbGUmZ3Q7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9Ii0wLjUgLTAuNSA1ODQgMjIwIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojZmZmIj48Zz48cmVjdCB3aWR0aD0iMTUwIiBoZWlnaHQ9IjQwIiB4PSIxMSIgeT0iMTY4IiBmaWxsPSIjRkZGIiBzdHJva2U9IiMwMDAiIHBvaW50ZXItZXZlbnRzPSJhbGwiIHJ4PSIxNC40IiByeT0iMTQuNCIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPjxzd2l0Y2g+PGZvcmVpZ25PYmplY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcG9pbnRlci1ldmVudHM9Im5vbmUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSIgc3R5bGU9Im92ZXJmbG93OnZpc2libGU7dGV4dC1hbGlnbjpsZWZ0Ij48ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOnVuc2FmZSBjZW50ZXI7anVzdGlmeS1jb250ZW50OnVuc2FmZSBjZW50ZXI7d2lkdGg6MTQ4cHg7aGVpZ2h0OjFweDtwYWRkaW5nLXRvcDoxODhweDttYXJnaW4tbGVmdDoxMnB4Ij48ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsiIHN0eWxlPSJib3gtc2l6aW5nOmJvcmRlci1ib3g7Zm9udC1zaXplOjA7dGV4dC1hbGlnbjpjZW50ZXIiPjxkaXYgc3R5bGU9ImRpc3BsYXk6aW5saW5lLWJsb2NrO2ZvbnQtc2l6ZToxOHB4O2ZvbnQtZmFtaWx5OkhlbHZldGljYTtjb2xvcjojMDAwO2xpbmUtaGVpZ2h0OjEuMjtwb2ludGVyLWV2ZW50czphbGw7d2hpdGUtc3BhY2U6bm9ybWFsO292ZXJmbG93LXdyYXA6bm9ybWFsIj5Jc0Rvb3JDbG9zZWQ8L2Rpdj48L2Rpdj48L2Rpdj48L2ZvcmVpZ25PYmplY3Q+PHRleHQgeD0iODYiIHk9IjE5MyIgZmlsbD0iIzAwMCIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxOCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+SXNEb29yQ2xvc2VkPC90ZXh0Pjwvc3dpdGNoPjwvZz48cmVjdCB3aWR0aD0iMTIwIiBoZWlnaHQ9IjQwIiB4PSIxNzkuNjIiIHk9IjEwMSIgZmlsbD0iI0ZGRiIgc3Ryb2tlPSIjMDAwIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+PHN3aXRjaD48Zm9yZWlnbk9iamVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBwb2ludGVyLWV2ZW50cz0ibm9uZSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5IiBzdHlsZT0ib3ZlcmZsb3c6dmlzaWJsZTt0ZXh0LWFsaWduOmxlZnQiPjxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6dW5zYWZlIGNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6dW5zYWZlIGNlbnRlcjt3aWR0aDoxMThweDtoZWlnaHQ6MXB4O3BhZGRpbmctdG9wOjEyMXB4O21hcmdpbi1sZWZ0OjE4MXB4Ij48ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsiIHN0eWxlPSJib3gtc2l6aW5nOmJvcmRlci1ib3g7Zm9udC1zaXplOjA7dGV4dC1hbGlnbjpjZW50ZXIiPjxkaXYgc3R5bGU9ImRpc3BsYXk6aW5saW5lLWJsb2NrO2ZvbnQtc2l6ZToxOHB4O2ZvbnQtZmFtaWx5OkhlbHZldGljYTtjb2xvcjojMDAwO2xpbmUtaGVpZ2h0OjEuMjtwb2ludGVyLWV2ZW50czphbGw7d2hpdGUtc3BhY2U6bm9ybWFsO292ZXJmbG93LXdyYXA6bm9ybWFsIj5PcGVuRG9vcjwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSIyNDAiIHk9IjEyNiIgZmlsbD0iIzAwMCIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxOCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+T3BlbkRvb3I8L3RleHQ+PC9zd2l0Y2g+PC9nPjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNIDE1OS42MiA1MSBMIDIzNC4yMiA5Ny42MiIgcG9pbnRlci1ldmVudHM9InN0cm9rZSIvPjxwYXRoIGZpbGw9IiMwMDAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNIDIzOC42NyAxMDAuNDEgTCAyMzAuODggOTkuNjcgTCAyMzQuMjIgOTcuNjIgTCAyMzQuNTkgOTMuNzMgWiIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNIDE1OS42MiA1MSBMIDkxLjI3IDk3LjQyIiBwb2ludGVyLWV2ZW50cz0ic3Ryb2tlIi8+PHBhdGggZmlsbD0iIzAwMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGQ9Ik0gODYuOTIgMTAwLjM3IEwgOTAuNzUgOTMuNTQgTCA5MS4yNyA5Ny40MiBMIDk0LjY4IDk5LjMzIFoiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48cmVjdCB3aWR0aD0iMTIwIiBoZWlnaHQ9IjQwIiB4PSI5OS42MiIgeT0iMTEiIGZpbGw9IiNGRkYiIHN0cm9rZT0iIzAwMCIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPjxzd2l0Y2g+PGZvcmVpZ25PYmplY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcG9pbnRlci1ldmVudHM9Im5vbmUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSIgc3R5bGU9Im92ZXJmbG93OnZpc2libGU7dGV4dC1hbGlnbjpsZWZ0Ij48ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOnVuc2FmZSBjZW50ZXI7anVzdGlmeS1jb250ZW50OnVuc2FmZSBjZW50ZXI7d2lkdGg6MTE4cHg7aGVpZ2h0OjFweDtwYWRkaW5nLXRvcDozMXB4O21hcmdpbi1sZWZ0OjEwMXB4Ij48ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsiIHN0eWxlPSJib3gtc2l6aW5nOmJvcmRlci1ib3g7Zm9udC1zaXplOjA7dGV4dC1hbGlnbjpjZW50ZXIiPjxkaXYgc3R5bGU9ImRpc3BsYXk6aW5saW5lLWJsb2NrO2ZvbnQtc2l6ZToxOHB4O2ZvbnQtZmFtaWx5OkhlbHZldGljYTtjb2xvcjojMDAwO2xpbmUtaGVpZ2h0OjEuMjtwb2ludGVyLWV2ZW50czphbGw7d2hpdGUtc3BhY2U6bm9ybWFsO292ZXJmbG93LXdyYXA6bm9ybWFsIj5GYWxsYmFjazwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSIxNjAiIHk9IjM2IiBmaWxsPSIjMDAwIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjE4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5GYWxsYmFjazwvdGV4dD48L3N3aXRjaD48L2c+PHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGQ9Ik0gODYgMTQxIEwgODYgMTYxLjYzIiBwb2ludGVyLWV2ZW50cz0ic3Ryb2tlIi8+PHBhdGggZmlsbD0iIzAwMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGQ9Ik0gODYgMTY2Ljg4IEwgODIuNSAxNTkuODggTCA4NiAxNjEuNjMgTCA4OS41IDE1OS44OCBaIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PHJlY3Qgd2lkdGg9IjEyMCIgaGVpZ2h0PSI0MCIgeD0iMjYiIHk9IjEwMSIgZmlsbD0iI0ZGRiIgc3Ryb2tlPSIjMDAwIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+PHN3aXRjaD48Zm9yZWlnbk9iamVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBwb2ludGVyLWV2ZW50cz0ibm9uZSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5IiBzdHlsZT0ib3ZlcmZsb3c6dmlzaWJsZTt0ZXh0LWFsaWduOmxlZnQiPjxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6dW5zYWZlIGNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6dW5zYWZlIGNlbnRlcjt3aWR0aDoxMThweDtoZWlnaHQ6MXB4O3BhZGRpbmctdG9wOjEyMXB4O21hcmdpbi1sZWZ0OjI3cHgiPjxkaXYgZGF0YS1kcmF3aW8tY29sb3JzPSJjb2xvcjogcmdiKDAsIDAsIDApOyIgc3R5bGU9ImJveC1zaXppbmc6Ym9yZGVyLWJveDtmb250LXNpemU6MDt0ZXh0LWFsaWduOmNlbnRlciI+PGRpdiBzdHlsZT0iZGlzcGxheTppbmxpbmUtYmxvY2s7Zm9udC1zaXplOjE4cHg7Zm9udC1mYW1pbHk6SGVsdmV0aWNhO2NvbG9yOiMwMDA7bGluZS1oZWlnaHQ6MS4yO3BvaW50ZXItZXZlbnRzOmFsbDt3aGl0ZS1zcGFjZTpub3JtYWw7b3ZlcmZsb3ctd3JhcDpub3JtYWwiPkludmVydGVyPC9kaXY+PC9kaXY+PC9kaXY+PC9mb3JlaWduT2JqZWN0Pjx0ZXh0IHg9Ijg2IiB5PSIxMjYiIGZpbGw9IiMwMDAiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMTgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPkludmVydGVyPC90ZXh0Pjwvc3dpdGNoPjwvZz48cmVjdCB3aWR0aD0iMTkwIiBoZWlnaHQ9IjkwIiB4PSIzODEiIHk9IjExIiBmaWxsPSIjRkZGIiBzdHJva2U9IiMwMDAiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpIj48c3dpdGNoPjxmb3JlaWduT2JqZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHBvaW50ZXItZXZlbnRzPSJub25lIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiIHN0eWxlPSJvdmVyZmxvdzp2aXNpYmxlO3RleHQtYWxpZ246bGVmdCI+PGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczp1bnNhZmUgZmxleC1lbmQ7anVzdGlmeS1jb250ZW50OnVuc2FmZSBjZW50ZXI7d2lkdGg6MTg4cHg7aGVpZ2h0OjFweDtwYWRkaW5nLXRvcDo4N3B4O21hcmdpbi1sZWZ0OjM4MnB4Ij48ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsiIHN0eWxlPSJib3gtc2l6aW5nOmJvcmRlci1ib3g7Zm9udC1zaXplOjA7dGV4dC1hbGlnbjpjZW50ZXIiPjxkaXYgc3R5bGU9ImRpc3BsYXk6aW5saW5lLWJsb2NrO2ZvbnQtc2l6ZToxOHB4O2ZvbnQtZmFtaWx5OkhlbHZldGljYTtjb2xvcjojMDAwO2xpbmUtaGVpZ2h0OjEuMjtwb2ludGVyLWV2ZW50czphbGw7d2hpdGUtc3BhY2U6bm9ybWFsO292ZXJmbG93LXdyYXA6bm9ybWFsIj5PcGVuRG9vcjwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSI0NzYiIHk9Ijg3IiBmaWxsPSIjMDAwIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjE4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5PcGVuRG9vcjwvdGV4dD48L3N3aXRjaD48L2c+PHJlY3Qgd2lkdGg9IjE3MCIgaGVpZ2h0PSIzMCIgeD0iMzkxIiB5PSIyMSIgZmlsbD0iI2ZmZjJjYyIgc3Ryb2tlPSIjZDZiNjU2IiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+PHN3aXRjaD48Zm9yZWlnbk9iamVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBwb2ludGVyLWV2ZW50cz0ibm9uZSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5IiBzdHlsZT0ib3ZlcmZsb3c6dmlzaWJsZTt0ZXh0LWFsaWduOmxlZnQiPjxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6dW5zYWZlIGNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6dW5zYWZlIGNlbnRlcjt3aWR0aDoxNjhweDtoZWlnaHQ6MXB4O3BhZGRpbmctdG9wOjM2cHg7bWFyZ2luLWxlZnQ6MzkycHgiPjxkaXYgZGF0YS1kcmF3aW8tY29sb3JzPSJjb2xvcjogcmdiKDAsIDAsIDApOyIgc3R5bGU9ImJveC1zaXppbmc6Ym9yZGVyLWJveDtmb250LXNpemU6MDt0ZXh0LWFsaWduOmNlbnRlciI+PGRpdiBzdHlsZT0iZGlzcGxheTppbmxpbmUtYmxvY2s7Zm9udC1zaXplOjE4cHg7Zm9udC1mYW1pbHk6SGVsdmV0aWNhO2NvbG9yOiMwMDA7bGluZS1oZWlnaHQ6MS4yO3BvaW50ZXItZXZlbnRzOmFsbDt3aGl0ZS1zcGFjZTpub3JtYWw7b3ZlcmZsb3ctd3JhcDpub3JtYWwiPjxmb250IHN0eWxlPSJmb250LXNpemU6MTVweCI+X3NraXBJZiA9ICZxdW90OyFkb29yX2Nsb3NlZCZxdW90OzwvZm9udD48L2Rpdj48L2Rpdj48L2Rpdj48L2ZvcmVpZ25PYmplY3Q+PHRleHQgeD0iNDc2IiB5PSI0MSIgZmlsbD0iIzAwMCIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxOCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+X3NraXBJZiA9ICZxdW90OyFkb29yX2NsLi4uPC90ZXh0Pjwvc3dpdGNoPjwvZz48L2c+PC9zdmc+" /></p>
<p>之前的方法：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a><span class="nt">&lt;Fallback&gt;</span>
<a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a><span class="w">    </span><span class="nt">&lt;Inverter&gt;</span>
<a id="__codelineno-105-3" name="__codelineno-105-3" href="#__codelineno-105-3"></a><span class="w">        </span><span class="nt">&lt;IsDoorClosed/&gt;</span>
<a id="__codelineno-105-4" name="__codelineno-105-4" href="#__codelineno-105-4"></a><span class="w">    </span><span class="nt">&lt;/Inverter&gt;</span>
<a id="__codelineno-105-5" name="__codelineno-105-5" href="#__codelineno-105-5"></a><span class="w">    </span><span class="nt">&lt;OpenDoor/&gt;</span>
<a id="__codelineno-105-6" name="__codelineno-105-6" href="#__codelineno-105-6"></a><span class="nt">&lt;/Fallback&gt;</span>
</code></pre></div>
<p>如果不使用自定义的条件节点 <strong>IsDoorOpen</strong>，而是将布尔值存储在名为 <code>door_closed</code> 的条目中，XML 可以改写为：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a><span class="nt">&lt;OpenDoor</span><span class="w"> </span><span class="na">_skipIf=</span><span class="s">&quot;!door_closed&quot;</span><span class="nt">/&gt;</span>
</code></pre></div>
<h3 id="_54">后置条件<a class="headerlink" href="#_54" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>_onSuccess</strong></td>
<td>节点返回 SUCCESS 时执行该脚本</td>
</tr>
<tr>
<td><strong>_onFailure</strong></td>
<td>节点返回 FAILURE 时执行该脚本</td>
</tr>
<tr>
<td><strong>_post</strong></td>
<td>节点返回 SUCCESS 或 FAILURE 时均执行该脚本</td>
</tr>
<tr>
<td><strong>_onHalted</strong></td>
<td>运行中节点被中断时执行脚本</td>
</tr>
</tbody>
</table>
<h4 id="_55">示例<a class="headerlink" href="#_55" title="Permanent link">&para;</a></h4>
<p>在<a href="https://www.behaviortree.dev/docs/tutorial-basics/tutorial_06_subtree_ports">关于子树的教程</a>中，看到如何根据 <strong>MoveBase</strong> 的结果写入特定黑板变量。</p>
<p>左侧展示了在 BT.CPP 3.x 中如何实现该逻辑，以及使用后置条件后语法简化的效果。此外，新语法支持 <strong>枚举类型</strong>。</p>
<p><img alt="img" src="https://www.behaviortree.dev/assets/images/post_example-a0dd14431e604464b8bed24a2f411fc9.svg" /></p>
<p>旧版本：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="nt">&lt;Fallback&gt;</span>
<a id="__codelineno-107-2" name="__codelineno-107-2" href="#__codelineno-107-2"></a><span class="w">    </span><span class="nt">&lt;Sequence&gt;</span>
<a id="__codelineno-107-3" name="__codelineno-107-3" href="#__codelineno-107-3"></a><span class="w">        </span><span class="nt">&lt;MoveBase</span><span class="w">  </span><span class="na">goal=</span><span class="s">&quot;{target}&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-107-4" name="__codelineno-107-4" href="#__codelineno-107-4"></a><span class="w">        </span><span class="nt">&lt;SetBlackboard</span><span class="w"> </span><span class="na">output_key=</span><span class="s">&quot;result&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-107-5" name="__codelineno-107-5" href="#__codelineno-107-5"></a><span class="w">    </span><span class="nt">&lt;/Sequence&gt;</span>
<a id="__codelineno-107-6" name="__codelineno-107-6" href="#__codelineno-107-6"></a><span class="w">    </span><span class="nt">&lt;ForceFailure&gt;</span>
<a id="__codelineno-107-7" name="__codelineno-107-7" href="#__codelineno-107-7"></a><span class="w">        </span><span class="nt">&lt;SetBlackboard</span><span class="w"> </span><span class="na">output_key=</span><span class="s">&quot;result&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;-1&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-107-8" name="__codelineno-107-8" href="#__codelineno-107-8"></a><span class="w">    </span><span class="nt">&lt;/ForceFailure&gt;</span>
<a id="__codelineno-107-9" name="__codelineno-107-9" href="#__codelineno-107-9"></a><span class="nt">&lt;/Fallback&gt;</span>
</code></pre></div>
<p>新版实现：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a><span class="nt">&lt;MoveBase</span><span class="w"> </span><span class="na">goal=</span><span class="s">&quot;{target}&quot;</span><span class="w"> </span>
<a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a><span class="w">          </span><span class="na">_onSuccess=</span><span class="s">&quot;result:=OK&quot;</span>
<a id="__codelineno-108-3" name="__codelineno-108-3" href="#__codelineno-108-3"></a><span class="w">          </span><span class="na">_onFailure=</span><span class="s">&quot;result:=ERROR&quot;</span><span class="nt">/&gt;</span>
</code></pre></div>
<h3 id="_56">设计模式：错误码<a class="headerlink" href="#_56" title="Permanent link">&para;</a></h3>
<p>相比状态机，行为树在根据动作结果执行不同策略的模式上可能较弱。</p>
<p>由于行为树的返回仅限 SUCCESS 和 FAILURE，可能不够直观。</p>
<p>一种解决方案是在黑板中存储<strong>结果/错误码</strong>，但在版本 3.X 中实现较繁琐。</p>
<p>前置条件帮助实现更易读的代码，例如：</p>
<p><img alt="error_codes.svg" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iNjI0IiBoZWlnaHQ9IjI0MyIgY29udGVudD0iJmx0O214ZmlsZSBob3N0PSZxdW90O2FwcC5kaWFncmFtcy5uZXQmcXVvdDsgbW9kaWZpZWQ9JnF1b3Q7MjAyMi0xMC0wN1QxMDo0MDoyOC43NTNaJnF1b3Q7IGFnZW50PSZxdW90OzUuMCAoWDExOyBMaW51eCB4ODZfNjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMDMuMC4wLjAgU2FmYXJpLzUzNy4zNiZxdW90OyB2ZXJzaW9uPSZxdW90OzIwLjQuMCZxdW90OyBldGFnPSZxdW90O200bzA1YmctN2FEY0liZzY1RlRBJnF1b3Q7IHR5cGU9JnF1b3Q7Z29vZ2xlJnF1b3Q7Jmd0OyZsdDtkaWFncmFtIGlkPSZxdW90O295RkN3eHVONjFLWGZNaXdWRi1lJnF1b3Q7Jmd0OzNWaExjOU13RVA0dEhIS0U4U08yazJPYmxNY01IUmpDRFBUVVVXelpGblc4cml3bkRyOGVLWkw4RHFUVUpFQXU4ZTVxMTlMMzdhNDJtZGlMVGZtR29peStoUUFuRThzSXlvbTluRmlXT2ZOTS9pVTBlNmx4WEZzcUlrb0N0YWhXck1oM3JKU0cwaFlrd0hscklRTklHTW5hU2gvU0ZQdXNwVU9Vd3E2OUxJU2svZFlNUmJpbldQa282V3Uva0lERlVqdHpqRnIvRnBNbzFtODJEV1haSUwxWUtmSVlCYkJycU95YmliMmdBRXcrYmNvRlRnUjRHaGZwOS9xSXRkb1l4U2s3eGNHU0RsdVVGT3BzRTh0TnVPdjFtajlFNHVFV3R2Z2E1Ymd5VUczUkdoNSszZFgxVjRYQXQ4UlB6UFlLUnZleEFHMTRtUjlJdnVJTFRDY3JwWnV5NjBBUm9FUTRldDJRUGlSQVd5RW5sbTN3VHhqMm8vVE94eENOTVB2WldiaE92a21wdldYL2xCU3pncVp5ZTVpbkdMMzNlZG9QTGowV1ZpWkVCWTlGb1VnRExJZ3l1SGtYRTRaWEdmS0ZkY2ZyaXV0aXRoR0ltQW9LVlNqbWpNdGJUQm5oR1h1VmtFaHNpMEZXdlVQWWNIazBZOHdxRDNrQlk5aGdSdmQ4aVhKdzV0SkRsYTQ1MVZtL3F5dkJuS213Y2JzS1ZBV3E2b3VxMkhXQzhnZVZvOFA1YXY4Q0phQXNoZ2hTbEx3SGNlSUROdDh3WTNzRkRpb1l0SkhESldGZmhmc3JSMGwzRGN1eVZKRVB3bDRKVGJSdFlVejVPV1FRejlIeW5mWVVRaDNuSU9sQThqZzQ2UFNiSEFycUs1V3JHcHhNMDJiVm5rQWF4UWxpWk51Ty9od0NwajBDeE9aWFNrd2h4YUlZTHNGSmc0TW5VZERsOHZjb21ZMVBpWEw5Q09UUTVWVDlUZlhWVVJXZzBha3J1UzNsMW1HMjJzZEpaRHYvQXRuV0JkZzJUMitibzFlZzI3dXlWL2l4d0NuZjdxZzN5QWgzaFRWMzJybHFUd2N1QzUzUXpjdGlPc0pkNFEzTU5oMkFJbzVRZHZTZ2FueEVhNzNjZURJQWJyZFloMjdMK1FBQTh4RUFtUFVBK0lSOVBzM1IvWWQwNUdUcGpodHJZQXcyM0pEekVDU05ycFc4Tk0xVFU4c2JSdlljd00wSE1tZWtJZlkrZnlEWk96NlhHZ2QzbzE1UlQ0MHZEaUEzWGYvOHZCaVNKRmxVYzdRZGhxSGwrNEkvUnVFQk55eUJ1M1lkOTVra2FvZE9kUXpVaGpkQXNUMEN4ZnBkbCt3T1UrK1MzVUhmWVFQdDRmTU8vdnIyWUJyRDJKNEZ1dU0vbTgvV0lLei9vMEVjby9Ic0hZS0w5ZDh1Y2xhdS83eXliMzRBJmx0Oy9kaWFncmFtJmd0OyZsdDsvbXhmaWxlJmd0OyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSItMC41IC0wLjUgNjI0IDI0MyIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6I2ZmZiI+PGc+PHJlY3Qgd2lkdGg9IjE4MSIgaGVpZ2h0PSIxMTAiIHg9IjExIiB5PSIxMjEiIGZpbGw9IiNGRkYiIHN0cm9rZT0iIzAwMCIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPjxzd2l0Y2g+PGZvcmVpZ25PYmplY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcG9pbnRlci1ldmVudHM9Im5vbmUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSIgc3R5bGU9Im92ZXJmbG93OnZpc2libGU7dGV4dC1hbGlnbjpsZWZ0Ij48ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOnVuc2FmZSBmbGV4LXN0YXJ0O2p1c3RpZnktY29udGVudDp1bnNhZmUgY2VudGVyO3dpZHRoOjE3OXB4O2hlaWdodDoxcHg7cGFkZGluZy10b3A6MTI4cHg7bWFyZ2luLWxlZnQ6MTJweCI+PGRpdiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7IiBzdHlsZT0iYm94LXNpemluZzpib3JkZXItYm94O2ZvbnQtc2l6ZTowO3RleHQtYWxpZ246Y2VudGVyIj48ZGl2IHN0eWxlPSJkaXNwbGF5OmlubGluZS1ibG9jaztmb250LXNpemU6MThweDtmb250LWZhbWlseTpIZWx2ZXRpY2E7Y29sb3I6IzAwMDtsaW5lLWhlaWdodDoxLjI7cG9pbnRlci1ldmVudHM6YWxsO3doaXRlLXNwYWNlOm5vcm1hbDtvdmVyZmxvdy13cmFwOm5vcm1hbCI+PGI+TW92ZUJhc2U8YnIvPjwvYj48YnIvPjxmb250IHN0eWxlPSJmb250LXNpemU6MTVweCI+Z29hbD17PGZvbnQgY29sb3I9IiMwMGYiPjxiPnRhcmdldDwvYj48L2ZvbnQ+fTxici8+cmV0dXJuPXtlcnJvcl9jb2RlfTxici8+PC9mb250PjwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSIxMDIiIHk9IjE0NiIgZmlsbD0iIzAwMCIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxOCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+TW92ZUJhc2UuLi48L3RleHQ+PC9zd2l0Y2g+PC9nPjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNIDMwNyA1MSBMIDE1Mi41OSAxMTguNDUiIHBvaW50ZXItZXZlbnRzPSJzdHJva2UiLz48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTSAxNDcuNzcgMTIwLjU1IEwgMTUyLjc5IDExNC41NCBMIDE1Mi41OSAxMTguNDUgTCAxNTUuNTkgMTIwLjk2IFoiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTSAzMDcgNTEgTCAzMDcgMTE0LjYzIiBwb2ludGVyLWV2ZW50cz0ic3Ryb2tlIi8+PHBhdGggZmlsbD0iIzAwMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGQ9Ik0gMzA3IDExOS44OCBMIDMwMy41IDExMi44OCBMIDMwNyAxMTQuNjMgTCAzMTAuNSAxMTIuODggWiIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNIDMwNyA1MSBMIDQ2My42NSAxMTguNDgiIHBvaW50ZXItZXZlbnRzPSJzdHJva2UiLz48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTSA0NjguNDcgMTIwLjU2IEwgNDYwLjY2IDEyMSBMIDQ2My42NSAxMTguNDggTCA0NjMuNDMgMTE0LjU3IFoiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48cmVjdCB3aWR0aD0iMTIwIiBoZWlnaHQ9IjQwIiB4PSIyNDciIHk9IjExIiBmaWxsPSIjRkZGIiBzdHJva2U9IiMwMDAiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpIj48c3dpdGNoPjxmb3JlaWduT2JqZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHBvaW50ZXItZXZlbnRzPSJub25lIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiIHN0eWxlPSJvdmVyZmxvdzp2aXNpYmxlO3RleHQtYWxpZ246bGVmdCI+PGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczp1bnNhZmUgY2VudGVyO2p1c3RpZnktY29udGVudDp1bnNhZmUgY2VudGVyO3dpZHRoOjExOHB4O2hlaWdodDoxcHg7cGFkZGluZy10b3A6MzFweDttYXJnaW4tbGVmdDoyNDhweCI+PGRpdiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7IiBzdHlsZT0iYm94LXNpemluZzpib3JkZXItYm94O2ZvbnQtc2l6ZTowO3RleHQtYWxpZ246Y2VudGVyIj48ZGl2IHN0eWxlPSJkaXNwbGF5OmlubGluZS1ibG9jaztmb250LXNpemU6MThweDtmb250LWZhbWlseTpIZWx2ZXRpY2E7Y29sb3I6IzAwMDtsaW5lLWhlaWdodDoxLjI7cG9pbnRlci1ldmVudHM6YWxsO3doaXRlLXNwYWNlOm5vcm1hbDtvdmVyZmxvdy13cmFwOm5vcm1hbCI+U2VxdWVuY2U8L2Rpdj48L2Rpdj48L2Rpdj48L2ZvcmVpZ25PYmplY3Q+PHRleHQgeD0iMzA3IiB5PSIzNiIgZmlsbD0iIzAwMCIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxOCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+U2VxdWVuY2U8L3RleHQ+PC9zd2l0Y2g+PC9nPjxyZWN0IHdpZHRoPSIxOTAiIGhlaWdodD0iOTAiIHg9IjIxMiIgeT0iMTIxIiBmaWxsPSIjRkZGIiBzdHJva2U9IiMwMDAiIHBvaW50ZXItZXZlbnRzPSJub25lIi8+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+PHN3aXRjaD48Zm9yZWlnbk9iamVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBwb2ludGVyLWV2ZW50cz0ibm9uZSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5IiBzdHlsZT0ib3ZlcmZsb3c6dmlzaWJsZTt0ZXh0LWFsaWduOmxlZnQiPjxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6dW5zYWZlIGZsZXgtZW5kO2p1c3RpZnktY29udGVudDp1bnNhZmUgY2VudGVyO3dpZHRoOjE4OHB4O2hlaWdodDoxcHg7cGFkZGluZy10b3A6MTk3cHg7bWFyZ2luLWxlZnQ6MjEzcHgiPjxkaXYgZGF0YS1kcmF3aW8tY29sb3JzPSJjb2xvcjogcmdiKDAsIDAsIDApOyIgc3R5bGU9ImJveC1zaXppbmc6Ym9yZGVyLWJveDtmb250LXNpemU6MDt0ZXh0LWFsaWduOmNlbnRlciI+PGRpdiBzdHlsZT0iZGlzcGxheTppbmxpbmUtYmxvY2s7Zm9udC1zaXplOjE4cHg7Zm9udC1mYW1pbHk6SGVsdmV0aWNhO2NvbG9yOiMwMDA7bGluZS1oZWlnaHQ6MS4yO3BvaW50ZXItZXZlbnRzOm5vbmU7d2hpdGUtc3BhY2U6bm9ybWFsO292ZXJmbG93LXdyYXA6bm9ybWFsIj5SZWNvdmVyeU9uZTwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSIzMDciIHk9IjE5NyIgZmlsbD0iIzAwMCIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxOCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+UmVjb3ZlcnlPbmU8L3RleHQ+PC9zd2l0Y2g+PC9nPjxyZWN0IHdpZHRoPSIxNzAiIGhlaWdodD0iMzAiIHg9IjIyMiIgeT0iMTMxIiBmaWxsPSIjZmZmMmNjIiBzdHJva2U9IiNkNmI2NTYiIHBvaW50ZXItZXZlbnRzPSJub25lIi8+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+PHN3aXRjaD48Zm9yZWlnbk9iamVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBwb2ludGVyLWV2ZW50cz0ibm9uZSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5IiBzdHlsZT0ib3ZlcmZsb3c6dmlzaWJsZTt0ZXh0LWFsaWduOmxlZnQiPjxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6dW5zYWZlIGNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6dW5zYWZlIGNlbnRlcjt3aWR0aDoxNjhweDtoZWlnaHQ6MXB4O3BhZGRpbmctdG9wOjE0NnB4O21hcmdpbi1sZWZ0OjIyM3B4Ij48ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsiIHN0eWxlPSJib3gtc2l6aW5nOmJvcmRlci1ib3g7Zm9udC1zaXplOjA7dGV4dC1hbGlnbjpjZW50ZXIiPjxkaXYgc3R5bGU9ImRpc3BsYXk6aW5saW5lLWJsb2NrO2ZvbnQtc2l6ZToxOHB4O2ZvbnQtZmFtaWx5OkhlbHZldGljYTtjb2xvcjojMDAwO2xpbmUtaGVpZ2h0OjEuMjtwb2ludGVyLWV2ZW50czpub25lO3doaXRlLXNwYWNlOm5vcm1hbDtvdmVyZmxvdy13cmFwOm5vcm1hbCI+PGZvbnQgc3R5bGU9ImZvbnQtc2l6ZToxNXB4Ij5fc2tpcElmID0gJnF1b3Q7ZXJyb3JfY29kZSE9MSZxdW90OzwvZm9udD48L2Rpdj48L2Rpdj48L2Rpdj48L2ZvcmVpZ25PYmplY3Q+PHRleHQgeD0iMzA3IiB5PSIxNTEiIGZpbGw9IiMwMDAiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMTgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPl9za2lwSWYgPSAmcXVvdDtlcnJvcl9jby4uLjwvdGV4dD48L3N3aXRjaD48L2c+PHJlY3Qgd2lkdGg9IjE5MCIgaGVpZ2h0PSI5MCIgeD0iNDIyIiB5PSIxMjEiIGZpbGw9IiNGRkYiIHN0cm9rZT0iIzAwMCIgcG9pbnRlci1ldmVudHM9Im5vbmUiLz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpIj48c3dpdGNoPjxmb3JlaWduT2JqZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHBvaW50ZXItZXZlbnRzPSJub25lIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiIHN0eWxlPSJvdmVyZmxvdzp2aXNpYmxlO3RleHQtYWxpZ246bGVmdCI+PGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczp1bnNhZmUgZmxleC1lbmQ7anVzdGlmeS1jb250ZW50OnVuc2FmZSBjZW50ZXI7d2lkdGg6MTg4cHg7aGVpZ2h0OjFweDtwYWRkaW5nLXRvcDoxOTdweDttYXJnaW4tbGVmdDo0MjNweCI+PGRpdiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7IiBzdHlsZT0iYm94LXNpemluZzpib3JkZXItYm94O2ZvbnQtc2l6ZTowO3RleHQtYWxpZ246Y2VudGVyIj48ZGl2IHN0eWxlPSJkaXNwbGF5OmlubGluZS1ibG9jaztmb250LXNpemU6MThweDtmb250LWZhbWlseTpIZWx2ZXRpY2E7Y29sb3I6IzAwMDtsaW5lLWhlaWdodDoxLjI7cG9pbnRlci1ldmVudHM6bm9uZTt3aGl0ZS1zcGFjZTpub3JtYWw7b3ZlcmZsb3ctd3JhcDpub3JtYWwiPlJlY292ZXJ5VHdvPC9kaXY+PC9kaXY+PC9kaXY+PC9mb3JlaWduT2JqZWN0Pjx0ZXh0IHg9IjUxNyIgeT0iMTk3IiBmaWxsPSIjMDAwIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjE4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5SZWNvdmVyeVR3bzwvdGV4dD48L3N3aXRjaD48L2c+PHJlY3Qgd2lkdGg9IjE3MCIgaGVpZ2h0PSIzMCIgeD0iNDMyIiB5PSIxMzEiIGZpbGw9IiNmZmYyY2MiIHN0cm9rZT0iI2Q2YjY1NiIgcG9pbnRlci1ldmVudHM9Im5vbmUiLz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpIj48c3dpdGNoPjxmb3JlaWduT2JqZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHBvaW50ZXItZXZlbnRzPSJub25lIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiIHN0eWxlPSJvdmVyZmxvdzp2aXNpYmxlO3RleHQtYWxpZ246bGVmdCI+PGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczp1bnNhZmUgY2VudGVyO2p1c3RpZnktY29udGVudDp1bnNhZmUgY2VudGVyO3dpZHRoOjE2OHB4O2hlaWdodDoxcHg7cGFkZGluZy10b3A6MTQ2cHg7bWFyZ2luLWxlZnQ6NDMzcHgiPjxkaXYgZGF0YS1kcmF3aW8tY29sb3JzPSJjb2xvcjogcmdiKDAsIDAsIDApOyIgc3R5bGU9ImJveC1zaXppbmc6Ym9yZGVyLWJveDtmb250LXNpemU6MDt0ZXh0LWFsaWduOmNlbnRlciI+PGRpdiBzdHlsZT0iZGlzcGxheTppbmxpbmUtYmxvY2s7Zm9udC1zaXplOjE4cHg7Zm9udC1mYW1pbHk6SGVsdmV0aWNhO2NvbG9yOiMwMDA7bGluZS1oZWlnaHQ6MS4yO3BvaW50ZXItZXZlbnRzOm5vbmU7d2hpdGUtc3BhY2U6bm9ybWFsO292ZXJmbG93LXdyYXA6bm9ybWFsIj48Zm9udCBzdHlsZT0iZm9udC1zaXplOjE1cHgiPl9za2lwSWYgPSAmcXVvdDtlcnJvcl9jb2RlIT0yJnF1b3Q7PC9mb250PjwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSI1MTciIHk9IjE1MSIgZmlsbD0iIzAwMCIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxOCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+X3NraXBJZiA9ICZxdW90O2Vycm9yX2NvLi4uPC90ZXh0Pjwvc3dpdGNoPjwvZz48L2c+PC9zdmc+" /></p>
<p>在上述树中，我们为 <strong>MoveBase</strong> 添加了一个输出端口 <strong>return</strong>，并根据 <code>error_code</code> 的值有条件地选择序列的第二或第三个分支。</p>
<h3 id="_57">设计模式：状态与声明式树<a class="headerlink" href="#_57" title="Permanent link">&para;</a></h3>
<p>尽管行为树的承诺是让我们摆脱状态机的束缚，但实际上，有时不借助状态很难推理应用逻辑。</p>
<p>使用状态可以使树结构更简单。例如，我们仅在机器人（或子系统）处于特定状态时，才选择树的某个分支。</p>
<p>考虑以下节点及其前置/后置条件：</p>
<p><img alt="landing.svg" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzk0IiBoZWlnaHQ9IjIwNCIgY29udGVudD0iJmx0O214ZmlsZSBob3N0PSZxdW90O2FwcC5kaWFncmFtcy5uZXQmcXVvdDsgbW9kaWZpZWQ9JnF1b3Q7MjAyMi0xMC0xMFQwODo0MDo0Ny43ODVaJnF1b3Q7IGFnZW50PSZxdW90OzUuMCAoWDExOyBMaW51eCB4ODZfNjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMDMuMC4wLjAgU2FmYXJpLzUzNy4zNiZxdW90OyB2ZXJzaW9uPSZxdW90OzIwLjQuMCZxdW90OyBldGFnPSZxdW90O3hiVElLTU9mUHphU3h1LV9ickdBJnF1b3Q7IHR5cGU9JnF1b3Q7Z29vZ2xlJnF1b3Q7Jmd0OyZsdDtkaWFncmFtIGlkPSZxdW90Oy1oWmhUSlJCNnVFQTZYeFJrNkY2JnF1b3Q7Jmd0OzFWYkpidHN3RVAyV0hvUWtod1JhTE5sWDIzTFRBR21LMWkxNk5HaUxXaEJKZENrNnR2djE1VEtrU0M5SVVNUUZlb21wTnd1SE0yOW00a1hUWm5kUDBicjhUREpjZTZHZjdid285Y0l3aU9PWS93aGtyNUJCTUZKQVFhc01sSHBnWHYzR0FQcUFicW9NZDQ0aUk2Um0xZG9GVjZSdDhZbzVHS0tVYkYyMW5OVHVyV3RVNENOZ3ZrTDFNZnF6eWxpcDBGSHM5L2duWEJXbHZqbndRZElnclF4QVY2S01iQzBvbW5uUmxCTEMxS25aVFhFdGtxZnpvdXcrbnBHYXdDaHUyVnNNUW1Yd2d1b052TTBMazVxYlRwYjhVSWpESTlsaU91YkpaWnNNYXluM2FCU01CVDFFY3NLajRJOWtlOGhjOG10RHRPQzJrM1VkYzRVZ1h1K1VHY2pQdTg0b2FmRUNtWEI4NFhjNE1jQXd0VUpVOTE4b3BtNk4ycE9PVnFRbVZEbWh4UkpkOHdwTStmbmc1MGE2OHVXdE9XcXFlcTlNR3RJUzducUZMWGtmbFE5QitRenYyQzJxcTZKVmdvNGh5azdHcXhKejJJMHg1d1AvbzZobXZqUS9Zc2tRanFUaUxEZ1VDMmJFbkVldjZRWkdWOVB3cjl5RXZSdEZUaU1SZjBRRk9BREZqSFVWdEk1S2dWWlE2ZU5mWTZrcUN5dGtycWI4S3RSNTBUMVg2NGRjcWh1bnZxdlBFODd3QnltOWVody9wUTlQOTR0dnM2OC9adlB2cy9UcWhJRWR0OHlCRGw3ZjJyL1lmVTFJeWFiTnNFcU9qR2V5TFN1RzU1SWxBdHp5d2txOFpJMnNiUnFZMTgvaDhhbVlzUUtyNm5vcUdhcjlSM21laDZzVnZJcVNaM3dnejVKbEVpZFNyaGduSkRYT0lSRThqS290SHVFN0hSNDg1Z1ZUVHRZM0VjU0lERGZ1TVdrd28zdXBiamtKQjhPN3VIZTB0M3drdzU1bi9sYU9aeU9NQXN1b1ZDTzZGMXAycU92eHdvcmhrTDN5MDFEWUJ0M0dBcjJqRGpTalNrMlQxd2JxMFV3TG5RbGttQ0o0NHJBRU9BSU1FZnl3MkNHNUVVMUVvU3ErNU1acXFxUk5sV1UxTnRkQUhjL3RtY0JzTDd0cVBoaUVBMWg0c1BHREpBRmcyeS9RYUFoWWFTL1BFWUFJbG5aZmpuNnZlYVlJcDlkY2RIYk52WGtkRE02c0F6TXI1Q1lTVGE4MVlFSkVhZnBsQVJQQ01iOXNSUWVlM2V2Q2wrNXp0OHVsQkRwYzl6ZDB0OXZib3JQZmlRdXlkeDAyREUrd0lRNjFtczJINkIzb01MZ2dIZGFrWStmSW9NQnIrNytYTUVHTnFLSWlnNVQ3ZDhHTjlNRG5qQytJTTVPdTlKcG4rQit5YVBRL3NXamtYNUpGSHN6MFhtWk44MmoyQnc9PSZsdDsvZGlhZ3JhbSZndDsmbHQ7L214ZmlsZSZndDsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iLTAuNSAtMC41IDM5NCAyMDQiIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiNmZmYiPjxnPjxyZWN0IHdpZHRoPSIzNzAiIGhlaWdodD0iMTgwIiB4PSIxMSIgeT0iMTEiIGZpbGw9IiNGRkYiIHN0cm9rZT0iIzAwMCIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPjxzd2l0Y2g+PGZvcmVpZ25PYmplY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcG9pbnRlci1ldmVudHM9Im5vbmUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSIgc3R5bGU9Im92ZXJmbG93OnZpc2libGU7dGV4dC1hbGlnbjpsZWZ0Ij48ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOnVuc2FmZSBjZW50ZXI7anVzdGlmeS1jb250ZW50OnVuc2FmZSBjZW50ZXI7d2lkdGg6MzY4cHg7aGVpZ2h0OjFweDtwYWRkaW5nLXRvcDoxMDFweDttYXJnaW4tbGVmdDoxMnB4Ij48ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsiIHN0eWxlPSJib3gtc2l6aW5nOmJvcmRlci1ib3g7Zm9udC1zaXplOjA7dGV4dC1hbGlnbjpjZW50ZXIiPjxkaXYgc3R5bGU9ImRpc3BsYXk6aW5saW5lLWJsb2NrO2ZvbnQtc2l6ZToxOHB4O2ZvbnQtZmFtaWx5OkhlbHZldGljYTtjb2xvcjojMDAwO2xpbmUtaGVpZ2h0OjEuMjtwb2ludGVyLWV2ZW50czphbGw7d2hpdGUtc3BhY2U6bm9ybWFsO292ZXJmbG93LXdyYXA6bm9ybWFsIj48Yj5Mb3dlckFsdGl0dWRlPC9iPjxici8+PGZvbnQgc3R5bGU9ImZvbnQtc2l6ZToxNXB4Ij48YnIvPmRyb25lX2FsdGl0dWRlID17YWx0aXR1ZGV9PC9mb250Pjxmb250IHN0eWxlPSJmb250LXNpemU6MTVweCI+PHNwYW4gc3R5bGU9ImNvbG9yOnRyYW5zcGFyZW50O2ZvbnQtZmFtaWx5Om1vbm9zcGFjZTtmb250LXNpemU6MDt0ZXh0LWFsaWduOnN0YXJ0Ij50aXR1ZGUzQ214R3JhcGhNb2RlbCUzRSUzQ3Jvb3QlM0UlM0NteENlbGwlMjBpZCUzRCUyMjAlMjIlMkYlM0UlM0NteENlbGwlMjBpZCUzRCUyMjElMjIlMjBwYXJlbnQlM0QlMjIwJTIyJTJGJTNFJTNDbXhDZWxsJTIwaWQlM0QlMjIyJTIyJTIwdmFsdWUlM0QlMjIlMjZsdCUzQmZvbnQlMjBzdHlsZSUzRCUyNnF1b3QlM0Jmb250LXNpemUlM0ElMjAxNXB4JTNCJTI2cXVvdCUzQiUyNmd0JTNCX3NraXBJZiUyMCUzRCUyMCUyNnF1b3QlM0JzdGF0ZSElM0QmYXBvcztMQU5ESU5HX1JFUVVFU1RFRCZhcG9zOyUyMCUyNnF1b3QlM0IlMjZsdCUzQiUyRmZvbnQlMjZndCUzQiUyMiUyMHN0eWxlJTNEJTIycm91bmRlZCUzRDAlM0J3aGl0ZVNwYWNlJTNEd3JhcCUzQmh0bWwlM0QxJTNCZm9udFNpemUlM0QxOCUzQmZpbGxDb2xvciUzRCUyM2ZmZjJjYyUzQnN0cm9rZUNvbG9yJTNEJTIzZDZiNjU2JTNCYWxpZ24lM0RsZWZ0JTNCc3BhY2luZ0xlZnQlM0Q3JTNCJTIyJTIwdmVydGV4JTNEJTIyMSUyMiUyMHBhcmVudCUzRCUyMjElMjIlM0UlM0NteEdlb21ldHJ5JTIweCUzRCUyMjI0Ny41JTIyJTIweSUzRCUyMjE2NzAlMjIlMjB3aWR0aCUzRCUyMjMxNSUyMiUyMGhlaWdodCUzRCUyMjMwJTIyJTIwYXMlM0QlMjJnZW9tZXRyeSUyMiUyRiUzRSUzQyUyRm14Q2VsbCUzRSUzQyUyRnJvb3QlM0UlM0MlMkZteEdyYXBoTW9kZWwlM0U8L3NwYW4+PGJyLz48L2ZvbnQ+PC9kaXY+PC9kaXY+PC9kaXY+PC9mb3JlaWduT2JqZWN0Pjx0ZXh0IHg9IjE5NiIgeT0iMTA2IiBmaWxsPSIjMDAwIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjE4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5Mb3dlckFsdGl0dWRlLi4uPC90ZXh0Pjwvc3dpdGNoPjwvZz48cmVjdCB3aWR0aD0iMzUyLjUiIGhlaWdodD0iMzAiIHg9IjE4LjUiIHk9IjIxIiBmaWxsPSIjZmZmMmNjIiBzdHJva2U9IiNkNmI2NTYiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpIj48c3dpdGNoPjxmb3JlaWduT2JqZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHBvaW50ZXItZXZlbnRzPSJub25lIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiIHN0eWxlPSJvdmVyZmxvdzp2aXNpYmxlO3RleHQtYWxpZ246bGVmdCI+PGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczp1bnNhZmUgY2VudGVyO2p1c3RpZnktY29udGVudDp1bnNhZmUgZmxleC1zdGFydDt3aWR0aDozNDRweDtoZWlnaHQ6MXB4O3BhZGRpbmctdG9wOjM2cHg7bWFyZ2luLWxlZnQ6MjhweCI+PGRpdiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7IiBzdHlsZT0iYm94LXNpemluZzpib3JkZXItYm94O2ZvbnQtc2l6ZTowO3RleHQtYWxpZ246bGVmdCI+PGRpdiBzdHlsZT0iZGlzcGxheTppbmxpbmUtYmxvY2s7Zm9udC1zaXplOjE0cHg7Zm9udC1mYW1pbHk6SGVsdmV0aWNhO2NvbG9yOiMwMDA7bGluZS1oZWlnaHQ6MS4yO3BvaW50ZXItZXZlbnRzOmFsbDt3aGl0ZS1zcGFjZTpub3JtYWw7b3ZlcmZsb3ctd3JhcDpub3JtYWwiPjxmb250IHN0eWxlPSJmb250LXNpemU6MTRweCI+X3NraXBJZiA9ICZxdW90O3N0YXRlIT1ET19MQU5ESU5HJnF1b3Q7PC9mb250PjwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSIyOCIgeT0iNDAiIGZpbGw9IiMwMDAiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMTQiPl9za2lwSWYgPSAmcXVvdDtzdGF0ZSE9RE9fTEFORElORyZxdW90OzwvdGV4dD48L3N3aXRjaD48L2c+PHJlY3Qgd2lkdGg9IjM1Mi41IiBoZWlnaHQ9IjMwIiB4PSIxOC41IiB5PSIxNTEiIGZpbGw9IiNmZmYyY2MiIHN0cm9rZT0iI2Q2YjY1NiIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPjxzd2l0Y2g+PGZvcmVpZ25PYmplY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcG9pbnRlci1ldmVudHM9Im5vbmUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSIgc3R5bGU9Im92ZXJmbG93OnZpc2libGU7dGV4dC1hbGlnbjpsZWZ0Ij48ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOnVuc2FmZSBjZW50ZXI7anVzdGlmeS1jb250ZW50OnVuc2FmZSBmbGV4LXN0YXJ0O3dpZHRoOjM0NHB4O2hlaWdodDoxcHg7cGFkZGluZy10b3A6MTY2cHg7bWFyZ2luLWxlZnQ6MjhweCI+PGRpdiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7IiBzdHlsZT0iYm94LXNpemluZzpib3JkZXItYm94O2ZvbnQtc2l6ZTowO3RleHQtYWxpZ246bGVmdCI+PGRpdiBzdHlsZT0iZGlzcGxheTppbmxpbmUtYmxvY2s7Zm9udC1zaXplOjE4cHg7Zm9udC1mYW1pbHk6SGVsdmV0aWNhO2NvbG9yOiMwMDA7bGluZS1oZWlnaHQ6MS4yO3BvaW50ZXItZXZlbnRzOmFsbDt3aGl0ZS1zcGFjZTpub3JtYWw7b3ZlcmZsb3ctd3JhcDpub3JtYWwiPjxmb250IHN0eWxlPSJmb250LXNpemU6MTRweCI+X3Bvc3QgPSAmcXVvdDtzdGF0ZT0gKGFsdGl0dWRlICZsdDs9IDAuMSkgPyBMQU5ERUQgOiBzdGF0ZSZxdW90OzwvZm9udD48L2Rpdj48L2Rpdj48L2Rpdj48L2ZvcmVpZ25PYmplY3Q+PHRleHQgeD0iMjgiIHk9IjE3MSIgZmlsbD0iIzAwMCIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxOCI+X3Bvc3QgPSAmcXVvdDtzdGF0ZT0gKGFsdGl0dWRlICZsdDs9IDAuMSkgPyBMQS4uLjwvdGV4dD48L3N3aXRjaD48L2c+PC9nPjwvc3ZnPg==" /></p>
<p>该节点仅在状态等于 <strong>DO_LANDING</strong> 时执行，一旦 <code>altitude</code> 足够低，状态将变为 <strong>LANDED</strong>。</p>
<p>注意，DO_LANDING 和 LANDED 是枚举类型，不是字符串。</p>
<blockquote>
<p>💡 提示
这种模式的一个意外效果是使节点更加<strong>声明式</strong>，即更容易将该特定节点/子树移动到树的其他部分。</p>
</blockquote>
<h2 id="_58">异步动作<a class="headerlink" href="#_58" title="Permanent link">&para;</a></h2>
<p>设计响应式行为树时，需要理解两个主要概念：</p>
<ul>
<li><strong>异步</strong>动作与<strong>同步</strong>动作的区别。</li>
<li>BT.CPP 中<strong>并发（Concurrency）</strong>与<strong>并行（Parallelism）</strong>的差异。</li>
</ul>
<h3 id="_59">并发与并行<a class="headerlink" href="#_59" title="Permanent link">&para;</a></h3>
<p>搜索相关内容可获大量优质文章。</p>
<blockquote>
<p><strong>并发</strong>指两个或多个任务在时间上有重叠启动、运行和完成，但不一定在同一时刻运行。
<strong>并行</strong>指任务在不同线程（如多核处理器）上同时运行。</p>
</blockquote>
<p>BT.CPP 以<strong>单线程</strong>顺序执行所有节点的 <code>tick()</code> 方法，即<strong>并发执行</strong>。</p>
<ul>
<li>树执行引擎是单线程的。</li>
<li>所有 <code>tick()</code> 按顺序执行。</li>
<li>若任一 <code>tick()</code> 阻塞，整个执行流被阻塞。</li>
</ul>
<p>响应性通过“并发”与异步执行实现。</p>
<p>换言之，耗时动作应尽快返回 RUNNING 状态，告知树该动作已启动，需要时间完成（返回 SUCCESS 或 FAILURE）。需要重复 tick 该节点以检测状态变化（轮询）。</p>
<p>异步节点可将长时间执行委托给其它线程或进程。</p>
<h3 id="_60">异步与同步<a class="headerlink" href="#_60" title="Permanent link">&para;</a></h3>
<p>一般来说，异步节点应满足：</p>
<ul>
<li>tick 时可能返回 RUNNING（非 SUCCESS 或 FAILURE）。</li>
<li>调用 <code>halt()</code> 时能尽快停止。</li>
</ul>
<p>通常，开发者需实现 <code>halt()</code> 方法。</p>
<p>当异步动作返回 RUNNING，状态通常<strong>向上传播</strong>，整个树视为 RUNNING。</p>
<p>示例中，“ActionE”为异步且处于 RUNNING，运行时其父节点通常也返回 RUNNING。</p>
<p><img alt="tree in running state" src="https://www.behaviortree.dev/assets/images/RunningTree-6247b58f3119ffcc695094305dfd07c7.svg" /></p>
<h3 id="sleepnode">简单示例 SleepNode<a class="headerlink" href="#sleepnode" title="Permanent link">&para;</a></h3>
<p>基于 <code>StatefulActionNode</code>，异步节点的良好模板：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="o">::</span><span class="nn">chrono</span><span class="p">;</span>
<a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a>
<a id="__codelineno-109-3" name="__codelineno-109-3" href="#__codelineno-109-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">SleepNode</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">StatefulActionNode</span>
<a id="__codelineno-109-4" name="__codelineno-109-4" href="#__codelineno-109-4"></a><span class="p">{</span>
<a id="__codelineno-109-5" name="__codelineno-109-5" href="#__codelineno-109-5"></a><span class="w">  </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-109-6" name="__codelineno-109-6" href="#__codelineno-109-6"></a><span class="w">    </span><span class="n">SleepNode</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">NodeConfig</span><span class="o">&amp;</span><span class="w"> </span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-109-7" name="__codelineno-109-7" href="#__codelineno-109-7"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">StatefulActionNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-109-8" name="__codelineno-109-8" href="#__codelineno-109-8"></a><span class="w">    </span><span class="p">{}</span>
<a id="__codelineno-109-9" name="__codelineno-109-9" href="#__codelineno-109-9"></a>
<a id="__codelineno-109-10" name="__codelineno-109-10" href="#__codelineno-109-10"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">PortsList</span><span class="w"> </span><span class="n">providedPorts</span><span class="p">()</span>
<a id="__codelineno-109-11" name="__codelineno-109-11" href="#__codelineno-109-11"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-109-12" name="__codelineno-109-12" href="#__codelineno-109-12"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">InputPort</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;msec&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-109-13" name="__codelineno-109-13" href="#__codelineno-109-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-109-14" name="__codelineno-109-14" href="#__codelineno-109-14"></a>
<a id="__codelineno-109-15" name="__codelineno-109-15" href="#__codelineno-109-15"></a><span class="w">    </span><span class="n">NodeStatus</span><span class="w"> </span><span class="n">onStart</span><span class="p">()</span><span class="w"> </span><span class="k">override</span>
<a id="__codelineno-109-16" name="__codelineno-109-16" href="#__codelineno-109-16"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-109-17" name="__codelineno-109-17" href="#__codelineno-109-17"></a><span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">msec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-109-18" name="__codelineno-109-18" href="#__codelineno-109-18"></a><span class="w">      </span><span class="n">getInput</span><span class="p">(</span><span class="s">&quot;msec&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msec</span><span class="p">);</span>
<a id="__codelineno-109-19" name="__codelineno-109-19" href="#__codelineno-109-19"></a>
<a id="__codelineno-109-20" name="__codelineno-109-20" href="#__codelineno-109-20"></a><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">msec</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-109-21" name="__codelineno-109-21" href="#__codelineno-109-21"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<a id="__codelineno-109-22" name="__codelineno-109-22" href="#__codelineno-109-22"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-109-23" name="__codelineno-109-23" href="#__codelineno-109-23"></a><span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-109-24" name="__codelineno-109-24" href="#__codelineno-109-24"></a><span class="w">        </span><span class="n">deadline_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">milliseconds</span><span class="p">(</span><span class="n">msec</span><span class="p">);</span>
<a id="__codelineno-109-25" name="__codelineno-109-25" href="#__codelineno-109-25"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">RUNNING</span><span class="p">;</span>
<a id="__codelineno-109-26" name="__codelineno-109-26" href="#__codelineno-109-26"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-109-27" name="__codelineno-109-27" href="#__codelineno-109-27"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-109-28" name="__codelineno-109-28" href="#__codelineno-109-28"></a>
<a id="__codelineno-109-29" name="__codelineno-109-29" href="#__codelineno-109-29"></a><span class="w">    </span><span class="n">NodeStatus</span><span class="w"> </span><span class="n">onRunning</span><span class="p">()</span><span class="w"> </span><span class="k">override</span>
<a id="__codelineno-109-30" name="__codelineno-109-30" href="#__codelineno-109-30"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-109-31" name="__codelineno-109-31" href="#__codelineno-109-31"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">deadline_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-109-32" name="__codelineno-109-32" href="#__codelineno-109-32"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<a id="__codelineno-109-33" name="__codelineno-109-33" href="#__codelineno-109-33"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-109-34" name="__codelineno-109-34" href="#__codelineno-109-34"></a><span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-109-35" name="__codelineno-109-35" href="#__codelineno-109-35"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">RUNNING</span><span class="p">;</span>
<a id="__codelineno-109-36" name="__codelineno-109-36" href="#__codelineno-109-36"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-109-37" name="__codelineno-109-37" href="#__codelineno-109-37"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-109-38" name="__codelineno-109-38" href="#__codelineno-109-38"></a>
<a id="__codelineno-109-39" name="__codelineno-109-39" href="#__codelineno-109-39"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">onHalted</span><span class="p">()</span><span class="w"> </span><span class="k">override</span>
<a id="__codelineno-109-40" name="__codelineno-109-40" href="#__codelineno-109-40"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-109-41" name="__codelineno-109-41" href="#__codelineno-109-41"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;SleepNode interrupted&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-109-42" name="__codelineno-109-42" href="#__codelineno-109-42"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-109-43" name="__codelineno-109-43" href="#__codelineno-109-43"></a>
<a id="__codelineno-109-44" name="__codelineno-109-44" href="#__codelineno-109-44"></a><span class="w">  </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-109-45" name="__codelineno-109-45" href="#__codelineno-109-45"></a><span class="w">    </span><span class="n">system_clock</span><span class="o">::</span><span class="n">time_point</span><span class="w"> </span><span class="n">deadline_</span><span class="p">;</span>
<a id="__codelineno-109-46" name="__codelineno-109-46" href="#__codelineno-109-46"></a><span class="p">};</span>
</code></pre></div>
<p>说明：</p>
<ol>
<li>第一次 tick 时执行 <code>onStart()</code>，若睡眠时间为 0，立即返回 SUCCESS，否则返回 RUNNING 并设定截止时间。</li>
<li>继续 tick 树时调用 <code>onRunning()</code>，返回 RUNNING 或 SUCCESS。</li>
<li>其他节点可触发 <code>halt()</code>，执行 <code>onHalted()</code>。</li>
</ol>
<h3 id="_61">避免阻塞树的执行<a class="headerlink" href="#_61" title="Permanent link">&para;</a></h3>
<p>以下实现是错误示范：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">BadSleepNode</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">ActionNodeBase</span>
<a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a><span class="p">{</span>
<a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a><span class="w">  </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-110-4" name="__codelineno-110-4" href="#__codelineno-110-4"></a><span class="w">    </span><span class="n">BadSleepNode</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">NodeConfig</span><span class="o">&amp;</span><span class="w"> </span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-110-5" name="__codelineno-110-5" href="#__codelineno-110-5"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">ActionNodeBase</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-110-6" name="__codelineno-110-6" href="#__codelineno-110-6"></a><span class="w">    </span><span class="p">{}</span>
<a id="__codelineno-110-7" name="__codelineno-110-7" href="#__codelineno-110-7"></a>
<a id="__codelineno-110-8" name="__codelineno-110-8" href="#__codelineno-110-8"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">PortsList</span><span class="w"> </span><span class="n">providedPorts</span><span class="p">()</span>
<a id="__codelineno-110-9" name="__codelineno-110-9" href="#__codelineno-110-9"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-110-10" name="__codelineno-110-10" href="#__codelineno-110-10"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">InputPort</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;msec&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-110-11" name="__codelineno-110-11" href="#__codelineno-110-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-110-12" name="__codelineno-110-12" href="#__codelineno-110-12"></a>
<a id="__codelineno-110-13" name="__codelineno-110-13" href="#__codelineno-110-13"></a><span class="w">    </span><span class="n">NodeStatus</span><span class="w"> </span><span class="n">tick</span><span class="p">()</span><span class="w"> </span><span class="k">override</span>
<a id="__codelineno-110-14" name="__codelineno-110-14" href="#__codelineno-110-14"></a><span class="w">    </span><span class="p">{</span><span class="w">  </span>
<a id="__codelineno-110-15" name="__codelineno-110-15" href="#__codelineno-110-15"></a><span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">msec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-110-16" name="__codelineno-110-16" href="#__codelineno-110-16"></a><span class="w">      </span><span class="n">getInput</span><span class="p">(</span><span class="s">&quot;msec&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msec</span><span class="p">);</span>
<a id="__codelineno-110-17" name="__codelineno-110-17" href="#__codelineno-110-17"></a><span class="w">      </span><span class="c1">// 该阻塞函数将冻结整个树 :(</span>
<a id="__codelineno-110-18" name="__codelineno-110-18" href="#__codelineno-110-18"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">milliseconds</span><span class="p">(</span><span class="n">msec</span><span class="p">));</span>
<a id="__codelineno-110-19" name="__codelineno-110-19" href="#__codelineno-110-19"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<a id="__codelineno-110-20" name="__codelineno-110-20" href="#__codelineno-110-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-110-21" name="__codelineno-110-21" href="#__codelineno-110-21"></a>
<a id="__codelineno-110-22" name="__codelineno-110-22" href="#__codelineno-110-22"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">halt</span><span class="p">()</span><span class="w"> </span><span class="k">override</span>
<a id="__codelineno-110-23" name="__codelineno-110-23" href="#__codelineno-110-23"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-110-24" name="__codelineno-110-24" href="#__codelineno-110-24"></a><span class="w">      </span><span class="c1">// 无法调用此方法，因为树已冻结</span>
<a id="__codelineno-110-25" name="__codelineno-110-25" href="#__codelineno-110-25"></a><span class="w">      </span><span class="c1">// 即使可调用，也无法中断 sleep_for()</span>
<a id="__codelineno-110-26" name="__codelineno-110-26" href="#__codelineno-110-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-110-27" name="__codelineno-110-27" href="#__codelineno-110-27"></a><span class="p">};</span>
</code></pre></div>
<h3 id="_62">多线程的问题<a class="headerlink" href="#_62" title="Permanent link">&para;</a></h3>
<p>在该库早期版本（1.x）中，启动新线程看似是实现异步动作的好方法。</p>
<p>但这是一个糟糕的主意，原因包括：</p>
<ul>
<li>线程安全地访问黑板更困难（后面会详细讲）。</li>
<li>很可能根本不需要这么做。</li>
<li>用户误以为启动线程就自动异步，但实际上<strong>必须自行负责</strong>在线程停止时，且在调用 <code>halt()</code> 时<strong>快速终止线程</strong>。</li>
</ul>
<p>因此，通常不建议继承 <code>BT::ThreadedAction</code>。回顾之前的 SleepNode 示例：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a><span class="c1">// 会启动自己的线程，但 halt 时仍有问题</span>
<a id="__codelineno-111-2" name="__codelineno-111-2" href="#__codelineno-111-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">BadSleepNode</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">ThreadedAction</span>
<a id="__codelineno-111-3" name="__codelineno-111-3" href="#__codelineno-111-3"></a><span class="p">{</span>
<a id="__codelineno-111-4" name="__codelineno-111-4" href="#__codelineno-111-4"></a><span class="w">  </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-111-5" name="__codelineno-111-5" href="#__codelineno-111-5"></a><span class="w">    </span><span class="n">BadSleepNode</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">NodeConfig</span><span class="o">&amp;</span><span class="w"> </span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-111-6" name="__codelineno-111-6" href="#__codelineno-111-6"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">ActionNodeBase</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-111-7" name="__codelineno-111-7" href="#__codelineno-111-7"></a><span class="w">    </span><span class="p">{}</span>
<a id="__codelineno-111-8" name="__codelineno-111-8" href="#__codelineno-111-8"></a>
<a id="__codelineno-111-9" name="__codelineno-111-9" href="#__codelineno-111-9"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">PortsList</span><span class="w"> </span><span class="n">providedPorts</span><span class="p">()</span>
<a id="__codelineno-111-10" name="__codelineno-111-10" href="#__codelineno-111-10"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-111-11" name="__codelineno-111-11" href="#__codelineno-111-11"></a><span class="w">      </span><span class="k">return</span><span class="p">{</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">InputPort</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;msec&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-111-12" name="__codelineno-111-12" href="#__codelineno-111-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-111-13" name="__codelineno-111-13" href="#__codelineno-111-13"></a>
<a id="__codelineno-111-14" name="__codelineno-111-14" href="#__codelineno-111-14"></a><span class="w">    </span><span class="n">NodeStatus</span><span class="w"> </span><span class="n">tick</span><span class="p">()</span><span class="w"> </span><span class="k">override</span>
<a id="__codelineno-111-15" name="__codelineno-111-15" href="#__codelineno-111-15"></a><span class="w">    </span><span class="p">{</span><span class="w">  </span>
<a id="__codelineno-111-16" name="__codelineno-111-16" href="#__codelineno-111-16"></a><span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">msec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-111-17" name="__codelineno-111-17" href="#__codelineno-111-17"></a><span class="w">      </span><span class="n">getInput</span><span class="p">(</span><span class="s">&quot;msec&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msec</span><span class="p">);</span>
<a id="__codelineno-111-18" name="__codelineno-111-18" href="#__codelineno-111-18"></a><span class="w">      </span><span class="c1">// 线程内执行，树仍运行，但线程无法中断</span>
<a id="__codelineno-111-19" name="__codelineno-111-19" href="#__codelineno-111-19"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="p">(</span><span class="n">msec</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-111-20" name="__codelineno-111-20" href="#__codelineno-111-20"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<a id="__codelineno-111-21" name="__codelineno-111-21" href="#__codelineno-111-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-111-22" name="__codelineno-111-22" href="#__codelineno-111-22"></a><span class="w">    </span><span class="c1">// halt() 无法终止线程 :(</span>
<a id="__codelineno-111-23" name="__codelineno-111-23" href="#__codelineno-111-23"></a><span class="p">};</span>
</code></pre></div>
<p>正确实现示例：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ThreadedSleepNode</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">ThreadedAction</span>
<a id="__codelineno-112-2" name="__codelineno-112-2" href="#__codelineno-112-2"></a><span class="p">{</span>
<a id="__codelineno-112-3" name="__codelineno-112-3" href="#__codelineno-112-3"></a><span class="w">  </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-112-4" name="__codelineno-112-4" href="#__codelineno-112-4"></a><span class="w">    </span><span class="n">ThreadedSleepNode</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">NodeConfig</span><span class="o">&amp;</span><span class="w"> </span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-112-5" name="__codelineno-112-5" href="#__codelineno-112-5"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">ActionNodeBase</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-112-6" name="__codelineno-112-6" href="#__codelineno-112-6"></a><span class="w">    </span><span class="p">{}</span>
<a id="__codelineno-112-7" name="__codelineno-112-7" href="#__codelineno-112-7"></a>
<a id="__codelineno-112-8" name="__codelineno-112-8" href="#__codelineno-112-8"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">PortsList</span><span class="w"> </span><span class="n">providedPorts</span><span class="p">()</span>
<a id="__codelineno-112-9" name="__codelineno-112-9" href="#__codelineno-112-9"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-112-10" name="__codelineno-112-10" href="#__codelineno-112-10"></a><span class="w">      </span><span class="k">return</span><span class="p">{</span><span class="w"> </span><span class="n">BT</span><span class="o">::</span><span class="n">InputPort</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;msec&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-112-11" name="__codelineno-112-11" href="#__codelineno-112-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-112-12" name="__codelineno-112-12" href="#__codelineno-112-12"></a>
<a id="__codelineno-112-13" name="__codelineno-112-13" href="#__codelineno-112-13"></a><span class="w">    </span><span class="n">NodeStatus</span><span class="w"> </span><span class="n">tick</span><span class="p">()</span><span class="w"> </span><span class="k">override</span>
<a id="__codelineno-112-14" name="__codelineno-112-14" href="#__codelineno-112-14"></a><span class="w">    </span><span class="p">{</span><span class="w">  </span>
<a id="__codelineno-112-15" name="__codelineno-112-15" href="#__codelineno-112-15"></a><span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">msec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-112-16" name="__codelineno-112-16" href="#__codelineno-112-16"></a><span class="w">      </span><span class="n">getInput</span><span class="p">(</span><span class="s">&quot;msec&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msec</span><span class="p">);</span>
<a id="__codelineno-112-17" name="__codelineno-112-17" href="#__codelineno-112-17"></a>
<a id="__codelineno-112-18" name="__codelineno-112-18" href="#__codelineno-112-18"></a><span class="w">      </span><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="o">::</span><span class="nn">chrono</span><span class="p">;</span>
<a id="__codelineno-112-19" name="__codelineno-112-19" href="#__codelineno-112-19"></a><span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">deadline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">milliseconds</span><span class="p">(</span><span class="n">msec</span><span class="p">);</span>
<a id="__codelineno-112-20" name="__codelineno-112-20" href="#__codelineno-112-20"></a>
<a id="__codelineno-112-21" name="__codelineno-112-21" href="#__codelineno-112-21"></a><span class="w">      </span><span class="c1">// 定期检查是否请求 halt，并每次休眠 1 毫秒</span>
<a id="__codelineno-112-22" name="__codelineno-112-22" href="#__codelineno-112-22"></a><span class="w">      </span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">isHaltRequested</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">deadline</span><span class="w"> </span><span class="p">)</span>
<a id="__codelineno-112-23" name="__codelineno-112-23" href="#__codelineno-112-23"></a><span class="w">      </span><span class="p">{</span>
<a id="__codelineno-112-24" name="__codelineno-112-24" href="#__codelineno-112-24"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-112-25" name="__codelineno-112-25" href="#__codelineno-112-25"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-112-26" name="__codelineno-112-26" href="#__codelineno-112-26"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<a id="__codelineno-112-27" name="__codelineno-112-27" href="#__codelineno-112-27"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-112-28" name="__codelineno-112-28" href="#__codelineno-112-28"></a>
<a id="__codelineno-112-29" name="__codelineno-112-29" href="#__codelineno-112-29"></a><span class="w">    </span><span class="c1">// halt() 会设置 isHaltRequested() 为 true，结束循环</span>
<a id="__codelineno-112-30" name="__codelineno-112-30" href="#__codelineno-112-30"></a><span class="p">};</span>
</code></pre></div>
<p>如你所见，这比使用 <code>BT::StatefulActionNode</code> 更复杂。虽然某些情况下仍有用，但默认应避免多线程。</p>
<h3 id="_63">高级示例：客户端/服务器通信<a class="headerlink" href="#_63" title="Permanent link">&para;</a></h3>
<p>很多用户让 BT.CPP 在不同进程执行任务。</p>
<p>ROS 中常用 <a href="http://wiki.ros.org/actionlib">ActionLib</a> 实现：</p>
<ol>
<li>非阻塞函数启动动作。</li>
<li>监控动作执行状态。</li>
<li>获取结果或错误信息。</li>
<li>可中断/终止正在执行的动作。</li>
</ol>
<p>所有操作均非阻塞，无需启动新线程。</p>
<p>一般假设开发者已有进程间通信机制，BT 执行器作为客户端，实际服务为服务器。</p>
<h2 id="_64">端口与黑板<a class="headerlink" href="#_64" title="Permanent link">&para;</a></h2>
<p><strong>BT.CPP</strong> 是目前唯一引入<strong>输入/输出端口</strong>（Ports）概念的行为树实现，作为替代黑板的方案。</p>
<p>端口提供对黑板的间接接口，赋予额外语义。</p>
<h3 id="btcpp">BT.CPP 目标<a class="headerlink" href="#btcpp" title="Permanent link">&para;</a></h3>
<h4 id="_65">模型驱动开发<a class="headerlink" href="#_65" title="Permanent link">&para;</a></h4>
<p>目的是构建节点的“模型”，即元信息，描述节点如何与树中其他节点交互。</p>
<p>模型对开发者（自文档化）和外部工具（如 Groot2 编辑器、静态分析器）均重要。</p>
<p>数据流描述必须是模型一部分，且需明确黑板条目是被写（输出）、读（输入）还是两者。</p>
<p>示例：</p>
<p><img alt="no_ports" src="https://www.behaviortree.dev/assets/images/no_ports_sequence-ea57978d7fe40152ab9a04893096afc4.png" /></p>
<p>其他实现（或不当用法）只能通过：</p>
<ul>
<li>查看代码（不理想）</li>
<li>依赖文档（可能过时）</li>
</ul>
<p>有端口后，节点意图及关系更明显：</p>
<p><img alt="with_ports" src="https://www.behaviortree.dev/assets/images/with_ports_sequence-610186a2466dfe975d67c2fd03f3a031.png" /></p>
<h4 id="_66">节点可组合性与子树作用域<a class="headerlink" href="#_66" title="Permanent link">&para;</a></h4>
<p>理想是支持不同开发者实现的节点在行为设计师平台中组合。</p>
<p>直接使用黑板时，名称冲突问题突出，常见名如 <code>goal</code>、<code>result</code>、<code>target</code>、<code>value</code>。</p>
<p>比如，<code>GraspObject</code> 和 <code>MoveBase</code> 由不同人开发，均读 <code>target</code>，但含义及类型不同。</p>
<p>端口提供一层间接（重映射），详见<a href="https://www.behaviortree.dev/docs/tutorial-basics/tutorial_02_basic_ports">教程2</a>。</p>
<p>即端口名称“写死”于代码中，但可在 XML 中重映射为不同黑板条目，无需改代码。</p>
<p>子树重映射类似，详见<a href="https://www.behaviortree.dev/docs/tutorial-basics/tutorial_06_subtree_ports">教程6</a>。黑板本质上是全局变量映射，扩展性差，故不推荐。</p>
<p>端口重映射解决此问题。</p>
<h3 id="_67">总结：避免直接使用黑板<a class="headerlink" href="#_67" title="Permanent link">&para;</a></h3>
<p>推荐写法：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a><span class="c1">// 代码示例</span>
<a id="__codelineno-113-2" name="__codelineno-113-2" href="#__codelineno-113-2"></a><span class="n">getInput</span><span class="p">(</span><span class="s">&quot;goal&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">goal</span><span class="p">);</span>
<a id="__codelineno-113-3" name="__codelineno-113-3" href="#__codelineno-113-3"></a><span class="n">setOutput</span><span class="p">(</span><span class="s">&quot;result&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">);</span>
</code></pre></div>
<p>尽量避免：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a><span class="c1">// 不推荐写法</span>
<a id="__codelineno-114-2" name="__codelineno-114-2" href="#__codelineno-114-2"></a><span class="n">config</span><span class="p">().</span><span class="n">blackboard</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;goal&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">goal</span><span class="p">);</span>
<a id="__codelineno-114-3" name="__codelineno-114-3" href="#__codelineno-114-3"></a><span class="n">config</span><span class="p">().</span><span class="n">blackboard</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;result&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">);</span>
</code></pre></div>
<p>尽管两者技术上可行，但后者被视为不良实践：</p>
<p>问题包括：</p>
<ol>
<li>名称硬编码，修改需重编译；端口可运行时通过 XML 重映射。</li>
<li>不易知晓节点读写黑板的条目，只能看代码或依赖文档，端口模型自文档化。</li>
<li>工厂无法感知黑板访问，端口能检查端口连接正确性。</li>
<li>子树使用时可能失效。</li>
<li><code>convertFromString()</code> 模板特化不正常。</li>
</ol>
<h1 id="_68">节点库<a class="headerlink" href="#_68" title="Permanent link">&para;</a></h1>
<p>本节列出库中原生实现的 TreeNodes。</p>
<h2 id="decorators_1">装饰器（Decorators）<a class="headerlink" href="#decorators_1" title="Permanent link">&para;</a></h2>
<p>装饰器节点必须只有一个子节点。</p>
<p>装饰器负责决定是否、何时以及执行多少次子节点的 tick。</p>
<h3 id="inverter">Inverter<a class="headerlink" href="#inverter" title="Permanent link">&para;</a></h3>
<p>对子节点执行一次 tick：</p>
<ul>
<li>如果子节点返回 FAILURE，则返回 SUCCESS。</li>
<li>如果子节点返回 SUCCESS，则返回 FAILURE。</li>
<li>如果子节点返回 RUNNING，则返回 RUNNING。</li>
</ul>
<h3 id="forcesuccess">ForceSuccess<a class="headerlink" href="#forcesuccess" title="Permanent link">&para;</a></h3>
<ul>
<li>子节点返回 RUNNING 时，返回 RUNNING。</li>
<li>否则总返回 SUCCESS。</li>
</ul>
<h3 id="forcefailure">ForceFailure<a class="headerlink" href="#forcefailure" title="Permanent link">&para;</a></h3>
<ul>
<li>子节点返回 RUNNING 时，返回 RUNNING。</li>
<li>否则总返回 FAILURE。</li>
</ul>
<h3 id="repeat">Repeat<a class="headerlink" href="#repeat" title="Permanent link">&para;</a></h3>
<p>对子节点执行 tick，最多执行 N 次（在同一次 tick 中），其中 N 由输入端口 <code>num_cycles</code> 指定，只要子节点返回 SUCCESS 即继续。</p>
<p>如果子节点每次都返回 SUCCESS，N 次重复后返回 SUCCESS。</p>
<p>如果子节点返回 FAILURE，则中断循环并返回 FAILURE。</p>
<p>如果子节点返回 RUNNING，则本节点返回 RUNNING，下次 tick 时重复计数不递增。</p>
<h3 id="retryuntilsuccessful">RetryUntilSuccessful<a class="headerlink" href="#retryuntilsuccessful" title="Permanent link">&para;</a></h3>
<p>对子节点执行 tick，最多执行 N 次，N 由输入端口 <code>num_attempts</code> 指定，只要子节点返回 FAILURE 即继续。</p>
<p>如果子节点每次都返回 FAILURE，N 次尝试后返回 FAILURE。</p>
<p>如果子节点返回 SUCCESS，则中断循环并返回 SUCCESS。</p>
<p>如果子节点返回 RUNNING，则本节点返回 RUNNING，下次 tick 时尝试计数不递增。</p>
<h3 id="keeprunninguntilfailure">KeepRunningUntilFailure<a class="headerlink" href="#keeprunninguntilfailure" title="Permanent link">&para;</a></h3>
<p>本节点始终返回 FAILURE（子节点返回 FAILURE）或 RUNNING（子节点返回 SUCCESS 或 RUNNING）。</p>
<h3 id="delay">Delay<a class="headerlink" href="#delay" title="Permanent link">&para;</a></h3>
<p>延迟指定时间后对子节点执行 tick，延迟时间由输入端口 <code>delay_msec</code> 指定。</p>
<p>如果子节点返回 RUNNING，本节点返回 RUNNING，并于下次 tick 时继续 tick 子节点。</p>
<p>否则，返回子节点状态。</p>
<h3 id="runonce">RunOnce<a class="headerlink" href="#runonce" title="Permanent link">&para;</a></h3>
<p>本节点用于只执行子节点一次。</p>
<p>若子节点为异步，将持续 tick 直到返回 SUCCESS 或 FAILURE。</p>
<p>执行完成后，可通过输入端口 <code>then_skip</code> 设置：</p>
<ul>
<li>TRUE（默认）：未来跳过本节点。</li>
<li>FALSE：持续同步返回子节点返回状态。</li>
</ul>
<h3 id="precondition">PreCondition<a class="headerlink" href="#precondition" title="Permanent link">&para;</a></h3>
<p>参见<a href="https://www.behaviortree.dev/docs/tutorial-basics/tutorial_09_scripting#script-and-precondition-nodes">脚本语言介绍</a>。</p>
<h3 id="subtree">SubTree<a class="headerlink" href="#subtree" title="Permanent link">&para;</a></h3>
<p>参见<a href="https://www.behaviortree.dev/docs/tutorial-basics/tutorial_05_subtrees">使用子树组合行为</a>。</p>
<h3 id="c_2">需在 C++ 中注册的其他装饰器<a class="headerlink" href="#c_2" title="Permanent link">&para;</a></h3>
<h4 id="consumequeue">ConsumeQueue<a class="headerlink" href="#consumequeue" title="Permanent link">&para;</a></h4>
<p>当队列非空时执行子节点。</p>
<p>每次迭代弹出类型为 T 的元素放入 <code>popped_item</code>。</p>
<p>空队列返回 SUCCESS。</p>
<p>注册示例：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a><span class="n">factory</span><span class="p">.</span><span class="n">registerNodeType</span><span class="o">&lt;</span><span class="n">ConsumeQueue</span><span class="o">&lt;</span><span class="n">Pose2D</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;ConsumeQueue&quot;</span><span class="p">);</span>
</code></pre></div>
<p>参见<a href="https://github.com/BehaviorTree/BehaviorTree.CPP/blob/master/examples/ex04_waypoints.cpp">ex04_waypoints.cpp</a>。</p>
<h4 id="simpledecoratornode">SimpleDecoratorNode<a class="headerlink" href="#simpledecoratornode" title="Permanent link">&para;</a></h4>
<p>使用</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a><span class="kt">void</span><span class="w"> </span><span class="n">BehaviorTreeFactory</span><span class="o">::</span><span class="n">registerSimpleDecorator</span><span class="p">(</span><span class="s">&quot;MyDecorator&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">tick_function</span><span class="p">,</span><span class="w"> </span><span class="n">ports</span><span class="p">)</span>
</code></pre></div>
<p>注册简单装饰器节点。内部使用 <code>SimpleDecoratorNode</code>，<code>tick_function</code> 为</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="n">NodeStatus</span><span class="p">(</span><span class="n">NodeStatus</span><span class="p">,</span><span class="w"> </span><span class="n">TreeNode</span><span class="o">&amp;</span><span class="p">)</span><span class="o">&gt;</span>
</code></pre></div>
<p>类型函数，<code>ports</code> 为 <code>PortsList</code> 类型。</p>
<hr />
<h2 id="fallbacks">回退节点（Fallbacks）<a class="headerlink" href="#fallbacks" title="Permanent link">&para;</a></h2>
<p>该类节点在其他框架中称为“Selector”或“Priority”。</p>
<p>其目的是尝试不同策略，直到找到一个“成功”的。</p>
<p>当前框架提供两种节点：</p>
<ul>
<li>Fallback</li>
<li>ReactiveFallback</li>
</ul>
<p>它们遵循规则：</p>
<ul>
<li>在 tick 第一个子节点前，节点状态变为 RUNNING。</li>
<li>子节点返回 FAILURE 时，fallback tick 下一个子节点。</li>
<li>若最后一个子节点也返回 FAILURE，停止所有子节点，返回 FAILURE。</li>
<li>子节点返回 SUCCESS 时，停止所有子节点，返回 SUCCESS。</li>
</ul>
<p>两者差异：</p>
<table>
<thead>
<tr>
<th>控制节点类型</th>
<th>子节点返回 RUNNING</th>
</tr>
</thead>
<tbody>
<tr>
<td>Fallback</td>
<td>再次 tick 同一子节点</td>
</tr>
<tr>
<td>ReactiveFallback</td>
<td>重新从第一个子节点开始 tick</td>
</tr>
</tbody>
</table>
<ul>
<li>“重新开始”意味着 fallback 从头开始 tick。</li>
<li>“再次 tick”意味着下次 tick 仍执行当前子节点，之前失败的兄弟节点不再 tick。</li>
</ul>
<h3 id="fallback_1">Fallback 示例<a class="headerlink" href="#fallback_1" title="Permanent link">&para;</a></h3>
<p>本例尝试多种开门策略。首先检查门是否已开（只检查一次）。</p>
<p><img alt="FallbackNode" src="data:image/png;base64,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" /></p>
<h3 id="reactivefallback">ReactiveFallback<a class="headerlink" href="#reactivefallback" title="Permanent link">&para;</a></h3>
<p>当需要在某个异步子节点的前置条件从 FAILURE 变为 SUCCESS 时，立即中断该异步子节点，使用该控制节点。</p>
<p>例如，角色最多睡眠 8 小时；如果其已经充分休息，节点 <code>areYouRested?</code> 返回 SUCCESS，则异步节点 <code>Timeout (8 hrs)</code> 和 <code>Sleep</code> 会被中断。</p>
<p><img alt="ReactiveFallback" src="data:image/png;base64,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" /></p>
<h2 id="sequences">序列（Sequences）<a class="headerlink" href="#sequences" title="Permanent link">&para;</a></h2>
<p><strong>Sequence</strong> 节点会依次 tick 所有子节点，只要它们返回 SUCCESS；若任一子节点返回 FAILURE，则序列中断。</p>
<p>当前框架提供三种序列节点：</p>
<ul>
<li>Sequence</li>
<li>SequenceWithMemory</li>
<li>ReactiveSequence</li>
</ul>
<p>它们遵循以下规则：</p>
<ul>
<li>在 tick 第一个子节点前，节点状态变为 <strong>RUNNING</strong>。</li>
<li>子节点返回 <strong>SUCCESS</strong> 时，继续 tick 下一个子节点。</li>
<li>如果最后一个子节点也返回 <strong>SUCCESS</strong>，停止所有子节点，序列返回 <strong>SUCCESS</strong>。</li>
</ul>
<p>三者差异如下表：</p>
<table>
<thead>
<tr>
<th>控制节点类型</th>
<th>子节点返回 FAILURE</th>
<th>子节点返回 RUNNING</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sequence</td>
<td>从头重新开始</td>
<td>再次 tick 当前子节点</td>
</tr>
<tr>
<td>ReactiveSequence</td>
<td>从头重新开始</td>
<td>从头重新开始</td>
</tr>
<tr>
<td>SequenceWithMemory</td>
<td>再次 tick 当前子节点</td>
<td>再次 tick 当前子节点</td>
</tr>
</tbody>
</table>
<ul>
<li>“从头重新开始”表示整个序列从第一个子节点重新 tick。</li>
<li>“再次 tick 当前子节点”表示下次 tick 时继续执行当前子节点，之前成功的兄弟节点不再 tick。</li>
</ul>
<h3 id="sequence_1">Sequence 示例<a class="headerlink" href="#sequence_1" title="Permanent link">&para;</a></h3>
<p>该树描述了计算机游戏中狙击手的行为。</p>
<p><img alt="SequenceNode" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhodG1sPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojZmZmIiBpZD0ic3ZnNzAiIHdpZHRoPSI1NzEiIGhlaWdodD0iMTgxIiBjb250ZW50PSImbHQ7bXhmaWxlIGhvc3Q9JnF1b3Q7YXBwLmRpYWdyYW1zLm5ldCZxdW90OyBtb2RpZmllZD0mcXVvdDsyMDIyLTAxLTE0VDIyOjE4OjQyLjQ5NlomcXVvdDsgYWdlbnQ9JnF1b3Q7NS4wIChYMTEpJnF1b3Q7IHZlcnNpb249JnF1b3Q7MTYuMi43JnF1b3Q7IGV0YWc9JnF1b3Q7U2s1d21VOXJXb2RvX1lDdnhnOFkmcXVvdDsgdHlwZT0mcXVvdDtnb29nbGUmcXVvdDsmZ3Q7Jmx0O2RpYWdyYW0gaWQ9JnF1b3Q7UUR2N1lNMkRfU19ZZDFTdkp5TEkmcXVvdDsmZ3Q7MVpkZGs1b3dGSVovRGJjZElTcDR1ZXZhajVudFRaMXB1NWVwSENHZGtFTkRVT2l2YjVDRGd1aCtkUjNjRytXOEp6a2t6eHRJY05nOEtUNXBuc1pmTVFUcGVLT3djTmlkNDNtKzc5cmZTaWhyWWN6OFdvaTBDR3ZKUFFoTDhSZElISkdhaXhDeVRrT0RLSTFJdStJS2xZS1Y2V2hjYTl4Mm02MVJkdSthOGdoNnduTEZaVi85SVVJVGsrcE9aNGZFWnhCUlRMY09QSnBmd3B2R05KTXM1aUZ1V3hKYk9HeXVFVTE5bFJSemtCVzdoa3ZkNytPWjdINWdHcFI1VGdlUGhtSEtabTRhY3hWQ2xSNDU3QmExaVRGQ3hlVTlZbXBGMTRxL3daaVNYT0c1UVN2RkpwR1VoVUtZbjFYM0R4T0tIbHFadTRJcTc0S1NnalVxUXdYZG9Fb3FvOHU2aUQ5cDRvZW1aeFVjNnV5aXBsQTlIUWlQL01zdzF5dVNwclJndUk2QUdNMzYyTnk5R1hZUkF5Wmc3MktiYUpEY2lFMjNPcWZsRk8zYkhZamJDNEorMmdEV002QWEvSkpDaGNyKzNRN2lTY3VERjFsdzdPWHJMR2tlOVNFOEdiOEhUN3dCVFBHSDgyVHlIandad0pKZ09FdG9OQnN1Y3lxNmhEODVLRHZheHplVmJTd01MRk8rbTliV25oQzZKcHdHc3dGdG9EaTd6WjJaTkhWZ0kzcWQwSUhEcDNEYjJyMmJMVGx1YmR6VDBmOWo4bnVZYmtSeVl4WUtrdkxxUUkyUFFMbXpFNlRZaFVnRi9RVVZWeWVoYTRNMG1UNE5LYmdRbzFtUDBaZHN0NVMraTB6OGtvODlldTdMWVhHOW9wQk4zNGFkLzR6MU5ia1F1K1pNMFlJbnNtOWlMZUVlZWNYb3l0blpwL05wZU9PM2dXZkR3MWZJTHRmNmxHT0xmdz09Jmx0Oy9kaWFncmFtJmd0OyZsdDsvbXhmaWxlJmd0OyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSItMC41IC0wLjUgNTcxIDE4MSI+PG1ldGFkYXRhIGlkPSJtZXRhZGF0YTc0Ii8+PGcgaWQ9Imc2MCI+PHBhdGggaWQ9InBhdGg0IiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTSAyOTAgNjAgTCAxMTguNTMgMTE3Ljk2IiBwb2ludGVyLWV2ZW50cz0ic3Ryb2tlIi8+PHBhdGggaWQ9InBhdGg2IiBmaWxsPSIjMDAwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTSAxMTMuNTYgMTE5LjY0IEwgMTE5LjA3IDExNC4wOCBMIDExOC41MyAxMTcuOTYgTCAxMjEuMzEgMTIwLjcyIFoiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48cGF0aCBpZD0icGF0aDgiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNIDI5MCA2MCBMIDI0NC4wOCAxMTUuMTEiIHBvaW50ZXItZXZlbnRzPSJzdHJva2UiLz48cGF0aCBpZD0icGF0aDEwIiBmaWxsPSIjMDAwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTSAyNDAuNzIgMTE5LjE0IEwgMjQyLjUxIDExMS41MiBMIDI0NC4wOCAxMTUuMTEgTCAyNDcuODkgMTE2IFoiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48cGF0aCBpZD0icGF0aDEyIiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTSAyOTAgNjAgTCAzNTcuNTkgMTE1Ljk0IiBwb2ludGVyLWV2ZW50cz0ic3Ryb2tlIi8+PHBhdGggaWQ9InBhdGgxNCIgZmlsbD0iIzAwMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGQ9Ik0gMzYxLjY0IDExOS4yOSBMIDM1NC4wMSAxMTcuNTIgTCAzNTcuNTkgMTE1Ljk0IEwgMzU4LjQ4IDExMi4xMyBaIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PHBhdGggaWQ9InBhdGgxNiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGQ9Ik0gMjkwIDYwIEwgNTIzLjgyIDExOC40NiIgcG9pbnRlci1ldmVudHM9InN0cm9rZSIvPjxwYXRoIGlkPSJwYXRoMTgiIGZpbGw9IiMwMDAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNIDUyOC45MiAxMTkuNzMgTCA1MjEuMjggMTIxLjQzIEwgNTIzLjgyIDExOC40NiBMIDUyMi45NyAxMTQuNjQgWiIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxyZWN0IGlkPSJyZWN0MjAiIHdpZHRoPSIxMjAiIGhlaWdodD0iNjAiIHg9IjIzMCIgeT0iMCIgZmlsbD0iI0ZGRiIgc3Ryb2tlPSIjMDAwIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PGcgaWQ9ImcyNiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+PHN3aXRjaCBpZD0ic3dpdGNoMjQiPjxmb3JlaWduT2JqZWN0IHN0eWxlPSJvdmVyZmxvdzp2aXNpYmxlO3RleHQtYWxpZ246bGVmdCIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcG9pbnRlci1ldmVudHM9Im5vbmUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSI+PHhodG1sOmRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOnVuc2FmZSBjZW50ZXI7anVzdGlmeS1jb250ZW50OnVuc2FmZSBjZW50ZXI7d2lkdGg6MTE4cHg7aGVpZ2h0OjFweDtwYWRkaW5nLXRvcDozMHB4O21hcmdpbi1sZWZ0OjIzMXB4Ij48eGh0bWw6ZGl2IHN0eWxlPSJib3gtc2l6aW5nOmJvcmRlci1ib3g7Zm9udC1zaXplOjA7dGV4dC1hbGlnbjpjZW50ZXIiIGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsiPjx4aHRtbDpkaXYgc3R5bGU9ImRpc3BsYXk6aW5saW5lLWJsb2NrO2ZvbnQtc2l6ZToxOHB4O2ZvbnQtZmFtaWx5OkhlbHZldGljYTtjb2xvcjojMDAwO2xpbmUtaGVpZ2h0OjEuMjtwb2ludGVyLWV2ZW50czphbGw7d2hpdGUtc3BhY2U6bm9ybWFsO292ZXJmbG93LXdyYXA6bm9ybWFsIj5TZXF1ZW5jZTwveGh0bWw6ZGl2PjwveGh0bWw6ZGl2PjwveGh0bWw6ZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCBpZD0idGV4dDIyIiB4PSIyOTAiIHk9IjM1IiBmaWxsPSIjMDAwIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjE4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5TZXF1ZW5jZTwvdGV4dD48L3N3aXRjaD48L2c+PHJlY3QgaWQ9InJlY3QyOCIgd2lkdGg9IjEzMCIgaGVpZ2h0PSI2MCIgeD0iMzMwIiB5PSIxMjAiIGZpbGw9IiNGRkYiIHN0cm9rZT0iIzAwMCIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxnIGlkPSJnMzQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPjxzd2l0Y2ggaWQ9InN3aXRjaDMyIj48Zm9yZWlnbk9iamVjdCBzdHlsZT0ib3ZlcmZsb3c6dmlzaWJsZTt0ZXh0LWFsaWduOmxlZnQiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHBvaW50ZXItZXZlbnRzPSJub25lIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiPjx4aHRtbDpkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczp1bnNhZmUgY2VudGVyO2p1c3RpZnktY29udGVudDp1bnNhZmUgY2VudGVyO3dpZHRoOjEyOHB4O2hlaWdodDoxcHg7cGFkZGluZy10b3A6MTUwcHg7bWFyZ2luLWxlZnQ6MzMxcHgiPjx4aHRtbDpkaXYgc3R5bGU9ImJveC1zaXppbmc6Ym9yZGVyLWJveDtmb250LXNpemU6MDt0ZXh0LWFsaWduOmNlbnRlciIgZGF0YS1kcmF3aW8tY29sb3JzPSJjb2xvcjogcmdiKDAsIDAsIDApOyI+PHhodG1sOmRpdiBzdHlsZT0iZGlzcGxheTppbmxpbmUtYmxvY2s7Zm9udC1zaXplOjE4cHg7Zm9udC1mYW1pbHk6SGVsdmV0aWNhO2NvbG9yOiMwMDA7bGluZS1oZWlnaHQ6MS4yO3BvaW50ZXItZXZlbnRzOmFsbDt3aGl0ZS1zcGFjZTpub3JtYWw7b3ZlcmZsb3ctd3JhcDpub3JtYWwiPkFpbUF0RW5lbXk8L3hodG1sOmRpdj48L3hodG1sOmRpdj48L3hodG1sOmRpdj48L2ZvcmVpZ25PYmplY3Q+PHRleHQgaWQ9InRleHQzMCIgeD0iMzk1IiB5PSIxNTUiIGZpbGw9IiMwMDAiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMTgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPkFpbUF0RW5lbXk8L3RleHQ+PC9zd2l0Y2g+PC9nPjxyZWN0IGlkPSJyZWN0MzYiIHdpZHRoPSI4MCIgaGVpZ2h0PSI2MCIgeD0iNDkwIiB5PSIxMjAiIGZpbGw9IiNGRkYiIHN0cm9rZT0iIzAwMCIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxnIGlkPSJnNDIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPjxzd2l0Y2ggaWQ9InN3aXRjaDQwIj48Zm9yZWlnbk9iamVjdCBzdHlsZT0ib3ZlcmZsb3c6dmlzaWJsZTt0ZXh0LWFsaWduOmxlZnQiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHBvaW50ZXItZXZlbnRzPSJub25lIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiPjx4aHRtbDpkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczp1bnNhZmUgY2VudGVyO2p1c3RpZnktY29udGVudDp1bnNhZmUgY2VudGVyO3dpZHRoOjc4cHg7aGVpZ2h0OjFweDtwYWRkaW5nLXRvcDoxNTBweDttYXJnaW4tbGVmdDo0OTFweCI+PHhodG1sOmRpdiBzdHlsZT0iYm94LXNpemluZzpib3JkZXItYm94O2ZvbnQtc2l6ZTowO3RleHQtYWxpZ246Y2VudGVyIiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7Ij48eGh0bWw6ZGl2IHN0eWxlPSJkaXNwbGF5OmlubGluZS1ibG9jaztmb250LXNpemU6MThweDtmb250LWZhbWlseTpIZWx2ZXRpY2E7Y29sb3I6IzAwMDtsaW5lLWhlaWdodDoxLjI7cG9pbnRlci1ldmVudHM6YWxsO3doaXRlLXNwYWNlOm5vcm1hbDtvdmVyZmxvdy13cmFwOm5vcm1hbCI+U2hvb3Q8L3hodG1sOmRpdj48L3hodG1sOmRpdj48L3hodG1sOmRpdj48L2ZvcmVpZ25PYmplY3Q+PHRleHQgaWQ9InRleHQzOCIgeD0iNTMwIiB5PSIxNTUiIGZpbGw9IiMwMDAiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMTgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPlNob290PC90ZXh0Pjwvc3dpdGNoPjwvZz48cmVjdCBpZD0icmVjdDQ0IiB3aWR0aD0iMTUwIiBoZWlnaHQ9IjYwIiB4PSIwIiB5PSIxMjAiIGZpbGw9IiNGRkYiIHN0cm9rZT0iIzAwMCIgcG9pbnRlci1ldmVudHM9ImFsbCIgcng9IjIxLjYiIHJ5PSIyMS42Ii8+PGcgaWQ9Imc1MCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+PHN3aXRjaCBpZD0ic3dpdGNoNDgiPjxmb3JlaWduT2JqZWN0IHN0eWxlPSJvdmVyZmxvdzp2aXNpYmxlO3RleHQtYWxpZ246bGVmdCIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcG9pbnRlci1ldmVudHM9Im5vbmUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSI+PHhodG1sOmRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOnVuc2FmZSBjZW50ZXI7anVzdGlmeS1jb250ZW50OnVuc2FmZSBjZW50ZXI7d2lkdGg6MTQ4cHg7aGVpZ2h0OjFweDtwYWRkaW5nLXRvcDoxNTBweDttYXJnaW4tbGVmdDoxcHgiPjx4aHRtbDpkaXYgc3R5bGU9ImJveC1zaXppbmc6Ym9yZGVyLWJveDtmb250LXNpemU6MDt0ZXh0LWFsaWduOmNlbnRlciIgZGF0YS1kcmF3aW8tY29sb3JzPSJjb2xvcjogcmdiKDAsIDAsIDApOyI+PHhodG1sOmRpdiBzdHlsZT0iZGlzcGxheTppbmxpbmUtYmxvY2s7Zm9udC1zaXplOjE4cHg7Zm9udC1mYW1pbHk6SGVsdmV0aWNhO2NvbG9yOiMwMDA7bGluZS1oZWlnaHQ6MS4yO3BvaW50ZXItZXZlbnRzOmFsbDt3aGl0ZS1zcGFjZTpub3JtYWw7b3ZlcmZsb3ctd3JhcDpub3JtYWwiPklzRW5lbXlWaXNpYmxlPC94aHRtbDpkaXY+PC94aHRtbDpkaXY+PC94aHRtbDpkaXY+PC9mb3JlaWduT2JqZWN0Pjx0ZXh0IGlkPSJ0ZXh0NDYiIHg9Ijc1IiB5PSIxNTUiIGZpbGw9IiMwMDAiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMTgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPklzRW5lbXlWaXNpYmxlPC90ZXh0Pjwvc3dpdGNoPjwvZz48cmVjdCBpZD0icmVjdDUyIiB3aWR0aD0iMTQwIiBoZWlnaHQ9IjYwIiB4PSIxNzAiIHk9IjEyMCIgZmlsbD0iI0ZGRiIgc3Ryb2tlPSIjMDAwIiBwb2ludGVyLWV2ZW50cz0iYWxsIiByeD0iMjEuNiIgcnk9IjIxLjYiLz48ZyBpZD0iZzU4IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpIj48c3dpdGNoIGlkPSJzd2l0Y2g1NiI+PGZvcmVpZ25PYmplY3Qgc3R5bGU9Im92ZXJmbG93OnZpc2libGU7dGV4dC1hbGlnbjpsZWZ0IiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBwb2ludGVyLWV2ZW50cz0ibm9uZSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5Ij48eGh0bWw6ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6dW5zYWZlIGNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6dW5zYWZlIGNlbnRlcjt3aWR0aDoxMzhweDtoZWlnaHQ6MXB4O3BhZGRpbmctdG9wOjE1MHB4O21hcmdpbi1sZWZ0OjE3MXB4Ij48eGh0bWw6ZGl2IHN0eWxlPSJib3gtc2l6aW5nOmJvcmRlci1ib3g7Zm9udC1zaXplOjA7dGV4dC1hbGlnbjpjZW50ZXIiIGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsiPjx4aHRtbDpkaXYgc3R5bGU9ImRpc3BsYXk6aW5saW5lLWJsb2NrO2ZvbnQtc2l6ZToxOHB4O2ZvbnQtZmFtaWx5OkhlbHZldGljYTtjb2xvcjojMDAwO2xpbmUtaGVpZ2h0OjEuMjtwb2ludGVyLWV2ZW50czphbGw7d2hpdGUtc3BhY2U6bm9ybWFsO292ZXJmbG93LXdyYXA6bm9ybWFsIj5pc1JpZmxlTG9hZGVkPC94aHRtbDpkaXY+PC94aHRtbDpkaXY+PC94aHRtbDpkaXY+PC9mb3JlaWduT2JqZWN0Pjx0ZXh0IGlkPSJ0ZXh0NTQiIHg9IjI0MCIgeT0iMTU1IiBmaWxsPSIjMDAwIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjE4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5pc1JpZmxlTG9hZGVkPC90ZXh0Pjwvc3dpdGNoPjwvZz48L2c+PC9zdmc+" /></p>
<h3 id="reactivesequence">ReactiveSequence<a class="headerlink" href="#reactivesequence" title="Permanent link">&para;</a></h3>
<p>该节点特别适合持续检查条件，但用户在使用异步子节点时需谨慎，确保它们不会被过于频繁地 tick。</p>
<p>下面来看一个示例：</p>
<p><img alt="ReactiveSequence" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhodG1sPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojZmZmIiBpZD0ic3ZnNDYiIHdpZHRoPSIzMjEiIGhlaWdodD0iMTgxIiBjb250ZW50PSImbHQ7bXhmaWxlIGhvc3Q9JnF1b3Q7YXBwLmRpYWdyYW1zLm5ldCZxdW90OyBtb2RpZmllZD0mcXVvdDsyMDIyLTAxLTE0VDIyOjEzOjU2LjQyMVomcXVvdDsgYWdlbnQ9JnF1b3Q7NS4wIChYMTEpJnF1b3Q7IHZlcnNpb249JnF1b3Q7MTYuMi43JnF1b3Q7IGV0YWc9JnF1b3Q7dG9QQ0hDMmZmZU1mR1FmdzB2eXYmcXVvdDsgdHlwZT0mcXVvdDtnb29nbGUmcXVvdDsmZ3Q7Jmx0O2RpYWdyYW0gaWQ9JnF1b3Q7OEpTUGRWRWw5eFdNMTQ0NnlYUU0mcXVvdDsmZ3Q7N1ZiQmtwUXdFUDBhcnRaQUZuWTg2dXlzV3FVWHAwcmRZNFJlaUJYU0dKb0IvSG9ETkFNc00xdGF1dXJCRTd6WDNVbjZ2VXd6bnRqbHpTc3JpK3dkSnFDOVlKTTBucmp4Z3NBWDRjWTlPcVlkbU92b2FpQlNxeEpPbW9pRCtnWk1jbDFhcVFUS1JTSWhhbExGa296UkdJaHB3VWxyc1Y2bTNhTmU3bHJJRkZiRUlaWjZ6WDVVQ1dYTSt0SHpLZkFhVkpyeDF0dmdlZ2prY2t6bVRzcE1KbGpQS0xIM3hNNGkwdkNXTnp2UW5YaWpMa1BkN1lYbzZXQVdEUDFJUWNESG9IYnNEUkxYS2tPRHhqMWVXcXhNQWwzRnhpRzBsR0dLUnVxM2lJVWpmVWQrQWFLV2paSVZvYU15eWpWSG9WSDBxU3QvRmpLNm0wVnVHbDY1QiswSURObDJWdFRCdTNsc0t1dlJXSGVQaHZnZy90YmhvY0d1cTRWRUpWWTJab292SDBtYkFxc1dyWVgwVC9hNGV3MllnOXZWcFZqUWt0Unh1YnJrQzVhZThpWVAzQXZiY040UzhkK1NzNWFFZjg4U1BzMVI2b29YZlE4eTdyWTR3TmNLakR2MVE4K1dCdFdaSWpnVXNtK3Zka054YWNaNWdZNWdDUnJ2MGcvN1F2TmNFQWllTUR4aXhZanIyY0RhTXBmTlpsVzArWFc5d3BWZUw0ckNvb3l6dllHOC9lZkVFZy9FdWdyUGlCVStrVmpSU3F3M1pTL1RCMVdxei9xeHErWC92RnJTeGd4RjlIdkU4Nk0vSjU2RDA3ZXhqODMrWVlqOWR3PT0mbHQ7L2RpYWdyYW0mZ3Q7Jmx0Oy9teGZpbGUmZ3Q7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9Ii0wLjUgLTAuNSAzMjEgMTgxIj48bWV0YWRhdGEgaWQ9Im1ldGFkYXRhNTAiLz48ZyBpZD0iZzM2Ij48cGF0aCBpZD0icGF0aDQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNIDE2MCA2MCBMIDgwLjIgMTE2LjMzIiBwb2ludGVyLWV2ZW50cz0ic3Ryb2tlIi8+PHBhdGggaWQ9InBhdGg2IiBmaWxsPSIjMDAwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTSA3NS45MSAxMTkuMzYgTCA3OS42MSAxMTIuNDYgTCA4MC4yIDExNi4zMyBMIDgzLjY1IDExOC4xOCBaIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PHBhdGggaWQ9InBhdGg4IiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTSAxNjAgNjAgTCAyMzkuOCAxMTYuMzMiIHBvaW50ZXItZXZlbnRzPSJzdHJva2UiLz48cGF0aCBpZD0icGF0aDEwIiBmaWxsPSIjMDAwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTSAyNDQuMDkgMTE5LjM2IEwgMjM2LjM1IDExOC4xOCBMIDIzOS44IDExNi4zMyBMIDI0MC4zOSAxMTIuNDYgWiIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxyZWN0IGlkPSJyZWN0MTIiIHdpZHRoPSIxODAiIGhlaWdodD0iNjAiIHg9IjcwIiB5PSIwIiBmaWxsPSIjRkZGIiBzdHJva2U9IiMwMDAiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48ZyBpZD0iZzE4IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpIj48c3dpdGNoIGlkPSJzd2l0Y2gxNiI+PGZvcmVpZ25PYmplY3Qgc3R5bGU9Im92ZXJmbG93OnZpc2libGU7dGV4dC1hbGlnbjpsZWZ0IiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBwb2ludGVyLWV2ZW50cz0ibm9uZSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5Ij48eGh0bWw6ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6dW5zYWZlIGNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6dW5zYWZlIGNlbnRlcjt3aWR0aDoxNzhweDtoZWlnaHQ6MXB4O3BhZGRpbmctdG9wOjMwcHg7bWFyZ2luLWxlZnQ6NzFweCI+PHhodG1sOmRpdiBzdHlsZT0iYm94LXNpemluZzpib3JkZXItYm94O2ZvbnQtc2l6ZTowO3RleHQtYWxpZ246Y2VudGVyIiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7Ij48eGh0bWw6ZGl2IHN0eWxlPSJkaXNwbGF5OmlubGluZS1ibG9jaztmb250LXNpemU6MThweDtmb250LWZhbWlseTpIZWx2ZXRpY2E7Y29sb3I6IzAwMDtsaW5lLWhlaWdodDoxLjI7cG9pbnRlci1ldmVudHM6YWxsO3doaXRlLXNwYWNlOm5vcm1hbDtvdmVyZmxvdy13cmFwOm5vcm1hbCI+UmVhY3RpdmVTZXF1ZW5jZTwveGh0bWw6ZGl2PjwveGh0bWw6ZGl2PjwveGh0bWw6ZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCBpZD0idGV4dDE0IiB4PSIxNjAiIHk9IjM1IiBmaWxsPSIjMDAwIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjE4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5SZWFjdGl2ZVNlcXVlbmNlPC90ZXh0Pjwvc3dpdGNoPjwvZz48cmVjdCBpZD0icmVjdDIwIiB3aWR0aD0iMTUwIiBoZWlnaHQ9IjYwIiB4PSIxNzAiIHk9IjEyMCIgZmlsbD0iI0ZGRiIgc3Ryb2tlPSIjMDAwIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PGcgaWQ9ImcyNiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+PHN3aXRjaCBpZD0ic3dpdGNoMjQiPjxmb3JlaWduT2JqZWN0IHN0eWxlPSJvdmVyZmxvdzp2aXNpYmxlO3RleHQtYWxpZ246bGVmdCIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcG9pbnRlci1ldmVudHM9Im5vbmUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSI+PHhodG1sOmRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOnVuc2FmZSBjZW50ZXI7anVzdGlmeS1jb250ZW50OnVuc2FmZSBjZW50ZXI7d2lkdGg6MTQ4cHg7aGVpZ2h0OjFweDtwYWRkaW5nLXRvcDoxNTBweDttYXJnaW4tbGVmdDoxNzFweCI+PHhodG1sOmRpdiBzdHlsZT0iYm94LXNpemluZzpib3JkZXItYm94O2ZvbnQtc2l6ZTowO3RleHQtYWxpZ246Y2VudGVyIiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7Ij48eGh0bWw6ZGl2IHN0eWxlPSJkaXNwbGF5OmlubGluZS1ibG9jaztmb250LXNpemU6MThweDtmb250LWZhbWlseTpIZWx2ZXRpY2E7Y29sb3I6IzAwMDtsaW5lLWhlaWdodDoxLjI7cG9pbnRlci1ldmVudHM6YWxsO3doaXRlLXNwYWNlOm5vcm1hbDtvdmVyZmxvdy13cmFwOm5vcm1hbCI+QXBwcm9hY2hFbmVteTwveGh0bWw6ZGl2PjwveGh0bWw6ZGl2PjwveGh0bWw6ZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCBpZD0idGV4dDIyIiB4PSIyNDUiIHk9IjE1NSIgZmlsbD0iIzAwMCIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxOCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+QXBwcm9hY2hFbmVteTwvdGV4dD48L3N3aXRjaD48L2c+PHJlY3QgaWQ9InJlY3QyOCIgd2lkdGg9IjE1MCIgaGVpZ2h0PSI2MCIgeD0iMCIgeT0iMTIwIiBmaWxsPSIjRkZGIiBzdHJva2U9IiMwMDAiIHBvaW50ZXItZXZlbnRzPSJhbGwiIHJ4PSIyMS42IiByeT0iMjEuNiIvPjxnIGlkPSJnMzQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPjxzd2l0Y2ggaWQ9InN3aXRjaDMyIj48Zm9yZWlnbk9iamVjdCBzdHlsZT0ib3ZlcmZsb3c6dmlzaWJsZTt0ZXh0LWFsaWduOmxlZnQiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHBvaW50ZXItZXZlbnRzPSJub25lIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiPjx4aHRtbDpkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczp1bnNhZmUgY2VudGVyO2p1c3RpZnktY29udGVudDp1bnNhZmUgY2VudGVyO3dpZHRoOjE0OHB4O2hlaWdodDoxcHg7cGFkZGluZy10b3A6MTUwcHg7bWFyZ2luLWxlZnQ6MXB4Ij48eGh0bWw6ZGl2IHN0eWxlPSJib3gtc2l6aW5nOmJvcmRlci1ib3g7Zm9udC1zaXplOjA7dGV4dC1hbGlnbjpjZW50ZXIiIGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsiPjx4aHRtbDpkaXYgc3R5bGU9ImRpc3BsYXk6aW5saW5lLWJsb2NrO2ZvbnQtc2l6ZToxOHB4O2ZvbnQtZmFtaWx5OkhlbHZldGljYTtjb2xvcjojMDAwO2xpbmUtaGVpZ2h0OjEuMjtwb2ludGVyLWV2ZW50czphbGw7d2hpdGUtc3BhY2U6bm9ybWFsO292ZXJmbG93LXdyYXA6bm9ybWFsIj5Jc0VuZW15VmlzaWJsZTwveGh0bWw6ZGl2PjwveGh0bWw6ZGl2PjwveGh0bWw6ZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCBpZD0idGV4dDMwIiB4PSI3NSIgeT0iMTU1IiBmaWxsPSIjMDAwIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjE4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5Jc0VuZW15VmlzaWJsZTwvdGV4dD48L3N3aXRjaD48L2c+PC9nPjwvc3ZnPg==" /></p>
<p><code>ApproachEnemy</code> 是一个<strong>异步</strong>动作，会持续返回 RUNNING，直到最终完成。</p>
<p>条件节点 <code>isEnemyVisible</code> 会被多次调用，若返回假（即 FAILURE），则会中断 <code>ApproachEnemy</code>。</p>
<h3 id="sequencewithmemory">SequenceWithMemory<a class="headerlink" href="#sequencewithmemory" title="Permanent link">&para;</a></h3>
<p>当你不希望再次 tick 已经返回 SUCCESS 的子节点时，使用该控制节点。</p>
<p><strong>示例</strong>：</p>
<p>这是一个巡逻的代理/机器人，必须<strong>只访问一次</strong>位置 A、B 和 C。</p>
<p>如果动作 <strong>GoTo(B)</strong> 失败，则不会再次 tick <strong>GoTo(A)</strong>。</p>
<p>另一方面，节点 <strong>isBatteryOK</strong> 需要每次 tick 都检查，因此它的父节点应为 <code>ReactiveSequence</code>。</p>
<p><img alt="SequenceWithMemory" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhodG1sPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojZmZmIiBpZD0ic3ZnNzAiIHdpZHRoPSI0NDEiIGhlaWdodD0iMzAyIiBjb250ZW50PSImbHQ7bXhmaWxlIGhvc3Q9JnF1b3Q7YXBwLmRpYWdyYW1zLm5ldCZxdW90OyBtb2RpZmllZD0mcXVvdDsyMDIyLTAxLTE0VDIyOjIzOjEyLjkwOFomcXVvdDsgYWdlbnQ9JnF1b3Q7NS4wIChYMTEpJnF1b3Q7IHZlcnNpb249JnF1b3Q7MTYuMi43JnF1b3Q7IGV0YWc9JnF1b3Q7MTh2ZW9mRUt1S1V3VURSeHpWb2ImcXVvdDsgdHlwZT0mcXVvdDtnb29nbGUmcXVvdDsmZ3Q7Jmx0O2RpYWdyYW0gaWQ9JnF1b3Q7Qk5DS0lsSl94ZXN0M1hCYkZHUUMmcXVvdDsmZ3Q7MVZkTGo1c3dFUDQxU08xbHhTTWhjT3htdDl0REsxVk5xM2FQRmt6QUs4ZVRPaVloL2ZVMVlSeHdTYXBLM1UzWUU4eG56M2ptbTRmQmkrYXIra0d4ZGZrSmN4QmU2T2UxRjkxNVlSZ0U0ZFE4R21UZkluRTBhNEZDOFp3MmRjQ0Mvd0lDZlVJcm5zUEcyYWdSaGVackY4eFFTc2kwZ3pHbGNPZHVXNkp3VDEyekFnYkFJbU5paUg3bnVTNXRYSEhhTFh3QVhwUjBkQkpTZkN0bU4xTWttNUxsdU90QjBiMFh6UldpYnQ5VzlSeEVRNTdscGRWN2YyYjE2SmdDcWY5RklTUTM5TjdHQnJrSmxVU0owanh1RlZZeWgwYkROeElxWFdLQmtvbVBpR3NEQmdaOEFxMzNsQ2hXYVRSUXFWZUNWcUhtK2tlamZqTWw2YkczY2xlVDVZT3d0NExVYXQ4cXphWldmdXd2ZG5vSHlTb3VVV3J5SkVpTTNFYlloT1Z3dE1GS1pRUlJPV3FtQ2lEYTBpR1R3VEUvcHJBQlYyQk9OVnNVQ0tiNTFyWE9xTUtLNDc2ajZtZmt4bUxvVXpja1BwMU92VENKZk5kRTZ4VnBkYWswTHowM091aVE0TlBKamw1RHNxK1E2L2o1YysxazZTOHBtWXcySmM5RHJaM1kxK0NXM05reVVaSFJCZnlzUUdhR1g2WUd4THNzNzBxdVliRm1oOWgyNWhwekdUM056aGFVaHRvN040clBCRzRIZ2IwVGFCQkVWdDcxcnBnSllXWHZkb245LytjcUhuRDFnRi94emZ6dDZHaEtrelB6c2s5VE1IMFptbWFqYmRjTFR0QmsyT2JUNjNWNU1xamNMNDJKYjFKenNhaXlERGJMU295dWltZXBXOFhIUWRtdjR2U0ZtajA5M2V6dnh0ZnNjZUxPeElzMnUwM0puenpkam8rbkpBcHZMamNXamRqOW9iVGZvZDEvWG5UL0d3PT0mbHQ7L2RpYWdyYW0mZ3Q7Jmx0Oy9teGZpbGUmZ3Q7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9Ii0wLjUgLTAuNSA0NDEgMzAyIj48bWV0YWRhdGEgaWQ9Im1ldGFkYXRhNzQiLz48cGF0aCBpZD0icGF0aDQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNIDIyMCwxODAgMTAyLjE1LDIyNy42MSIgcG9pbnRlci1ldmVudHM9InN0cm9rZSIvPjxwYXRoIGlkPSJwYXRoNiIgZmlsbD0iIzAwMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGQ9Im0gOTcuMjksMjI5LjU4IDUuMTgsLTUuODcgLTAuMzIsMy45IDIuOTQsMi41OSB6IiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PHBhdGggaWQ9InBhdGg4IiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0ibSAyMjAsMTgwIDE0Ni40NSw0OC4wMiIgcG9pbnRlci1ldmVudHM9InN0cm9rZSIvPjxwYXRoIGlkPSJwYXRoMTAiIGZpbGw9IiMwMDAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJtIDM3MS40NCwyMjkuNjUgLTcuNzQsMS4xNSAyLjc1LC0yLjc4IC0wLjU3LC0zLjg3IHoiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48cGF0aCBpZD0icGF0aDEyIiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0ibSAyMjAsMTgwIHYgNDMuNjMiIHBvaW50ZXItZXZlbnRzPSJzdHJva2UiLz48cGF0aCBpZD0icGF0aDE0IiBmaWxsPSIjMDAwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0ibSAyMjAsMjI4Ljg4IC0zLjUsLTcgMy41LDEuNzUgMy41LC0xLjc1IHoiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48cmVjdCBpZD0icmVjdDE2IiB3aWR0aD0iMTk4LjkyMiIgaGVpZ2h0PSI1OS44MSIgeD0iMTE4LjkyMSIgeT0iMTIwLjA5NSIgZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBwb2ludGVyLWV2ZW50cz0iYWxsIiBzdHlsZT0ic3Ryb2tlLXdpZHRoOjEuMTkwMTEiLz48ZyBpZD0iZzIyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41LC0wLjUpIj48c3dpdGNoIGlkPSJzd2l0Y2gyMCI+PGZvcmVpZ25PYmplY3Qgc3R5bGU9Im92ZXJmbG93OnZpc2libGU7dGV4dC1hbGlnbjpsZWZ0IiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBwb2ludGVyLWV2ZW50cz0ibm9uZSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5Ij48eGh0bWw6ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6dW5zYWZlIGNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6dW5zYWZlIGNlbnRlcjt3aWR0aDoxMzhweDtoZWlnaHQ6MXB4O3BhZGRpbmctdG9wOjE1MHB4O21hcmdpbi1sZWZ0OjE1MXB4Ij48eGh0bWw6ZGl2IHN0eWxlPSJib3gtc2l6aW5nOmJvcmRlci1ib3g7Zm9udC1zaXplOjA7dGV4dC1hbGlnbjpjZW50ZXIiIGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsiPjx4aHRtbDpkaXYgc3R5bGU9ImRpc3BsYXk6aW5saW5lLWJsb2NrO2ZvbnQtc2l6ZToxOHB4O2ZvbnQtZmFtaWx5OkhlbHZldGljYTtjb2xvcjojMDAwO2xpbmUtaGVpZ2h0OjEuMjtwb2ludGVyLWV2ZW50czphbGw7d2hpdGUtc3BhY2U6bm9ybWFsO292ZXJmbG93LXdyYXA6bm9ybWFsIj5TZXF1ZW5jZVdpdGhNZW1vcnk8L3hodG1sOmRpdj48L3hodG1sOmRpdj48L3hodG1sOmRpdj48L2ZvcmVpZ25PYmplY3Q+PHRleHQgaWQ9InRleHQxOCIgeD0iMjIwIiB5PSIxNTUiIGZpbGw9IiMwMDAiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMTgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPlNlcXVlbmNlV2l0aE1lbW9yeTwvdGV4dD48L3N3aXRjaD48L2c+PHJlY3QgaWQ9InJlY3QyNCIgd2lkdGg9IjExNSIgaGVpZ2h0PSI2MCIgeD0iMzE1IiB5PSIyMzAiIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxnIGlkPSJnMzAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUsLTAuNSkiPjxzd2l0Y2ggaWQ9InN3aXRjaDI4Ij48Zm9yZWlnbk9iamVjdCBzdHlsZT0ib3ZlcmZsb3c6dmlzaWJsZTt0ZXh0LWFsaWduOmxlZnQiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHBvaW50ZXItZXZlbnRzPSJub25lIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiPjx4aHRtbDpkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczp1bnNhZmUgY2VudGVyO2p1c3RpZnktY29udGVudDp1bnNhZmUgY2VudGVyO3dpZHRoOjExM3B4O2hlaWdodDoxcHg7cGFkZGluZy10b3A6MjYwcHg7bWFyZ2luLWxlZnQ6MzE2cHgiPjx4aHRtbDpkaXYgc3R5bGU9ImJveC1zaXppbmc6Ym9yZGVyLWJveDtmb250LXNpemU6MDt0ZXh0LWFsaWduOmNlbnRlciIgZGF0YS1kcmF3aW8tY29sb3JzPSJjb2xvcjogcmdiKDAsIDAsIDApOyI+PHhodG1sOmRpdiBzdHlsZT0iZGlzcGxheTppbmxpbmUtYmxvY2s7Zm9udC1zaXplOjE4cHg7Zm9udC1mYW1pbHk6SGVsdmV0aWNhO2NvbG9yOiMwMDA7bGluZS1oZWlnaHQ6MS4yO3BvaW50ZXItZXZlbnRzOmFsbDt3aGl0ZS1zcGFjZTpub3JtYWw7b3ZlcmZsb3ctd3JhcDpub3JtYWwiPkdvVG8oQyk8L3hodG1sOmRpdj48L3hodG1sOmRpdj48L3hodG1sOmRpdj48L2ZvcmVpZ25PYmplY3Q+PHRleHQgaWQ9InRleHQyNiIgeD0iMzczIiB5PSIyNjUiIGZpbGw9IiMwMDAiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMTgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPkdvVG8oQyk8L3RleHQ+PC9zd2l0Y2g+PC9nPjxwYXRoIGlkPSJwYXRoMzIiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJtIDIyMCw3MCB2IDQzLjYzIiBwb2ludGVyLWV2ZW50cz0ic3Ryb2tlIi8+PHBhdGggaWQ9InBhdGgzNCIgZmlsbD0iIzAwMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGQ9Im0gMjIwLDExOC44OCAtMy41LC03IDMuNSwxLjc1IDMuNSwtMS43NSB6IiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PHJlY3QgaWQ9InJlY3QzNiIgd2lkdGg9IjE5MCIgaGVpZ2h0PSI2MCIgeD0iMTI1IiB5PSIxMCIgZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PGcgaWQ9Imc0MiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSwtMC41KSI+PHN3aXRjaCBpZD0ic3dpdGNoNDAiPjxmb3JlaWduT2JqZWN0IHN0eWxlPSJvdmVyZmxvdzp2aXNpYmxlO3RleHQtYWxpZ246bGVmdCIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcG9pbnRlci1ldmVudHM9Im5vbmUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSI+PHhodG1sOmRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOnVuc2FmZSBjZW50ZXI7anVzdGlmeS1jb250ZW50OnVuc2FmZSBjZW50ZXI7d2lkdGg6MTg4cHg7aGVpZ2h0OjFweDtwYWRkaW5nLXRvcDo0MHB4O21hcmdpbi1sZWZ0OjEyNnB4Ij48eGh0bWw6ZGl2IHN0eWxlPSJib3gtc2l6aW5nOmJvcmRlci1ib3g7Zm9udC1zaXplOjA7dGV4dC1hbGlnbjpjZW50ZXIiIGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsiPjx4aHRtbDpkaXYgc3R5bGU9ImRpc3BsYXk6aW5saW5lLWJsb2NrO2ZvbnQtc2l6ZToxOHB4O2ZvbnQtZmFtaWx5OkhlbHZldGljYTtjb2xvcjojMDAwO2xpbmUtaGVpZ2h0OjEuMjtwb2ludGVyLWV2ZW50czphbGw7d2hpdGUtc3BhY2U6bm9ybWFsO292ZXJmbG93LXdyYXA6bm9ybWFsIj5SZXRyeVVudGlsU3VjY2Vzc2Z1bDwveGh0bWw6ZGl2PjwveGh0bWw6ZGl2PjwveGh0bWw6ZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCBpZD0idGV4dDM4IiB4PSIyMjAiIHk9IjQ1IiBmaWxsPSIjMDAwIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjE4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5SZXRyeVVudGlsU3VjY2Vzc2Z1bDwvdGV4dD48L3N3aXRjaD48L2c+PHJlY3QgaWQ9InJlY3Q0NCIgd2lkdGg9IjExNSIgaGVpZ2h0PSI2MCIgeD0iMTAiIHk9IjIzMCIgZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PGcgaWQ9Imc1MCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSwtMC41KSI+PHN3aXRjaCBpZD0ic3dpdGNoNDgiPjxmb3JlaWduT2JqZWN0IHN0eWxlPSJvdmVyZmxvdzp2aXNpYmxlO3RleHQtYWxpZ246bGVmdCIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcG9pbnRlci1ldmVudHM9Im5vbmUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSI+PHhodG1sOmRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOnVuc2FmZSBjZW50ZXI7anVzdGlmeS1jb250ZW50OnVuc2FmZSBjZW50ZXI7d2lkdGg6MTEzcHg7aGVpZ2h0OjFweDtwYWRkaW5nLXRvcDoyNjBweDttYXJnaW4tbGVmdDoxMXB4Ij48eGh0bWw6ZGl2IHN0eWxlPSJib3gtc2l6aW5nOmJvcmRlci1ib3g7Zm9udC1zaXplOjA7dGV4dC1hbGlnbjpjZW50ZXIiIGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsiPjx4aHRtbDpkaXYgc3R5bGU9ImRpc3BsYXk6aW5saW5lLWJsb2NrO2ZvbnQtc2l6ZToxOHB4O2ZvbnQtZmFtaWx5OkhlbHZldGljYTtjb2xvcjojMDAwO2xpbmUtaGVpZ2h0OjEuMjtwb2ludGVyLWV2ZW50czphbGw7d2hpdGUtc3BhY2U6bm9ybWFsO292ZXJmbG93LXdyYXA6bm9ybWFsIj5Hb1RvKEEpPC94aHRtbDpkaXY+PC94aHRtbDpkaXY+PC94aHRtbDpkaXY+PC9mb3JlaWduT2JqZWN0Pjx0ZXh0IGlkPSJ0ZXh0NDYiIHg9IjY4IiB5PSIyNjUiIGZpbGw9IiMwMDAiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMTgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPkdvVG8oQSk8L3RleHQ+PC9zd2l0Y2g+PC9nPjxyZWN0IGlkPSJyZWN0NTIiIHdpZHRoPSIxMTUiIGhlaWdodD0iNjAiIHg9IjE2Mi41IiB5PSIyMzAiIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxnIGlkPSJnNTgiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUsLTAuNSkiPjxzd2l0Y2ggaWQ9InN3aXRjaDU2Ij48Zm9yZWlnbk9iamVjdCBzdHlsZT0ib3ZlcmZsb3c6dmlzaWJsZTt0ZXh0LWFsaWduOmxlZnQiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHBvaW50ZXItZXZlbnRzPSJub25lIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiPjx4aHRtbDpkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczp1bnNhZmUgY2VudGVyO2p1c3RpZnktY29udGVudDp1bnNhZmUgY2VudGVyO3dpZHRoOjExM3B4O2hlaWdodDoxcHg7cGFkZGluZy10b3A6MjYwcHg7bWFyZ2luLWxlZnQ6MTY0cHgiPjx4aHRtbDpkaXYgc3R5bGU9ImJveC1zaXppbmc6Ym9yZGVyLWJveDtmb250LXNpemU6MDt0ZXh0LWFsaWduOmNlbnRlciIgZGF0YS1kcmF3aW8tY29sb3JzPSJjb2xvcjogcmdiKDAsIDAsIDApOyI+PHhodG1sOmRpdiBzdHlsZT0iZGlzcGxheTppbmxpbmUtYmxvY2s7Zm9udC1zaXplOjE4cHg7Zm9udC1mYW1pbHk6SGVsdmV0aWNhO2NvbG9yOiMwMDA7bGluZS1oZWlnaHQ6MS4yO3BvaW50ZXItZXZlbnRzOmFsbDt3aGl0ZS1zcGFjZTpub3JtYWw7b3ZlcmZsb3ctd3JhcDpub3JtYWwiPkdvVG8oQik8L3hodG1sOmRpdj48L3hodG1sOmRpdj48L3hodG1sOmRpdj48L2ZvcmVpZ25PYmplY3Q+PHRleHQgaWQ9InRleHQ1NCIgeD0iMjIwIiB5PSIyNjUiIGZpbGw9IiMwMDAiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMTgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPkdvVG8oQik8L3RleHQ+PC9zd2l0Y2g+PC9nPjwvc3ZnPg==" /></p>
<h1 id="ros2">与 ROS2 的集成<a class="headerlink" href="#ros2" title="Permanent link">&para;</a></h1>
<p>BehaviorTree.CPP 在机器人领域及 <a href="https://docs.ros.org/en/humble/index.html">ROS</a> 生态系统中被广泛使用。</p>
<p>我们提供了一套现成的封装，可以用来快速实现与 ROS2 交互的 TreeNode：<a href="https://github.com/BehaviorTree/BehaviorTree.ROS2">BehaviorTree.ROS2</a></p>
<p>关于系统架构，需要记住：</p>
<ul>
<li>应该有一个集中式的“协调器”ROS节点，负责行为的执行。该节点后续称为“任务规划器”，并将使用 BT.CPP 实现。</li>
<li>系统的其他所有部分应为“面向服务”的组件，任何业务逻辑和决策应委托给任务规划器。</li>
</ul>
<blockquote>
<p>⚠️ 注意</p>
<p>一些词在 <strong>ROS</strong> 和 <strong>BT.CPP</strong> 语境中相同，但含义不同。</p>
</blockquote>
<p>尤其是“Action”和“Node”这两个词：</p>
<ul>
<li><code>TreeNode</code> 与 <code>rclcpp::Node</code></li>
<li><code>BT::Action</code> 与 <code>rclcpp_action</code></li>
</ul>
<p>你可以直接使用它们，也可以将它们作为模板/蓝图来创建你自己的版本。</p>
<h3 id="rclcpp_action-btaction">使用 rclcpp_action 的异步 BT::Action<a class="headerlink" href="#rclcpp_action-btaction" title="Permanent link">&para;</a></h3>
<p>推荐通过 <a href="https://docs.ros.org/en/humble/Tutorials/Intermediate/Writing-an-Action-Server-Client/Cpp.html">rclcpp_action</a> 与 ROS 交互。</p>
<p>它们非常合适，因为：</p>
<ul>
<li>其 API 是异步的，即用户不必担心创建单独线程。</li>
<li>它们可以被中止，这对于实现 <code>TreeNode::halt()</code> 和构建响应式行为是必要的。</li>
</ul>
<p>例如，考虑<a href="https://docs.ros.org/en/humble/Tutorials/Intermediate/Writing-an-Action-Server-Client/Cpp.html#writing-an-action-client">官方 C++ 教程</a>中描述的“Fibonacci”动作客户端：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a><span class="c1">// 简化定义</span>
<a id="__codelineno-118-2" name="__codelineno-118-2" href="#__codelineno-118-2"></a><span class="k">using</span><span class="w"> </span><span class="n">Fibonacci</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">action_tutorials_interfaces</span><span class="o">::</span><span class="n">action</span><span class="o">::</span><span class="n">Fibonacci</span><span class="p">;</span>
<a id="__codelineno-118-3" name="__codelineno-118-3" href="#__codelineno-118-3"></a><span class="k">using</span><span class="w"> </span><span class="n">GoalHandleFibonacci</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rclcpp_action</span><span class="o">::</span><span class="n">ServerGoalHandle</span><span class="o">&lt;</span><span class="n">Fibonacci</span><span class="o">&gt;</span><span class="p">;</span>
</code></pre></div>
<p>创建一个调用此 ROS 动作的 BT 动作：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;behaviortree_ros2/bt_action_node.hpp&gt;</span>
<a id="__codelineno-119-2" name="__codelineno-119-2" href="#__codelineno-119-2"></a>
<a id="__codelineno-119-3" name="__codelineno-119-3" href="#__codelineno-119-3"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">BT</span><span class="p">;</span>
<a id="__codelineno-119-4" name="__codelineno-119-4" href="#__codelineno-119-4"></a>
<a id="__codelineno-119-5" name="__codelineno-119-5" href="#__codelineno-119-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">FibonacciAction</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">RosActionNode</span><span class="o">&lt;</span><span class="n">Fibonacci</span><span class="o">&gt;</span>
<a id="__codelineno-119-6" name="__codelineno-119-6" href="#__codelineno-119-6"></a><span class="p">{</span>
<a id="__codelineno-119-7" name="__codelineno-119-7" href="#__codelineno-119-7"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-119-8" name="__codelineno-119-8" href="#__codelineno-119-8"></a><span class="w">  </span><span class="n">FibonacciAction</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-119-9" name="__codelineno-119-9" href="#__codelineno-119-9"></a><span class="w">                  </span><span class="k">const</span><span class="w"> </span><span class="n">NodeConfig</span><span class="o">&amp;</span><span class="w"> </span><span class="n">conf</span><span class="p">,</span>
<a id="__codelineno-119-10" name="__codelineno-119-10" href="#__codelineno-119-10"></a><span class="w">                  </span><span class="k">const</span><span class="w"> </span><span class="n">RosNodeParams</span><span class="o">&amp;</span><span class="w"> </span><span class="n">params</span><span class="p">)</span>
<a id="__codelineno-119-11" name="__codelineno-119-11" href="#__codelineno-119-11"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">RosActionNode</span><span class="o">&lt;</span><span class="n">Fibonacci</span><span class="o">&gt;</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">conf</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">)</span>
<a id="__codelineno-119-12" name="__codelineno-119-12" href="#__codelineno-119-12"></a><span class="w">  </span><span class="p">{}</span>
<a id="__codelineno-119-13" name="__codelineno-119-13" href="#__codelineno-119-13"></a>
<a id="__codelineno-119-14" name="__codelineno-119-14" href="#__codelineno-119-14"></a><span class="w">  </span><span class="c1">// 派生类特定的端口</span>
<a id="__codelineno-119-15" name="__codelineno-119-15" href="#__codelineno-119-15"></a><span class="w">  </span><span class="c1">// 应与基类端口合并，</span>
<a id="__codelineno-119-16" name="__codelineno-119-16" href="#__codelineno-119-16"></a><span class="w">  </span><span class="c1">// 使用 RosActionNode::providedBasicPorts()</span>
<a id="__codelineno-119-17" name="__codelineno-119-17" href="#__codelineno-119-17"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">PortsList</span><span class="w"> </span><span class="n">providedPorts</span><span class="p">()</span>
<a id="__codelineno-119-18" name="__codelineno-119-18" href="#__codelineno-119-18"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-119-19" name="__codelineno-119-19" href="#__codelineno-119-19"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">providedBasicPorts</span><span class="p">({</span><span class="n">InputPort</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;order&quot;</span><span class="p">)});</span>
<a id="__codelineno-119-20" name="__codelineno-119-20" href="#__codelineno-119-20"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-119-21" name="__codelineno-119-21" href="#__codelineno-119-21"></a>
<a id="__codelineno-119-22" name="__codelineno-119-22" href="#__codelineno-119-22"></a><span class="w">  </span><span class="c1">// 当 TreeNode 被 tick 时调用，</span>
<a id="__codelineno-119-23" name="__codelineno-119-23" href="#__codelineno-119-23"></a><span class="w">  </span><span class="c1">// 应向动作服务器发送请求</span>
<a id="__codelineno-119-24" name="__codelineno-119-24" href="#__codelineno-119-24"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">setGoal</span><span class="p">(</span><span class="n">RosActionNode</span><span class="o">::</span><span class="n">Goal</span><span class="o">&amp;</span><span class="w"> </span><span class="n">goal</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span>
<a id="__codelineno-119-25" name="__codelineno-119-25" href="#__codelineno-119-25"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-119-26" name="__codelineno-119-26" href="#__codelineno-119-26"></a><span class="w">    </span><span class="c1">// 从输入端口获取 &quot;order&quot;</span>
<a id="__codelineno-119-27" name="__codelineno-119-27" href="#__codelineno-119-27"></a><span class="w">    </span><span class="n">getInput</span><span class="p">(</span><span class="s">&quot;order&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">goal</span><span class="p">.</span><span class="n">order</span><span class="p">);</span>
<a id="__codelineno-119-28" name="__codelineno-119-28" href="#__codelineno-119-28"></a><span class="w">    </span><span class="c1">// 如果成功设置目标，则返回 true</span>
<a id="__codelineno-119-29" name="__codelineno-119-29" href="#__codelineno-119-29"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-119-30" name="__codelineno-119-30" href="#__codelineno-119-30"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-119-31" name="__codelineno-119-31" href="#__codelineno-119-31"></a>
<a id="__codelineno-119-32" name="__codelineno-119-32" href="#__codelineno-119-32"></a><span class="w">  </span><span class="c1">// 接收到回复时的回调函数。</span>
<a id="__codelineno-119-33" name="__codelineno-119-33" href="#__codelineno-119-33"></a><span class="w">  </span><span class="c1">// 可根据回复决定返回 SUCCESS 或 FAILURE。</span>
<a id="__codelineno-119-34" name="__codelineno-119-34" href="#__codelineno-119-34"></a><span class="w">  </span><span class="n">NodeStatus</span><span class="w"> </span><span class="n">onResultReceived</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">WrappedResult</span><span class="o">&amp;</span><span class="w"> </span><span class="n">wr</span><span class="p">)</span><span class="w"> </span><span class="k">override</span>
<a id="__codelineno-119-35" name="__codelineno-119-35" href="#__codelineno-119-35"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-119-36" name="__codelineno-119-36" href="#__codelineno-119-36"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">stringstream</span><span class="w"> </span><span class="n">ss</span><span class="p">;</span>
<a id="__codelineno-119-37" name="__codelineno-119-37" href="#__codelineno-119-37"></a><span class="w">    </span><span class="n">ss</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;结果已接收: &quot;</span><span class="p">;</span>
<a id="__codelineno-119-38" name="__codelineno-119-38" href="#__codelineno-119-38"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">wr</span><span class="p">.</span><span class="n">result</span><span class="o">-&gt;</span><span class="n">sequence</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-119-39" name="__codelineno-119-39" href="#__codelineno-119-39"></a><span class="w">      </span><span class="n">ss</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">;</span>
<a id="__codelineno-119-40" name="__codelineno-119-40" href="#__codelineno-119-40"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-119-41" name="__codelineno-119-41" href="#__codelineno-119-41"></a><span class="w">    </span><span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="n">node_</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="n">ss</span><span class="p">.</span><span class="n">str</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
<a id="__codelineno-119-42" name="__codelineno-119-42" href="#__codelineno-119-42"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<a id="__codelineno-119-43" name="__codelineno-119-43" href="#__codelineno-119-43"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-119-44" name="__codelineno-119-44" href="#__codelineno-119-44"></a>
<a id="__codelineno-119-45" name="__codelineno-119-45" href="#__codelineno-119-45"></a><span class="w">  </span><span class="c1">// 通信客户端与服务器出错时调用的回调。</span>
<a id="__codelineno-119-46" name="__codelineno-119-46" href="#__codelineno-119-46"></a><span class="w">  </span><span class="c1">// 将设置 TreeNode 状态为 SUCCESS 或 FAILURE，</span>
<a id="__codelineno-119-47" name="__codelineno-119-47" href="#__codelineno-119-47"></a><span class="w">  </span><span class="c1">// 根据返回值确定。</span>
<a id="__codelineno-119-48" name="__codelineno-119-48" href="#__codelineno-119-48"></a><span class="w">  </span><span class="c1">// 若不重写，默认返回 FAILURE。</span>
<a id="__codelineno-119-49" name="__codelineno-119-49" href="#__codelineno-119-49"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="n">NodeStatus</span><span class="w"> </span><span class="n">onFailure</span><span class="p">(</span><span class="n">ActionNodeErrorCode</span><span class="w"> </span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="k">override</span>
<a id="__codelineno-119-50" name="__codelineno-119-50" href="#__codelineno-119-50"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-119-51" name="__codelineno-119-51" href="#__codelineno-119-51"></a><span class="w">    </span><span class="n">RCLCPP_ERROR</span><span class="p">(</span><span class="n">node_</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;错误: %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">);</span>
<a id="__codelineno-119-52" name="__codelineno-119-52" href="#__codelineno-119-52"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">FAILURE</span><span class="p">;</span>
<a id="__codelineno-119-53" name="__codelineno-119-53" href="#__codelineno-119-53"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-119-54" name="__codelineno-119-54" href="#__codelineno-119-54"></a>
<a id="__codelineno-119-55" name="__codelineno-119-55" href="#__codelineno-119-55"></a><span class="w">  </span><span class="c1">// 支持反馈回调，如原教程所示。</span>
<a id="__codelineno-119-56" name="__codelineno-119-56" href="#__codelineno-119-56"></a><span class="w">  </span><span class="c1">// 通常此回调应返回 RUNNING，但你可能基于反馈值</span>
<a id="__codelineno-119-57" name="__codelineno-119-57" href="#__codelineno-119-57"></a><span class="w">  </span><span class="c1">// 决定中止动作，并认为 TreeNode 完成。</span>
<a id="__codelineno-119-58" name="__codelineno-119-58" href="#__codelineno-119-58"></a><span class="w">  </span><span class="c1">// 这种情况下返回 SUCCESS 或 FAILURE。</span>
<a id="__codelineno-119-59" name="__codelineno-119-59" href="#__codelineno-119-59"></a><span class="w">  </span><span class="c1">// 取消请求会自动发送给服务器。</span>
<a id="__codelineno-119-60" name="__codelineno-119-60" href="#__codelineno-119-60"></a><span class="w">  </span><span class="n">NodeStatus</span><span class="w"> </span><span class="n">onFeedback</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">Feedback</span><span class="o">&gt;</span><span class="w"> </span><span class="n">feedback</span><span class="p">)</span>
<a id="__codelineno-119-61" name="__codelineno-119-61" href="#__codelineno-119-61"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-119-62" name="__codelineno-119-62" href="#__codelineno-119-62"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">stringstream</span><span class="w"> </span><span class="n">ss</span><span class="p">;</span>
<a id="__codelineno-119-63" name="__codelineno-119-63" href="#__codelineno-119-63"></a><span class="w">    </span><span class="n">ss</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;接收到序列中的下一个数字: &quot;</span><span class="p">;</span>
<a id="__codelineno-119-64" name="__codelineno-119-64" href="#__codelineno-119-64"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">feedback</span><span class="o">-&gt;</span><span class="n">partial_sequence</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-119-65" name="__codelineno-119-65" href="#__codelineno-119-65"></a><span class="w">      </span><span class="n">ss</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">;</span>
<a id="__codelineno-119-66" name="__codelineno-119-66" href="#__codelineno-119-66"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-119-67" name="__codelineno-119-67" href="#__codelineno-119-67"></a><span class="w">    </span><span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="n">node_</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="n">ss</span><span class="p">.</span><span class="n">str</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
<a id="__codelineno-119-68" name="__codelineno-119-68" href="#__codelineno-119-68"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">RUNNING</span><span class="p">;</span>
<a id="__codelineno-119-69" name="__codelineno-119-69" href="#__codelineno-119-69"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-119-70" name="__codelineno-119-70" href="#__codelineno-119-70"></a><span class="p">};</span>
</code></pre></div>
<p>你会注意到，BT 版本的动作客户端比原版更简洁，因为大部分模板代码已封装在 <code>BT::RosActionNode</code> 中。</p>
<p>注册该节点时，需要使用 <code>BT::RosNodeParams</code> 传入 <code>rclcpp::Node</code> 和其他参数：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a><span class="w">  </span><span class="c1">// 在 main() 中</span>
<a id="__codelineno-120-2" name="__codelineno-120-2" href="#__codelineno-120-2"></a><span class="w">  </span><span class="n">BehaviorTreeFactory</span><span class="w"> </span><span class="n">factory</span><span class="p">;</span>
<a id="__codelineno-120-3" name="__codelineno-120-3" href="#__codelineno-120-3"></a>
<a id="__codelineno-120-4" name="__codelineno-120-4" href="#__codelineno-120-4"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Node</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;fibonacci_action_client&quot;</span><span class="p">);</span>
<a id="__codelineno-120-5" name="__codelineno-120-5" href="#__codelineno-120-5"></a><span class="w">  </span><span class="c1">// 提供 ROS 节点和动作服务名称</span>
<a id="__codelineno-120-6" name="__codelineno-120-6" href="#__codelineno-120-6"></a><span class="w">  </span><span class="n">RosNodeParams</span><span class="w"> </span><span class="n">params</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-120-7" name="__codelineno-120-7" href="#__codelineno-120-7"></a><span class="w">  </span><span class="n">params</span><span class="p">.</span><span class="n">nh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="p">;</span>
<a id="__codelineno-120-8" name="__codelineno-120-8" href="#__codelineno-120-8"></a><span class="w">  </span><span class="n">params</span><span class="p">.</span><span class="n">default_port_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;fibonacci&quot;</span><span class="p">;</span>
<a id="__codelineno-120-9" name="__codelineno-120-9" href="#__codelineno-120-9"></a><span class="w">  </span><span class="n">factory</span><span class="p">.</span><span class="n">registerNodeType</span><span class="o">&lt;</span><span class="n">FibonacciAction</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;Fibonacci&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">);</span>
</code></pre></div>
<h3 id="rclcppclient-btaction">使用 rclcpp::Client（服务）的异步 BT::Action<a class="headerlink" href="#rclcppclient-btaction" title="Permanent link">&para;</a></h3>
<p>针对 ROS 服务客户端也有类似的封装，使用异步接口。</p>
<p>下面示例基于<a href="https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Writing-A-Simple-Cpp-Service-And-Client.html#write-the-client-node">官方教程</a>。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;behaviortree_ros2/bt_service_node.hpp&gt;</span>
<a id="__codelineno-121-2" name="__codelineno-121-2" href="#__codelineno-121-2"></a>
<a id="__codelineno-121-3" name="__codelineno-121-3" href="#__codelineno-121-3"></a><span class="k">using</span><span class="w"> </span><span class="n">AddTwoInts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">example_interfaces</span><span class="o">::</span><span class="n">srv</span><span class="o">::</span><span class="n">AddTwoInts</span><span class="p">;</span>
<a id="__codelineno-121-4" name="__codelineno-121-4" href="#__codelineno-121-4"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">BT</span><span class="p">;</span>
<a id="__codelineno-121-5" name="__codelineno-121-5" href="#__codelineno-121-5"></a>
<a id="__codelineno-121-6" name="__codelineno-121-6" href="#__codelineno-121-6"></a>
<a id="__codelineno-121-7" name="__codelineno-121-7" href="#__codelineno-121-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">AddTwoIntsNode</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">RosServiceNode</span><span class="o">&lt;</span><span class="n">AddTwoInts</span><span class="o">&gt;</span>
<a id="__codelineno-121-8" name="__codelineno-121-8" href="#__codelineno-121-8"></a><span class="p">{</span>
<a id="__codelineno-121-9" name="__codelineno-121-9" href="#__codelineno-121-9"></a><span class="w">  </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-121-10" name="__codelineno-121-10" href="#__codelineno-121-10"></a>
<a id="__codelineno-121-11" name="__codelineno-121-11" href="#__codelineno-121-11"></a><span class="w">  </span><span class="n">AddTwoIntsNode</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-121-12" name="__codelineno-121-12" href="#__codelineno-121-12"></a><span class="w">                  </span><span class="k">const</span><span class="w"> </span><span class="n">NodeConfig</span><span class="o">&amp;</span><span class="w"> </span><span class="n">conf</span><span class="p">,</span>
<a id="__codelineno-121-13" name="__codelineno-121-13" href="#__codelineno-121-13"></a><span class="w">                  </span><span class="k">const</span><span class="w"> </span><span class="n">RosNodeParams</span><span class="o">&amp;</span><span class="w"> </span><span class="n">params</span><span class="p">)</span>
<a id="__codelineno-121-14" name="__codelineno-121-14" href="#__codelineno-121-14"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">RosServiceNode</span><span class="o">&lt;</span><span class="n">AddTwoInts</span><span class="o">&gt;</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">conf</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">)</span>
<a id="__codelineno-121-15" name="__codelineno-121-15" href="#__codelineno-121-15"></a><span class="w">  </span><span class="p">{}</span>
<a id="__codelineno-121-16" name="__codelineno-121-16" href="#__codelineno-121-16"></a>
<a id="__codelineno-121-17" name="__codelineno-121-17" href="#__codelineno-121-17"></a><span class="w">  </span><span class="c1">// 派生类特定端口</span>
<a id="__codelineno-121-18" name="__codelineno-121-18" href="#__codelineno-121-18"></a><span class="w">  </span><span class="c1">// 应与基类端口合并，</span>
<a id="__codelineno-121-19" name="__codelineno-121-19" href="#__codelineno-121-19"></a><span class="w">  </span><span class="c1">// 使用 RosServiceNode::providedBasicPorts()</span>
<a id="__codelineno-121-20" name="__codelineno-121-20" href="#__codelineno-121-20"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">PortsList</span><span class="w"> </span><span class="n">providedPorts</span><span class="p">()</span>
<a id="__codelineno-121-21" name="__codelineno-121-21" href="#__codelineno-121-21"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-121-22" name="__codelineno-121-22" href="#__codelineno-121-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">providedBasicPorts</span><span class="p">({</span>
<a id="__codelineno-121-23" name="__codelineno-121-23" href="#__codelineno-121-23"></a><span class="w">        </span><span class="n">InputPort</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">),</span>
<a id="__codelineno-121-24" name="__codelineno-121-24" href="#__codelineno-121-24"></a><span class="w">        </span><span class="n">InputPort</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;B&quot;</span><span class="p">)});</span>
<a id="__codelineno-121-25" name="__codelineno-121-25" href="#__codelineno-121-25"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-121-26" name="__codelineno-121-26" href="#__codelineno-121-26"></a>
<a id="__codelineno-121-27" name="__codelineno-121-27" href="#__codelineno-121-27"></a><span class="w">  </span><span class="c1">// TreeNode 被 tick 时调用，</span>
<a id="__codelineno-121-28" name="__codelineno-121-28" href="#__codelineno-121-28"></a><span class="w">  </span><span class="c1">// 应向服务提供者发送请求</span>
<a id="__codelineno-121-29" name="__codelineno-121-29" href="#__codelineno-121-29"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">setRequest</span><span class="p">(</span><span class="n">Request</span><span class="o">::</span><span class="n">SharedPtr</span><span class="o">&amp;</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="k">override</span>
<a id="__codelineno-121-30" name="__codelineno-121-30" href="#__codelineno-121-30"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-121-31" name="__codelineno-121-31" href="#__codelineno-121-31"></a><span class="w">    </span><span class="c1">// 使用输入端口设置 A 和 B</span>
<a id="__codelineno-121-32" name="__codelineno-121-32" href="#__codelineno-121-32"></a><span class="w">    </span><span class="n">getInput</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">);</span>
<a id="__codelineno-121-33" name="__codelineno-121-33" href="#__codelineno-121-33"></a><span class="w">    </span><span class="n">getInput</span><span class="p">(</span><span class="s">&quot;B&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">);</span>
<a id="__codelineno-121-34" name="__codelineno-121-34" href="#__codelineno-121-34"></a><span class="w">    </span><span class="c1">// 准备好发送请求时必须返回 true</span>
<a id="__codelineno-121-35" name="__codelineno-121-35" href="#__codelineno-121-35"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-121-36" name="__codelineno-121-36" href="#__codelineno-121-36"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-121-37" name="__codelineno-121-37" href="#__codelineno-121-37"></a>
<a id="__codelineno-121-38" name="__codelineno-121-38" href="#__codelineno-121-38"></a><span class="w">  </span><span class="c1">// 接收到响应时调用回调。</span>
<a id="__codelineno-121-39" name="__codelineno-121-39" href="#__codelineno-121-39"></a><span class="w">  </span><span class="c1">// 必须返回 SUCCESS 或 FAILURE</span>
<a id="__codelineno-121-40" name="__codelineno-121-40" href="#__codelineno-121-40"></a><span class="w">  </span><span class="n">NodeStatus</span><span class="w"> </span><span class="n">onResponseReceived</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Response</span><span class="o">::</span><span class="n">SharedPtr</span><span class="o">&amp;</span><span class="w"> </span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="k">override</span>
<a id="__codelineno-121-41" name="__codelineno-121-41" href="#__codelineno-121-41"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-121-42" name="__codelineno-121-42" href="#__codelineno-121-42"></a><span class="w">    </span><span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="n">node_</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;和: %ld&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="o">-&gt;</span><span class="n">sum</span><span class="p">);</span>
<a id="__codelineno-121-43" name="__codelineno-121-43" href="#__codelineno-121-43"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<a id="__codelineno-121-44" name="__codelineno-121-44" href="#__codelineno-121-44"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-121-45" name="__codelineno-121-45" href="#__codelineno-121-45"></a>
<a id="__codelineno-121-46" name="__codelineno-121-46" href="#__codelineno-121-46"></a><span class="w">  </span><span class="c1">// 通信客户端与服务器出错时调用回调。</span>
<a id="__codelineno-121-47" name="__codelineno-121-47" href="#__codelineno-121-47"></a><span class="w">  </span><span class="c1">// 将设置 TreeNode 状态为 SUCCESS 或 FAILURE，</span>
<a id="__codelineno-121-48" name="__codelineno-121-48" href="#__codelineno-121-48"></a><span class="w">  </span><span class="c1">// 根据返回值确定。</span>
<a id="__codelineno-121-49" name="__codelineno-121-49" href="#__codelineno-121-49"></a><span class="w">  </span><span class="c1">// 若不重写，默认返回 FAILURE。</span>
<a id="__codelineno-121-50" name="__codelineno-121-50" href="#__codelineno-121-50"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="n">NodeStatus</span><span class="w"> </span><span class="n">onFailure</span><span class="p">(</span><span class="n">ServiceNodeErrorCode</span><span class="w"> </span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="k">override</span>
<a id="__codelineno-121-51" name="__codelineno-121-51" href="#__codelineno-121-51"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-121-52" name="__codelineno-121-52" href="#__codelineno-121-52"></a><span class="w">    </span><span class="n">RCLCPP_ERROR</span><span class="p">(</span><span class="n">node_</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;错误: %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">);</span>
<a id="__codelineno-121-53" name="__codelineno-121-53" href="#__codelineno-121-53"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">FAILURE</span><span class="p">;</span>
<a id="__codelineno-121-54" name="__codelineno-121-54" href="#__codelineno-121-54"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-121-55" name="__codelineno-121-55" href="#__codelineno-121-55"></a><span class="p">};</span>
</code></pre></div>
<h1 id="38-4x">从版本 3.8 迁移到 4.X<a class="headerlink" href="#38-4x" title="Permanent link">&para;</a></h1>
<p>你会发现版本 4.X 中的大部分更改都是渐进式的，并且向后兼容你之前的代码。</p>
<p>这里我们尝试总结你在迁移时应该注意的最重要的区别。</p>
<blockquote>
<p>ℹ️ 注意</p>
<p>在代码库中，你可以找到一个名为 <strong>convert_v3_to_v4.py</strong> 的 Python 脚本，可以帮你节省一些时间（感谢用户 <a href="https://github.com/SubaruArai）！">https://github.com/SubaruArai）！</a></p>
</blockquote>
<p>试用它，但请务必先仔细检查转换结果！</p>
<h2 id="_69">类重命名<a class="headerlink" href="#_69" title="Permanent link">&para;</a></h2>
<p>以下类名 / XML 标签名发生了变化。</p>
<table>
<thead>
<tr>
<th>3.8+ 版本名</th>
<th>4.x 版本名</th>
<th>适用范围</th>
</tr>
</thead>
<tbody>
<tr>
<td>NodeConfiguration</td>
<td>NodeConfig</td>
<td>C++</td>
</tr>
<tr>
<td>SequenceStar</td>
<td>SequenceWithMemory</td>
<td>C++ 和 XML</td>
</tr>
<tr>
<td>AsyncActionNode</td>
<td>ThreadedAction</td>
<td>C++</td>
</tr>
<tr>
<td>Optional</td>
<td>Expected</td>
<td>C++</td>
</tr>
</tbody>
</table>
<p>如果你想快速修复 C++ 代码的编译问题（<strong>尽管建议重构</strong>），可以添加：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">BT</span><span class="w"> </span>
<a id="__codelineno-122-2" name="__codelineno-122-2" href="#__codelineno-122-2"></a><span class="p">{</span>
<a id="__codelineno-122-3" name="__codelineno-122-3" href="#__codelineno-122-3"></a><span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">NodeConfiguration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NodeConfig</span><span class="p">;</span>
<a id="__codelineno-122-4" name="__codelineno-122-4" href="#__codelineno-122-4"></a><span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">AsyncActionNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ThreadedAction</span><span class="p">;</span>
<a id="__codelineno-122-5" name="__codelineno-122-5" href="#__codelineno-122-5"></a><span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">Optional</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Expected</span><span class="p">;</span>
<a id="__codelineno-122-6" name="__codelineno-122-6" href="#__codelineno-122-6"></a><span class="p">}</span>
</code></pre></div>
<h2 id="xml_4">XML<a class="headerlink" href="#xml_4" title="Permanent link">&para;</a></h2>
<p>你应当在 XML 的 <code>&lt;root&gt;</code> 标签上添加属性 <code>BTCPP_format</code>：</p>
<p>之前：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a><span class="nt">&lt;root&gt;</span>
</code></pre></div>
<p>现在：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a><span class="nt">&lt;root</span><span class="w"> </span><span class="na">BTCPP_format=</span><span class="s">&quot;4&quot;</span><span class="nt">&gt;</span>
</code></pre></div>
<p>这将允许我们兼容 3 和 4 两个版本……最终实现！</p>
<h2 id="subtree-subtreeplus">SubTree 和 SubTreePlus<a class="headerlink" href="#subtree-subtreeplus" title="Permanent link">&para;</a></h2>
<p>3.X 默认的 <strong>SubTree</strong> 已被弃用，推荐使用 <strong>SubtreePlus</strong>。新版本中，默认的称为 “SubTree”。</p>
<table>
<thead>
<tr>
<th>3.8+ 版本名</th>
<th>4.x 版本名</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;SubTree&gt;</code></td>
<td>已弃用</td>
</tr>
<tr>
<td><code>&lt;SubTreePlus&gt;</code></td>
<td><code>&lt;SubTree&gt;</code></td>
</tr>
</tbody>
</table>
<h2 id="setblackboard-blackboardcheck">SetBlackboard 和 BlackboardCheck<a class="headerlink" href="#setblackboard-blackboardcheck" title="Permanent link">&para;</a></h2>
<p>新的<a href="https://www.behaviortree.dev/docs/guides/scripting">scripting 语言</a>更简单且更强大。</p>
<p>也请查看<a href="https://www.behaviortree.dev/docs/guides/pre_post_conditions">前置条件和后置条件介绍</a>。</p>
<p>3.8 旧代码示例：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a><span class="nt">&lt;SetBlackboard</span><span class="w"> </span><span class="na">output_key=</span><span class="s">&quot;port_A&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;42&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-125-2" name="__codelineno-125-2" href="#__codelineno-125-2"></a><span class="nt">&lt;SetBlackboard</span><span class="w"> </span><span class="na">output_key=</span><span class="s">&quot;port_B&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;69&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-125-3" name="__codelineno-125-3" href="#__codelineno-125-3"></a><span class="nt">&lt;BlackboardCheckInt</span><span class="w"> </span><span class="na">value_A=</span><span class="s">&quot;{port_A}&quot;</span><span class="w"> </span><span class="na">value_B=</span><span class="s">&quot;{port_B}&quot;</span><span class="w"> </span>
<a id="__codelineno-125-4" name="__codelineno-125-4" href="#__codelineno-125-4"></a><span class="w">                    </span><span class="na">return_on_mismatch=</span><span class="s">&quot;FAILURE&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-125-5" name="__codelineno-125-5" href="#__codelineno-125-5"></a><span class="w">    </span><span class="nt">&lt;MyAction/&gt;</span>
<a id="__codelineno-125-6" name="__codelineno-125-6" href="#__codelineno-125-6"></a><span class="nt">&lt;/BlackboardCheckInt&gt;</span>
</code></pre></div>
<p>4.X 新代码示例：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a><span class="nt">&lt;Script</span><span class="w"> </span><span class="na">code=</span><span class="s">&quot;port_A:=42; port_B:=69&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-126-2" name="__codelineno-126-2" href="#__codelineno-126-2"></a><span class="nt">&lt;MyAction</span><span class="w"> </span><span class="na">_failureIf=</span><span class="s">&quot;port_A!=port_B&quot;</span><span class="nt">/&gt;</span>
</code></pre></div>
<h2 id="while-ticking">在 While 循环中执行 Ticking<a class="headerlink" href="#while-ticking" title="Permanent link">&para;</a></h2>
<p>以前的典型执行代码如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a><span class="c1">// 简化代码，常见于 BT.CPP 3.8</span>
<a id="__codelineno-127-2" name="__codelineno-127-2" href="#__codelineno-127-2"></a><span class="k">while</span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">SUCCESS</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NodeStatus</span><span class="o">::</span><span class="n">FAILURE</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-127-3" name="__codelineno-127-3" href="#__codelineno-127-3"></a><span class="p">{</span>
<a id="__codelineno-127-4" name="__codelineno-127-4" href="#__codelineno-127-4"></a><span class="w">  </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tree</span><span class="p">.</span><span class="n">tickRoot</span><span class="p">();</span>
<a id="__codelineno-127-5" name="__codelineno-127-5" href="#__codelineno-127-5"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">sleep_ms</span><span class="p">);</span>
<a id="__codelineno-127-6" name="__codelineno-127-6" href="#__codelineno-127-6"></a><span class="p">}</span>
</code></pre></div>
<p>行为树的“轮询”模型有时受到批评。sleep 是为了避免“忙循环”，但可能引入延迟。</p>
<p>为了提升行为树的响应性，我们引入了方法：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-128-1" name="__codelineno-128-1" href="#__codelineno-128-1"></a><span class="n">Tree</span><span class="o">::</span><span class="n">sleep</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="w"> </span><span class="n">timeout</span><span class="p">)</span>
</code></pre></div>
<p>该实现的 <strong>sleep</strong> 可被树中任意节点调用 <code>TreeNode::emitWakeUpSignal</code> 中断，允许循环 <strong>立即</strong> 重新 tick 树。</p>
<p><code>Tree::tickRoot()</code> 已从公共 API 中移除，推荐的新用法是：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-129-1" name="__codelineno-129-1" href="#__codelineno-129-1"></a><span class="c1">// 使用 Tree::sleep 等待 SUCCESS 或 FAILURE</span>
<a id="__codelineno-129-2" name="__codelineno-129-2" href="#__codelineno-129-2"></a><span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">BT</span><span class="o">::</span><span class="n">isStatusCompleted</span><span class="p">(</span><span class="n">status</span><span class="p">))</span><span class="w"> </span>
<a id="__codelineno-129-3" name="__codelineno-129-3" href="#__codelineno-129-3"></a><span class="p">{</span>
<a id="__codelineno-129-4" name="__codelineno-129-4" href="#__codelineno-129-4"></a><span class="w">  </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tree</span><span class="p">.</span><span class="n">tickOnce</span><span class="p">();</span>
<a id="__codelineno-129-5" name="__codelineno-129-5" href="#__codelineno-129-5"></a><span class="w">  </span><span class="n">tree</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep_ms</span><span class="p">);</span>
<a id="__codelineno-129-6" name="__codelineno-129-6" href="#__codelineno-129-6"></a><span class="p">}</span>
<a id="__codelineno-129-7" name="__codelineno-129-7" href="#__codelineno-129-7"></a><span class="c1">//---- 或者，更佳的用法 ------</span>
<a id="__codelineno-129-8" name="__codelineno-129-8" href="#__codelineno-129-8"></a><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tree</span><span class="p">.</span><span class="n">tickWhileRunning</span><span class="p">(</span><span class="n">sleep_ms</span><span class="p">);</span><span class="w"> </span>
</code></pre></div>
<p><code>Tree::tickWhileRunning</code> 是新默认方法，内部带循环；第一个参数为循环中 sleep 的超时时间。</p>
<p>你也可以使用：</p>
<ul>
<li><code>Tree::tickExactlyOnce()</code>：等同于旧版 3.8+ 行为</li>
<li><code>Tree::tickOnce()</code> 大致相当于 <code>tickWhileRunning(0ms)</code>，可能会 tick 多次。</li>
</ul>
<h2 id="controlnodes-decorators-nodestatusskipped">ControlNodes 和 Decorators 必须支持 NodeStatus\:SKIPPED<a class="headerlink" href="#controlnodes-decorators-nodestatusskipped" title="Permanent link">&para;</a></h2>
<p>新增状态 <strong>SKIPPED</strong> 用于表示 <a href="https://www.behaviortree.dev/docs/guides/pre_post_conditions">PreCondition</a> 不满足时返回。</p>
<p>当节点返回 <strong>SKIPPED</strong>，它向父节点（ControlNode 或 Decorator）表示该节点未执行。</p>
<blockquote>
<p>ℹ️ 注意</p>
<p>自定义 <strong>叶子节点</strong> 不应返回 <strong>SKIPPED</strong>。该状态专用于 PreCondition。</p>
</blockquote>
<p>另一方面，<strong>ControlNodes 和 Decorators</strong> 必须支持此新状态。</p>
<p>一般规则是：若子节点返回 <strong>SKIPPED</strong>，表示未执行，ControlNode 应跳过该子节点，继续下一个。</p>
<h2 id="_70">异步控制节点<a class="headerlink" href="#_70" title="Permanent link">&para;</a></h2>
<p>用户<a href="https://github.com/BehaviorTree/BehaviorTree.CPP/issues/395">反馈</a>发现一个严重问题：</p>
<blockquote>
<p>若一个 <strong>ControlNode</strong> 或 <strong>DecoratorNode</strong> 仅有同步子节点，则无法中断它们。</p>
</blockquote>
<p>示例：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-130-1" name="__codelineno-130-1" href="#__codelineno-130-1"></a><span class="nt">&lt;ReactiveSequence&gt;</span>
<a id="__codelineno-130-2" name="__codelineno-130-2" href="#__codelineno-130-2"></a><span class="w">    </span><span class="nt">&lt;AbortCondition/&gt;</span>
<a id="__codelineno-130-3" name="__codelineno-130-3" href="#__codelineno-130-3"></a><span class="w">    </span><span class="nt">&lt;Sequence</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;synch_sequence&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-130-4" name="__codelineno-130-4" href="#__codelineno-130-4"></a><span class="w">        </span><span class="nt">&lt;SyncActionA/&gt;</span>
<a id="__codelineno-130-5" name="__codelineno-130-5" href="#__codelineno-130-5"></a><span class="w">        </span><span class="nt">&lt;SyncActionB/&gt;</span>
<a id="__codelineno-130-6" name="__codelineno-130-6" href="#__codelineno-130-6"></a><span class="w">        </span><span class="nt">&lt;SyncActionC/&gt;</span>
<a id="__codelineno-130-7" name="__codelineno-130-7" href="#__codelineno-130-7"></a><span class="w">    </span><span class="nt">&lt;Sequence&gt;</span>
<a id="__codelineno-130-8" name="__codelineno-130-8" href="#__codelineno-130-8"></a><span class="nt">&lt;/ReactiveSequence&gt;</span><span class="w">   </span>
</code></pre></div>
<p>当 <code>Sequence</code>（或 <code>Fallback</code>）仅有同步子节点时，整个序列变成“原子操作”。</p>
<p>换言之，当 "synch_sequence" 开始执行时，<code>AbortCondition</code> 无法中止它。</p>
<p>为了解决此问题，我们添加了两个新节点：<code>AsyncSequence</code> 和 <code>AsyncFallback</code>。</p>
<p>使用 <code>AsyncSequence</code> 时，每执行完一个同步子节点后都会返回 <strong>RUNNING</strong>，然后再切换到下一个子节点。</p>
<p>上述示例中，要完成整棵树，需要 3 次 tick。</p>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.path", "navigation.top", "search.suggest", "search.highlight", "content.code.annotate", "content.code.copy", "content.action.view", "navigation.indexes"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>