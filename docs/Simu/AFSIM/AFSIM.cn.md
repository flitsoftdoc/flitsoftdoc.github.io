# AFSIM Overview

*Peter D. Clive, Jeffrey A. Johnson, Michael J. Moss, James M. Zeh, Brian M. Birkmire, and Douglas D. Hodson, "Advanced Framework for Simulation, Integration and Modeling (AFSIM)," in Proceedings from International Conference on Scientific Computing (CSC '15), Las Vegas, July 2015.*


### abstract

高级仿真、集成和建模框架（AFSIM, The Advanced Framework for Simulation, Integration and Modeling ）是由波音公司最初开发，现由空军研究实验室（AFRL）管理的用C++编写的参与和任务级仿真环境。AFSIM是为了解决现有传统仿真环境中的分析能力不足，以及提供一个用更现代的编程范式构建的环境而开发的。AFSIM能够模拟从水下到太空以及多个模型保真度级别的任务。AFSIM环境包括三个软件部分：提供用于定义平台和交互的框架本身，用于场景创建和脚本编写的集成开发环境（IDE），以及一个名为VESPA的可视化工具。AFSIM还提供了一种灵活且易于使用的代理建模架构，采用了行为树和层次任务分配，称为Reactive Integrated Planning aRchitecture (RIPR)。AFSIM目前受到ITAR限制，AFRL只在DoD社群内分发AFSIM。然而，正在进行修改基础架构的工作，以便在多个可发布级别上维护AFSIM版本。

**Index Terms**- Simulation Framework, Mission Level Model, Artificial Intelligence Framework, Agent Framework 

仿真框架、任务级模型、人工智能框架、代理框架

### 1 INTRODUCTION

AFSIM是一种经政府批准的C++模拟框架，用于构建用于作战分析的战术级和任务级分析仿真以及虚拟实验。AFSIM应用的主要目标是评估具有传统参与和任务级模拟中难以评估的先进能力的新系统概念和设计。开发活动包括对武器动力学、传感器系统、电子战系统、通信网络、高级跟踪、相关和融合算法以及自动化战术和作战管理软件建模。

本节介绍了AFSIM开发的原因和历史。下一节概述了AFSIM的架构、集成开发环境、可视化工具以及AFSIM的代理建模体系结构。接下来的部分重点介绍了当前/计划中的努力，以为AFSIM创建一个组件化的架构，这将允许多个可发布级别。最后一节对AFSIM及其当前状态进行了总结。

#### A. Background

AFSIM基于波音公司的网络化系统分析框架(AFNES, Analytic Framework for Network-Enabled Systems)。在合同约定下，波音公司于2013年2月向空军（具体来说是AFRL/RQQD）交付了AFNES，包括源代码在内的无限制使用权。AFRL/RQQD将AFNES重新命名为AFSIM，并已开始在空军和国防部内部分发AFSIM，包括国防部承包商。

波音公司通过内部研究和开发（IR&D）资金，在2003-2014年间开发并资助了AFNES仿真框架。自2005年开始，波音公司开始开发定制化的AFNES能力，用于模拟威胁集成防空系统(IADS, Integrated Air Defense Systems)，以评估执行精确打击任务的先进飞行器概念。这种新的IADS仿真能力的要求包括能够与空军批准的任务级别模型相匹配。开发AFNES替代空军IADS建模能力的原因与空军任务级别模型的限制有关。空军任务级别模型缺乏的领域包括：扩展电子战(EW)技术的表示方法；独立的跟踪和相关系统的集成；利用供应商提供的自动路由器和任务优化能力；以网络为中心的通信系统；太空资产的贡献；以及集成特殊的现有模型，如AGI的System Tool Kit (STK)。

AFNES的IADS功能在2008年开始运行，用于评估先进飞行器设计概念穿透先进防空网络和执行精确打击任务的能力，目前正被多个波音开发项目以及政府合同项目使用，2010年，AFRL/RQQD航空器技术评估与仿真（AVTAS）实验室（前身为AFRL/RBCD）委托进行了一项关于M&S框架的技术选型，目的是评估可能替代或增强其当前建设性仿真环境的潜在替代方案。该研究的结果是选择AFNES作为满足其空中载具任务效能分析需求的最佳M&S框架。。

### 2 AFSIM SOFTWARE SUITE

AFSIM软件套件由三个独立的部分或应用程序组成。第一个部分是框架本身，它提供底层架构和服务，允许创建仿真应用程序。第二个部分是集成开发环境（IDE），用于场景的创建。第三部分是VESPA (Visualization Environment for Scenario, Preparation and Analysis）可视化应用程序，允许后处理和场景执行的可视化。本节提供有关所有三个部分的详细信息。

#### A. Functional Architecture

AFSIM是一个面向对象的C++仿真环境，有助于定制战术和任务级作战仿真的原型设计。AFSIM包括一组软件库，图1中为其功能架构，其中包含常用于创建分析应用程序的例程。AFSIM的基础设施包括用于仿真的顶层控制和管理的例程、仿真中时间和事件的管理、地形数据库的管理、通用数学和坐标变换实用程序、以及支持分布式交互式仿真（DIS）协议等标准仿真接口等。AFSIM组件软件例程支持定义用于在场景部署的实体（平台）。这些软件例程包含了用于定义一系列用户定义的移动体、传感器、武器、用于定义系统行为和信息流的处理器、通信、以及轨迹管理的模型。

<img src="https://cdn.mathpix.com/snip/images/zOFAxjBw692Bb6tmdqLrGFD76VOS6rAifSquK0JevmA.original.fullsize.png" width=500/>

**Fig. 1.** The AFSIM functional architecture. 

AFSIM框架的顶层特征和功能包括：

- 模拟对象的类层次结构，包括数据驱动的平台、移动体、传感器、通信网络、处理器、武器和模拟观察器。
- 用于控制AFSIM基于模型的时间和/或事件处理以及实体数据记录的模拟和事件类。
- 坐标系统（WGS84、球面、ENU、NED）、随机数生成、DIS通信、高层架构（HLA）发布和订阅以及广义软件例程（如用于存储对象和数据的容器类）的标准数学库。
- 通用的地理空间环境和地形表示，导入标准格式，如国家地球空间情报局（NGA）数字地形高程数据（DTED）、ESRI、GeoTiff和VMAP数据库格式。
- 通用的脚本语言，用于通过文本输入文件（即脚本）而非应用程序编程接口（API）访问框架对象。
- 通信网络建模，包括基本无线电收发机和先进的通信算法，包括可寻址节点、路由器、多址协议、争用和排队。
- 电子战建模，包括噪声和欺骗性干扰技术，以及干扰和降低任何类型的电磁接收器，包括通信系统的能力。
- 模拟信息流和任务分配，以定义候选的网络中心化作战（NCO）概念。
- 能够在构造（批处理）和虚拟（实时）模式下运行任何AFSIM应用程序的能力。
- 用于集成场景生成和后处理可视化软件的用户界面元素。

除了AFSIM核心外，还提供了一些功能。其他功能包括：多目标跟踪算法；Link-16的物理和消息层建模；以及用于实现复杂对象行为的反应式集成规划体系（RIPR）智能代理算法。RIPR利用了波音开发的量子任务概念进行指挥官下属互动和任务冲突消解。第3节提供了RIPR模型的其他详细信息。其中导弹飞行模型是受限制分发的。

基础的AFSIM构造型仿真的应用程序称为自主生成实体模拟（SAGE, Simulation of Autonomously Generated Entities），它是使用AFSIM框架开发的最早的构造应用程序之一。SAGE是一个简单的应用程序，它读入用户定义的输入文件，执行模拟，并输出任何用户定义的数据文件。最初SAGE的目的是模拟背景的空中、道路或海上交通。虽然SAGE保留了生成背景交通的能力，但用户可以使用所有可用的AFSIM功能。

#### B. AFSIM IDE

AFSIM 允许用户在单独的文件中创建子系统定义，并以分层的方式包含这些定义来表示。 这使得子系统配置控制和重用成为可能。 在创建包含各种不同复杂系统的场景时，这种灵活性会导致产生大量的子系统定义文件。 VESPA 应用程序有助于创建场景初始条件文件。 但是，它没有解决与定义和集成系统和子系统模型或定义系统级关系（例如使用 ASCII 数据文件的命令链和对等体）相关的问题。 在执行 AFSIM 应用程序之前，不会发现任何输入文件错误。

2011 年初，波音启动了 AFSIM 集成开发环境 (IDE) 的开发，以支持分析师定义和集成系统和子系统模型。 AFSIM的IDE模仿了为软件开发而创建的IDE。 使用软件 IDE，单个应用程序用于编辑文件、编译、链接和运行软件可执行文件，以及查看输出结果或错误消息。 同样，AFSIM IDE 允许分析人员编辑输入文件，执行基于 AFSIM 的应用程序，并可视化输出结果和任何错误消息。 这个迭代过程允许分析师在定义系统和子系统模型以及创建场景时立即收到反馈。

IDE 的当前功能支持输入文件创建，包括支持语法突出显示、自动完成、上下文相关的命令文档和各种场景浏览器。 语法突出显示使分析人员更容易阅读和理解内容。 未知的关键字或命令以红色下划线标出，以便于发现。 未知关键字或命令的示例包括关键字拼写错误或使用超出范围的关键字。 自动完成功能提供了一个建议列表，供分析师根据上下文进行选择。 分析师可以选择其中一项建议，无需手动键入命令即可完成命令。 上下文相关的命令文档允许分析人员调出与命令相关的文档，以说明命令的范围和用途。 其他 IDE 功能可用于帮助分析人员定义系统和子系统模型和场景。 

IDE 可以使用分析师定义的输入文件执行任何基于 AFSIM 的应用程序。 应用程序的任何屏幕输出都与任何错误消息一起显示在 IDE 输出窗口中。 IDE 当前查看仿真结果的功能包括使用在仿真运行期间创建的 AFSIM 回放文件从 IDE 运行 VESPA 应用程序的能力。

#### C. Visual Environment for Scenario Preparation and Analysis (VESPA)

为了支持分析师，波音开发了工具以方便场景生成和后处理数据分析与可视化。具体而言，开发了视觉环境场景准备和分析（VESPA）软件应用程序，以支持创建与任何基于AFSIM的应用程序兼容的场景初始条件文件。此外，VESPA还可用于可视化由任何基于AFSIM的应用程序生成的对象位置时间历史和其他事件信息。这使分析师能够快速理解并分析仿真输出。由于VESPA是一个“DIS侦听器”可视化工具，它还可用于显示任何实时仿真发布的DIS数据的实时实体交互。

VESPA 包括一个图形用户界面 (GUI)，其中包括一个带有地理空间地图的绘图区域和一个数据输入区域，如图 2 所示。

<img src="https://cdn.mathpix.com/snip/images/lOUXf2DRAejpVWb6tNt-44SBYnkLx4p0geZSCo3exLk.original.fullsize.png" width=500/>

**Fig. 2.** The VESPA GUI.

使用 VESPA，分析人员可以在地理空间地图上的特定纬度和经度位置放置代表对象的图标。 然后可以为每个选定的对象分配初始条件。 例如，一架飞机的初始条件可能是它的速度、航向和高度。 还可以创建与对象关联的视觉特征，称为附件。 示例包括路线、作用距离环和区域。

VESPA 可用于使用在 AFSIM 模拟运行期间生成的 AFSIM 重放文件来显示对象位置历史和事件。 AFSIM 回放文件是一个二进制文件，包含 AFSIM 模拟的 DIS 输出。 此外，还可以为模拟期间发生的选定事件生成分析图。

### 3 REACTIVE INTEGRATED PLANNING ARCHITECTURE (RIPR)

反应式综合规划架构 RIPR（REACTIVE INTEGRATED PLANNING ARCHITECTURE）是与AFSIM一同包含的用于启用行为建模的框架。RIPR是基于代理的，这意味着每个代理都根据自己的知识来行动；然而，代理们通常会相互合作和通讯。最好将 RIPR 视为是用于构建智能代理的实用程序和算法的集合。然而，大多数现代的RIPR代理确实包含一个感知处理器和一个量子任务（Quantum Tasker）处理器。代理通过查询平台及其子系统来感知世界，以获取信息。代理在内部构建知识，做出决策，然后通过相应地控制其平台来采取行动。大多数平台查询和控制动作都发生在AFSIM脚本语言内部。RIPR执行的知识构建和决策动作得到了本节中描述的各种人工智能技术的帮助。

#### A. Cognitive Model

RIPR 代理维护自己对威胁、资产和对等体的感知。 这代表智能体的大脑有限，信息可能会延迟或错误。 为了代表不同技能的参与者，每个代理都有自己可调的认知模型。 例如，“专家”飞行员代理可以维护他每 5 秒更新一次（查看雷达）的 16 种威胁的知识。 认知模型的大部分功能都包含在感知处理器中。

#### B. Quantum Tasker

RIPR Quantum Tasker 用于指挥官下属互动和任务冲突消除。 Quantum Tasker 包括任务生成器、任务-资产对评估器、分配算法和各种策略设置（例如如何处理被拒绝的任务分配）。 每个组件（生成器、评估器、分配器）都可以从预定义选项中选择，或在脚本中自定义创建。 RIPR Quantum Tasker 任务分配系统还与使用旧任务管理器（WSF_TASK_MANAGER 和 WSF_TASK_PROCESSOR）的平台兼容。 它可以向/从其他 RIPR 代理和其他任务管理器平台发送和/或接收任务。 图 3 说明了 Quantum Tasker 的各个部分及其连接。

<img src="https://cdn.mathpix.com/snip/images/0Qs3yW-Gkbsv1r40FACucBj_6WqE7V3HS-pY8OSy6Wk.original.fullsize.png" width=200/>

**Fig. 3.** Quantum tasker mode of operation. 

量子任务处理器的操作方法：

- 从认知模型中获取矩阵列中的资产感知。
- 从认知模型中获取威胁感知。
- 生成器为矩阵行生成任务。
- 策略规定如何处理先前分配的任务、被拒绝的任务或新任务。
- 评估器计算矩阵主体中可能的资产-任务对的价值。
- 分配器在任务-资产矩阵上运行，以找到适当的任务分配，例如贪婪、最优等。
- 任务通过通讯分配，进行接受/拒绝的握手操作。

#### C. Behavior Tree

RIPR代理通常使用RIPR行为树来定义它们的行为。行为是一种紧凑的模块化脚本，用于执行某些独特的动作。行为应该是可参数化和可重用的。行为树允许以可设定的方式连接行为，以便它们按照特定的顺序或子集执行。整个树将行为聚合起来，以模拟代理的行为。图4提供了RIPR行为树的示例。

RIPR行为树提供了五种不同的中间连接器节点类型：

- 选择器 - 选择并执行第一个通过其先决条件检查的子行为。
- 序列 - 按顺序执行所有子行为，直到其中一个未通过其先决条件检查。
- 并行 - 执行所有先决条件检查通过的子行为。
- 加权随机 - 从其子行为中进行加权随机选择。
- 优先级选择器 - 选择返回最大先决条件值的子行为。

行为树为开发和编辑代理提供了最大的效用。 正确构造的行为树允许用户快速找到相关脚本，并在适当的地方交换其他行为。 例如：尝试将选择所需航向、高度和速度的行为与实际执行飞行任务的行为分开。 当你发展出一种新的飞行行为时，例如 一个使用新路线查找器的人，您可以将其换成旧路线查找器，同时保持用于计算所需方向的逻辑。

<img src="https://cdn.mathpix.com/snip/images/J0DxB3gb2-j3n5G0r2p2s92SyqJZNscIIUQDiuL6VKA.original.fullsize.png" width=300 />

**Fig. 4.** Example RIPR behavior tree.

####  D. Cluster Manager

一些RIPR代理利用集群管理器对威胁或资产感知进行聚类，以便将这些较大的集合视为较小的群组。例如，指挥官常常会将进来的威胁分成两个群组，以便它可以派遣其两个中队去追击不同的群组。集群管理器可以基于期望的相似性阈值或基于期望的群集数量进行聚类。相似性测量可以基于地面距离、三维距离或三维距离和速度。集群管理器可以使用三种聚类算法之一：

- 分层树最大化（Hierarchical Tree Max）- 默认设置，保证是最优的，没有群集成员在超过阈值后与其他任何成员不相似（该方法提供了更紧密的“经典”成员群）。

- 分层树最小化（Hierarchical Tree Min）- 保证是最优的，没有群集成员在超过阈值后至少与一个其他成员不相似（该方法允许成员之间有长的“细长”链）。

- K-均值（K-Means）- 不保证是最优的，最快，群集围绕K个不同的均值点为中心。

#### E. Example Agent Interaction

以下是一组代理在RIPR架构中交互的示例序列：

1. 指挥官代理从其认知模型（感知处理器）中获取威胁。

2. 指挥官的量子任务生成器将威胁聚集成群组，并为每个群组创建一个任务。

3. 指挥官的量子任务评估器根据每个群组对其中队（资产）进行评分。

4. 指挥官的量子任务分配器找到最优任务分配。

5. 指挥官通过通讯将任务分配给下级飞行队长。

6. 飞行队长在解释任务时使用来自认知模型的资产和威胁感知。

7. 飞行队长代理的量子任务生成器生成、评估、分配并将任务分配给飞行员代理。

8. 飞行员代理使用来自认知模型的同伴和威胁感知。

9. 飞行员代理的行为树检查躲避、解除、即将完成的条件。

10. 飞行员代理的行为树飞行拦截并最终从任务中参与威胁。

11. 飞行员代理使用路径查找器，在朝目标前进期间绕过地对空导弹区域。

### 4. FUTURE WORK

由于国际武器贸易条例（ITAR）的限制，AFSIM框架当前的状态只允许向国防部（DoD）机构和DoD承包商进行分发。空军研究实验室（AFRL）希望能更广泛地传播该框架，以提供更多的建模和仿真协作机会。然而，AFSIM当前的架构并不容易维护多个版本以适应多个发布限制，这就是为什么正在进行架构重构，以创建一个基于组件的架构。

#### A. Component Based Architecture

图5详细描述了AFSIM当前的基础架构。由于AFSIM的基础组件在代码中直接命名，这使得添加或删除基础组件类型变得困难。同时，目前也很难扩展其他非平台组件。

<img src="https://cdn.mathpix.com/snip/images/6BB48S8vxV8krhKd2nzD8AmC81XK1KwkzN-Cmj7o6hs.original.fullsize.png"  width=400/>

**Fig. 5.** Existing AFSIM base level architecture.

为了更好地促进添加和删除基础组件的能力，正在进行工作以创建一个基于组件的架构，该架构依赖于一个底层的通用组件类，所有组件都可以从该类派生。这种架构允许通过命名访问已经存在的组件，并将简化某些组件类型的添加和删除。这个解决方案在最大程度上保留了与原始架构的共性，同时提供了一种维护不包括武器或电子战能力的发布版本以及一个包括这些组件的ITAR版本的方式。新的架构显示在图6中。

<img src="https://cdn.mathpix.com/snip/images/AXBtZLgkS3Ijr96cJ1-DVvdJG-VcAi1i6rK-s_5TE-A.original.fullsize.png" width=400/>

**Fig. 6.** New AFSIM Component Based Architecture.

### 5 CONCLUSION

在本文中，我们提供了对AFSIM仿真环境的高级概述。AFSIM已经由波音公司使用内部研发资金开发了十多年。根据合同，波音公司在2013年2月将AFSIM（包括源代码）以无限制的政府权利的形式交付给了空军（特别是AFRL/RQQD）。AFRL现在已经开始在DoD社群内分发AFSIM。AFSIM的分发包括三个软件部分：框架本身、一个集成开发环境（IDE）以及可视化工具VESPA。尽管AFSIM目前受到ITAR限制，但计划进行未来的工作以修改底层架构，以便维护具有不同可发布性的多个版本。在AFRL的管理下，AFSIM将继续作为有价值的建模和仿真工具而发展。